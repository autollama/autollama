var ve=Object.defineProperty,we=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var le=Object.getOwnPropertySymbols;var ke=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable;var ie=(s,a,i)=>a in s?ve(s,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[a]=i,$=(s,a)=>{for(var i in a||(a={}))ke.call(a,i)&&ie(s,i,a[i]);if(le)for(var i of le(a))Pe.call(a,i)&&ie(s,i,a[i]);return s},L=(s,a)=>we(s,Ce(a));var I=(s,a,i)=>new Promise((u,h)=>{var d=m=>{try{c(i.next(m))}catch(b){h(b)}},r=m=>{try{c(i.throw(m))}catch(b){h(b)}},c=m=>m.done?u(m.value):Promise.resolve(m.value).then(d,r);c((i=i.apply(s,a)).next())});import{u as X,j as e,c as Se}from"./index-220525ce.js";import{r as C}from"./vendor-146ef102.js";import{U as ee,X as se,F as O,I as Te,y as Ue,L as Z,b as ue,A as te,m as re,c as Fe,S as Re,o as Ie,f as _,T as Ee,C as V,z as $e}from"./icons-521df13f.js";import"./utils-d9662bcb.js";const Me=s=>s.includes("pdf")?O:s.includes("image")?Te:Ue,_e=s=>{if(s===0)return"0 Bytes";const a=1024,i=["Bytes","KB","MB","GB"],u=Math.floor(Math.log(s)/Math.log(a));return parseFloat((s/Math.pow(a,u)).toFixed(2))+" "+i[u]},Ae=({onSuccess:s,onError:a})=>{const{api:i,settings:u,updateSetting:h,uploadQueue:d,addToUploadQueue:r,updateUploadStatus:c,removeFromUploadQueue:m,clearCompletedUploads:b}=X(),[v,U]=C.useState(!1),F=C.useRef(null),E=C.useCallback(t=>{t.preventDefault(),t.stopPropagation(),t.type==="dragenter"||t.type==="dragover"?U(!0):t.type==="dragleave"&&U(!1)},[]),A=C.useCallback(t=>{t.preventDefault(),t.stopPropagation(),U(!1),t.dataTransfer.files&&t.dataTransfer.files[0]&&S(Array.from(t.dataTransfer.files))},[]),j=t=>{t.target.files&&t.target.files.length>0&&S(Array.from(t.target.files))},S=t=>{var l;const p=t.filter(o=>w(o)),g=r(p);(l=u==null?void 0:u.processing)!=null&&l.autoStartProcessing&&g.forEach(o=>{z(o)})},w=t=>["application/pdf","text/plain","text/markdown","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/epub+zip","text/csv","application/json"].includes(t.type)&&t.size<=104857600,z=t=>I(void 0,null,function*(){c(t.id,{status:"uploading",progress:0});const p=10*1024*1024;return t.file.size>p?Y(t):W(t)}),W=t=>I(void 0,null,function*(){var g,l;let p=null;try{const o=new FormData;o.append("file",t.file),o.append("enableContextual",u.processing.enableContextualEmbeddings),o.append("source","user");const x=new AbortController;p=setTimeout(()=>x.abort(),18e5),c(t.id,{abortController:x});const f=yield fetch("/api/process-file-stream",{method:"POST",body:o,signal:x.signal});if(!f.ok)throw new Error(`HTTP ${f.status}: ${f.statusText}`);yield Q(f,t)}catch(o){p&&clearTimeout(p);let x="Upload failed";if(o.name==="AbortError"){if(((g=d.find(M=>M.id===t.id))==null?void 0:g.status)==="cancelled")return;x="Upload timeout - file too large or connection too slow"}else o.response?o.response.status===413?x="File too large (max 500MB)":o.response.status===415?x="Unsupported file type":(l=o.response.data)!=null&&l.message?x=o.response.data.message:x=`HTTP ${o.response.status}: ${o.response.statusText||"Upload failed"}`:o.message&&(x=o.message);c(t.id,{status:"error",error:x}),a&&a(t,o)}}),Y=t=>I(void 0,null,function*(){var M;const g=t.file,l=Math.ceil(g.size/2097152);let o=0,x=Date.now(),f=new AbortController;c(t.id,{abortController:f,totalChunks:l,uploadedChunks:0,uploadSpeed:0,estimatedTimeRemaining:0});try{const P=yield fetch("/api/upload/initialize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:g.name,fileSize:g.size,fileType:g.type,totalChunks:l,enableContextual:u.processing.enableContextualEmbeddings,source:"user"}),signal:f.signal});if(!P.ok)throw new Error(`Failed to initialize upload: ${P.status}`);const{uploadId:T,sessionId:R}=yield P.json();c(t.id,{uploadId:T,sessionId:R,status:"uploading",progress:5});for(let B=0;B<l;B++){if(f.signal.aborted)throw new Error("Upload cancelled by user");const ae=B*2097152,me=Math.min(ae+2097152,g.size),xe=g.slice(ae,me),H=new FormData;H.append("chunk",xe),H.append("uploadId",T),H.append("chunkIndex",B.toString()),H.append("totalChunks",l.toString());const he=Date.now(),ne=yield fetch("/api/upload/chunk",{method:"POST",body:H,signal:f.signal});if(!ne.ok)throw new Error(`Chunk upload failed: ${ne.status}`);o++;const ye=Date.now()-he,be=Date.now()-x,oe=o*2097152,ce=oe/(be/1e3),fe=(g.size-oe)/ce,je=5+o/l*85;c(t.id,{uploadedChunks:o,progress:Math.min(je,90),uploadSpeed:Math.round(ce/1024),estimatedTimeRemaining:Math.round(fe),lastChunkTime:ye}),B<l-1&&(yield new Promise(Ne=>setTimeout(Ne,50)))}const q=yield fetch("/api/upload/finalize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uploadId:T,sessionId:R}),signal:f.signal});if(!q.ok)throw new Error(`Failed to finalize upload: ${q.status}`);c(t.id,{status:"processing",progress:95,message:"Upload complete, starting processing..."});const D=yield fetch(`/api/upload/stream/${R}`,{method:"GET",signal:f.signal});if(!D.ok)throw new Error(`Failed to connect to processing stream: ${D.status}`);yield Q(D,t)}catch(P){let T="Upload failed";if(P.name==="AbortError"){if(((M=d.find(q=>q.id===t.id))==null?void 0:M.status)==="cancelled")return;T="Upload cancelled"}else P.message&&(T=P.message);c(t.id,{status:"error",error:T}),a&&a(t,P)}}),Q=(t,p)=>I(void 0,null,function*(){const g=t.body.getReader(),l=new TextDecoder;let o="";try{for(;;){const{done:x,value:f}=yield g.read();if(x)break;o+=l.decode(f,{stream:!0});const M=o.split(`
`);o=M.pop()||"";for(const P of M)if(P.trim()!==""&&P.startsWith("data: "))try{const T=P.slice(6).trim();if(T==="")continue;const R=JSON.parse(T);R&&typeof R=="object"&&n({event:R.event,data:R.data},p)}catch(T){}}if(o.trim()&&o.startsWith("data: "))try{const x=o.slice(6).trim();if(x){const f=JSON.parse(x);f&&typeof f=="object"&&n({event:f.event,data:f.data},p)}}catch(x){}}finally{g.releaseLock()}setTimeout(()=>{const x=d.find(f=>f.id===p.id);x&&x.status==="processing"&&c(p.id,{status:"processing",progress:Math.max(x.progress||0,95)})},1e3)}),n=(t,p)=>{if(!t||typeof t!="object")return;const g=t.event,l=t.data||{};if(g==="error"){const o={id:Date.now().toString(),message:l.message||"Upload failed",error_type:l.error_type||"unknown",recovery_suggestions:l.recovery_suggestions||["Try uploading again"],retry_recommended:l.retry_recommended||!1,severity:l.severity||"high",category:l.category||"processing",retryable:l.retryable||l.retry_recommended||!1,timestamp:new Date().toISOString()};c(p.id,{status:"error",error:o.message,error_type:o.error_type,recovery_suggestions:o.recovery_suggestions,retry_recommended:o.retry_recommended}),a&&a(p,o)}else if(g==="heartbeat_timeout")c(p.id,{status:"stuck",message:l.message||"Processing is taking longer than expected...",time_since_last_update:l.time_since_last_update,progress:l.total_progress||50});else if(g==="heartbeat")c(p.id,{last_heartbeat:l.timestamp,heartbeat_step:l.step});else if(g==="start")c(p.id,{status:"processing",sessionId:l.processingId,progress:5});else if(g==="upload")c(p.id,{status:"uploading",progress:Math.max(l.progress||5,5)});else if(g==="parse")c(p.id,{status:"processing",progress:Math.max(l.progress||40,30)});else if(g==="chunk")c(p.id,{status:"processing",progress:Math.max(l.progress||55,50)});else if(g==="analyze"){const o=l.progress||70,x={status:"processing",progress:Math.max(o,60)};l.chunkData&&(x.processedChunks=l.chunkData.currentChunk||0,x.totalChunks=l.chunkData.totalChunks||0),c(p.id,x)}else if(g==="embedding"){const o=l.progress||85;c(p.id,{status:"processing",progress:Math.max(o,80)})}else if(g==="qdrant")c(p.id,{status:"processing",progress:Math.max(l.progress||92,90)});else if(g==="complete")c(p.id,{status:"completed",progress:100}),s&&s(p,l);else{const o=l.progress||0;o>0&&c(p.id,{status:"processing",progress:Math.min(Math.max(o,5),95)})}},y=t=>{m(t)},N=t=>{z(t)},k=t=>{t.abortController&&(t.abortController.abort(),c(t.id,{status:"cancelled",error:"Upload cancelled by user",abortController:null}))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:`
          relative border-2 border-dashed rounded-xl p-8 text-center transition-all duration-200 cursor-pointer
          ${v?"border-primary-400 bg-primary-600 bg-opacity-10":"border-gray-600 hover:border-gray-500"}
        `,onDragEnter:E,onDragLeave:E,onDragOver:E,onDrop:A,onClick:()=>{var t;(t=F.current)==null||t.click()},children:[e.jsx("input",{ref:F,type:"file",multiple:!0,accept:".pdf,.txt,.md,.doc,.docx,.epub,.csv,.json",onChange:j,className:"hidden"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:`w-16 h-16 mx-auto rounded-full flex items-center justify-center ${v?"bg-primary-500 bg-opacity-20":"bg-gray-700"}`,children:e.jsx(ee,{className:`w-8 h-8 ${v?"text-primary-400":"text-gray-400"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:v?"Drop files here!":"Upload Documents"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Drag and drop files here, or click to browse"}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("p",{children:"Supported: PDF, TXT, MD, DOC, DOCX, EPUB, CSV, JSON"}),e.jsx("p",{children:"Maximum size: 100MB per file"}),e.jsx("p",{className:"text-xs mt-1",children:"Large files (>10MB) use chunked upload with progress tracking"})]})]}),e.jsxs("button",{className:"btn-primary",children:[e.jsx(ee,{className:"w-4 h-4"}),"Choose Files"]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-4",children:"Processing Options"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:u.processing.enableContextualEmbeddings,onChange:t=>h("processing","enableContextualEmbeddings",t.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Enable Contextual Embeddings"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:u.processing.autoStartProcessing||!1,onChange:t=>h("processing","autoStartProcessing",t.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Auto-start Processing"})]})]})]}),d.length>0&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-bold",children:"Upload Queue"}),e.jsxs("div",{className:"text-sm text-gray-400",children:[d.length," file",d.length!==1?"s":""]})]}),e.jsx("div",{className:"space-y-3",children:d.map(t=>e.jsx(Le,{fileData:t,onRemove:()=>y(t.id),onRetry:()=>N(t),onUpload:()=>z(t),onStop:()=>k(t)},t.id))})]}),d.length>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(K,{title:"Total Files",value:d.length,color:"text-blue-400"}),e.jsx(K,{title:"Completed",value:d.filter(t=>t.status==="completed").length,color:"text-green-400"}),e.jsx(K,{title:"Processing",value:d.filter(t=>t.status==="processing"||t.status==="uploading").length,color:"text-yellow-400"}),e.jsx(K,{title:"Failed",value:d.filter(t=>t.status==="error"||t.status==="cancelled").length,color:"text-red-400"})]})]})},Le=({fileData:s,onRemove:a,onRetry:i,onUpload:u,onStop:h})=>{const d=Me(s.type),r={pending:{color:"text-gray-400",bg:"bg-gray-600",icon:O,action:"Upload"},uploading:{color:"text-blue-400",bg:"bg-blue-600",icon:Z,action:"Uploading..."},processing:{color:"text-yellow-400",bg:"bg-yellow-600",icon:Z,action:"Processing..."},completed:{color:"text-green-400",bg:"bg-green-600",icon:ue,action:"Completed"},error:{color:"text-red-400",bg:"bg-red-600",icon:te,action:"Failed"},cancelled:{color:"text-orange-400",bg:"bg-orange-600",icon:se,action:"Cancelled"}},c=r[s.status]||r.pending,m=c.icon;return e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(d,{className:"w-5 h-5 text-primary-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-white truncate",children:s.name}),e.jsx("span",{className:"text-xs text-gray-500",children:_e(s.size)})]}),(s.status==="uploading"||s.status==="processing")&&e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2 mb-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${c.bg}`,style:{width:`${s.progress||0}%`}})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(m,{className:`w-4 h-4 ${c.color} ${s.status==="uploading"||s.status==="processing"?"animate-spin":""}`}),e.jsx("span",{className:c.color,children:c.action}),s.progress>0&&s.status!=="completed"&&e.jsxs("span",{className:"text-gray-400",children:["(",Math.round(s.progress),"%)"]})]}),s.status==="uploading"&&s.totalChunks&&e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500 mt-1",children:[e.jsxs("span",{children:[s.uploadedChunks||0,"/",s.totalChunks," chunks"]}),s.uploadSpeed>0&&e.jsxs("span",{children:[s.uploadSpeed," KB/s"]}),s.estimatedTimeRemaining>0&&e.jsxs("span",{children:["~",Math.ceil(s.estimatedTimeRemaining/1e3),"s remaining"]})]}),s.error&&e.jsx("div",{className:"text-sm text-red-400 mt-1",children:s.error})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="pending"&&e.jsx("button",{onClick:u,className:"btn-primary text-sm",children:"Upload"}),(s.status==="uploading"||s.status==="processing")&&e.jsx("button",{onClick:h,className:"btn-secondary text-sm bg-red-600 hover:bg-red-700 text-white",title:"Stop upload",children:"Stop"}),s.status==="error"&&e.jsx("button",{onClick:i,className:"btn-secondary text-sm",children:"Retry"}),s.status==="cancelled"&&e.jsx("button",{onClick:i,className:"btn-secondary text-sm",children:"Retry"}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-700 rounded transition-colors",title:"Remove",children:e.jsx(se,{className:"w-4 h-4 text-gray-400"})})]})]})},K=({title:s,value:a,color:i})=>e.jsxs("div",{className:"text-center p-4 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700",children:[e.jsx("div",{className:`text-2xl font-bold ${i}`,children:a}),e.jsx("div",{className:"text-sm text-gray-400",children:s})]}),de=Ae,ze=({onSuccess:s,onError:a})=>{const{api:i,settings:u,updateSetting:h}=X(),[d,r]=C.useState(""),[c,m]=C.useState(!1),[b,v]=C.useState([]),[U,F]=C.useState(""),E=C.useRef(null),A=Se("process-url-stream",{onMessage:n=>{w(n)},autoConnect:!1}),j=n=>{try{const y=new URL(n);return y.protocol==="http:"||y.protocol==="https:"}catch(y){return!1}},S=()=>I(void 0,null,function*(){if(!d.trim()){F("Please enter a URL");return}if(!j(d)){F("Please enter a valid HTTP/HTTPS URL");return}F(""),m(!0);const n={id:Y(),url:d.trim(),status:"processing",progress:0,startTime:new Date,sessionId:null,error:null};v(y=>[n,...y]);try{A.connect();const y=yield i.processing.processUrlStream({url:d.trim(),enableContextual:u.processing.enableContextualEmbeddings,source:"user"});v(N=>N.map(k=>k.id===n.id?L($({},k),{sessionId:y.sessionId}):k)),s&&s({url:d.trim(),sessionId:y.sessionId}),r("")}catch(y){v(N=>N.map(k=>k.id===n.id?L($({},k),{status:"error",error:y.message||"Processing failed",endTime:new Date}):k)),a&&a({url:d.trim()},y)}finally{m(!1)}}),w=n=>{try{if(!n||typeof n!="object")return;n.type==="progress"&&n.sessionId&&v(y=>y.map(N=>{var k;return N.sessionId===n.sessionId?L($({},N),{status:n.status||N.status,progress:((k=n.progress)==null?void 0:k.percentage)||N.progress,error:n.error||N.error,endTime:n.status==="completed"||n.status==="error"?new Date:N.endTime}):N}))}catch(y){}},z=n=>{v(y=>y.filter(N=>N.id!==n))},W=n=>{var y;r(n.url),(y=E.current)==null||y.focus()},Y=()=>Math.random().toString(36).substr(2,9),Q=n=>{n.key==="Enter"&&!c&&S()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"font-bold mb-4 flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-primary-400"}),"Process URL"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"relative",children:[e.jsx(Fe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{ref:E,type:"url",placeholder:"https://example.com/article",value:d,onChange:n=>{r(n.target.value),F("")},onKeyPress:Q,className:`input-primary pl-10 ${U?"border-red-500":""}`,disabled:c})]}),U&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-red-400 text-sm",children:[e.jsx(te,{className:"w-4 h-4"}),U]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:u.processing.enableContextualEmbeddings,onChange:n=>h("processing","enableContextualEmbeddings",n.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{children:"Enable Contextual Embeddings"})]})}),e.jsx("button",{onClick:S,disabled:c||!d.trim(),className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:c?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-4 h-4 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4"}),"Process URL"]})})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Quick Start Templates"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[{label:"GitHub Repository",template:"https://github.com/",icon:"ðŸ”§"},{label:"Research Paper",template:"https://arxiv.org/",icon:"ðŸ“„"},{label:"Documentation",template:"https://docs.",icon:"ðŸ“š"},{label:"Blog Article",template:"https://",icon:"âœï¸"}].map((n,y)=>e.jsxs("button",{onClick:()=>r(n.template),className:"flex items-center gap-3 p-3 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700 hover:border-gray-600 transition-colors text-left",children:[e.jsx("span",{className:"text-xl",children:n.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:n.label}),e.jsx("div",{className:"text-xs text-gray-400",children:n.template})]})]},y))})]}),b.length>0&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-bold",children:"Processing History"}),e.jsxs("div",{className:"text-sm text-gray-400",children:[b.length," item",b.length!==1?"s":""]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto custom-scrollbar",children:b.map(n=>e.jsx(Be,{item:n,onRemove:()=>z(n.id),onRetry:()=>W(n)},n.id))})]}),b.length>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(G,{title:"Total URLs",value:b.length,color:"text-blue-400"}),e.jsx(G,{title:"Completed",value:b.filter(n=>n.status==="completed").length,color:"text-green-400"}),e.jsx(G,{title:"Processing",value:b.filter(n=>n.status==="processing").length,color:"text-yellow-400"}),e.jsx(G,{title:"Failed",value:b.filter(n=>n.status==="error").length,color:"text-red-400"})]})]})},Be=({item:s,onRemove:a,onRetry:i})=>{const u={processing:{color:"text-yellow-400",bg:"bg-yellow-600",icon:Z,action:"Processing..."},completed:{color:"text-green-400",bg:"bg-green-600",icon:ue,action:"Completed"},error:{color:"text-red-400",bg:"bg-red-600",icon:te,action:"Failed"}},h=u[s.status]||u.processing,d=h.icon,r=(c,m)=>m?`${Math.round((m-c)/1e3)}s`:"In progress...";return e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(re,{className:"w-5 h-5 text-primary-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-white truncate",children:s.url}),e.jsx("button",{onClick:()=>window.open(s.url,"_blank"),className:"p-1 hover:bg-gray-700 rounded transition-colors",title:"Open URL",children:e.jsx(Ie,{className:"w-3 h-3 text-gray-400"})})]}),s.status==="processing"&&e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2 mb-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${h.bg}`,style:{width:`${s.progress||0}%`}})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(d,{className:`w-4 h-4 ${h.color} ${s.status==="processing"?"animate-spin":""}`}),e.jsx("span",{className:h.color,children:h.action}),s.progress>0&&s.status==="processing"&&e.jsxs("span",{className:"text-gray-400",children:["(",Math.round(s.progress),"%)"]}),e.jsx("span",{className:"text-gray-500",children:r(s.startTime,s.endTime)})]}),s.error&&e.jsx("div",{className:"text-sm text-red-400 mt-1",children:s.error})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="error"&&e.jsx("button",{onClick:i,className:"btn-secondary text-sm",children:"Retry"}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-700 rounded transition-colors",title:"Remove",children:e.jsx(se,{className:"w-4 h-4 text-gray-400"})})]})]})},G=({title:s,value:a,color:i})=>e.jsxs("div",{className:"text-center p-4 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700",children:[e.jsx("div",{className:`text-2xl font-bold ${i}`,children:a}),e.jsx("div",{className:"text-sm text-gray-400",children:s})]}),pe=ze,He=()=>{var A;const{api:s,documents:a,systemStats:i,refreshDocuments:u}=X(),[h,d]=C.useState("files"),[r,c]=C.useState([]),[m,b]=C.useState({totalProcessed:0,successfulProcessing:0,failedProcessing:0,averageTime:0});C.useEffect(()=>{v();const j=setInterval(v,5e3);return()=>clearInterval(j)},[]);const v=()=>I(void 0,null,function*(){try{const[j,S]=yield Promise.all([s.processing.getQueue(),s.processing.getStats()]);c(j||[]),b(w=>$($({},w),S))}catch(j){}}),U=(j,S)=>I(void 0,null,function*(){setTimeout(()=>{u()},1e3),b(w=>L($({},w),{totalProcessed:w.totalProcessed+1}))}),F=(j,S)=>{b(w=>L($({},w),{totalProcessed:w.totalProcessed+1,failedProcessing:w.failedProcessing+1}))},E=[{id:"files",label:"File Upload",icon:ee,description:"Upload and process documents",component:de},{id:"urls",label:"URL Processing",icon:re,description:"Process content from URLs",component:pe},{id:"queue",label:"Processing Queue",icon:_,description:"Monitor processing status",component:ge}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(J,{title:"Total Documents",value:((A=i.knowledgeBase)==null?void 0:A.total_documents)||0,icon:O,color:"text-blue-400",change:"+12 today"}),e.jsx(J,{title:"Processing Queue",value:r.length,icon:_,color:"text-yellow-400",change:r.length>0?`${r.filter(j=>j.status==="processing").length} active`:"Empty"}),e.jsx(J,{title:"Success Rate",value:`${m.totalProcessed>0?Math.round((m.totalProcessed-m.failedProcessing)/m.totalProcessed*100):100}%`,icon:Ee,color:"text-green-400",change:`${m.failedProcessing} failed`}),e.jsx(J,{title:"Avg Processing Time",value:`${m.averageTime||45}s`,icon:V,color:"text-purple-400",change:"Per document"})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"flex items-center gap-2 mb-6 bg-gray-800 bg-opacity-50 rounded-lg p-1",children:E.map(j=>{const S=j.icon,w=h===j.id;return e.jsxs("button",{onClick:()=>d(j.id),className:`flex items-center gap-2 px-4 py-3 rounded-md text-sm font-medium transition-all duration-200 flex-1 ${w?"bg-primary-600 text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:[e.jsx(S,{className:"w-4 h-4"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{children:j.label}),e.jsx("div",{className:"text-xs opacity-75",children:j.description})]})]},j.id)})}),e.jsxs("div",{className:"min-h-[500px]",children:[h==="files"&&e.jsx(de,{onSuccess:U,onError:F}),h==="urls"&&e.jsx(pe,{onSuccess:U,onError:F}),h==="queue"&&e.jsx(ge,{queue:r,onRefresh:v})]})]}),e.jsx(Oe,{documents:(a==null?void 0:a.slice(0,5))||[]})]})},ge=({queue:s,onRefresh:a})=>{const{api:i}=X(),u=(r,c)=>I(void 0,null,function*(){try{yield i.processing.stopProcessing(r),a&&a()}catch(m){alert("Failed to stop processing session. Please try again.")}}),h=r=>{switch(r){case"queued":return"text-gray-400";case"processing":return"text-yellow-400";case"completed":return"text-green-400";case"error":return"text-red-400";default:return"text-gray-400"}},d=r=>{switch(r){case"queued":return V;case"processing":return _;case"completed":return O;case"error":return _;default:return V}};return s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_,{className:"w-16 h-16 text-gray-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"No Active Processing"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Upload files or process URLs to see them appear in the queue."}),e.jsxs("button",{onClick:a,className:"btn-primary",children:[e.jsx(_,{className:"w-4 h-4"}),"Refresh Queue"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Active Processing Queue"}),e.jsxs("button",{onClick:a,className:"btn-secondary text-sm",children:[e.jsx(_,{className:"w-4 h-4"}),"Refresh"]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto custom-scrollbar",children:s.map((r,c)=>{const m=d(r.status),b=h(r.status);return e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(m,{className:`w-5 h-5 ${b} ${r.status==="processing"?"animate-spin":""}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-white truncate",children:r.title||r.url||r.filename||"Unknown Item"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[r.completedChunks||0," / ",r.totalChunks||0," chunks"]})]}),r.status==="processing"&&r.progress&&e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2 mb-2",children:e.jsx("div",{className:"h-2 bg-yellow-500 rounded-full transition-all duration-300",style:{width:`${r.progress||0}%`}})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:b,children:r.status==="processing"?"Processing...":r.status==="completed"?"Completed":r.status==="error"?"Failed":"Queued"}),r.progress&&e.jsxs("span",{className:"text-gray-400",children:["(",Math.round(r.progress),"%)"]}),r.estimatedTime&&e.jsxs("span",{className:"text-gray-500",children:["â€¢ ~",r.estimatedTime,"s remaining"]})]}),r.error&&e.jsx("div",{className:"text-sm text-red-400 mt-1",children:r.error})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:r.startedAt||r.createdAt?new Date(r.startedAt||r.createdAt).toLocaleTimeString():"Pending"}),(r.status==="processing"||r.status==="queued")&&r.id&&e.jsxs("button",{onClick:()=>u(r.id,r.title||r.filename||"Unknown Item"),className:"px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-white text-sm font-medium flex items-center gap-1 min-w-fit",title:"Stop processing",children:[e.jsx($e,{className:"w-4 h-4"}),"Stop"]})]})]},r.id||c)})})]})},Oe=({documents:s})=>!s||s.length===0?null:e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"font-bold mb-4 flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5 text-primary-400"}),"Recent Activity"]}),e.jsx("div",{className:"space-y-3",children:s.map((a,i)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-800 bg-opacity-30 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(O,{className:"w-4 h-4 text-primary-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-white truncate",children:a.title||a.url||"Untitled Document"}),e.jsxs("div",{className:"text-sm text-gray-400",children:[a.chunkCount||0," chunks â€¢ ",a.contentType||"document"]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:a.processedAt?new Date(a.processedAt).toLocaleDateString():"Recently"})]},a.id||i))})]}),J=({title:s,value:a,icon:i,color:u,change:h})=>e.jsxs("div",{className:"card text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(i,{className:`w-6 h-6 ${u}`})}),e.jsx("div",{className:`text-2xl font-bold ${u} mb-1`,children:a}),e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:s}),h&&e.jsx("div",{className:"text-xs text-gray-500",children:h})]}),Ve=He;export{de as FileUploader,Ve as ProcessingManager,pe as URLProcessor,Ve as default};
