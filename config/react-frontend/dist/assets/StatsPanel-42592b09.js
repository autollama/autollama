var De=Object.defineProperty,Ie=Object.defineProperties;var He=Object.getOwnPropertyDescriptors;var ve=Object.getOwnPropertySymbols;var Te=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable;var Ne=(t,s,a)=>s in t?De(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,D=(t,s)=>{for(var a in s||(s={}))Te.call(s,a)&&Ne(t,a,s[a]);if(ve)for(var a of ve(s))Le.call(s,a)&&Ne(t,a,s[a]);return t},I=(t,s)=>Ie(t,He(s));var S=(t,s,a)=>new Promise((l,n)=>{var d=r=>{try{o(a.next(r))}catch(g){n(g)}},i=r=>{try{o(a.throw(r))}catch(g){n(g)}},o=r=>r.done?l(r.value):Promise.resolve(r.value).then(d,i);o((a=a.apply(t,s)).next())});import{j as e,u as Ue}from"./index-220525ce.js";import{r as y}from"./vendor-146ef102.js";import{R as A,a1 as ke,u as Ce,f as U,X as Ae,a as Se,E as R,D as $e,S as we,Z as Re,a0 as H,g as qe,a2 as Ee,b as Pe,A as Oe,T as Qe}from"./icons-521df13f.js";import"./utils-d9662bcb.js";const $=({title:t,value:s,icon:a,description:l,status:n,badge:d,onClick:i,loading:o=!1,className:r=""})=>{const g=()=>n==="error"?"border-red-500 text-red-400":n==="warning"?"border-yellow-500 text-yellow-400":n==="success"?"border-green-500 text-green-400":n==="active"?"border-blue-500 text-blue-400":"border-gray-500 text-gray-400",j=!!i;return e.jsxs("div",{className:`
        p-4 rounded-lg border-2 transition-all duration-200 relative
        ${g()}
        ${j?"cursor-pointer hover:bg-gray-800 hover:bg-opacity-30":""}
        ${o?"opacity-75":""}
        ${r}
      `,onClick:j&&!o?i:void 0,children:[o&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900 bg-opacity-50 rounded-lg",children:e.jsx(A,{className:"w-6 h-6 animate-spin text-primary-400"})}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(a,{className:"w-5 h-5"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg font-bold",children:s}),d&&e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-red-600 text-red-200 font-bold",children:d})]})]}),e.jsx("div",{className:"text-sm font-medium mb-1",children:t}),e.jsx("div",{className:"text-xs opacity-80",children:l})]})},q=({children:t,onClick:s,variant:a="secondary",size:l="md",loading:n=!1,disabled:d=!1,className:i=""})=>{const o="flex items-center gap-2 font-medium transition-all duration-200 rounded-lg",r={primary:"bg-primary-600 hover:bg-primary-700 text-white",secondary:"bg-gray-700 hover:bg-gray-600 text-gray-200",danger:"bg-red-600 hover:bg-red-700 text-white",success:"bg-green-600 hover:bg-green-700 text-white",warning:"bg-yellow-600 hover:bg-yellow-700 text-white"},g={sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"};return e.jsxs("button",{onClick:s,disabled:d||n,className:`
        ${o}
        ${r[a]}
        ${g[l]}
        ${d||n?"opacity-50 cursor-not-allowed":""}
        ${i}
      `,children:[n&&e.jsx(A,{className:"w-4 h-4 animate-spin"}),t]})},ze=({memoryData:t,onClick:s})=>{if(!t)return null;const a=t.current||t,l=r=>typeof r=="string"&&r.includes("MB")?parseFloat(r.replace("MB","")):Math.round(r/1024/1024),n=l(a.heapUsed||0),d=l(a.heapTotal||0),i=d>0?Math.round(n/d*100):0,o=()=>i>90?"error":i>75?"warning":"success";return e.jsx($,{title:"Memory Usage",value:`${i}%`,icon:ke,description:`${n}MB used`,status:o(),onClick:s})},Je=({lastCleanup:t,recommendationsCount:s,onCleanup:a})=>{const l=n=>{if(!n)return"Never";const d=Date.now()-new Date(n).getTime(),i=Math.floor(d/6e4),o=Math.floor(i/60),r=Math.floor(o/24);return r>0?`${r}d ago`:o>0?`${o}h ago`:i>0?`${i}m ago`:"Just now"};return e.jsx($,{title:"Last Cleanup",value:l(t),icon:Ce,description:s>0?`${s} issues found`:"System clean",status:s>0?"warning":"success",badge:s>0?s:null,onClick:a})},Ve=({healthData:t,onDetails:s})=>{var o,r;if(!t)return null;const a=t.healthScore||((o=t.health)==null?void 0:o.percentage)||0,l=t.status||((r=t.health)==null?void 0:r.overall)||"unknown",n=()=>a>=90?"success":a>=70?"warning":"error",i=(()=>{if(!t.recommendations||t.recommendations.length===0)return 0;const g=["Memory usage appears normal","System running smoothly","All services healthy","Performance is optimal","No issues detected"];return t.recommendations.filter(u=>!g.some(M=>u.toLowerCase().includes(M.toLowerCase()))).length})();return e.jsx($,{title:"System Health",value:`${a}/100`,icon:U,description:l.toUpperCase(),status:n(),badge:i>0?i:null,onClick:s})},Ze=({isOpen:t,onClose:s,onConfirm:a,title:l,message:n,confirmText:d="Confirm",confirmVariant:i="danger",loading:o=!1})=>t?e.jsx("div",{className:"modal-overlay",onClick:r=>r.target===r.currentTarget&&s(),children:e.jsxs("div",{className:"modal-content max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold",children:l}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white",children:e.jsx(Ae,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-gray-300 mb-6",children:n}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(q,{onClick:s,variant:"secondary",disabled:o,children:"Cancel"}),e.jsx(q,{onClick:a,variant:i,loading:o,children:d})]})]})]})}):null,Fe=({isOpen:t,onClose:s,title:a,progress:l,message:n,canCancel:d=!1})=>t?e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content max-w-md",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold",children:a}),d&&e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-white",children:e.jsx(Ae,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{children:n}),e.jsxs("span",{children:[l,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-primary-600 h-2 rounded-full transition-all duration-300",style:{width:`${l}%`}})})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(A,{className:"w-6 h-6 animate-spin text-primary-400"})})]})]})}):null,Ke=({title:t,children:s,collapsible:a=!1,defaultExpanded:l=!0})=>{const[n,d]=y.useState(l);return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:`flex items-center justify-between mb-6 ${a?"cursor-pointer":""}`,onClick:a?()=>d(!n):void 0,children:[e.jsxs("h4",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5 text-primary-400"}),t]}),a&&e.jsx("button",{className:"text-gray-400 hover:text-white",children:n?e.jsx(R,{className:"w-4 h-4"}):e.jsx(Se,{className:"w-4 h-4"})})]}),(!a||n)&&e.jsx("div",{className:"space-y-4",children:s})]})},Xe=({actions:t=[]})=>e.jsx("div",{className:"flex flex-wrap gap-3",children:t.map((s,a)=>e.jsxs(q,{onClick:s.onClick,variant:s.variant||"secondary",loading:s.loading,disabled:s.disabled,className:"flex-1 min-w-[140px]",children:[s.icon&&e.jsx(s.icon,{className:"w-4 h-4"}),s.label,s.badge&&e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-red-600 text-red-200 font-bold ml-1",children:s.badge})]},a))}),ns=()=>{var O,Q,z,J,V,Z,F,K,X,G,W,Y,ee,se,te,ae,ne,le,re,ce;const{api:t,systemStats:s,sse:a,loadSystemStats:l}=Ue(),[n,d]=y.useState({}),[i,o]=y.useState(!1),[r,g]=y.useState(!1),j=c=>{if(!c||c.length===0)return 0;const x=["Memory usage appears normal","System running smoothly","All services healthy","Performance is optimal","No issues detected"];return c.filter(C=>!x.some(f=>C.toLowerCase().includes(f.toLowerCase()))).length},[u,M]=y.useState({stuckSessions:{stuck_count:0},systemHealth:null,cleanupStatus:null,sessionStats:null}),[v,E]=y.useState({}),[h,B]=y.useState(null),[p,Me]=y.useState(null);y.useEffect(()=>{_(),N();const c=setInterval(()=>{_(),N()},3e4);return()=>clearInterval(c)},[]);const _=()=>S(void 0,null,function*(){try{const[c,x,b]=yield Promise.all([t.stats.getBM25Health().catch(()=>({status:"offline"})),t.stats.getBM25Stats().catch(()=>({total_indices:0})),t.stats.getQdrantActivity().catch(()=>({totalSearches:0}))]);d({bm25:{health:c,stats:x},qdrant:b,lastUpdated:new Date})}catch(c){}}),N=()=>S(void 0,null,function*(){try{const[c,x,b]=yield Promise.all([t.admin.checkStuckSessions().catch(()=>({stuck_count:0})),t.admin.getSystemHealth().catch(()=>null),t.admin.getCleanupStatus().catch(()=>null)]);M({stuckSessions:c,systemHealth:x,cleanupStatus:b,lastUpdated:new Date})}catch(c){}}),Be=()=>S(void 0,null,function*(){g(!0);try{yield Promise.all([l(),_(),N()])}finally{g(!1)}}),k=c=>{B({type:c,title:c==="stuck"?"Clean Stuck Sessions":"Safe System Cleanup",message:c==="stuck"?`This will clean ${u.stuckSessions.stuck_count} stuck sessions. Continue?`:"This will perform a safe cleanup of timeout sessions and system optimization. Continue?",confirmText:"Start Cleanup"})},_e=c=>S(void 0,null,function*(){E(x=>I(D({},x),{[c]:!0})),B(null);try{let x;c==="stuck"?x=yield t.admin.cleanupStuckSessions({dryRun:!1}):x=yield t.admin.cleanupSessions({dryRun:!1}),yield N(),yield l()}catch(x){}finally{E(x=>I(D({},x),{[c]:!1}))}}),P=()=>{},m=(()=>{var ie,oe,de,ue,me,xe,he,ge,pe,ye,be,fe,je;const c=u.systemHealth,x={database:((oe=(ie=c==null?void 0:c.services)==null?void 0:ie.postgresql)==null?void 0:oe.status)==="healthy"||((de=s.database)==null?void 0:de.status)==="connected",qdrant:((me=(ue=c==null?void 0:c.services)==null?void 0:ue.qdrant)==null?void 0:me.status)==="healthy"||((xe=s.knowledgeBase)==null?void 0:xe.qdrant_status)==="active",bm25:((ge=(he=c==null?void 0:c.services)==null?void 0:he.bm25)==null?void 0:ge.status)==="healthy"||((ye=(pe=n.bm25)==null?void 0:pe.health)==null?void 0:ye.status)==="healthy",api:((be=s.health)==null?void 0:be.status)==="connected"||!0,sessions:(((fe=u.stuckSessions)==null?void 0:fe.stuck_count)||0)===0},b=Object.values(x).filter(Boolean).length,C=Object.values(x).length,f=Math.round(b/C*100);return{percentage:f,healthy:b,total:C,status:f===100?"excellent":f>=75?"good":f>=50?"fair":"poor",checks:x,sessionIssues:((je=u.stuckSessions)==null?void 0:je.stuck_count)||0}})();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${m.status==="excellent"?"bg-green-600 bg-opacity-20":m.status==="good"?"bg-blue-600 bg-opacity-20":m.status==="fair"?"bg-yellow-600 bg-opacity-20":"bg-red-600 bg-opacity-20"}`,children:e.jsx(U,{className:`w-5 h-5 ${m.status==="excellent"?"text-green-400":m.status==="good"?"text-blue-400":m.status==="fair"?"text-yellow-400":"text-red-400"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"System Health"}),e.jsxs("p",{className:"text-sm text-gray-400",children:[m.healthy,"/",m.total," services operational"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:`text-2xl font-bold ${m.status==="excellent"?"text-green-400":m.status==="good"?"text-blue-400":m.status==="fair"?"text-yellow-400":"text-red-400"}`,children:[m.percentage,"%"]}),e.jsx("button",{onClick:Be,disabled:r,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",title:"Refresh Stats",children:e.jsx(A,{className:`w-4 h-4 text-gray-400 ${r?"animate-spin":""}`})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(w,{icon:$e,label:"PostgreSQL",status:m.checks.database,details:((O=s.database)==null?void 0:O.version)||"Unknown"}),e.jsx(w,{icon:we,label:"Qdrant",status:m.checks.qdrant,details:((Q=s.knowledgeBase)==null?void 0:Q.total_documents)||0}),e.jsx(w,{icon:Re,label:"BM25 Search",status:m.checks.bm25,details:((J=(z=n.bm25)==null?void 0:z.stats)==null?void 0:J.total_indices)||0}),e.jsx(w,{icon:U,label:"API Service",status:m.checks.api,details:"Operational"}),e.jsx(w,{icon:H,label:"Session Health",status:m.checks.sessions,details:m.sessionIssues>0?`${m.sessionIssues} stuck`:"Healthy"})]})]}),e.jsxs(Ke,{title:"Session Management & System Control",collapsible:!0,defaultExpanded:!1,children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx($,{title:"Stuck Sessions",value:((V=u.stuckSessions)==null?void 0:V.stuck_count)||0,icon:H,description:"Sessions without heartbeat",status:((Z=u.stuckSessions)==null?void 0:Z.stuck_count)>0?"warning":"success",badge:((F=u.stuckSessions)==null?void 0:F.stuck_count)>0?u.stuckSessions.stuck_count:null,onClick:()=>k("stuck"),loading:v.stuck}),((K=u.systemHealth)==null?void 0:K.memory)&&e.jsx(ze,{memoryData:u.systemHealth.memory,onClick:P}),u.systemHealth&&e.jsx(Ve,{healthData:u.systemHealth,onDetails:()=>{}}),e.jsx(Je,{lastCleanup:(X=u.cleanupStatus)==null?void 0:X.timestamp,recommendationsCount:j((G=u.systemHealth)==null?void 0:G.recommendations),onCleanup:()=>k("safe")})]}),e.jsx(Xe,{actions:[{label:"Check Sessions",icon:R,onClick:()=>N(),loading:v.check},{label:"Safe Cleanup",icon:Ce,onClick:()=>k("safe"),variant:"warning",loading:v.safe},{label:"Clean Stuck",icon:H,onClick:()=>k("stuck"),variant:"danger",loading:v.stuck,badge:((W=u.stuckSessions)==null?void 0:W.stuck_count)>0?u.stuckSessions.stuck_count:null,disabled:((Y=u.stuckSessions)==null?void 0:Y.stuck_count)===0},{label:"Memory Analysis",icon:ke,onClick:P,variant:"secondary"}]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(T,{icon:qe,title:"Knowledge Base",value:((ee=s.knowledgeBase)==null?void 0:ee.total_documents)||0,label:"documents processed",trend:"+12%",trendDirection:"up",details:[{label:"Total Chunks",value:((se=s.knowledgeBase)==null?void 0:se.total_chunks)||0},{label:"Avg. Processing Time",value:"2.3s"},{label:"Storage Used",value:((te=s.database)==null?void 0:te.size)||"Unknown"}]}),e.jsx(T,{icon:we,title:"Search Activity",value:((ae=n.qdrant)==null?void 0:ae.totalSearches)||0,label:"total searches",trend:"+5%",trendDirection:"up",details:[{label:"Avg. Response Time",value:"145ms"},{label:"BM25 Indices",value:((le=(ne=n.bm25)==null?void 0:ne.stats)==null?void 0:le.total_indices)||0},{label:"Last Activity",value:Ge((re=n.qdrant)==null?void 0:re.lastSearchActivity)}]}),e.jsx(T,{icon:Ee,title:"Processing",value:((ce=s.database)==null?void 0:ce.connections)||0,label:"active connections",trend:"stable",details:[{label:"Queue Length",value:0},{label:"Success Rate",value:"98.5%"},{label:"Contextual Embeddings",value:"Enabled"}]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("button",{onClick:()=>o(!i),className:"w-full flex items-center justify-between p-4 hover:bg-gray-700 hover:bg-opacity-30 rounded-lg transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(R,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:"font-medium",children:"Detailed System Information"})]}),e.jsx("div",{className:`transform transition-transform ${i?"rotate-180":""}`,children:"▼"})]}),i&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700 space-y-4",children:[e.jsx(L,{title:"Database Statistics",data:s.database}),e.jsx(L,{title:"Qdrant Vector Database",data:s.knowledgeBase}),e.jsx(L,{title:"BM25 Search Service",data:n.bm25})]})]}),e.jsx(Ze,{isOpen:!!h,onClose:()=>B(null),onConfirm:()=>_e(h==null?void 0:h.type),title:h==null?void 0:h.title,message:h==null?void 0:h.message,confirmText:h==null?void 0:h.confirmText,confirmVariant:"danger",loading:v[h==null?void 0:h.type]}),e.jsx(Fe,{isOpen:!!p,onClose:()=>Me(null),title:p==null?void 0:p.title,progress:(p==null?void 0:p.progress)||0,message:p==null?void 0:p.message,canCancel:!1})]})},w=({icon:t,label:s,status:a,details:l})=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-800 bg-opacity-30 rounded-lg",children:[e.jsx("div",{className:`w-8 h-8 rounded-lg flex items-center justify-center ${a?"bg-green-600 bg-opacity-20":"bg-red-600 bg-opacity-20"}`,children:e.jsx(t,{className:`w-4 h-4 ${a?"text-green-400":"text-red-400"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm",children:s}),a?e.jsx(Pe,{className:"w-3 h-3 text-green-400"}):e.jsx(Oe,{className:"w-3 h-3 text-red-400"})]}),e.jsx("div",{className:"text-xs text-gray-400 truncate",children:l})]})]}),T=({icon:t,title:s,value:a,label:l,trend:n,trendDirection:d,details:i})=>e.jsxs("div",{className:"card p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsx(t,{className:"w-5 h-5 text-primary-400"})}),e.jsx("h3",{className:"font-bold",children:s})]}),n&&e.jsxs("div",{className:`flex items-center gap-1 text-sm ${d==="up"?"text-green-400":d==="down"?"text-red-400":"text-gray-400"}`,children:[d==="up"&&e.jsx(Qe,{className:"w-3 h-3"}),e.jsx("span",{children:n})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:a}),e.jsx("div",{className:"text-sm text-gray-400",children:l})]}),i&&e.jsx("div",{className:"space-y-2 text-sm",children:i.map((o,r)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:o.label}),e.jsx("span",{className:"text-gray-300",children:o.value})]},r))})]}),L=({title:t,data:s})=>e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-lg mb-3 flex items-center gap-2",children:[e.jsx($e,{className:"w-4 h-4 text-primary-400"}),t]}),e.jsx("div",{className:"bg-gray-800 bg-opacity-30 rounded-lg p-4",children:e.jsx("pre",{className:"text-xs text-gray-300 font-mono overflow-x-auto",children:JSON.stringify(s,null,2)})})]}),Ge=t=>{if(!t)return"None";const s=new Date(t),l=new Date-s;return l<6e4?"Just now":l<36e5?`${Math.floor(l/6e4)}m ago`:l<864e5?`${Math.floor(l/36e5)}h ago`:s.toLocaleDateString()};export{ns as default};
