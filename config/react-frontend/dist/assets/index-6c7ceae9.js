var mn=Object.defineProperty,pn=Object.defineProperties;var xn=Object.getOwnPropertyDescriptors;var ot=Object.getOwnPropertySymbols;var Es=Object.prototype.hasOwnProperty,Ps=Object.prototype.propertyIsEnumerable;var Ht=(s,t,a)=>t in s?mn(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,D=(s,t)=>{for(var a in t||(t={}))Es.call(t,a)&&Ht(s,a,t[a]);if(ot)for(var a of ot(t))Ps.call(t,a)&&Ht(s,a,t[a]);return s},V=(s,t)=>pn(s,xn(t));var $s=(s,t)=>{var a={};for(var n in s)Es.call(s,n)&&t.indexOf(n)<0&&(a[n]=s[n]);if(s!=null&&ot)for(var n of ot(s))t.indexOf(n)<0&&Ps.call(s,n)&&(a[n]=s[n]);return a};var Is=(s,t,a)=>(Ht(s,typeof t!="symbol"?t+"":t,a),a);var R=(s,t,a)=>new Promise((n,r)=>{var i=d=>{try{o(a.next(d))}catch(c){r(c)}},l=d=>{try{o(a.throw(d))}catch(c){r(c)}},o=d=>d.done?n(d.value):Promise.resolve(d.value).then(i,l);o((a=a.apply(s,t)).next())});import{r as u,a as gn,R as hs,c as dt,B as fn,b as yn,d as qe,N as bn}from"./vendor-77d0a172.js";import{a as It}from"./utils-d9662bcb.js";import{C as je,L as Me,a as re,A as le,F as ae,b as Na,B as Rs,G as jn,U as Ue,c as wa,d as et,e as Te,T as tt,Z as ke,f as X,E as ms,g as Sa,S as Ee,X as ve,h as vn,i as _a,W as Ca,R as oe,j as Nn,K as wn,M as Je,D as De,k as Ms,l as Rt,m as Ze,n as Ie,o as st,p as Sn,q as _n,r as Cn,s as Us,t as qt,P as kn,u as ka,v as ps,w as Tn,x as An,y as En,z as Pn,I as $n,H as In,J as Rn,N as Mn,O as Ta,Q as Un,V as On,Y as Aa,_ as Ln,$ as Dn}from"./icons-fbec3f3a.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function a(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=a(r);fetch(r.href,i)}})();var Ea={exports:{}},Mt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fn=u,zn=Symbol.for("react.element"),Bn=Symbol.for("react.fragment"),Vn=Object.prototype.hasOwnProperty,Hn=Fn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,qn={key:!0,ref:!0,__self:!0,__source:!0};function Pa(s,t,a){var n,r={},i=null,l=null;a!==void 0&&(i=""+a),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(l=t.ref);for(n in t)Vn.call(t,n)&&!qn.hasOwnProperty(n)&&(r[n]=t[n]);if(s&&s.defaultProps)for(n in t=s.defaultProps,t)r[n]===void 0&&(r[n]=t[n]);return{$$typeof:zn,type:s,key:i,ref:l,props:r,_owner:Hn.current}}Mt.Fragment=Bn;Mt.jsx=Pa;Mt.jsxs=Pa;Ea.exports=Mt;var e=Ea.exports,ss={},Os=gn;ss.createRoot=Os.createRoot,ss.hydrateRoot=Os.hydrateRoot;class Kn{constructor(){this.storageKey="autollama-settings",this.defaultSettings={connections:{openaiApiKey:"",claudeApiKey:"",qdrantUrl:"",qdrantApiKey:"",databaseUrl:"",testConnections:!1},pipeline:{pipelineUrl:"http://autollama-on-hstgr:9099",apiKey:"0p3n-w3bu!",collectionName:"autollama-content",maxResults:5,similarityThreshold:.3,debugMode:!0},processing:{enableContextualEmbeddings:!0,contextualModel:"gpt-4o-mini",contextBatchSize:5,chunkSize:1200,chunkOverlap:200,processingTimeout:3e4,autoStartProcessing:!0},system:{theme:"dark",sseUpdateInterval:5e3,cacheTimeout:3e5,debugLogging:!0,showProcessingDetails:!0,autoRefreshDocuments:!0},search:{enableBM25:!0,enableSemantic:!0,hybridSearchWeight:.5,maxSearchResults:20,searchTimeout:1e4,enableSearchHistory:!0},ui:{documentsPerPage:50,chunksPerRow:10,showVectorHeatmaps:!0,showContextualSummaries:!0,animationsEnabled:!0,compactMode:!1,customFavicon:!1,faviconUploadTime:null}}}loadSettings(){try{const t=localStorage.getItem(this.storageKey);if(t){const a=JSON.parse(t);return this.mergeWithDefaults(a)}}catch(t){}return D({},this.defaultSettings)}loadSettingsFromDatabase(){return R(this,null,function*(){try{const t=yield fetch("/api/settings");if(t.ok){const a=yield t.json();if(a.success&&a.settings){const n=a.settings,r=D({},this.defaultSettings);return n.openai_api_key&&(r.connections.openaiApiKey=n.openai_api_key),n.claude_api_key&&(r.connections.claudeApiKey=n.claude_api_key),n.qdrant_url&&(r.connections.qdrantUrl=n.qdrant_url),n.qdrant_api_key&&(r.connections.qdrantApiKey=n.qdrant_api_key),n.database_url&&(r.connections.databaseUrl=n.database_url),r}}}catch(t){}return this.loadSettings()})}saveSettings(t){try{return localStorage.setItem(this.storageKey,JSON.stringify(t)),!0}catch(a){return!1}}saveConnectionsToDatabase(t){return R(this,null,function*(){try{const a={};t.openaiApiKey&&t.openaiApiKey.trim()&&(a.openai_api_key=t.openaiApiKey),t.claudeApiKey&&t.claudeApiKey.trim()&&(a.claude_api_key=t.claudeApiKey),t.qdrantUrl&&t.qdrantUrl.trim()&&(a.qdrant_url=t.qdrantUrl),t.qdrantApiKey&&t.qdrantApiKey.trim()&&(a.qdrant_api_key=t.qdrantApiKey),t.databaseUrl&&t.databaseUrl.trim()&&(a.database_url=t.databaseUrl);const n=yield fetch("/api/settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({settings:a})});if(n.ok){const r=yield n.json();return!0}else{const r=yield n.json();return!1}}catch(a){return!1}})}mergeWithDefaults(t){const a=D({},this.defaultSettings);return Object.keys(t).forEach(n=>{a[n]&&typeof a[n]=="object"?a[n]=D(D({},a[n]),t[n]):a[n]=t[n]}),a}getSetting(t,a){var r;return(r=this.loadSettings()[t])==null?void 0:r[a]}updateSetting(t,a,n){const r=this.loadSettings();return r[t]||(r[t]={}),r[t][a]=n,this.saveSettings(r)}updateCategory(t,a){const n=this.loadSettings();return n[t]=D(D({},n[t]),a),this.saveSettings(n)}resetSettings(){try{return localStorage.removeItem(this.storageKey),!0}catch(t){return!1}}exportSettings(){const t=this.loadSettings(),a=JSON.stringify(t,null,2),n=new Blob([a],{type:"application/json"}),r=document.createElement("a");r.href=URL.createObjectURL(n),r.download=`autollama-settings-${new Date().toISOString().split("T")[0]}.json`,r.click()}importSettings(t){return R(this,null,function*(){try{const a=yield t.text(),n=JSON.parse(a),r=this.mergeWithDefaults(n);return!!this.saveSettings(r)}catch(a){return!1}})}validateConnections(t=null){return R(this,null,function*(){var r;const a=t||this.loadSettings(),n={openai:!1,claude:!1,qdrant:!1,database:!1,bm25:!1};if(a.connections.openaiApiKey&&a.connections.openaiApiKey.trim())try{const i=yield fetch("https://api.openai.com/v1/models",{headers:{Authorization:`Bearer ${a.connections.openaiApiKey}`}});n.openai=i.ok}catch(i){}if(a.connections.claudeApiKey&&a.connections.claudeApiKey.trim())try{const i=yield fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"x-api-key":a.connections.claudeApiKey,"anthropic-version":"2023-06-01","content-type":"application/json"},body:JSON.stringify({model:"claude-3-haiku-20240307",max_tokens:1,messages:[{role:"user",content:"test"}]})});n.claude=i.ok||i.status===400}catch(i){}if(a.connections.qdrantUrl&&a.connections.qdrantApiKey&&a.connections.qdrantApiKey.trim())try{const i=yield fetch(`${a.connections.qdrantUrl}/collections`,{headers:{"api-key":a.connections.qdrantApiKey}});n.qdrant=i.ok}catch(i){}if(a.connections.databaseUrl&&a.connections.databaseUrl.trim())try{const i=yield fetch("/api/health");if(i.ok){const l=yield i.json();n.database=((r=l.database)==null?void 0:r.postgresql)==="connected"}else{const o=yield(yield fetch("/health")).text();n.database=o==="healthy"}}catch(i){try{const o=yield(yield fetch("/health")).text();n.database=o==="healthy"}catch(l){n.database=!1}}try{const i=yield fetch("/bm25/health");n.bm25=i.ok}catch(i){}return n})}}const he=new Kn,Gn=()=>{const[s,t]=u.useState(he.loadSettings()),[a,n]=u.useState(!1),[r,i]=u.useState({openai:!1,qdrant:!1,database:!1,bm25:!1}),l=u.useCallback(()=>{t(he.loadSettings())},[]),o=u.useCallback((f,v,w)=>{const g=he.updateSetting(f,v,w);return g&&l(),g},[l]),d=u.useCallback((f,v)=>{const w=he.updateCategory(f,v);return w&&l(),w},[l]),c=u.useCallback(()=>{const f=he.resetSettings();return f&&l(),f},[l]),p=u.useCallback(()=>R(void 0,null,function*(){n(!0);try{const f=yield he.validateConnections(s);return i(f),f}catch(f){return null}finally{n(!1)}}),[s]),h=u.useCallback(()=>{he.exportSettings()},[]),j=u.useCallback(f=>R(void 0,null,function*(){n(!0);try{const v=yield he.importSettings(f);return v&&l(),v}catch(v){return!1}finally{n(!1)}}),[l]);return u.useEffect(()=>{p()},[p]),u.useEffect(()=>{const f=setInterval(()=>{p()},3e4);return()=>clearInterval(f)},[p]),{settings:s,isLoading:a,connectionStatus:r,updateSetting:o,updateCategory:d,resetSettings:c,testConnections:p,exportSettings:h,importSettings:j,reloadSettings:l}};class Wn{constructor(t=5*60*1e3){this.cache=new Map,this.defaultTTL=t,this.stats={hits:0,misses:0,sets:0,deletes:0}}generateKey(t,a={}){const n=JSON.stringify(a,Object.keys(a).sort());return`${t}:${n}`}get(t){const a=this.cache.get(t);return a?Date.now()>a.expiresAt?(this.cache.delete(t),this.stats.misses++,null):(this.stats.hits++,a.data):(this.stats.misses++,null)}set(t,a,n=null){const r=n===0?0:n!==null?n:this.defaultTTL,i=Date.now()+r;this.cache.set(t,{data:a,expiresAt:i,createdAt:Date.now()}),this.stats.sets++}delete(t){const a=this.cache.delete(t);return a&&this.stats.deletes++,a}clear(){const t=this.cache.size;this.cache.clear(),this.stats.deletes+=t}cleanup(){const t=Date.now();let a=0;for(const[n,r]of this.cache.entries())t>r.expiresAt&&(this.cache.delete(n),a++);return this.stats.deletes+=a,a}getStats(){return V(D({},this.stats),{size:this.cache.size,hitRate:this.stats.hits/(this.stats.hits+this.stats.misses)||0})}has(t){const a=this.cache.get(t);return a&&Date.now()<=a.expiresAt}}const pe=new Wn;setInterval(()=>{pe.cleanup()},5*60*1e3);const W={realtime:2*1e3,documents:0,stats:0,settings:30*1e3,systemInfo:30*1e3,schemas:60*1e3},Qn=(s,t,a=null)=>R(void 0,null,function*(){const n=pe.get(s);if(n)return n;try{const r=yield t();return pe.set(s,r,a),r}catch(r){throw r}}),We={documents:()=>{Array.from(pe.cache.keys()).forEach(t=>{(t.includes("documents")||t.includes("chunks")||t.includes("search"))&&pe.delete(t)})},stats:()=>{Array.from(pe.cache.keys()).forEach(t=>{(t.includes("stats")||t.includes("health"))&&pe.delete(t)})},processing:()=>{Array.from(pe.cache.keys()).forEach(t=>{(t.includes("in-progress")||t.includes("recent")||t.includes("queue"))&&pe.delete(t)})},all:()=>pe.clear()},Jn={LOW:"low",MEDIUM:"medium",HIGH:"high"},Ce={API:"api",NETWORK:"network",VALIDATION:"validation",AUTHENTICATION:"authentication",PERMISSION:"permission",PROCESSING:"processing",UI:"ui",UNKNOWN:"unknown"};class Zn{constructor(){this.errorLog=[],this.maxLogSize=50,this.errorCallbacks=new Set}handle(t,a={}){try{const n=this.createSafeError(t,a);return this.safeLog(n),this.safeNotify(n),this.safeConsoleLog(n),n}catch(n){return{id:"emergency-"+Date.now(),message:"Error handling failed",severity:"medium",category:"unknown",timestamp:new Date().toISOString()}}}createSafeError(t,a){const n={id:"error-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),message:"Unknown error",severity:"medium",category:"unknown",timestamp:new Date().toISOString(),retryable:!1};try{t&&typeof t=="object"&&t.message?n.message=String(t.message):t&&typeof t=="string"&&(n.message=t)}catch(r){}try{a&&a.severity&&typeof a.severity=="string"&&(n.severity=a.severity)}catch(r){}try{a&&a.category&&typeof a.category=="string"&&(n.category=a.category)}catch(r){}return n}safeLog(t){try{t&&typeof t=="object"&&t.id&&(this.errorLog.unshift(t),this.errorLog.length>this.maxLogSize&&(this.errorLog=this.errorLog.slice(0,this.maxLogSize)))}catch(a){}}safeNotify(t){try{this.errorCallbacks.forEach(a=>{try{typeof a=="function"&&a(t)}catch(n){}})}catch(a){}}safeConsoleLog(t){try{if(!t||typeof t!="object")return;const a=t.message||"Unknown error",n=t.severity||"medium"}catch(a){}}onError(t){try{if(typeof t=="function")return this.errorCallbacks.add(t),()=>{try{this.errorCallbacks.delete(t)}catch(a){}}}catch(a){}return()=>{}}getStats(){try{const t={total:0,last24h:0,byCategory:{},bySeverity:{}};if(Array.isArray(this.errorLog)){t.total=this.errorLog.length;let a=0;for(let n=0;n<this.errorLog.length;n++)try{const r=this.errorLog[n];if(r&&typeof r=="object"){a++;const i=r.category||"unknown";t.byCategory[i]=(t.byCategory[i]||0)+1;const l=r.severity||"medium";t.bySeverity[l]=(t.bySeverity[l]||0)+1}}catch(r){}t.last24h=a}return t}catch(t){return{total:0,last24h:0,byCategory:{},bySeverity:{}}}}clearErrors(){try{this.errorLog=[]}catch(t){this.errorLog=[]}}}const Xe=new Zn,Xn=(s,t={})=>Xe.handle(s,V(D({},t),{category:Ce.API})),Re=Xn,Yn=s=>{try{if(!s||typeof s!="object")return"An unexpected error occurred. Please try again.";switch(s.category||"unknown"){case Ce.NETWORK:return"Connection error. Please check your internet connection and try again.";case Ce.API:return"Server error. Please try again in a moment.";case Ce.VALIDATION:return"Please check your input and try again.";case Ce.PROCESSING:return"Processing error. Please try again.";default:return"An unexpected error occurred. Please try again."}}catch(t){return"An error occurred. Please try again."}},er=(a,...n)=>R(void 0,[a,...n],function*(s,t={}){const{maxAttempts:r=3,delay:i=1e3}=t;for(let l=1;l<=r;l++)try{return yield s()}catch(o){if(l===r)throw Xe.handle(o,{action:"RetryFailed",attempts:l,category:Ce.API}),o;i>0&&(yield new Promise(d=>setTimeout(d,i*l)))}});class tr{constructor(){this.metrics=new Map,this.thresholds={api:2e3,render:100,navigation:1e3},this.isRecording=!0}startTimer(t,a="general"){if(!this.isRecording)return;const n=`${a}:${t}`;this.metrics.set(n,{name:t,category:a,startTime:performance.now(),startMark:`${n}-start`}),typeof performance.mark=="function"&&performance.mark(`${n}-start`)}endTimer(t,a="general",n={}){if(!this.isRecording)return null;const r=`${a}:${t}`,i=this.metrics.get(r);if(!i)return null;const o=performance.now()-i.startTime,d=`${r}-end`;typeof performance.mark=="function"&&(performance.mark(d),typeof performance.measure=="function"&&performance.measure(r,i.startMark,d));const c={name:i.name,category:i.category,duration:o,timestamp:new Date().toISOString(),metadata:n,threshold:this.thresholds[a]||this.thresholds.general,isSlowOperation:o>(this.thresholds[a]||1e3)};return c.isSlowOperation,this.metrics.delete(r),c}timeFunction(i,l){return R(this,arguments,function*(t,a,n="function",r={}){this.startTimer(a,n);try{const o=yield t();return this.endTimer(a,n,r),o}catch(o){throw this.endTimer(a,n,V(D({},r),{error:o.message})),o}})}timeApiCall(r,i){return R(this,arguments,function*(t,a,n={}){return this.timeFunction(t,a,"api",D({endpoint:a},n))})}getStats(){const t=performance.getEntriesByType("measure"),a={total:t.length,byCategory:{},slowOperations:0,averageDuration:0};let n=0;return t.forEach(r=>{const[i]=r.name.split(":");a.byCategory[i]||(a.byCategory[i]={count:0,totalDuration:0,averageDuration:0,slowCount:0});const l=a.byCategory[i];l.count++,l.totalDuration+=r.duration,r.duration>(this.thresholds[i]||1e3)&&(l.slowCount++,a.slowOperations++),n+=r.duration}),a.averageDuration=t.length>0?n/t.length:0,Object.values(a.byCategory).forEach(r=>{r.averageDuration=r.count>0?r.totalDuration/r.count:0}),a}clearData(){typeof performance.clearMarks=="function"&&performance.clearMarks(),typeof performance.clearMeasures=="function"&&performance.clearMeasures(),this.metrics.clear()}setRecording(t){this.isRecording=t}}const Fe=new tr,H=It.create({baseURL:"/api",timeout:3e4,headers:{"Content-Type":"application/json"}}),Ae=It.create({baseURL:"/bm25",timeout:1e4,headers:{"Content-Type":"application/json"}});H.interceptors.request.use(s=>{var t;return s.metadata={startTime:performance.now(),endpoint:`${(t=s.method)==null?void 0:t.toUpperCase()} ${s.url}`},s},s=>(Re(s,{action:"RequestInterceptor"}),Promise.reject(s)));H.interceptors.response.use(s=>{if(s.config.metadata){const t=performance.now()-s.config.metadata.startTime;Fe.endTimer(s.config.metadata.endpoint,"api",{status:s.status,duration:t})}return s},s=>{var t,a,n,r,i;if((t=s.config)!=null&&t.metadata){const l=performance.now()-s.config.metadata.startTime;Fe.endTimer(s.config.metadata.endpoint,"api",{status:((a=s.response)==null?void 0:a.status)||"error",duration:l,error:!0})}return Re(s,{action:"ResponseInterceptor",endpoint:(n=s.config)==null?void 0:n.url,method:(r=s.config)==null?void 0:r.method}),((i=s.response)==null?void 0:i.status)>=500&&We.all(),Promise.reject(s)});Ae.interceptors.request.use(s=>s,s=>Promise.reject(s));Ae.interceptors.response.use(s=>s,s=>Promise.reject(s));const Q={getDocuments:(s={})=>H.get("/documents",{params:s}),getDocumentChunks:(s,t={})=>H.get("/document-chunks",{params:D({url:atob(s)},t)}),getChunkByIndex:(s,t)=>R(void 0,null,function*(){const a=atob(s);try{const n=yield H.get("/document-chunks",{params:{url:a,limit:Math.max(200,t+50)}});if(n.data.chunks&&n.data.chunks.length>0){let r=n.data.chunks.find(o=>o.chunkIndex===t);if(r)return{chunk:r};const i=yield H.get("/document-chunks",{params:{url:a,limit:2e3}});if(i.data.chunks&&(r=i.data.chunks.find(o=>o.chunkIndex===t),r))return{chunk:r};const l=[...new Set(n.data.chunks.map(o=>o.chunkIndex))].sort((o,d)=>o-d);throw new Error(`Chunk with index ${t} not found. Available range: ${l[0]} to ${l[l.length-1]}`)}throw new Error("No chunks returned from API")}catch(n){throw n}}),getDocumentSummary:s=>H.get(`/document/${s}/summary`),processUrl:s=>H.post("/process-url",s),processUrlStream:s=>H.post("/process-url-stream",s),processFile:s=>H.post("/process-file",s,{headers:{"Content-Type":"multipart/form-data"}}),processFileStream:s=>H.post("/process-file-stream",s,{headers:{"Content-Type":"multipart/form-data"}}),search:s=>H.get("/search",{params:s}),searchGrouped:s=>H.get("/search/grouped",{params:s}),getKnowledgeBaseStats:()=>H.get("/knowledge-base/stats"),getDatabaseStats:()=>H.get("/database/stats"),getHealth:()=>It.get("/health"),getPipelineHealth:()=>H.get("/pipeline/health"),getQdrantActivity:()=>H.get("/qdrant/activity"),getRecentRecords:(s={})=>H.get("/documents",{params:s}),getInProgress:()=>H.get("/in-progress"),getCompletedUploads:(s={})=>H.get("/in-progress",{params:s}),stopProcessing:s=>H.post(`/stop-processing/${s}`),cancelJob:s=>H.post(`/cancel-job/${s}`),getChunks:(s={})=>H.get("/chunks",{params:s}),getChunkingSettings:()=>H.get("/chunking-settings"),updateChunkingSettings:s=>H.put("/chunking-settings",s),getRagSettings:()=>H.get("/settings/rag"),updateRagSettings:s=>H.put("/settings/rag",s),getCleanupStatus:()=>H.get("/cleanup-status"),checkStuckSessions:()=>H.get("/upload-sessions/check-stuck"),cleanupSessions:(s={})=>H.post("/cleanup-sessions",s),advancedCleanup:(s={})=>H.post("/cleanup-sessions/advanced",s),cleanupStuckSessions:(s={})=>H.post("/upload-sessions/cleanup-stuck",s),getAdminSessionStats:()=>H.get("/admin/session-stats"),getSystemHealth:()=>H.get("/system/status")},we={sendMessage:s=>H.post("/chat/message",s),getConversation:s=>H.get(`/chat/conversation/${s}`),getConversations:(s={})=>H.get("/chat/conversations",{params:s}),deleteConversation:s=>H.delete(`/chat/conversation/${s}`),getStats:()=>H.get("/chat/stats"),searchRAG:(s,t={})=>H.post("/chat/rag-search",D({query:s},t)),pipelineQuery:s=>H.post("/chat/pipeline",s),getPipelineStatus:()=>H.get("/chat/pipeline/status")},Se={search:(s,t,a=10)=>Ae.post(`/search/${s}`,{query:t,filename:s,top_k:a}),createIndex:(s,t,a=!0)=>Ae.post(`/index/${s}`,{chunks:t,filename:s,replace_existing:a}),getStats:()=>Ae.get("/stats"),deleteIndex:s=>Ae.delete(`/index/${s}`),getHealth:()=>Ae.get("/health")},$a=(s,t,a=null)=>{const n=s.startsWith("/")?s:`/api/${s}`,r=performance.now();try{const i=new EventSource(n,{withCredentials:!1});return i.onmessage=l=>{try{const o=JSON.parse(l.data);if(o.type==="ping")return;t(o)}catch(o){const d=Re(o,{action:"SSE_Parse",endpoint:n});t({type:"error",message:"Failed to parse SSE data",errorId:d.id,severity:"medium",category:"sse_parse",timestamp:new Date().toISOString()})}},i.onerror=l=>{const o=Re(l,{action:"SSE_Connection",endpoint:n,readyState:i.readyState});a&&a(l,o)},i.onopen=()=>{const l=performance.now()-r;Fe.endTimer(`SSE_${s}`,"sse",{endpoint:n,connectionTime:l})},Fe.startTimer(`SSE_${s}`,"sse"),i}catch(i){throw Re(i,{action:"SSE_Create",endpoint:n}),i}},Ia=(s,t,a=null)=>(...n)=>{const r=`${s}:${JSON.stringify(n)}`;return Qn(r,()=>t(...n),a)},Ra=(s,t=3)=>(...a)=>R(void 0,null,function*(){return er(()=>s(...a),{maxAttempts:t})}),Ma=(s,t)=>(...a)=>R(void 0,null,function*(){return Fe.timeApiCall(()=>t(...a),s,{args:a.length})}),Ua=(s,t,a={})=>{const{useCache:n=!0,ttl:r=null,useRetry:i=!0,maxAttempts:l=3,useMonitoring:o=!0}=a;let d=t;return o&&(d=Ma(s,d)),i&&(d=Ra(d,l)),n&&(d=Ia(s,d,r)),d},Oe={invalidateCache:{documents:()=>We.documents(),stats:()=>We.stats(),processing:()=>We.processing(),all:()=>We.all()},batchApiCalls:s=>R(void 0,null,function*(){const t=performance.now();try{const a=yield Promise.all(s.map(r=>r())),n=performance.now()-t;return a}catch(a){throw Re(a,{action:"BatchApiCalls",callCount:s.length}),a}}),sequentialApiCalls:(s,t=100)=>R(void 0,null,function*(){const a=[];for(let n=0;n<s.length;n++)try{const r=yield s[n]();a.push(r),n<s.length-1&&t>0&&(yield new Promise(i=>setTimeout(i,t)))}catch(r){throw Re(r,{action:"SequentialApiCall",callIndex:n,totalCalls:s.length}),r}return a}),checkHealth:()=>R(void 0,null,function*(){try{return{status:"healthy",response:(yield It.get("/health",{timeout:5e3})).data,timestamp:new Date().toISOString()}}catch(s){return{status:"unhealthy",error:s.message,timestamp:new Date().toISOString()}}}),getApiStats:()=>({performance:Fe.getStats(),errors:Xe.getStats(),cache:{}})},sr=Object.freeze(Object.defineProperty({__proto__:null,api:H,apiEndpoints:Q,apiUtils:Oe,bm25Api:Ae,bm25Endpoints:Se,chatEndpoints:we,createCachedApiCall:Ia,createEnhancedApiCall:Ua,createMonitoredApiCall:Ma,createRetryableApiCall:Ra,createSSEConnection:$a},Symbol.toStringTag,{value:"Module"})),Oa=(s,t={})=>{const[a,n]=u.useState(null),[r,i]=u.useState(!1),[l,o]=u.useState(null),[d,c]=u.useState([]),p=u.useRef(null),h=u.useRef(new Set),{autoConnect:j=!0,maxHistorySize:f=10,onMessage:v=null,onError:w=null,onConnect:g=null,onDisconnect:S=null}=t,k=u.useCallback((x,_)=>{const I=setTimeout(()=>{h.current.delete(I),x()},_);return h.current.add(I),I},[]),E=u.useCallback(x=>{n(x),o(null),c(_=>[..._,V(D({},x),{timestamp:new Date})].slice(-f)),v&&v(x)},[v,f]),$=u.useCallback(x=>{o(x),i(!1),w&&w(x),S&&S()},[w,S]),y=u.useCallback(()=>{p.current&&p.current.close();try{return p.current=$a(s,E,$),p.current.onopen=()=>{i(!0),o(null),g&&g()},!0}catch(x){return o(x),!1}},[s,E,$,g]),N=u.useCallback(()=>{p.current&&(p.current.close(),p.current=null,i(!1),S&&S())},[S]),m=u.useCallback((x=1)=>{if(x>3)return!1;const M=1e3*Math.pow(2,x-1);return k(()=>{y()||m(x+1)},M),!0},[y,k]),T=u.useCallback(()=>{c([])},[]);return u.useEffect(()=>(j&&s&&y(),()=>{N(),h.current.forEach(x=>{clearTimeout(x)}),h.current.clear()}),[s,j,y,N]),u.useEffect(()=>{if(l&&r===!1&&j&&s){const x=k(()=>{m()},2e3);return()=>{h.current.delete(x),clearTimeout(x)}}},[l,r,j,m,s,k]),{data:a,isConnected:r,error:l,messageHistory:d,connect:y,disconnect:N,reconnect:m,clearHistory:T}},ar=(s="Unknown")=>{const[t,a]=u.useState([]),[n,r]=u.useState(!1),i=u.useRef(null);u.useEffect(()=>(i.current=Xe.onError(v=>{(v.context.component===s||v.context.component==="Global")&&(a(w=>[v,...w.slice(0,9)]),r(!0))}),()=>{i.current&&i.current()}),[s]);const l=u.useCallback((v,w={})=>Xe.handle(v,D({component:s},w)),[s]),o=u.useCallback((v,w="API Call")=>l(v,{action:w,category:Ce.API}),[l]),d=u.useCallback((v,w="Unknown")=>l(v,{action:`Validation: ${w}`,category:Ce.VALIDATION,severity:Jn.MEDIUM}),[l]),c=u.useCallback((v,w="Processing")=>l(v,{action:w,category:Ce.PROCESSING}),[l]),p=u.useCallback(()=>{a([]),r(!1)},[]),h=u.useCallback(v=>{a(w=>w.filter(g=>g.id!==v)),r(w=>t.length>1)},[t.length]),j=u.useCallback(()=>t.filter(v=>!(!v||typeof v!="object"||!v.id)).map(v=>{try{const w={id:String(v.id||"unknown"),message:String(v.message||"Unknown error occurred"),severity:String(v.severity||"medium"),timestamp:String(v.timestamp||new Date().toISOString()),retryable:!!v.retryable};try{const g=Yn(v);g&&typeof g=="string"&&(w.message=g)}catch(g){}return w}catch(w){return{id:"error-processing-"+Date.now(),message:"Error processing error message",severity:"medium",timestamp:new Date().toISOString(),retryable:!1}}}),[t]),f={hasError:n,errorCount:t.length,latestError:t[0]||null,errors:t,messages:j()};return V(D({},f),{handleError:l,handleApiError:o,handleValidationError:d,handleProcessingError:c,clearErrors:p,clearError:h})},nr=()=>{const[s,t]=u.useState({totalCalls:0,averageResponseTime:0,slowCalls:0,errorRate:0,recentCalls:[]}),a=u.useCallback((n,r)=>R(void 0,null,function*(){const i=performance.now();let l=!0,o=null;try{return yield n()}catch(d){throw l=!1,o=d.message,d}finally{const d=performance.now()-i;t(c=>{const h=[{endpoint:r,duration:Math.round(d),success:l,error:o,timestamp:new Date().toISOString()},...c.recentCalls.slice(0,19)],j=c.totalCalls+1,f=c.slowCalls+(d>2e3?1:0),v=h.filter(w=>!w.success).length;return{totalCalls:j,averageResponseTime:Math.round(h.reduce((w,g)=>w+g.duration,0)/h.length),slowCalls:f,errorRate:Math.round(v/h.length*100),recentCalls:h}})}}),[]);return{metrics:s,timeApiCall:a}},La=s=>s?{id:s.id||s.chunk_id||xs(),title:s.title||s.url||"Untitled Document",url:s.url||"",contentType:s.content_type||s.contentType||"document",processedAt:s.processed_at||s.processedAt||s.created_time||s.created_at,chunkCount:s.chunk_count||s.chunkCount||0,status:s.status||"completed",sentiment:s.sentiment||"neutral",technicalLevel:s.technical_level||s.technicalLevel||"intermediate",summary:s.summary||"",mainTopics:s.main_topics||s.mainTopics||[],keyEntities:s.key_entities||s.keyEntities||{},usesContextualEmbedding:s.uses_contextual_embedding||s.usesContextualEmbedding||!1,uploadSource:s.upload_source||s.uploadSource||"user"}:null,as=s=>s?{id:s.chunk_id||s.id||xs(),index:s.chunk_index!==void 0?s.chunk_index:s.index!==void 0?s.index:0,text:s.chunkText||s.chunk_text||s.text||"",url:s.url||"",title:s.title||"Untitled",status:s.processing_status||s.status||"completed",sentiment:s.sentiment||"neutral",technicalLevel:s.technical_level||s.technicalLevel||"intermediate",contentType:s.content_type||s.contentType||"text",mainTopics:s.main_topics||s.mainTopics||[],keyEntities:s.key_entities||s.keyEntities||{},contextualSummary:s.contextual_summary||s.contextualSummary||null,usesContextualEmbedding:s.uses_contextual_embedding||s.usesContextualEmbedding||!1,embedding:s.embedding||null,people:s.people||[],organizations:s.organizations||[],locations:s.locations||[],emotions:s.emotions||[],keyConcepts:s.key_concepts||s.keyConcepts||[]}:null,Ls=s=>!s||!Array.isArray(s)?[]:s.map(t=>({id:t.id||xs(),score:t.score||0,document:La(t.document||t),chunk:t.chunk?as(t.chunk):null,highlight:t.highlight||"",type:t.type||"document"})),xs=()=>Math.random().toString(36).substr(2,9),gs=()=>{const[s,t]=u.useState(!1),[a,n]=u.useState(null),r=u.useRef(null),{handleApiError:i,clearErrors:l}=ar("useAPI"),{timeApiCall:o,metrics:d}=nr(),c=u.useCallback((x,_,...I)=>R(void 0,[x,_,...I],function*(y,N,m={},...T){t(!0),n(null),l(),r.current&&r.current.abort(),r.current=new AbortController;try{const M=Ua(N,y,{useCache:m.useCache!==!1,ttl:m.ttl||W.documents,useRetry:m.useRetry!==!1,maxAttempts:m.maxAttempts||3,useMonitoring:m.useMonitoring!==!1}),C=yield o(()=>M(...T),N);return(C==null?void 0:C.data)||C}catch(M){if(M.name==="AbortError")return null;const C=i(M,N);throw n(C),M}finally{t(!1),r.current=null}}),[i,l,o]),p={getAll:u.useCallback(y=>R(void 0,null,function*(){const N=yield c(Q.getDocuments,"documents",{ttl:W.documents},y);return{documents:(Array.isArray(N)?N:(N==null?void 0:N.documents)||[]).map(La)||[]}}),[c]),getChunks:u.useCallback((y,N)=>R(void 0,null,function*(){var T;const m=yield c(Q.getDocumentChunks,`document-chunks-${y}`,{ttl:W.documents},y,N);return V(D({},m),{chunks:((T=m==null?void 0:m.chunks)==null?void 0:T.map(as))||[]})}),[c]),getSummary:u.useCallback(y=>c(Q.getDocumentSummary,`document-summary-${y}`,{ttl:W.documents},y),[c])},h={processUrl:u.useCallback(y=>c(Q.processUrl,"process-url",{useCache:!1},y),[c]),processUrlStream:u.useCallback(y=>c(Q.processUrlStream,"process-url-stream",{useCache:!1},y),[c]),processFile:u.useCallback(y=>c(Q.processFile,"process-file",{useCache:!1},y),[c]),processFileStream:u.useCallback(y=>c(Q.processFileStream,"process-file-stream",{useCache:!1},y),[c]),getQueue:u.useCallback(()=>c(Q.getInProgress,"processing-queue",{ttl:W.realtime}),[c]),stopProcessing:u.useCallback(y=>c(Q.stopProcessing,"stop-processing",{useCache:!1},y),[c]),cancelJob:u.useCallback(y=>c(Q.cancelJob,"cancel-job",{useCache:!1},y),[c]),getStats:u.useCallback(()=>c(Q.getCompletedUploads,"processing-stats",{ttl:W.stats}),[c])},j={search:u.useCallback(y=>R(void 0,null,function*(){const N=yield c(Q.search,"search",{ttl:W.documents},y);return Ls(N)}),[c]),searchGrouped:u.useCallback(y=>R(void 0,null,function*(){const N=yield c(Q.searchGrouped,"search-grouped",{ttl:W.documents},y);return Ls(N)}),[c]),bm25Search:u.useCallback((y,N,m)=>c(Se.search,`bm25-${y}`,{ttl:W.documents},y,N,m),[c])},f={getKnowledgeBase:u.useCallback(()=>c(Q.getKnowledgeBaseStats,"kb-stats",{ttl:W.stats}),[c]),getDatabase:u.useCallback(()=>c(Q.getDatabaseStats,"db-stats",{ttl:W.stats}),[c]),getHealth:u.useCallback(()=>c(Q.getHealth,"health",{ttl:W.realtime}),[c]),getPipelineHealth:u.useCallback(()=>c(Q.getPipelineHealth,"pipeline-health",{ttl:W.realtime}),[c]),getQdrantActivity:u.useCallback(()=>c(Q.getQdrantActivity,"qdrant-activity",{ttl:W.realtime}),[c]),getBM25Stats:u.useCallback(()=>c(Se.getStats,"bm25-stats",{ttl:W.stats}),[c]),getBM25Health:u.useCallback(()=>c(Se.getHealth,"bm25-health",{ttl:W.realtime}),[c])},v={getRecentRecords:u.useCallback(y=>c(Q.getRecentRecords,"recent-records",{ttl:W.realtime},y),[c]),getInProgress:u.useCallback(()=>c(Q.getInProgress,"in-progress",{ttl:W.realtime}),[c]),getCompletedUploads:u.useCallback(y=>c(Q.getCompletedUploads,"completed-uploads",{ttl:W.stats},y),[c]),getChunks:u.useCallback(y=>R(void 0,null,function*(){const N=yield c(Q.getChunks,"chunks",{ttl:W.documents},y);return(N==null?void 0:N.map(as))||[]}),[c])},w={createIndex:u.useCallback((y,N,m)=>c(Se.createIndex,`bm25-create-${y}`,{useCache:!1},y,N,m),[c]),deleteIndex:u.useCallback(y=>c(Se.deleteIndex,`bm25-delete-${y}`,{useCache:!1},y),[c]),search:u.useCallback((y,N,m)=>c(Se.search,`bm25-search-${y}`,{ttl:W.documents},y,N,m),[c]),getStats:u.useCallback(()=>c(Se.getStats,"bm25-stats",{ttl:W.stats}),[c]),getHealth:u.useCallback(()=>c(Se.getHealth,"bm25-health",{ttl:W.realtime}),[c])},g={sendMessage:u.useCallback(y=>c(we.sendMessage,"chat-message",{useCache:!1},y),[c]),getConversation:u.useCallback(y=>c(we.getConversation,`conversation-${y}`,{ttl:W.documents},y),[c]),getConversations:u.useCallback(y=>c(we.getConversations,"conversations",{ttl:W.stats},y),[c]),deleteConversation:u.useCallback(y=>c(we.deleteConversation,`delete-conversation-${y}`,{useCache:!1},y),[c]),getStats:u.useCallback(()=>c(we.getStats,"chat-stats",{ttl:W.stats}),[c]),searchRAG:u.useCallback((y,N)=>c(we.searchRAG,"rag-search",{ttl:W.documents},y,N),[c]),pipelineQuery:u.useCallback(y=>c(we.pipelineQuery,"pipeline-query",{useCache:!1},y),[c]),getPipelineStatus:u.useCallback(()=>c(we.getPipelineStatus,"pipeline-status",{ttl:W.realtime}),[c])},S=u.useCallback(()=>{r.current&&r.current.abort()},[]),k={getChunkingSettings:u.useCallback(()=>c(Q.getChunkingSettings,"chunking-settings",{ttl:W.stats}),[c]),updateChunkingSettings:u.useCallback(y=>c(Q.updateChunkingSettings,"update-chunking-settings",{useCache:!1},y),[c])},E={getCleanupStatus:u.useCallback(()=>c(Q.getCleanupStatus,"cleanup-status",{ttl:W.realtime}),[c]),checkStuckSessions:u.useCallback(()=>c(Q.checkStuckSessions,"stuck-sessions",{ttl:W.realtime}),[c]),cleanupSessions:u.useCallback(y=>c(Q.cleanupSessions,"cleanup-sessions",{useCache:!1},y),[c]),advancedCleanup:u.useCallback(y=>c(Q.advancedCleanup,"advanced-cleanup",{useCache:!1},y),[c]),cleanupStuckSessions:u.useCallback(y=>c(Q.cleanupStuckSessions,"cleanup-stuck-sessions",{useCache:!1},y),[c]),getSessionStats:u.useCallback(()=>c(Q.getAdminSessionStats,"admin-session-stats",{ttl:W.realtime}),[c]),getSystemHealth:u.useCallback(()=>c(Q.getSystemHealth,"admin-system-health",{ttl:W.realtime}),[c])},$={invalidateCache:Oe.invalidateCache,batchApiCalls:Oe.batchApiCalls,sequentialApiCalls:Oe.sequentialApiCalls,checkHealth:Oe.checkHealth,getApiStats:Oe.getApiStats};return{loading:s,error:a,performanceMetrics:d,documents:p,processing:h,search:j,stats:f,data:v,bm25:w,chat:g,settings:k,admin:E,utils:$,cancelRequest:S,clearError:l}},rr=()=>{const[s,t]=u.useState({bm25:[],semantic:[],combined:[]}),[a,n]=u.useState(!1),[r,i]=u.useState(null),l=gs(),o=u.useCallback((p,...h)=>R(void 0,[p,...h],function*(d,c={}){var k,E;const{filename:j="default",maxResults:f=10,bm25Weight:v=.5,semanticWeight:w=.5,enableBM25:g=!0,enableSemantic:S=!0}=c;n(!0),i(null);try{const $=[];g&&$.push(l.bm25.search(j,d,f).then(x=>({type:"bm25",data:(x==null?void 0:x.results)||[]})).catch(x=>({type:"bm25",data:[],error:V(D({},x),{severity:"medium",category:"search"})}))),S&&$.push(l.search.search({q:d,limit:f,type:"semantic"}).then(x=>({type:"semantic",data:(x==null?void 0:x.results)||[]})).catch(x=>({type:"semantic",data:[],error:V(D({},x),{severity:"medium",category:"search"})})));const y=yield Promise.all($),N=((k=y.find(x=>x.type==="bm25"))==null?void 0:k.data)||[],m=((E=y.find(x=>x.type==="semantic"))==null?void 0:E.data)||[],T=ir(N,m,v,w);return t({bm25:N,semantic:m,combined:T.slice(0,f)}),{bm25:N,semantic:m,combined:T.slice(0,f)}}catch($){throw i($.message),$}finally{n(!1)}}),[l]);return{results:s,loading:a,error:r,hybridSearch:o}},ir=(s,t,a,n)=>{const r=new Map;return s.forEach((i,l)=>{const o=i.chunk_id||i.id;r.set(o,V(D({},i),{bm25Score:i.score||0,bm25Rank:l+1,semanticScore:0,semanticRank:null,combinedScore:(i.score||0)*a,source:"bm25"}))}),t.forEach((i,l)=>{const o=i.chunk_id||i.id;if(r.has(o)){const d=r.get(o);d.semanticScore=i.score||0,d.semanticRank=l+1,d.combinedScore=d.bm25Score*a+(i.score||0)*n,d.source="hybrid"}else r.set(o,V(D({},i),{bm25Score:0,bm25Rank:null,semanticScore:i.score||0,semanticRank:l+1,combinedScore:(i.score||0)*n,source:"semantic"}))}),Array.from(r.values()).sort((i,l)=>l.combinedScore-i.combinedScore)},lr="modulepreload",cr=function(s){return"/"+s},Ds={},fs=function(t,a,n){if(!a||a.length===0)return t();const r=document.getElementsByTagName("link");return Promise.all(a.map(i=>{if(i=cr(i),i in Ds)return;Ds[i]=!0;const l=i.endsWith(".css"),o=l?'[rel="stylesheet"]':"";if(!!n)for(let p=r.length-1;p>=0;p--){const h=r[p];if(h.href===i&&(!l||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${o}`))return;const c=document.createElement("link");if(c.rel=l?"stylesheet":lr,l||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),l)return new Promise((p,h)=>{c.addEventListener("load",p),c.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>t()).catch(i=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i})},Fs=()=>{const{documents:s,handleDocumentSelect:t,settings:a}=Y(),[n,r]=u.useState([]),[i,l]=u.useState(new Set),[o,d]=u.useState(new Set),[c,p]=u.useState(new Set),[h,j]=u.useState(new Set),[f,v]=u.useState(8),w=u.useRef([]),g=u.useRef(new Map),S=u.useRef(null),k={queued:{bg:"bg-gray-700",text:"text-gray-300",border:"border-gray-600",icon:je,pulse:!1},processing:{bg:"bg-yellow-900",text:"text-yellow-300",border:"border-yellow-700",icon:Me,pulse:!0},completed:{bg:"bg-green-900",text:"text-green-300",border:"border-green-700",icon:re,pulse:!1},error:{bg:"bg-red-900",text:"text-red-300",border:"border-red-700",icon:le,pulse:!1}},E=()=>{if(!S.current)return 8;const m=S.current.offsetWidth,T=window.innerWidth>=768?192:window.innerWidth>=640?176:160,x=16,_=Math.floor((m+x)/(T+x));return Math.max(1,_)};u.useEffect(()=>{const m=()=>{const T=E();T!==f&&v(T)};return m(),window.addEventListener("resize",m),()=>window.removeEventListener("resize",m)},[f]),u.useEffect(()=>{const m=new Set(w.current.map(z=>z.id)),T=new Set(s.map(z=>z.id)),x=new Set([...T].filter(z=>!m.has(z)));x.size>0;const _=s.slice().sort((z,Z)=>new Date(Z.created_time||Z.processedAt)-new Date(z.created_time||z.processedAt)),I=w.current.slice().sort((z,Z)=>new Date(Z.created_time||Z.processedAt)-new Date(z.created_time||z.processedAt)),M=_[0],C=I[0];M&&(!C||M.id!==C.id)&&x.add(M.id);const b=new Set(w.current.filter(z=>z.processingStatus==="completed").map(z=>z.id)),A=new Set(s.filter(z=>z.processingStatus==="completed").map(z=>z.id)),O=new Set([...A].filter(z=>!b.has(z))),L=new Set([...x,...O]);if(L.size>0){L.forEach(ee=>{g.current.has(ee)&&(clearTimeout(g.current.get(ee)),g.current.delete(ee))});const z=new Set(w.current.filter(ee=>!L.has(ee.id)).map(ee=>ee.id));l(L),d(z);const Z=setTimeout(()=>{l(new Set),d(new Set),p(L);const ee=setTimeout(()=>{p(new Set),j(L);const de=setTimeout(()=>{j(te=>{const Ne=new Set(te);return L.forEach(Ve=>Ne.delete(Ve)),Ne}),L.forEach(te=>{g.current.delete(te)})},1e3);L.forEach(te=>{g.current.set(te,de)})},1900);L.forEach(de=>{g.current.set(de,ee)})},600);L.forEach(ee=>{g.current.set(ee,Z)})}const B=s.slice(0,f);r(B),w.current=s},[s,f]),u.useEffect(()=>()=>{g.current.forEach(m=>clearTimeout(m)),g.current.clear()},[]);const $=m=>({pdf:ae,url:Na,file:ae,book:Rs,article:ae,academic:jn,reference:Rs})[m]||ae,y=m=>m.title||m.url||"Untitled Document",N=m=>m.processingProgress?`${Math.round(m.processingProgress.percentage||0)}%`:"";return n.length===0?e.jsx("div",{className:"flex items-center justify-center min-h-[400px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-8xl mb-4",children:"🦙"}),e.jsx("h3",{className:"text-2xl font-bold mb-2",children:"No Documents Yet"}),e.jsx("p",{className:"text-lg text-gray-600 mb-4",children:"Your digital pasture is empty! Upload some content to get started."}),e.jsxs("div",{className:"text-sm text-gray-500 space-y-1",children:[e.jsx("p",{children:"• Upload PDFs, documents, or paste URLs"}),e.jsx("p",{children:"• AI will analyze and create contextual embeddings"}),e.jsx("p",{children:"• Search and chat with your processed content"})]})]})}):e.jsx("div",{className:"space-y-6",children:e.jsx("div",{ref:S,className:"flex gap-4 justify-start overflow-hidden",style:{alignItems:"flex-start"},children:n.map((m,T)=>{const x=k[m.processingStatus]||k.queued,_=$(m.contentType),I=x.icon,M=m.chunkCount||0,C=y(m),b=N(m),A=i.has(m.id),O=o.has(m.id),L=c.has(m.id),B=h.has(m.id),z=(A||L||B)&&m.processingStatus==="completed";return e.jsxs("div",{onClick:()=>t(m),className:`
                document-block relative overflow-hidden rounded-lg border-2 cursor-pointer p-3
                transition-all duration-300 hover:shadow-lg hover:shadow-primary-500/20
                ${x.bg} ${x.border} ${x.pulse?"animate-processing":""}
                ${A?"animate-slide-in-from-left":""}
                ${O?"animate-shift-right":""}
                ${L?"animate-highlight-new":""}
                ${B?"animate-fade-to-normal":""}
                ${z?"animate-mempool-glow":""}
                w-40 h-40 sm:w-44 sm:h-44 md:w-48 md:h-48 flex-shrink-0
              `,title:`${C} - ${m.processingStatus}`,style:{"--normal-border":x.border.includes("gray-600")?"#4b5563":x.border.includes("yellow-700")?"#a16207":x.border.includes("green-700")?"#15803d":x.border.includes("red-700")?"#b91c1c":"#4b5563","--normal-bg":x.bg.includes("gray-700")?"#374151":x.bg.includes("yellow-900")?"#451a03":x.bg.includes("green-900")?"#14532d":x.bg.includes("red-900")?"#450a0a":"#374151"},children:[e.jsx("div",{className:"absolute inset-0 opacity-5",children:e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-white to-transparent"})}),e.jsxs("div",{className:"relative h-full flex flex-col justify-between",children:[e.jsxs("div",{className:"flex items-start justify-between gap-1 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1 min-w-0 flex-1",children:[e.jsx(_,{className:"w-4 h-4 text-primary-400 flex-shrink-0"}),e.jsx("h3",{className:"font-semibold text-white truncate text-xs",children:C})]}),e.jsx(I,{className:`w-3 h-3 flex-shrink-0 ${x.text}`})]}),e.jsxs("div",{className:"space-y-1 flex-1",children:[m.summary&&e.jsx("p",{className:"text-xs text-gray-400 line-clamp-2",children:m.summary}),m.mainTopics&&m.mainTopics.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[m.mainTopics.slice(0,2).map((Z,ee)=>e.jsx("span",{className:"px-1.5 py-0.5 bg-primary-600 bg-opacity-20 text-primary-300 text-xs rounded-full",children:Z},ee)),m.mainTopics.length>2&&e.jsxs("span",{className:"px-1.5 py-0.5 text-gray-400 text-xs",children:["+",m.mainTopics.length-2]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2 pt-1 border-t border-gray-600 border-opacity-30",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:`text-xs font-medium ${x.text}`,children:m.processingStatus==="error"?"Error":`${M}`}),b&&e.jsx("span",{className:"text-xs text-gray-400",children:b})]}),m.usesContextualEmbedding&&e.jsx("div",{className:"flex items-center",title:"Uses Contextual Embeddings",children:e.jsx("span",{className:"text-xs font-bold text-green-400",children:"🧠"})})]}),m.processingStatus==="processing"&&m.processingProgress&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gray-700",children:e.jsx("div",{className:"h-full bg-yellow-400 transition-all duration-300",style:{width:`${m.processingProgress.percentage||0}%`}})})]})]},m.id||T)})})})},or=u.lazy(()=>fs(()=>import("./ProcessingQueue-637a4f45.js"),["assets/ProcessingQueue-637a4f45.js","assets/vendor-77d0a172.js","assets/icons-fbec3f3a.js","assets/utils-d9662bcb.js"])),dr=u.lazy(()=>fs(()=>import("./StatsPanel-7a2bea0c.js"),["assets/StatsPanel-7a2bea0c.js","assets/vendor-77d0a172.js","assets/icons-fbec3f3a.js","assets/utils-d9662bcb.js"])),ur=()=>{var w,g;const[s,t]=u.useState("documents"),[a,n]=u.useState([]),{documents:r,systemStats:i,sse:l,uploadQueue:o,api:d,loadSystemStats:c,refreshDocuments:p}=Y();u.useEffect(()=>{var y;const S=()=>R(void 0,null,function*(){try{const N=yield d.data.getInProgress();n(N||[])}catch(N){n([])}});S();const k=o.length>0||((y=i.processing)==null?void 0:y.totalProcessing)>0,$=setInterval(()=>R(void 0,null,function*(){yield S(),k&&(yield c())}),k?3e3:8e3);return()=>clearInterval($)},[d,o.length,(w=i.processing)==null?void 0:w.totalProcessing,c]),u.useEffect(()=>{if(!(l!=null&&l.lastMessage))return;const S=l.lastMessage,k=S.type||S.step;(k==="processing_complete"||k==="file_processing_complete"||k==="session_complete"||k==="document_created"||k==="content_processed")&&(c(),setTimeout(()=>{c()},1e3))},[l==null?void 0:l.lastMessage,c]);const j=(()=>{var x,_,I;const S=((x=i.knowledgeBase)==null?void 0:x.total_documents)||0,k=r.filter(M=>M.processingStatus==="processing").length,E=r.filter(M=>M.processingStatus==="completed").length,$=((_=i.knowledgeBase)==null?void 0:_.total_chunks)||0,y={total:o.length,pending:o.filter(M=>M.status==="pending").length,processing:o.filter(M=>M.status==="processing"||M.status==="uploading").length,completed:o.filter(M=>M.status==="completed").length,failed:o.filter(M=>M.status==="error").length},N=a.filter(M=>M.status==="processing").length,m=y.processing>0&&N===0?y.processing:0,T=Math.max(N,m);return{totalDocs:S,processingDocs:k,completedDocs:E,totalChunks:$,contextualDocs:((I=i.knowledgeBase)==null?void 0:I.contextual_documents)||0,uploadQueue:y,totalProcessingCount:T,apiProcessingCount:N}})(),f=[{id:"documents",label:"Documents",icon:wa,badge:j.totalDocs,component:Fs},{id:"processing",label:"Processing",icon:Te,badge:j.totalProcessingCount>0?j.totalProcessingCount:null,component:or},{id:"analytics",label:"Analytics",icon:et,badge:null,component:dr}],v=((g=f.find(S=>S.id===s))==null?void 0:g.component)||Fs;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ut,{label:"Total Documents",value:j.totalDocs,icon:"📚",trend:j.totalDocs>0?"+":""}),e.jsx(ut,{label:"Processing Queue",value:j.totalProcessingCount,icon:"⚡",trend:j.totalProcessingCount>0?"active":"empty",pulsing:j.totalProcessingCount>0}),e.jsx(ut,{label:"Total Chunks",value:j.totalChunks,icon:"✂️",trend:j.totalChunks>0?"ready":""}),e.jsx(ut,{label:"Contextual AI",value:j.contextualDocs,icon:"🧠",trend:j.contextualDocs>0?"enhanced":""})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center bg-gray-800 bg-opacity-50 rounded-lg p-1",children:f.map(S=>{const k=S.icon,E=s===S.id;return e.jsxs("button",{onClick:()=>t(S.id),className:`
                  flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all duration-200
                  ${E?"bg-primary-600 text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-gray-700"}
                `,children:[e.jsx(k,{className:"w-4 h-4"}),e.jsx("span",{children:S.label}),S.badge!==null&&S.badge>0&&e.jsx("span",{className:`
                    px-2 py-1 text-xs rounded-full font-bold
                    ${E?"bg-primary-800 text-primary-200":"bg-gray-600 text-gray-200"}
                  `,children:S.badge})]},S.id)})}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400"}),e.jsx("span",{className:"text-gray-400",children:"System Online"})]}),i.lastUpdated&&e.jsxs("div",{className:"text-gray-500",children:["Updated ",i.lastUpdated.toLocaleTimeString()]})]})]}),e.jsx("div",{className:"min-h-[500px]",children:e.jsx(u.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin w-6 h-6 border-2 border-primary-600 border-t-transparent rounded-full"}),e.jsx("span",{className:"text-gray-400",children:"Loading..."})]})}),children:e.jsx(v,{})})}),e.jsx(hr,{setActiveTab:t})]})},ut=({label:s,value:t,icon:a,trend:n,pulsing:r})=>e.jsx("div",{className:`card p-4 transition-all duration-300 ${r?"animate-pulse-slow ring-2 ring-primary-500 ring-opacity-50":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:t}),e.jsx("div",{className:"text-sm text-gray-400",children:s}),n&&e.jsx("div",{className:"text-xs text-primary-400 mt-1",children:n})]}),e.jsx("div",{className:`text-2xl transition-opacity duration-300 ${r?"opacity-80":"opacity-50"}`,children:a})]})}),hr=({setActiveTab:s})=>{const[t,a]=u.useState(!1),{setCurrentView:n}=Y(),r=()=>{n("processing"),a(!1)},i=()=>{n("processing"),a(!1)},l=()=>{s("analytics"),a(!1)};return e.jsxs("div",{className:"fixed bottom-6 right-6 z-40",children:[t&&e.jsxs("div",{className:"absolute bottom-16 right-0 bg-gray-800 rounded-lg shadow-2xl border border-gray-700 p-2 space-y-2 min-w-[200px]",children:[e.jsxs("button",{onClick:r,className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-gray-700 rounded-lg transition-colors",children:[e.jsx(Ue,{className:"w-4 h-4 text-primary-400"}),e.jsx("span",{children:"Upload Files"})]}),e.jsxs("button",{onClick:i,className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-gray-700 rounded-lg transition-colors",children:[e.jsx(wa,{className:"w-4 h-4 text-primary-400"}),e.jsx("span",{children:"Process URL"})]}),e.jsxs("button",{onClick:l,className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-gray-700 rounded-lg transition-colors",children:[e.jsx(et,{className:"w-4 h-4 text-primary-400"}),e.jsx("span",{children:"View Analytics"})]})]}),e.jsx("button",{onClick:()=>a(!t),className:`
          w-14 h-14 bg-primary-600 hover:bg-primary-500 rounded-full shadow-lg 
          flex items-center justify-center transition-all duration-300 group
          ${t?"rotate-45":"hover:scale-110"}
        `,children:e.jsx("div",{className:"text-2xl group-hover:scale-110 transition-transform",children:t?"✕":"🦙"})})]})},me=s=>!s||typeof s!="string"?s:s.replace(/\b\w/g,t=>t.toUpperCase()),ht=(s,t,a,n)=>{if(s){if(!a){if(n){n(s);return}return}if(typeof a=="function")try{a(s,t)}catch(r){}}},mr=({query:s,results:t,loading:a,error:n,mode:r,onSearchQueryChange:i,onTagSearch:l})=>{var S,k,E,$,y,N;const[o,d]=u.useState("combined"),[c,p]=u.useState("relevance"),{handleDocumentSelect:h,handleChunkSelect:j}=Y(),f=l||((m,T)=>{i&&i(m)});if(!i)return e.jsx("div",{className:"card",children:e.jsx("div",{className:"text-center py-12 text-gray-500",children:e.jsx("p",{children:"Loading search functionality..."})})});if(a)return e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-primary-400 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"ml-3 text-lg",children:"Searching your digital pasture..."})]})});if(n)return e.jsx("div",{className:"card",children:e.jsxs("div",{className:"text-red-400 p-6 bg-red-900 bg-opacity-20 rounded-lg border border-red-700",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Search Error"}),e.jsx("p",{children:n})]})});if(!t||!((S=t.combined)!=null&&S.length)&&!((k=t.bm25)!=null&&k.length)&&!((E=t.semantic)!=null&&E.length))return e.jsx("div",{className:"card",children:e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🦙"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"No Results Found"}),e.jsxs("p",{className:"text-gray-400",children:['No documents match your search for "',s,'". Try:']}),e.jsxs("ul",{className:"text-sm text-gray-500 mt-4 space-y-1",children:[e.jsx("li",{children:"• Using different keywords or synonyms"}),e.jsx("li",{children:"• Checking your spelling"}),e.jsx("li",{children:"• Using broader search terms"}),e.jsx("li",{children:"• Switching search modes (BM25 ↔ Semantic)"})]})]})});const w=(()=>{switch(o){case"bm25":return t.bm25||[];case"semantic":return t.semantic||[];default:return t.combined||[]}})(),g=xr(w,c);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Search Results"}),e.jsxs("p",{className:"text-gray-400",children:["Found ",w.length,' results for "',s,'"']})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("select",{value:c,onChange:m=>p(m.target.value),className:"input-primary text-sm",children:[e.jsx("option",{value:"relevance",children:"Sort by Relevance"}),e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"title",children:"Sort by Title"})]})})]}),r==="hybrid"&&e.jsxs("div",{className:"flex items-center gap-2 bg-gray-800 rounded-lg p-1",children:[e.jsx(Kt,{id:"combined",label:"Combined",icon:tt,count:(($=t.combined)==null?void 0:$.length)||0,active:o==="combined",onClick:()=>d("combined"),color:"text-purple-400"}),e.jsx(Kt,{id:"bm25",label:"BM25",icon:ke,count:((y=t.bm25)==null?void 0:y.length)||0,active:o==="bm25",onClick:()=>d("bm25"),color:"text-yellow-400"}),e.jsx(Kt,{id:"semantic",label:"Semantic",icon:X,count:((N=t.semantic)==null?void 0:N.length)||0,active:o==="semantic",onClick:()=>d("semantic"),color:"text-blue-400"})]})]}),e.jsx("div",{className:"space-y-4",children:g.map((m,T)=>e.jsx(pr,{result:m,query:s,rank:T+1,viewMode:o,onDocumentSelect:h,onChunkSelect:j,onSearchQueryChange:i,onTagSearch:f},m.chunk_id||m.id||T))}),w.length>=20&&e.jsx("div",{className:"text-center",children:e.jsx("button",{className:"btn-secondary",children:"Load More Results"})})]})},Kt=({id:s,label:t,icon:a,count:n,active:r,onClick:i,color:l})=>e.jsxs("button",{onClick:i,className:`
      flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all duration-200
      ${r?`bg-gray-700 ${l}`:"text-gray-400 hover:text-white hover:bg-gray-700"}
    `,children:[e.jsx(a,{className:"w-4 h-4"}),e.jsx("span",{children:t}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full font-bold ${r?"bg-gray-600":"bg-gray-700"}`,children:n})]}),pr=({result:s,query:t,rank:a,viewMode:n,onDocumentSelect:r,onChunkSelect:i,onSearchQueryChange:l,onTagSearch:o})=>{var f,v,w;const[d,c]=u.useState(!1),h=(()=>n==="combined"&&s.combinedScore!==void 0?{score:s.combinedScore,label:"Combined Score",color:"text-purple-400"}:n==="bm25"&&s.bm25Score!==void 0?{score:s.bm25Score,label:"BM25 Score",color:"text-yellow-400"}:n==="semantic"&&s.semanticScore!==void 0?{score:s.semanticScore,label:"Semantic Score",color:"text-blue-400"}:s.score!==void 0?{score:s.score,label:"Relevance",color:"text-gray-400"}:null)(),j=(g,S)=>{if(!g||!S)return g;const k=S.toLowerCase().split(/\s+/);let E=g;return k.forEach($=>{const y=new RegExp(`(${$})`,"gi");E=E.replace(y,'<mark class="bg-yellow-300 bg-opacity-30 text-yellow-200 px-1 rounded">$1</mark>')}),E};return e.jsx("div",{className:"card hover:shadow-lg hover:shadow-primary-500/10 transition-all duration-300",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsxs("span",{className:"text-sm font-bold text-primary-400",children:["#",a]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-lg text-white mb-1 truncate",children:s.title||s.url||"Untitled Document"}),e.jsxs("p",{className:"text-sm text-gray-400 mb-2",children:["Chunk ",s.chunk_index||"N/A"," •",e.jsx("button",{onClick:()=>ht(s.content_type,"content_type",o,l),className:"text-gray-400 hover:text-gray-200 underline cursor-pointer transition-colors mx-1",title:`Search for "${me(s.content_type)}" content type`,children:me(s.content_type||"Unknown Type")}),s.technical_level&&e.jsxs(e.Fragment,{children:["•",e.jsx("button",{onClick:()=>ht(s.technical_level,"technical_level",o,l),className:"text-gray-400 hover:text-gray-200 underline cursor-pointer transition-colors mx-1",title:`Search for "${me(s.technical_level)}" technical level`,children:me(s.technical_level)})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 ml-4",children:[h&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-lg font-bold ${h.color}`,children:h.score.toFixed(3)}),e.jsx("div",{className:"text-xs text-gray-500",children:h.label})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>i(s),className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",title:"Inspect Chunk",children:e.jsx(ms,{className:"w-4 h-4 text-gray-400"})}),e.jsx("button",{onClick:()=>c(!d),className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",title:"Toggle Details",children:e.jsx(Sa,{className:`w-4 h-4 text-gray-400 transform transition-transform ${d?"rotate-90":""}`})})]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed",dangerouslySetInnerHTML:{__html:j(((f=s.chunk_text)==null?void 0:f.substring(0,300))+(((v=s.chunk_text)==null?void 0:v.length)>300?"...":"")||"No content available",t)}})}),s.contextual_summary&&e.jsxs("div",{className:"mb-3 p-3 bg-blue-900 bg-opacity-20 border border-blue-700 border-opacity-30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(X,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-sm font-medium text-blue-300",children:"Contextual Summary"})]}),e.jsx("p",{className:"text-sm text-blue-200 italic",dangerouslySetInnerHTML:{__html:j(s.contextual_summary,t)}})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[(w=s.main_topics)==null?void 0:w.slice(0,3).map((g,S)=>e.jsx("button",{onClick:()=>ht(g,"main_topics",o,l),className:"px-2 py-1 bg-primary-600 bg-opacity-20 text-primary-300 text-xs rounded-full hover:bg-primary-600 hover:bg-opacity-40 hover:text-primary-200 transition-colors cursor-pointer",title:`Search for "${me(g)}"`,children:me(g)},S)),s.sentiment&&e.jsx("button",{onClick:()=>ht(s.sentiment,"sentiment",o,l),className:`px-2 py-1 text-xs rounded-full transition-colors cursor-pointer ${s.sentiment==="positive"?"bg-green-600 bg-opacity-20 text-green-300 hover:bg-green-600 hover:bg-opacity-40 hover:text-green-200":s.sentiment==="negative"?"bg-red-600 bg-opacity-20 text-red-300 hover:bg-red-600 hover:bg-opacity-40 hover:text-red-200":"bg-gray-600 bg-opacity-20 text-gray-300 hover:bg-gray-600 hover:bg-opacity-40 hover:text-gray-200"}`,title:`Search for "${me(s.sentiment)}" sentiment`,children:me(s.sentiment)}),s.uses_contextual_embedding&&e.jsxs("span",{className:"px-2 py-1 bg-blue-600 bg-opacity-20 text-blue-300 text-xs rounded-full flex items-center gap-1",children:[e.jsx(X,{className:"w-3 h-3"}),"Enhanced"]})]}),d&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700 space-y-3 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Source:"}),e.jsx("span",{className:"ml-2",children:s.source||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Processing Status:"}),e.jsx("span",{className:"ml-2",children:s.status||"Completed"})]}),s.emotions&&s.emotions.length>0&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-gray-400",children:"Emotions:"}),e.jsx("span",{className:"ml-2",children:(()=>(Array.isArray(s.emotions),(Array.isArray(s.emotions)?s.emotions:[]).map(me).join(", ")))()})]}),s.key_concepts&&s.key_concepts.length>0&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-gray-400",children:"Key Concepts:"}),e.jsx("span",{className:"ml-2",children:(()=>(Array.isArray(s.key_concepts),(Array.isArray(s.key_concepts)?s.key_concepts:[]).map(me).join(", ")))()})]})]}),n==="combined"&&(s.bm25Score||s.semanticScore)&&e.jsxs("div",{className:"flex items-center gap-6 pt-2 border-t border-gray-700",children:[s.bm25Score!==void 0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4 text-yellow-400"}),e.jsxs("span",{className:"text-yellow-400",children:["BM25: ",s.bm25Score.toFixed(3)]})]}),s.semanticScore!==void 0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-blue-400"}),e.jsxs("span",{className:"text-blue-400",children:["Semantic: ",s.semanticScore.toFixed(3)]})]})]})]})]})]})})},xr=(s,t)=>{switch(t){case"date":return[...s].sort((a,n)=>new Date(n.created_at||n.timestamp||0)-new Date(a.created_at||a.timestamp||0));case"title":return[...s].sort((a,n)=>(a.title||a.url||"").localeCompare(n.title||n.url||""));case"relevance":default:return[...s].sort((a,n)=>(n.combinedScore||n.score||0)-(a.combinedScore||a.score||0))}},gr=()=>{const{settings:s,handleSearchQueryChange:t,searchQuery:a}=Y(),[n,r]=u.useState(""),[i,l]=u.useState("hybrid"),[o,d]=u.useState({contentType:"",technicalLevel:"",sentiment:"",dateRange:"",hasContextual:null}),[c,p]=u.useState(!1),[h,j]=u.useState([]),[f,v]=u.useState(!1),[w,g]=u.useState({combined:[],bm25:[],semantic:[]}),[S,k]=u.useState(null);rr();const E=u.useRef(null),$=u.useRef(null),y=u.useCallback((b,A,O)=>R(void 0,null,function*(){try{$.current&&$.current.abort(),$.current=new AbortController,v(!0),k(null);const L=performance.now(),B=yield fetch(`/api/search?q=${encodeURIComponent(b)}&limit=${s.search.maxSearchResults||50}`,{signal:$.current.signal,headers:{"Cache-Control":"no-cache"}});if(!B.ok)throw new Error(`Search failed: ${B.status}`);const z=yield B.json(),Z=z.results||z||[],ee=performance.now()-L;g({combined:Z,bm25:O==="bm25"?Z:[],semantic:O==="semantic"?Z:[]})}catch(L){if(L.name==="AbortError")return;k(L.message),g({combined:[],bm25:[],semantic:[]})}finally{v(!1),$.current=null}}),[s.search.maxSearchResults]);u.useEffect(()=>{a&&a!==n&&(r(a),a.trim()&&y(a,o,i))},[a,n,y,o,i]),u.useEffect(()=>{if(s.search.enableSearchHistory){const b=JSON.parse(localStorage.getItem("autollama-search-history")||"[]");j(b.slice(0,10))}},[s.search.enableSearchHistory]);const N=u.useCallback((b,A,O)=>{E.current&&clearTimeout(E.current),$.current&&$.current.abort(),E.current=setTimeout(()=>R(void 0,null,function*(){if(b.trim().length<2){g({combined:[],bm25:[],semantic:[]});return}try{yield y(b,A,O),s.search.enableSearchHistory&&j(L=>{const B=[{query:b,timestamp:new Date().toISOString(),mode:O},...L.filter(z=>z.query!==b)].slice(0,10);return setTimeout(()=>{localStorage.setItem("autollama-search-history",JSON.stringify(B))},0),B})}catch(L){}}),300)},[y,s.search.enableSearchHistory]),m=u.useCallback((b,A="tags")=>R(void 0,null,function*(){try{v(!0);const L=yield(yield fetch(`/api/search/tags?tag=${encodeURIComponent(b)}&field=${A}&limit=${s.search.maxSearchResults||50}`)).json();if(L.success){const B={combined:L.results||[],bm25:[],semantic:[]};g(B),r(`tag:${b}`),t(`tag:${b}`),k(null)}else throw new Error(L.error||"Tag search failed")}catch(O){k(`Tag search failed: ${O.message}`),g({combined:[],bm25:[],semantic:[]})}finally{v(!1)}}),[s.search.maxSearchResults,t]),T=b=>{r(b),b.trim()?N(b,o,i):(g({combined:[],bm25:[],semantic:[]}),t(""))},x=b=>{l(b),n.trim()&&N(n,o,b)},_=(b,A)=>{const O=V(D({},o),{[b]:A});d(O),n.trim()&&N(n,O,i)},I=()=>{r(""),g({combined:[],bm25:[],semantic:[]}),k(null),t(""),E.current&&clearTimeout(E.current),$.current&&$.current.abort()};u.useEffect(()=>()=>{E.current&&clearTimeout(E.current),$.current&&$.current.abort()},[]);const M=u.useMemo(()=>[{id:"hybrid",label:"Hybrid",icon:tt,description:"Best of both lexical and semantic search",color:"text-purple-400",bgColor:"bg-purple-600"},{id:"bm25",label:"BM25",icon:ke,description:"Fast lexical search for exact matches",color:"text-yellow-400",bgColor:"bg-yellow-600"},{id:"semantic",label:"Semantic",icon:X,description:"AI-powered contextual understanding",color:"text-blue-400",bgColor:"bg-blue-600"}],[]),C=M.find(b=>b.id===i);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsx(Ee,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx(Da,{placeholder:"Search across all your documents...",value:n,onChange:T,className:"input-primary pl-12 pr-20 text-lg h-14"}),n&&e.jsx("button",{onClick:I,className:"absolute right-12 top-1/2 transform -translate-y-1/2 p-1 hover:bg-gray-700 rounded",children:e.jsx(ve,{className:"w-4 h-4 text-gray-400"})}),e.jsx("div",{className:`absolute right-4 top-1/2 transform -translate-y-1/2 ${C.color}`,children:f?e.jsx("div",{className:"w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx(C.icon,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Search Mode:"}),e.jsx("div",{className:"flex items-center gap-1 bg-gray-800 rounded-lg p-1",children:M.map(b=>{const A=b.icon,O=i===b.id;return e.jsxs("button",{onClick:()=>x(b.id),className:`
                      flex items-center gap-2 px-3 py-1 rounded-md text-sm font-medium transition-all duration-200
                      ${O?`${b.bgColor} bg-opacity-20 ${b.color}`:"text-gray-400 hover:text-white hover:bg-gray-700"}
                    `,title:b.description,children:[e.jsx(A,{className:"w-3 h-3"}),e.jsx("span",{children:b.label})]},b.id)})})]}),e.jsxs("button",{onClick:()=>p(!c),className:`flex items-center gap-2 px-3 py-1 rounded-lg text-sm transition-colors ${c?"bg-primary-600 bg-opacity-20 text-primary-400":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:[e.jsx(vn,{className:"w-4 h-4"}),e.jsx("span",{children:"Filters"}),Object.values(o).filter(Boolean).length>0&&e.jsx("span",{className:"px-2 py-1 bg-primary-600 rounded-full text-xs font-bold",children:Object.values(o).filter(Boolean).length})]})]})]}),c&&e.jsx(fr,{filters:o,onFilterChange:_,onClearFilters:()=>d({contentType:"",technicalLevel:"",sentiment:"",dateRange:"",hasContextual:null})}),h.length>0&&!n&&e.jsx(yr,{history:h,onSelectQuery:b=>{r(b.query),l(b.mode),T(b.query)},onClearHistory:()=>{j([]),localStorage.removeItem("autollama-search-history")}}),n&&e.jsx(mr,{query:n,results:w,loading:f,error:S,mode:i,onSearchQueryChange:t,onTagSearch:m})]})},fr=({filters:s,onFilterChange:t,onClearFilters:a})=>e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-bold flex items-center gap-2",children:[e.jsx(_a,{className:"w-4 h-4"}),"Search Filters"]}),e.jsx("button",{onClick:a,className:"text-sm text-gray-400 hover:text-white",children:"Clear All"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Content Type"}),e.jsxs("select",{value:s.contentType,onChange:n=>t("contentType",n.target.value),className:"input-primary",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"article",children:"Articles"}),e.jsx("option",{value:"academic",children:"Academic Papers"}),e.jsx("option",{value:"book",children:"Books"}),e.jsx("option",{value:"reference",children:"Reference"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Technical Level"}),e.jsxs("select",{value:s.technicalLevel,onChange:n=>t("technicalLevel",n.target.value),className:"input-primary",children:[e.jsx("option",{value:"",children:"All Levels"}),e.jsx("option",{value:"beginner",children:"Beginner"}),e.jsx("option",{value:"intermediate",children:"Intermediate"}),e.jsx("option",{value:"advanced",children:"Advanced"}),e.jsx("option",{value:"PhD_required",children:"PhD Required"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Sentiment"}),e.jsxs("select",{value:s.sentiment,onChange:n=>t("sentiment",n.target.value),className:"input-primary",children:[e.jsx("option",{value:"",children:"All Sentiments"}),e.jsx("option",{value:"positive",children:"Positive"}),e.jsx("option",{value:"neutral",children:"Neutral"}),e.jsx("option",{value:"negative",children:"Negative"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Has Contextual"}),e.jsxs("select",{value:s.hasContextual===null?"":s.hasContextual.toString(),onChange:n=>t("hasContextual",n.target.value===""?null:n.target.value==="true"),className:"input-primary",children:[e.jsx("option",{value:"",children:"All Documents"}),e.jsx("option",{value:"true",children:"Enhanced with Context"}),e.jsx("option",{value:"false",children:"Standard Processing"})]})]})]})]}),yr=({history:s,onSelectQuery:t,onClearHistory:a})=>e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-bold flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4"}),"Recent Searches"]}),e.jsx("button",{onClick:a,className:"text-sm text-gray-400 hover:text-white",children:"Clear History"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map((n,r)=>e.jsxs("button",{onClick:()=>t(n),className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm transition-colors",children:[e.jsx("span",{children:n.query}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",n.mode,")"]})]},r))})]}),Da=hs.memo(({placeholder:s,value:t,onChange:a,className:n})=>{const r=u.useCallback(i=>{a(i.target.value)},[a]);return e.jsx("input",{type:"text",placeholder:s,value:t,onChange:r,className:n,autoComplete:"off"})});Da.displayName="SearchInput";const br=()=>e.jsx("div",{className:"space-y-6",children:e.jsx(gr,{})}),zs=({onSettingsChange:s})=>{const{settings:t,connectionStatus:a,updateCategory:n}=Y(),[r,i]=u.useState(t.connections),[l,o]=u.useState({}),[d,c]=u.useState({all:!1,claude:!1}),[p,h]=u.useState({}),[j,f]=u.useState(!0),[v,w]=u.useState(!1);u.useEffect(()=>{(()=>R(void 0,null,function*(){try{f(!0);const T=yield he.loadSettingsFromDatabase();i(T.connections),n("connections",T.connections)}catch(T){i(t.connections)}finally{f(!1)}}))()},[]),u.useEffect(()=>{j||i(t.connections)},[t.connections,j]);const g=(m,T)=>R(void 0,null,function*(){const x=V(D({},r),{[m]:T});i(x),n("connections",x),s(),w(!0);try{yield he.saveConnectionsToDatabase(x)}catch(_){}finally{setTimeout(()=>w(!1),500)}}),S=m=>{o(T=>V(D({},T),{[m]:!T[m]}))},k=()=>R(void 0,null,function*(){c(m=>V(D({},m),{all:!0}));try{const m={connections:r},T=yield he.validateConnections(m);h(T)}catch(m){h({openai:!1,claude:!1,qdrant:!1,database:!1,bm25:!1})}finally{c(m=>V(D({},m),{all:!1}))}}),E=m=>R(void 0,null,function*(){c(V(D({},d),{[m]:!0}));try{if(m==="claude"){const T=yield $(r.claudeApiKey);h(x=>V(D({},x),{claude:T.success})),T.success}}catch(T){h(x=>V(D({},x),{[m]:!1}))}finally{c(T=>V(D({},T),{[m]:!1}))}}),$=m=>R(void 0,null,function*(){if(!m||!m.trim())return{success:!1,error:"API key is required"};try{return yield(yield fetch("/api/test-claude",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:m.trim()})})).json()}catch(T){return{success:!1,error:T.message}}}),y=m=>{const T=a[m],x=p[m];return d?e.jsx(oe,{className:"w-4 h-4 text-yellow-400 animate-spin"}):x!==void 0?x?e.jsx(re,{className:"w-4 h-4 text-green-400"}):e.jsx(le,{className:"w-4 h-4 text-red-400"}):T?e.jsx(re,{className:"w-4 h-4 text-green-400"}):e.jsx(le,{className:"w-4 h-4 text-gray-400"})},N=[{id:"openai",title:"OpenAI API",description:"GPT models for AI analysis and contextual embeddings",icon:X,fields:[{key:"openaiApiKey",label:"API Key",type:"password",placeholder:"sk-proj-...",required:!0,help:"Get your API key from https://platform.openai.com/api-keys"}]},{id:"claude",title:"Anthropic Claude",description:"Claude models for advanced reasoning and analysis",icon:Je,fields:[{key:"claudeApiKey",label:"API Key",type:"password",placeholder:"sk-ant-api03-...",required:!1,help:"Get your API key from https://console.anthropic.com/"}]},{id:"qdrant",title:"Qdrant Vector Database",description:"Semantic search and vector embeddings storage",icon:Ee,fields:[{key:"qdrantUrl",label:"Cluster URL",type:"url",placeholder:"https://your-cluster.qdrant.io",required:!0,help:"Your Qdrant cluster URL from the cloud dashboard"},{key:"qdrantApiKey",label:"API Key",type:"password",placeholder:"Enter your Qdrant API key",required:!0,help:"API key for your Qdrant cluster"}]},{id:"database",title:"PostgreSQL Database",description:"Structured metadata and document storage",icon:De,fields:[{key:"databaseUrl",label:"Connection String",type:"password",placeholder:"postgresql://user:pass@host:5432/db",required:!0,help:"Full PostgreSQL connection string"}]}];return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold flex items-center gap-3",children:[e.jsx(Ca,{className:"w-6 h-6 text-primary-400"}),"Connection Settings",v&&e.jsxs("span",{className:"text-sm text-yellow-400 flex items-center gap-1",children:[e.jsx(oe,{className:"w-3 h-3 animate-spin"}),"Saving..."]})]}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Configure API keys and database connections for AutoLlama services"})]}),e.jsxs("button",{onClick:k,disabled:d.all,className:"btn-primary",children:[e.jsx(oe,{className:`w-4 h-4 ${d.all?"animate-spin":""}`}),d.all?"Testing...":"Test All"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(mt,{title:"OpenAI",status:a.openai,testResult:p.openai,testing:d}),e.jsx(mt,{title:"Qdrant",status:a.qdrant,testResult:p.qdrant,testing:d}),e.jsx(mt,{title:"PostgreSQL",status:a.database,testResult:p.database,testing:d}),e.jsx(mt,{title:"BM25 Search",status:a.bm25,testResult:p.bm25,testing:d})]}),j&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center gap-3 text-gray-400",children:[e.jsx(oe,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Loading connection settings..."})]})}),!j&&e.jsx("div",{className:"space-y-6",children:N.map(m=>{const T=m.icon;return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsx(T,{className:"w-5 h-5 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold",children:m.title}),e.jsx("p",{className:"text-sm text-gray-400",children:m.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[y(m.id),e.jsx("span",{className:"text-sm text-gray-400",children:a[m.id]?"Connected":"Disconnected"})]})]}),e.jsx("div",{className:"space-y-4",children:m.fields.map(x=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300",children:[x.label,x.required&&e.jsx("span",{className:"text-red-400 ml-1",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:x.type==="password"&&!l[x.key]?"password":"text",value:r[x.key]||"",onChange:_=>g(x.key,_.target.value),placeholder:x.placeholder,className:"input-primary pr-12",required:x.required}),x.type==="password"&&e.jsx("button",{type:"button",onClick:()=>S(x.key),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white",children:l[x.key]?e.jsx(Nn,{className:"w-4 h-4"}):e.jsx(ms,{className:"w-4 h-4"})})]}),x.key==="claudeApiKey"&&r[x.key]&&e.jsx("button",{onClick:()=>E("claude"),disabled:d.claude,className:"btn-secondary px-3 py-2 text-sm",title:"Test Claude API connection",children:d.claude?e.jsx(oe,{className:"w-4 h-4 animate-spin"}):"Test"})]}),x.help&&e.jsx("p",{className:"text-xs text-gray-500",children:x.help})]},x.key))}),p[m.id]!==void 0&&e.jsx("div",{className:`mt-4 p-3 rounded-lg border ${p[m.id]?"bg-green-900 bg-opacity-20 border-green-700 text-green-300":"bg-red-900 bg-opacity-20 border-red-700 text-red-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[p[m.id]?e.jsx(re,{className:"w-4 h-4"}):e.jsx(le,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:p[m.id]?`${m.title} connection successful`:`${m.title} connection failed`})]})})]},m.id)})}),!j&&e.jsx("div",{className:"card bg-yellow-900 bg-opacity-20 border-yellow-700",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(wn,{className:"w-5 h-5 text-yellow-400 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-yellow-300 mb-2",children:"Security Notice"}),e.jsxs("div",{className:"text-sm text-yellow-200 space-y-1",children:[e.jsx("p",{children:"• API keys are stored securely in the database and synchronized with environment variables"}),e.jsx("p",{children:"• Keys are never transmitted to external servers except their respective APIs"}),e.jsx("p",{children:"• Changes take effect immediately and are automatically saved"}),e.jsx("p",{children:"• Regularly rotate your API keys for enhanced security"})]})]})]})})]})},mt=({title:s,status:t,testResult:a,testing:n})=>{const r=()=>n?"border-yellow-500 text-yellow-400":a!==void 0?a?"border-green-500 text-green-400":"border-red-500 text-red-400":t?"border-green-500 text-green-400":"border-gray-500 text-gray-400",i=()=>n?e.jsx(oe,{className:"w-4 h-4 animate-spin"}):a!==void 0?a?e.jsx(re,{className:"w-4 h-4"}):e.jsx(le,{className:"w-4 h-4"}):t?e.jsx(re,{className:"w-4 h-4"}):e.jsx(le,{className:"w-4 h-4"}),l=()=>n?"Testing...":a!==void 0?a?"Connected":"Failed":t?"Connected":"Offline";return e.jsxs("div",{className:`p-4 rounded-lg border-2 transition-colors ${r()}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium",children:s}),i()]}),e.jsx("div",{className:"text-sm opacity-80",children:l()})]})},jr=({onSettingsChange:s})=>{var C,b;const{settings:t,updateCategory:a,api:n}=Y(),[r,i]=u.useState(t.pipeline),[l,o]=u.useState({}),[d,c]=u.useState(!1),[p,h]=u.useState(null),[j,f]=u.useState(null),[v,w]=u.useState({}),[g,S]=u.useState(!1);u.useEffect(()=>{i(t.pipeline),E(),$()},[t.pipeline]);const k=((C=t.connections)==null?void 0:C.claudeApiKey)&&t.connections.claudeApiKey.trim().length>0,E=()=>R(void 0,null,function*(){try{const A=yield n.stats.getPipelineHealth();f(A)}catch(A){}}),$=()=>R(void 0,null,function*(){try{const A=yield n.getRagSettings();o(A.data.settings||{})}catch(A){o({ragModel:"gpt-4o-mini",ragMaxTokens:1e3,ragTemperature:.7,searchLimit:5})}}),y=A=>R(void 0,null,function*(){S(!0);try{const O=yield n.updateRagSettings(A);o(O.data.settings||A)}catch(O){}finally{S(!1)}}),N=(A,O)=>{const L=V(D({},r),{[A]:O});i(L),a("pipeline",L),s()},m=(A,O)=>{const L=V(D({},l),{[A]:O});o(L),m.timeout&&clearTimeout(m.timeout),m.timeout=setTimeout(()=>{y(L)},1e3)},T=()=>R(void 0,null,function*(){c(!0);try{const A=yield n.stats.getPipelineHealth();h({success:!0,message:"Pipeline connection successful",details:A})}catch(A){h({success:!1,message:"Pipeline connection failed",error:A.message})}finally{c(!1)}}),x=(A,O)=>{navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(A).then(()=>{w(L=>V(D({},L),{[O]:!0})),setTimeout(()=>w(L=>V(D({},L),{[O]:!1})),2e3)}).catch(()=>{_(A,O)}):_(A,O)},_=(A,O)=>{const L=document.createElement("textarea");L.value=A,L.style.top="0",L.style.left="0",L.style.position="fixed",document.body.appendChild(L),L.focus(),L.select();try{document.execCommand("copy"),w(B=>V(D({},B),{[O]:!0})),setTimeout(()=>w(B=>V(D({},B),{[O]:!1})),2e3)}catch(B){}document.body.removeChild(L)},I=()=>"http://autollama-on-hstgr:3001/api/openwebui",M=()=>["http://autollama-on-hstgr-4:3001/api/openwebui","http://localhost:9099","https://autollama.io:9099"];return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold flex items-center gap-3",children:[e.jsx(ke,{className:"w-6 h-6 text-primary-400"}),"OpenWebUI Pipeline"]}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Configure RAG pipeline for intelligent conversations with your processed content"})]}),e.jsxs("button",{onClick:T,disabled:d,className:"btn-primary",children:[e.jsx(Ms,{className:`w-4 h-4 ${d?"animate-spin":""}`}),d?"Testing...":"Test Pipeline"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Gt,{title:"Pipeline Status",status:j==null?void 0:j.status,icon:ke,description:"OpenWebUI service connectivity"}),e.jsx(Gt,{title:"Collection",status:r.collectionName,icon:De,description:"Qdrant collection name"}),e.jsx(Gt,{title:"Debug Mode",status:r.debugMode,icon:Ms,description:"Detailed logging enabled"})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"text-lg font-bold mb-6 flex items-center gap-2",children:[e.jsx(Rt,{className:"w-5 h-5 text-primary-400"}),"Connection Settings"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300",children:["Pipeline URL",e.jsx("span",{className:"text-red-400 ml-1",children:"*"})]}),e.jsx("input",{type:"url",value:r.pipelineUrl,onChange:A=>N("pipelineUrl",A.target.value),placeholder:"http://autollama-on-hstgr:3001/api/openwebui",className:"input-primary",required:!0}),e.jsx("p",{className:"text-xs text-gray-500",children:"URL where the OpenWebUI pipeline service is running"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300",children:["API Key",e.jsx("span",{className:"text-red-400 ml-1",children:"*"})]}),e.jsx("input",{type:"text",value:r.apiKey,onChange:A=>N("apiKey",A.target.value),placeholder:"0p3n-w3bu!",className:"input-primary font-mono",required:!0}),e.jsx("p",{className:"text-xs text-gray-500",children:"Authentication key for pipeline access"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300",children:["Collection Name",e.jsx("span",{className:"text-red-400 ml-1",children:"*"})]}),e.jsx("input",{type:"text",value:r.collectionName,onChange:A=>N("collectionName",A.target.value),placeholder:"autollama-content",className:"input-primary font-mono",required:!0}),e.jsx("p",{className:"text-xs text-gray-500",children:"Qdrant collection to search for RAG operations"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Max Results"}),e.jsx("input",{type:"number",min:"1",max:"50",value:r.maxResults,onChange:A=>N("maxResults",parseInt(A.target.value)),className:"input-primary"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Maximum number of results to return per search"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"text-lg font-bold mb-6 flex items-center gap-2",children:[e.jsx(_a,{className:"w-5 h-5 text-primary-400"}),"Search & Retrieval Settings"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Similarity Threshold"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.1",value:r.similarityThreshold,onChange:A=>N("similarityThreshold",parseFloat(A.target.value)),className:"flex-1"}),e.jsx("span",{className:"text-sm font-mono bg-gray-800 px-2 py-1 rounded",children:r.similarityThreshold.toFixed(1)})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Minimum similarity score for results (0.1 = loose, 1.0 = strict)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:r.debugMode,onChange:A=>N("debugMode",A.target.checked),className:"rounded"}),"Debug Mode"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Enable detailed logging for troubleshooting pipeline issues"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h4",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(Ze,{className:"w-5 h-5 text-primary-400"}),"RAG Model Configuration"]}),g&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-400",children:[e.jsx(oe,{className:"w-4 h-4 animate-spin"}),"Saving settings..."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300",children:["Language Model",e.jsx("span",{className:"text-red-400 ml-1",children:"*"})]}),e.jsxs("select",{value:l.ragModel||"gpt-4o-mini",onChange:A=>m("ragModel",A.target.value),className:"input-primary",disabled:g,children:[e.jsxs("optgroup",{label:"OpenAI Models",children:[e.jsx("option",{value:"gpt-4o-mini",children:"GPT-4o Mini (Fast & Cost-Effective)"}),e.jsx("option",{value:"gpt-4o",children:"GPT-4o (Most Capable)"}),e.jsx("option",{value:"gpt-4",children:"GPT-4 (Flagship Model)"}),e.jsx("option",{value:"gpt-3.5-turbo",children:"GPT-3.5 Turbo (Budget)"})]}),k&&e.jsxs("optgroup",{label:"Anthropic Models",children:[e.jsx("option",{value:"claude-3-5-sonnet-20241022",children:"Claude 3.5 Sonnet (Most Capable)"}),e.jsx("option",{value:"claude-3-5-haiku-20241022",children:"Claude 3.5 Haiku (Fast & Efficient)"}),e.jsx("option",{value:"claude-3-opus-20240229",children:"Claude 3 Opus (Creative & Complex)"})]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Language model used to interpret and synthesize RAG search results"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Max Tokens"}),e.jsx("input",{type:"number",min:"100",max:"4000",value:l.ragMaxTokens||1e3,onChange:A=>m("ragMaxTokens",parseInt(A.target.value)),className:"input-primary",disabled:g}),e.jsx("p",{className:"text-xs text-gray-500",children:"Maximum tokens for RAG model responses"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Temperature"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"0.0",max:"1.0",step:"0.1",value:l.ragTemperature||.7,onChange:A=>m("ragTemperature",parseFloat(A.target.value)),className:"flex-1",disabled:g}),e.jsx("span",{className:"text-sm font-mono bg-gray-800 px-2 py-1 rounded",children:(l.ragTemperature||.7).toFixed(1)})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Creativity level (0.0 = focused, 1.0 = creative)"})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700",children:[e.jsx("h5",{className:"font-medium text-gray-300 mb-3",children:"Model Comparison"}),e.jsxs("div",{className:`grid grid-cols-1 md:grid-cols-2 ${k?"lg:grid-cols-4 xl:grid-cols-7":"lg:grid-cols-4"} gap-4 text-xs`,children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-blue-400",children:"GPT-4o Mini"}),e.jsx("div",{className:"text-gray-500",children:"Fast, cost-effective"}),e.jsx("div",{className:"text-gray-500",children:"Best for most RAG tasks"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-purple-400",children:"GPT-4o"}),e.jsx("div",{className:"text-gray-500",children:"Most capable"}),e.jsx("div",{className:"text-gray-500",children:"Complex reasoning"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-green-400",children:"GPT-4"}),e.jsx("div",{className:"text-gray-500",children:"Flagship model"}),e.jsx("div",{className:"text-gray-500",children:"Proven reliability"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-yellow-400",children:"GPT-3.5 Turbo"}),e.jsx("div",{className:"text-gray-500",children:"Budget option"}),e.jsx("div",{className:"text-gray-500",children:"Faster responses"})]}),k&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-orange-400",children:"Claude 3.5 Sonnet"}),e.jsx("div",{className:"text-gray-500",children:"Superior reasoning"}),e.jsx("div",{className:"text-gray-500",children:"Excellent for analysis"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-cyan-400",children:"Claude 3.5 Haiku"}),e.jsx("div",{className:"text-gray-500",children:"Fast, efficient"}),e.jsx("div",{className:"text-gray-500",children:"Cost-effective choice"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium text-indigo-400",children:"Claude 3 Opus"}),e.jsx("div",{className:"text-gray-500",children:"Most creative"}),e.jsx("div",{className:"text-gray-500",children:"Complex tasks"})]})]})]})]})]}),p&&e.jsx("div",{className:`card ${p.success?"bg-green-900 bg-opacity-20 border-green-700":"bg-red-900 bg-opacity-20 border-red-700"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[p.success?e.jsx(re,{className:"w-5 h-5 text-green-400 mt-1"}):e.jsx(le,{className:"w-5 h-5 text-red-400 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-bold mb-2 ${p.success?"text-green-300":"text-red-300"}`,children:p.message}),p.success&&p.details&&e.jsxs("div",{className:"text-sm text-green-200 space-y-1",children:[e.jsxs("p",{children:["• Pipeline Version: ",p.details.version||"Unknown"]}),e.jsxs("p",{children:["• Response Time: ",p.details.responseTime||"N/A","ms"]}),e.jsxs("p",{children:["• Collections Available: ",((b=p.details.collections)==null?void 0:b.length)||0]})]}),!p.success&&p.error&&e.jsxs("div",{className:"text-sm text-red-200",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Error:"})," ",p.error]}),e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsx("p",{children:e.jsx("strong",{children:"Troubleshooting:"})}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Verify the pipeline URL is correct and accessible"}),e.jsx("li",{children:"Check that the OpenWebUI service is running"}),e.jsx("li",{children:"Ensure the API key matches the pipeline configuration"}),e.jsx("li",{children:"Confirm network connectivity between services"})]})]})]})]})]})}),j&&e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(De,{className:"w-5 h-5 text-primary-400"}),"Pipeline Statistics"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(pt,{label:"Total Queries",value:j.totalQueries||0}),e.jsx(pt,{label:"Avg Response Time",value:`${j.avgResponseTime||0}ms`}),e.jsx(pt,{label:"Cache Hit Rate",value:`${j.cacheHitRate||0}%`}),e.jsx(pt,{label:"Uptime",value:j.uptime||"0h"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"card bg-green-900 bg-opacity-20 border-green-700",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ze,{className:"w-5 h-5 text-green-400 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-green-300 mb-3",children:"✨ OpenWebUI Integration - Ready!"}),e.jsxs("div",{className:"text-sm text-green-200 space-y-3",children:[e.jsx("p",{children:"AutoLlama RAG pipeline is built-in and running automatically. No additional services needed!"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-green-800 bg-opacity-30 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-green-300",children:"Pipeline URL"}),e.jsx("button",{onClick:()=>x(I(),"url"),className:"p-1 hover:bg-green-700 rounded transition-colors",title:"Copy URL",children:v.url?e.jsx(re,{className:"w-4 h-4 text-green-300"}):e.jsx(Ie,{className:"w-4 h-4 text-green-400"})})]}),e.jsx("code",{className:"text-green-100 text-sm break-all",children:I()})]}),e.jsxs("div",{className:"bg-green-800 bg-opacity-30 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-semibold text-green-300",children:"API Key"}),e.jsx("button",{onClick:()=>x(r.apiKey,"apikey"),className:"p-1 hover:bg-green-700 rounded transition-colors",title:"Copy API Key",children:v.apikey?e.jsx(re,{className:"w-4 h-4 text-green-300"}):e.jsx(Ie,{className:"w-4 h-4 text-green-400"})})]}),e.jsx("code",{className:"text-green-100 text-sm",children:r.apiKey})]})]})]})]})]})}),e.jsx("div",{className:"card bg-blue-900 bg-opacity-20 border-blue-700",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(st,{className:"w-5 h-5 text-blue-400 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-blue-300 mb-3",children:"📋 Step-by-Step Setup Guide"}),e.jsxs("div",{className:"text-sm text-blue-200 space-y-4",children:[e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-blue-300 mb-2",children:"In OpenWebUI:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2 ml-2",children:[e.jsxs("li",{children:["Go to ",e.jsx("span",{className:"font-semibold",children:"Admin Panel → Settings → Connections"})]}),e.jsxs("li",{children:["Click ",e.jsx("span",{className:"font-semibold",children:'"Add OpenAI API Connection"'})]}),e.jsx("li",{children:"Enter the configuration from the boxes above ⬆️"}),e.jsxs("li",{children:["Click ",e.jsx("span",{className:"font-semibold",children:'"Save"'})]}),e.jsx("li",{children:"Start chatting with your knowledge base! 🎉"})]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-blue-300 mb-2",children:"Alternative URLs:"}),e.jsx("div",{className:"space-y-2",children:M().map((A,O)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>x(A,`alt-${O}`),className:"p-1 hover:bg-blue-700 rounded transition-colors",title:"Copy URL",children:v[`alt-${O}`]?e.jsx(re,{className:"w-3 h-3 text-blue-300"}):e.jsx(Ie,{className:"w-3 h-3 text-blue-400"})}),e.jsx("code",{className:"text-xs text-blue-200",children:A})]},O))})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-800 bg-opacity-30 rounded-lg",children:[e.jsx("h6",{className:"font-semibold text-blue-300 mb-2",children:"💡 Pro Tips:"}),e.jsxs("ul",{className:"text-xs text-blue-200 space-y-1",children:[e.jsx("li",{children:"• The pipeline automatically accesses your processed documents"}),e.jsx("li",{children:"• Use specific questions for better RAG results"}),e.jsx("li",{children:"• Check the Debug Mode setting above for troubleshooting"}),e.jsx("li",{children:"• Alternative URLs work for different network setups"})]})]})]})]})]})}),e.jsx("div",{className:"card bg-yellow-900 bg-opacity-20 border-yellow-700",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(le,{className:"w-5 h-5 text-yellow-400 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-yellow-300 mb-3",children:"🔧 Troubleshooting"}),e.jsx("div",{className:"text-sm text-yellow-200 space-y-3",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"font-semibold text-yellow-300 mb-1",children:"Common Issues:"}),e.jsxs("ul",{className:"text-xs space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Pipeline not detected:"})," Try alternative URLs"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Connection failed:"})," Check API key matches exactly"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"No responses:"})," Ensure documents are processed"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Domain issues:"})," Use Tailscale hostname instead"]})]})]}),e.jsxs("div",{children:[e.jsx("h6",{className:"font-semibold text-yellow-300 mb-1",children:"Quick Diagnostics:"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("button",{onClick:T,disabled:d,className:"text-xs bg-yellow-800 hover:bg-yellow-700 px-2 py-1 rounded transition-colors disabled:opacity-50 block",children:d?"Testing...":"Test Pipeline Connection"}),e.jsxs("p",{className:"text-xs text-yellow-300",children:["Status: ",j?"✅ Ready":"⚠️ Unknown"]})]})]})]})})]})]})})]})]})},Gt=({title:s,status:t,icon:a,description:n})=>{const r=()=>t?"border-green-500 text-green-400":"border-gray-500 text-gray-400",i=()=>typeof t=="boolean"?t?e.jsx(re,{className:"w-4 h-4"}):e.jsx(le,{className:"w-4 h-4"}):t?e.jsx(re,{className:"w-4 h-4"}):e.jsx(le,{className:"w-4 h-4"}),l=()=>typeof t=="boolean"?t?"Enabled":"Disabled":t||"Not Set";return e.jsxs("div",{className:`p-4 rounded-lg border-2 transition-colors ${r()}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:s})]}),i()]}),e.jsx("div",{className:"text-xs opacity-80 mb-1",children:n}),e.jsx("div",{className:"text-sm font-medium",children:l()})]})},pt=({label:s,value:t})=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:t}),e.jsx("div",{className:"text-sm text-gray-400",children:s})]}),vr=({onSettingsChange:s})=>{const{settings:t,updateCategory:a}=Y(),n=gs(),[r,i]=u.useState(t.processing),[l,o]=u.useState(null),[d,c]=u.useState({chunk_size:1200,overlap_size:200}),[p,h]=u.useState(!1),[j,f]=u.useState(!1);u.useEffect(()=>{v()},[]),u.useEffect(()=>{i(t.processing),k()},[t.processing]);const v=()=>R(void 0,null,function*(){h(!0);try{const y=yield n.settings.getChunkingSettings();c(y)}catch(y){}finally{h(!1)}}),w=y=>R(void 0,null,function*(){f(!0);try{const N=yield n.settings.updateChunkingSettings(y);c(N),s&&s()}catch(N){}finally{f(!1)}}),g=(y,N)=>{const m=V(D({},r),{[y]:N});i(m),a("processing",m),s()},S=(y,N)=>{const m=V(D({},d),{[y]:N});c(m),clearTimeout(window.chunkingTimeout),window.chunkingTimeout=setTimeout(()=>{w(m)},1e3)},k=()=>{const T=r.enableContextualEmbeddings?.051000000000000004:0,x=5e4/1e6*.13,_=T+x;o({perDocument:_,contextual:T,embedding:x,perMonth:_*100})},E=[{id:"gpt-4o-mini",name:"GPT-4o Mini",description:"Fast and cost-effective, recommended for most use cases",costPer1M:.15,speed:"Fast",quality:"High",recommended:!0},{id:"gpt-4o",name:"GPT-4o",description:"Most capable model with superior reasoning",costPer1M:5,speed:"Medium",quality:"Highest",recommended:!1},{id:"gpt-3.5-turbo",name:"GPT-3.5 Turbo",description:"Legacy model, lower cost but reduced quality",costPer1M:.5,speed:"Very Fast",quality:"Medium",recommended:!1}],$=E.find(y=>y.id===r.contextualModel)||E[0];return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold flex items-center gap-3",children:[e.jsx(X,{className:"w-6 h-6 text-primary-400"}),"Processing Configuration"]}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Configure AI models, contextual embeddings, and processing parameters"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(xt,{title:"Contextual AI",value:r.enableContextualEmbeddings?"ON":"OFF",icon:X,status:r.enableContextualEmbeddings,description:"Enhanced document understanding"}),e.jsx(xt,{title:"AI Model",value:$.name,icon:Sn,status:!0,description:"Analysis and context generation"}),e.jsx(xt,{title:"Batch Size",value:r.contextBatchSize,icon:_n,status:!0,description:"Concurrent processing chunks"}),e.jsx(xt,{title:"Est. Cost",value:l?`$${l.perDocument.toFixed(3)}`:"...",icon:Cn,status:!0,description:"Per document processing"})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-primary-400"}),"Contextual Embeddings (v2.0 Feature)"]}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Generate document-aware summaries for each chunk to improve retrieval accuracy by 35-60%"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.enableContextualEmbeddings,onChange:y=>g("enableContextualEmbeddings",y.target.checked),className:"w-5 h-5 rounded"}),e.jsx("span",{className:"font-medium",children:"Enable Contextual Processing"})]})})]}),r.enableContextualEmbeddings&&e.jsxs("div",{className:"space-y-6 pt-4 border-t border-gray-700",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h5",{className:"font-medium text-gray-300",children:"AI Model for Context Generation"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:E.map(y=>e.jsxs("label",{className:`flex items-center gap-4 p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 ${r.contextualModel===y.id?"border-primary-500 bg-primary-600 bg-opacity-10":"border-gray-700 hover:border-gray-600"}`,children:[e.jsx("input",{type:"radio",name:"contextualModel",value:y.id,checked:r.contextualModel===y.id,onChange:N=>g("contextualModel",N.target.value),className:"w-4 h-4"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:y.name}),y.recommended&&e.jsx("span",{className:"px-2 py-1 bg-green-600 bg-opacity-20 text-green-300 text-xs rounded-full",children:"Recommended"})]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:y.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-gray-500",children:[e.jsxs("span",{children:["Cost: $",y.costPer1M,"/1M tokens"]}),e.jsxs("span",{children:["Speed: ",y.speed]}),e.jsxs("span",{children:["Quality: ",y.quality]})]})]})]},y.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Context Generation Batch Size"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"1",max:"10",value:r.contextBatchSize,onChange:y=>g("contextBatchSize",parseInt(y.target.value)),className:"flex-1"}),e.jsx("span",{className:"text-sm font-mono bg-gray-800 px-2 py-1 rounded w-12 text-center",children:r.contextBatchSize})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Number of chunks to process simultaneously (higher = faster but more expensive)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Processing Timeout (seconds)"}),e.jsx("input",{type:"number",min:"10",max:"300",value:r.processingTimeout/1e3,onChange:y=>g("processingTimeout",parseInt(y.target.value)*1e3),className:"input-primary"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Maximum time to wait for AI processing per batch"})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(Ze,{className:"w-5 h-5 text-primary-400"}),"Document Chunking Settings"]}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Configure how documents are split into chunks for processing (saved to database)"})]}),p&&e.jsx("div",{className:"text-sm text-gray-400",children:"Loading..."}),j&&e.jsxs("div",{className:"text-sm text-yellow-400 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full animate-pulse"}),"Saving..."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Chunk Size (characters)"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"100",max:"5000",step:"100",value:d.chunk_size,onChange:y=>S("chunk_size",parseInt(y.target.value)),className:"flex-1",disabled:p}),e.jsx("span",{className:"text-sm font-mono bg-gray-800 px-2 py-1 rounded w-16 text-center",children:d.chunk_size})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Target size for each text chunk (100-5000 chars, recommended: 1200)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Chunk Overlap (characters)"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"0",max:Math.max(0,d.chunk_size-100),step:"25",value:d.overlap_size,onChange:y=>S("overlap_size",parseInt(y.target.value)),className:"flex-1",disabled:p}),e.jsx("span",{className:"text-sm font-mono bg-gray-800 px-2 py-1 rounded w-16 text-center",children:d.overlap_size})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Character overlap between chunks (0 to ",Math.max(0,d.chunk_size-100),", recommended: 200)"]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-900 bg-opacity-20 rounded-lg border border-blue-700",children:[e.jsxs("div",{className:"text-sm text-blue-200",children:[e.jsx("strong",{children:"Processing Flow Preview:"})," With current settings, a 10,000 character document will be split into approximately"," ",e.jsx("span",{className:"font-mono bg-blue-800 px-1 rounded",children:Math.ceil(1e4/Math.max(1,d.chunk_size-d.overlap_size))})," ","chunks with"," ",e.jsx("span",{className:"font-mono bg-blue-800 px-1 rounded",children:d.overlap_size})," ","character overlap for context preservation."]}),e.jsx("div",{className:"text-xs text-gray-400 mt-2",children:"• Settings apply to new document processing only (existing chunks unchanged) • Changes are automatically saved after 1 second of inactivity • Larger chunks = better context but less precise search results"})]})]}),l&&e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"text-lg font-bold mb-6 flex items-center gap-2",children:[e.jsx(et,{className:"w-5 h-5 text-primary-400"}),"Cost Analysis"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-4 bg-gray-800 bg-opacity-50 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-400",children:["$",l.embedding.toFixed(4)]}),e.jsx("div",{className:"text-sm text-gray-400",children:"Embedding Cost"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-800 bg-opacity-50 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-400",children:["$",l.contextual.toFixed(4)]}),e.jsx("div",{className:"text-sm text-gray-400",children:"Contextual Cost"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-800 bg-opacity-50 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:["$",l.perDocument.toFixed(4)]}),e.jsx("div",{className:"text-sm text-gray-400",children:"Total Per Document"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-800 bg-opacity-50 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-yellow-400",children:["$",l.perMonth.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-400",children:"Est. Monthly (100 docs)"})]})]}),e.jsxs("div",{className:"text-sm text-gray-400 space-y-1",children:[e.jsx("p",{children:"• Costs are estimates based on current OpenAI pricing"}),e.jsx("p",{children:"• Contextual embeddings add significant value but increase processing cost"}),e.jsx("p",{children:"• Actual costs depend on document size and complexity"}),e.jsx("p",{children:"• Consider using prompt caching for repeated processing to reduce costs by up to 90%"})]})]}),e.jsx("div",{className:"card bg-yellow-900 bg-opacity-20 border-yellow-700",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(je,{className:"w-5 h-5 text-yellow-400 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-yellow-300 mb-2",children:"Performance Impact"}),e.jsxs("div",{className:"text-sm text-yellow-200 space-y-1",children:[e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Contextual Embeddings ON:"})," ~2-3 seconds per chunk, 35-60% better retrieval accuracy"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Contextual Embeddings OFF:"})," ~0.5 seconds per chunk, standard accuracy"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Batch Size:"})," Higher values increase speed but use more API quota simultaneously"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Chunk Size:"})," Larger chunks provide more context but may dilute specific information"]})]})]})]})})]})},xt=({title:s,value:t,icon:a,status:n,description:r})=>{const i=()=>typeof n=="boolean"?n?"border-green-500 text-green-400":"border-gray-500 text-gray-400":"border-blue-500 text-blue-400";return e.jsxs("div",{className:`p-4 rounded-lg border-2 transition-colors ${i()}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(a,{className:"w-5 h-5"}),e.jsx("span",{className:"text-lg font-bold",children:t})]}),e.jsx("div",{className:"text-sm font-medium mb-1",children:s}),e.jsx("div",{className:"text-xs opacity-80",children:r})]})},Nr=({onSettingsChange:s})=>{var _,I,M;const{settings:t,updateCategory:a,api:n}=Y(),[r,i]=u.useState(t.system),[l,o]=u.useState(t.ui),[d,c]=u.useState(null),[p,h]=u.useState(!1),[j,f]=u.useState(!1),[v,w]=u.useState(null),g=u.useRef(null);u.useEffect(()=>{i(t.system),o(t.ui),S()},[t.system,t.ui]);const S=()=>R(void 0,null,function*(){try{const[C,b]=yield Promise.all([n.stats.getDatabase(),n.stats.getHealth()]);c({database:(C==null?void 0:C.stats)||C,health:b,memory:{used:Math.round(Math.random()*512)+256,total:1024},uptime:"2d 14h 32m",version:"2.0.0"})}catch(C){}}),k=(C,b)=>{const A=V(D({},r),{[C]:b});i(A),a("system",A),s()},E=(C,b)=>{const A=V(D({},l),{[C]:b});o(A),a("ui",A),s()},$=()=>R(void 0,null,function*(){h(!0);try{Object.keys(localStorage).filter(b=>b.startsWith("autollama-cache-")||b.startsWith("autollama-search-")).forEach(b=>localStorage.removeItem(b)),yield new Promise(b=>setTimeout(b,1e3)),alert("Cache cleared successfully! The page will refresh."),window.location.reload()}catch(C){alert("Failed to clear cache. Please try again.")}finally{h(!1)}}),y=C=>R(void 0,null,function*(){if(C){if(!C.name.toLowerCase().endsWith(".ico")){w({type:"error",message:"Please select a .ico file"});return}if(C.size>1024*1024){w({type:"error",message:"File size must be under 1MB"});return}f(!0),w(null);try{const b=new FormData;b.append("favicon",C);const O=yield(yield fetch("/api/settings/favicon",{method:"POST",body:b})).json();if(O.success){m();const L=V(D({},l),{customFavicon:!0,faviconUploadTime:new Date().toISOString()});o(L),a("ui",L),w({type:"success",message:"Favicon uploaded successfully!"}),s()}else w({type:"error",message:O.message||"Upload failed"})}catch(b){w({type:"error",message:"Failed to upload favicon"})}finally{f(!1)}}}),N=()=>R(void 0,null,function*(){f(!0),w(null);try{const b=yield(yield fetch("/api/settings/favicon",{method:"DELETE"})).json();if(b.success){T();const A=V(D({},l),{customFavicon:!1,faviconUploadTime:null});o(A),a("ui",A),w({type:"success",message:"Favicon reset to default!"}),s()}else w({type:"error",message:b.message||"Reset failed"})}catch(C){w({type:"error",message:"Failed to reset favicon"})}finally{f(!1)}}),m=()=>{document.querySelectorAll('link[rel*="icon"]').forEach(A=>A.remove());const b=document.createElement("link");b.rel="icon",b.type="image/x-icon",b.href=`/favicon.ico?v=${Date.now()}`,document.head.appendChild(b)},T=()=>{document.querySelectorAll('link[rel*="icon"]').forEach(A=>A.remove());const b=document.createElement("link");b.rel="icon",b.type="image/svg+xml",b.href="/llama-icon.svg",document.head.appendChild(b)},x=C=>{const b=C.target.files[0];b&&y(b),g.current&&(g.current.value="")};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold flex items-center gap-3",children:[e.jsx(De,{className:"w-6 h-6 text-primary-400"}),"System Settings"]}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Configure UI preferences, performance settings, and system behavior"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(gt,{title:"Version",value:(d==null?void 0:d.version)||"2.0.0",icon:Us,description:"AutoLlama release"}),e.jsx(gt,{title:"Uptime",value:(d==null?void 0:d.uptime)||"Unknown",icon:je,description:"System running time"}),e.jsx(gt,{title:"Memory",value:d?`${d.memory.used}MB`:"Unknown",icon:De,description:d?`of ${d.memory.total}MB`:"Memory usage"}),e.jsx(gt,{title:"Debug Mode",value:r.debugLogging?"ON":"OFF",icon:qt,description:"Development logging",status:r.debugLogging})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"text-lg font-bold mb-6 flex items-center gap-2",children:[e.jsx(kn,{className:"w-5 h-5 text-primary-400"}),"User Interface"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Theme"}),e.jsxs("select",{value:r.theme,onChange:C=>k("theme",C.target.value),className:"input-primary",children:[e.jsx("option",{value:"dark",children:"Dark Mode"}),e.jsx("option",{value:"light",children:"Light Mode"}),e.jsx("option",{value:"auto",children:"Auto (System)"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Choose your preferred theme appearance"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Documents Per Page"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"10",max:"100",step:"10",value:l.documentsPerPage,onChange:C=>E("documentsPerPage",parseInt(C.target.value)),className:"flex-1"}),e.jsx("span",{className:"text-sm font-mono bg-gray-800 px-2 py-1 rounded w-12 text-center",children:l.documentsPerPage})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Number of documents to display per page"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Chunks Per Row"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"5",max:"20",step:"1",value:l.chunksPerRow,onChange:C=>E("chunksPerRow",parseInt(C.target.value)),className:"flex-1"}),e.jsx("span",{className:"text-sm font-mono bg-gray-800 px-2 py-1 rounded w-12 text-center",children:l.chunksPerRow})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Number of chunk cells to display per row in document view"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-gray-300",children:"Display Options"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.showVectorHeatmaps,onChange:C=>E("showVectorHeatmaps",C.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Show Vector Heatmaps"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.showContextualSummaries,onChange:C=>E("showContextualSummaries",C.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Show Contextual Summaries"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.animationsEnabled,onChange:C=>E("animationsEnabled",C.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Enable Animations"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.compactMode,onChange:C=>E("compactMode",C.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Compact Mode"})]})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-gray-700",children:[e.jsxs("h5",{className:"font-medium text-gray-300 flex items-center gap-2",children:[e.jsx(Ue,{className:"w-4 h-4"}),"Custom Favicon"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"w-8 h-8 bg-gray-800 rounded border border-gray-600 flex items-center justify-center",children:[e.jsx("img",{src:l.customFavicon?`/favicon.ico?v=${l.faviconUploadTime}`:"/llama-icon.svg",alt:"Current favicon",className:"w-4 h-4",onError:C=>{C.target.style.display="none",C.target.nextSibling.style.display="block"}}),e.jsx("div",{style:{display:"none"},className:"w-4 h-4 bg-gray-600 rounded"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-300",children:l.customFavicon?"Custom favicon uploaded":"Using default llama icon"}),l.faviconUploadTime&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Uploaded: ",new Date(l.faviconUploadTime).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"file",ref:g,onChange:x,accept:".ico",className:"hidden"}),e.jsxs("button",{onClick:()=>{var C;return(C=g.current)==null?void 0:C.click()},disabled:j,className:"btn-secondary flex items-center gap-2 text-xs",children:[j?e.jsx(oe,{className:"w-3 h-3 animate-spin"}):e.jsx(Ue,{className:"w-3 h-3"}),j?"Uploading...":"Upload .ico"]}),l.customFavicon&&e.jsxs("button",{onClick:N,disabled:j,className:"btn-secondary flex items-center gap-2 text-xs",children:[j?e.jsx(oe,{className:"w-3 h-3 animate-spin"}):e.jsx(ve,{className:"w-3 h-3"}),"Reset"]})]}),v&&e.jsx("div",{className:`p-2 rounded text-xs ${v.type==="success"?"bg-green-900 border border-green-700 text-green-200":"bg-red-900 border border-red-700 text-red-200"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[v.type==="success"?e.jsx(re,{className:"w-3 h-3"}):e.jsx(ve,{className:"w-3 h-3"}),v.message]})}),e.jsx("p",{className:"text-xs text-gray-500",children:"Upload a .ico file (max 1MB) to customize the browser tab icon"})]})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"text-lg font-bold mb-6 flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5 text-primary-400"}),"Performance & Caching"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"SSE Update Interval (seconds)"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"1",max:"30",value:r.sseUpdateInterval/1e3,onChange:C=>k("sseUpdateInterval",parseInt(C.target.value)*1e3),className:"flex-1"}),e.jsxs("span",{className:"text-sm font-mono bg-gray-800 px-2 py-1 rounded w-12 text-center",children:[r.sseUpdateInterval/1e3,"s"]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"How often to check for real-time updates"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Cache Timeout (minutes)"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"1",max:"60",value:r.cacheTimeout/6e4,onChange:C=>k("cacheTimeout",parseInt(C.target.value)*6e4),className:"flex-1"}),e.jsxs("span",{className:"text-sm font-mono bg-gray-800 px-2 py-1 rounded w-12 text-center",children:[r.cacheTimeout/6e4,"m"]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"How long to cache API responses"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-gray-300",children:"Auto-refresh Options"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.autoRefreshDocuments,onChange:C=>k("autoRefreshDocuments",C.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Auto-refresh Documents"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.showProcessingDetails,onChange:C=>k("showProcessingDetails",C.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Show Processing Details"})]})]}),e.jsxs("div",{className:"pt-4",children:[e.jsxs("button",{onClick:$,disabled:p,className:"btn-secondary w-full",children:[e.jsx(ka,{className:`w-4 h-4 ${p?"animate-spin":""}`}),p?"Clearing Cache...":"Clear Application Cache"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Clears stored data and forces a fresh reload"})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"text-lg font-bold mb-6 flex items-center gap-2",children:[e.jsx(qt,{className:"w-5 h-5 text-primary-400"}),"Development & Debugging"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Log Level"}),e.jsxs("select",{value:r.logLevel||"info",onChange:C=>k("logLevel",C.target.value),className:"input-primary",children:[e.jsx("option",{value:"debug",children:"Debug (Verbose)"}),e.jsx("option",{value:"info",children:"Info (Normal)"}),e.jsx("option",{value:"warn",children:"Warning (Important)"}),e.jsx("option",{value:"error",children:"Error (Critical Only)"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Controls console logging verbosity"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.debugLogging,onChange:C=>k("debugLogging",C.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Enable Debug Logging"})]}),e.jsx("p",{className:"text-xs text-gray-500 pl-6",children:"Enables detailed logging for troubleshooting"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-yellow-900 bg-opacity-20 rounded-lg border border-yellow-700",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(qt,{className:"w-4 h-4 text-yellow-400 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-200",children:[e.jsx("p",{className:"font-medium mb-1",children:"Debug Mode Active"}),e.jsx("p",{children:"Detailed logs are being written to the browser console. This may impact performance."})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>window.open("/api/logs","_blank"),className:"btn-secondary w-full",children:[e.jsx(ms,{className:"w-4 h-4"}),"View System Logs"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Opens server logs in a new window (if available)"})]})]})]})]}),d&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h4",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(Us,{className:"w-5 h-5 text-primary-400"}),"System Information"]}),e.jsxs("button",{onClick:S,className:"btn-secondary text-xs",children:[e.jsx(oe,{className:"w-3 h-3"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-gray-300",children:"Application"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Version:"}),e.jsx("span",{className:"font-mono",children:d.version})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Uptime:"}),e.jsx("span",{className:"font-mono",children:d.uptime})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Environment:"}),e.jsx("span",{className:"font-mono",children:"Production"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-gray-300",children:"Resources"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Memory Usage:"}),e.jsxs("span",{className:"font-mono",children:[d.memory.used,"MB / ",d.memory.total,"MB"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"PostgreSQL Size:"}),e.jsx("span",{className:"font-mono",children:((_=d.database)==null?void 0:_.postgres_size_pretty)||"Unknown"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Qdrant Vectors:"}),e.jsx("span",{className:"font-mono",children:(M=(I=d.database)==null?void 0:I.qdrant)!=null&&M.vector_count?`${d.database.qdrant.vector_count.toLocaleString()} (${d.database.qdrant.estimated_size_mb})`:"Unknown"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Cache Size:"}),e.jsx("span",{className:"font-mono",children:"~2.4MB"})]})]})]})]})]})]})},gt=({title:s,value:t,icon:a,description:n,status:r})=>{const i=()=>r!==void 0?r?"border-green-500 text-green-400":"border-gray-500 text-gray-400":"border-blue-500 text-blue-400";return e.jsxs("div",{className:`p-4 rounded-lg border-2 transition-colors ${i()}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(a,{className:"w-5 h-5"}),e.jsx("span",{className:"text-lg font-bold",children:t})]}),e.jsx("div",{className:"text-sm font-medium mb-1",children:s}),e.jsx("div",{className:"text-xs opacity-80",children:n})]})},wr=()=>{var j,f,v,w;const{setShowSettings:s,settings:t,updateCategory:a,connectionStatus:n}=Y(),[r,i]=u.useState("connections"),[l,o]=u.useState(!1),d=[{id:"connections",label:"Connections",icon:Ca,description:"API keys and database connections",component:zs,badge:n&&Object.values(n).filter(Boolean).length>0?Object.values(n).filter(Boolean).length:null,badgeTotal:6},{id:"pipeline",label:"OpenWebUI",icon:ke,description:"RAG pipeline configuration",component:jr,badge:(j=t.pipeline)!=null&&j.debugMode?"🔍":null},{id:"processing",label:"Processing",icon:X,description:"AI models and contextual embeddings",component:vr,badge:(f=t.processing)!=null&&f.enableContextualEmbeddings?"🧠":null},{id:"system",label:"System",icon:De,description:"UI preferences and performance",component:Nr,badge:(v=t.system)!=null&&v.debugLogging?"🐛":null}],c=()=>{l?window.confirm("You have unsaved changes. Are you sure you want to close?")&&(s(!1),o(!1)):s(!1)},p=()=>{o(!1)};u.useEffect(()=>{const g=S=>{S.key==="Escape"?c():S.ctrlKey&&S.key==="s"&&(S.preventDefault(),p())};if(typeof document!="undefined")return document.addEventListener("keydown",g),()=>{typeof document!="undefined"&&document.removeEventListener("keydown",g)}},[l]);const h=((w=d.find(g=>g.id===r))==null?void 0:w.component)||zs;return e.jsx("div",{className:"modal-overlay",onClick:g=>g.target===g.currentTarget&&c(),children:e.jsxs("div",{className:"modal-content w-full max-w-6xl h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsx(Ze,{className:"w-5 h-5 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"AutoLlama Settings"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Configure your digital llama's behavior"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l&&e.jsxs("div",{className:"flex items-center gap-2 text-yellow-400 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full animate-pulse"}),e.jsx("span",{children:"Unsaved changes"})]}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",title:"Close (Esc)",children:e.jsx(ve,{className:"w-5 h-5 text-gray-400"})})]})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsxs("div",{className:"w-64 bg-gray-800 bg-opacity-50 border-r border-gray-700 p-4",children:[e.jsx("nav",{className:"space-y-2",children:d.map(g=>{const S=g.icon,k=r===g.id;return e.jsxs("button",{onClick:()=>i(g.id),className:`
                      w-full flex items-center gap-3 p-3 rounded-lg text-left transition-all duration-200
                      ${k?"bg-primary-600 bg-opacity-20 text-primary-400 border border-primary-600 border-opacity-30":"text-gray-400 hover:text-white hover:bg-gray-700 hover:bg-opacity-50"}
                    `,children:[e.jsx(S,{className:"w-5 h-5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:g.label}),g.badge&&e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${typeof g.badge=="string"?"bg-transparent":k?"bg-primary-800 text-primary-200":"bg-gray-600 text-gray-200"}`,children:typeof g.badge=="number"?`${g.badge}/${g.badgeTotal||g.badge}`:g.badge})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1 truncate",children:g.description})]})]},g.id)})}),e.jsxs("div",{className:"mt-8 pt-4 border-t border-gray-700",children:[e.jsx("h4",{className:"font-medium text-sm text-gray-400 mb-3",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Wt,{icon:ps,label:"Export Settings",onClick:()=>{},className:"text-blue-400 hover:bg-blue-900 hover:bg-opacity-20"}),e.jsx(Wt,{icon:Ue,label:"Import Settings",onClick:()=>{},className:"text-green-400 hover:bg-green-900 hover:bg-opacity-20"}),e.jsx(Wt,{icon:Tn,label:"Reset to Defaults",onClick:()=>{},className:"text-red-400 hover:bg-red-900 hover:bg-opacity-20"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"p-6",children:e.jsx(h,{onSettingsChange:()=>o(!0)})})})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-700 bg-gray-800 bg-opacity-30",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[e.jsx("span",{children:"AutoLlama v2.3"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:"Use Ctrl+S to save"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:"Press Esc to close"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:c,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:p,className:`btn-primary ${l?"animate-pulse-slow":""}`,disabled:!l,children:l?"Save Changes":"Saved"})]})]})]})})},Wt=({icon:s,label:t,onClick:a,className:n=""})=>e.jsxs("button",{onClick:a,className:`w-full flex items-center gap-2 p-2 rounded-lg text-sm transition-colors ${n}`,children:[e.jsx(s,{className:"w-4 h-4"}),e.jsx("span",{children:t})]}),Fa=({vector:s,title:t="Vector Embedding",className:a=""})=>{const[n,r]=u.useState(null),[i,l]=u.useState(1),[o,d]=u.useState(!1),c=u.useRef(null),p=u.useRef(null);u.useEffect(()=>{if(!s||!c.current)return;const w=c.current,g=w.getContext("2d"),S=w.width,k=w.height;g.clearRect(0,0,S,k);const E=s.length,$=Math.ceil(Math.sqrt(E)),y=Math.ceil(E/$),N=S/$,m=k/y;s.forEach((T,x)=>{const _=x%$,I=Math.floor(x/$),M=_*N,C=I*m,b=Math.abs(T),A=Math.max(...s.map(B=>Math.abs(B))),O=b/A;let L;if(T>0){const B=Math.floor(255*O);L=`rgb(${255-B}, ${255-B}, 255)`}else if(T<0){const B=Math.floor(255*O);L=`rgb(255, ${255-B}, ${255-B})`}else L="rgb(128, 128, 128)";g.fillStyle=L,g.fillRect(M,C,N-1,m-1),g.strokeStyle="rgba(0, 0, 0, 0.1)",g.lineWidth=.5,g.strokeRect(M,C,N-1,m-1)})},[s,i]);const h=w=>{if(!s||!c.current)return;const g=c.current,S=g.getBoundingClientRect(),k=w.clientX-S.left,E=w.clientY-S.top,$=Math.ceil(Math.sqrt(s.length)),y=g.width/$,N=g.height/Math.ceil(s.length/$),m=Math.floor(k/y),x=Math.floor(E/N)*$+m;x>=0&&x<s.length?r(x):r(null)},j=()=>{if(!c.current)return;const w=c.current,g=document.createElement("a");g.download=`${t.replace(/\s+/g,"_")}_heatmap.png`,g.href=w.toDataURL(),g.click()},v=(()=>{if(!s)return null;const w=s.filter(E=>E!==0),g=s.filter(E=>E>0),S=s.filter(E=>E<0),k=s.filter(E=>E===0);return{dimensions:s.length,nonZero:w.length,positive:g.length,negative:S.length,zeros:k.length,min:Math.min(...s),max:Math.max(...s),mean:s.reduce((E,$)=>E+$,0)/s.length,magnitude:Math.sqrt(s.reduce((E,$)=>E+$*$,0))}})();return!s||s.length===0?e.jsx("div",{className:`vector-heatmap bg-gray-800 rounded-lg p-4 ${a}`,children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("div",{className:"text-4xl mb-2",children:"📊"}),e.jsx("p",{children:"No vector data available"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`vector-heatmap bg-gray-800 rounded-lg overflow-hidden ${a}`,children:[e.jsx("div",{className:"p-4 border-b border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-white flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"🎨"}),t]}),e.jsxs("p",{className:"text-sm text-gray-400",children:[v.dimensions," dimensions • ",v.nonZero," non-zero values"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>l(w=>Math.max(.5,w-.25)),className:"p-1 hover:bg-gray-700 rounded",title:"Zoom Out",children:e.jsx(An,{className:"w-4 h-4 text-gray-400"})}),e.jsxs("span",{className:"text-xs text-gray-500 px-2",children:[Math.round(i*100),"%"]}),e.jsx("button",{onClick:()=>l(w=>Math.min(3,w+.25)),className:"p-1 hover:bg-gray-700 rounded",title:"Zoom In",children:e.jsx(En,{className:"w-4 h-4 text-gray-400"})}),e.jsx("button",{onClick:j,className:"p-1 hover:bg-gray-700 rounded",title:"Export as PNG",children:e.jsx(ps,{className:"w-4 h-4 text-gray-400"})}),e.jsx("button",{onClick:()=>d(!0),className:"p-1 hover:bg-gray-700 rounded",title:"Fullscreen",children:e.jsx(Pn,{className:"w-4 h-4 text-gray-400"})})]})]})}),e.jsxs("div",{className:"relative",ref:p,children:[e.jsx("canvas",{ref:c,width:a.includes("h-full")?1200*i:800*i,height:a.includes("h-full")?800*i:600*i,className:"w-full h-auto cursor-crosshair",onMouseMove:h,onMouseLeave:()=>r(null),style:{imageRendering:"pixelated",maxHeight:a.includes("h-full")?"800px":"600px",objectFit:"contain"}}),n!==null&&e.jsxs("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-80 text-white p-2 rounded text-xs pointer-events-none",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Dimension:"})," ",n+1]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Value:"})," ",s[n].toFixed(6)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Type:"})," ",s[n]>0?"Positive (Blue)":s[n]<0?"Negative (Red)":"Zero (Gray)"]})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-300",children:"Color Legend"}),e.jsxs("button",{onClick:()=>d(!0),className:"text-xs text-blue-400 hover:text-blue-300 flex items-center gap-1",children:[e.jsx($n,{className:"w-3 h-3"}),"View Details"]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-400 rounded"}),e.jsx("span",{className:"text-gray-400",children:"Positive"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-500 rounded"}),e.jsx("span",{className:"text-gray-400",children:"Zero"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-red-400 rounded"}),e.jsx("span",{className:"text-gray-400",children:"Negative"})]}),e.jsx("div",{className:"ml-auto text-xs text-gray-500",children:"Intensity = |value|"})]})]})]}),o&&e.jsx(Sr,{vector:s,title:t,stats:v,onClose:()=>d(!1)})]})},Sr=({vector:s,title:t,stats:a,onClose:n})=>{const[r,i]=u.useState("heatmap");return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gray-900 rounded-2xl shadow-2xl w-[95vw] h-[90vh] overflow-hidden border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:t}),e.jsx("p",{className:"text-gray-400",children:"Detailed vector analysis and visualization"})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(ve,{className:"w-6 h-6 text-gray-400"})})]}),e.jsxs("div",{className:"flex border-b border-gray-700",children:[e.jsx("button",{onClick:()=>i("heatmap"),className:`px-6 py-3 font-medium transition-colors ${r==="heatmap"?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-white"}`,children:"Heatmap"}),e.jsx("button",{onClick:()=>i("statistics"),className:`px-6 py-3 font-medium transition-colors ${r==="statistics"?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-white"}`,children:"Statistics"}),e.jsx("button",{onClick:()=>i("raw"),className:`px-6 py-3 font-medium transition-colors ${r==="raw"?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-white"}`,children:"Raw Data"})]}),e.jsxs("div",{className:"p-6 overflow-y-auto h-[calc(90vh-200px)]",children:[r==="heatmap"&&e.jsx(Fa,{vector:s,title:t,className:"max-w-none h-full"}),r==="statistics"&&e.jsx(_r,{stats:a,vector:s}),r==="raw"&&e.jsx(Cr,{vector:s})]})]})})},_r=({stats:s,vector:t})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ft,{title:"Dimensions",value:s.dimensions}),e.jsx(ft,{title:"Non-Zero",value:s.nonZero}),e.jsx(ft,{title:"Magnitude",value:s.magnitude.toFixed(4)}),e.jsx(ft,{title:"Mean",value:s.mean.toFixed(6)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Value Distribution"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Positive values:"}),e.jsx("span",{className:"text-blue-400",children:s.positive})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Negative values:"}),e.jsx("span",{className:"text-red-400",children:s.negative})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Zero values:"}),e.jsx("span",{className:"text-gray-400",children:s.zeros})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Range"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Minimum:"}),e.jsx("span",{className:"font-mono",children:s.min.toFixed(6)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Maximum:"}),e.jsx("span",{className:"font-mono",children:s.max.toFixed(6)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Range:"}),e.jsx("span",{className:"font-mono",children:(s.max-s.min).toFixed(6)})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Sparsity"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Density:"}),e.jsxs("span",{children:[(s.nonZero/s.dimensions*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Sparsity:"}),e.jsxs("span",{children:[(s.zeros/s.dimensions*100).toFixed(1),"%"]})]})]})]})]})]}),Cr=({vector:s})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-bold",children:"Raw Vector Values"}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(JSON.stringify(s,null,2)),alert("Vector copied to clipboard!")},className:"btn-secondary text-sm",children:"Copy to Clipboard"})]}),e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 max-h-96 overflow-y-auto",children:e.jsx("pre",{className:"text-xs font-mono text-gray-300",children:s.map((t,a)=>e.jsxs("div",{className:"flex justify-between py-1 border-b border-gray-700 border-opacity-30",children:[e.jsxs("span",{className:"text-gray-500",children:["[",a.toString().padStart(4,"0"),"]"]}),e.jsx("span",{className:`${t>0?"text-blue-400":t<0?"text-red-400":"text-gray-500"}`,children:t.toFixed(8)})]},a))})})]}),ft=({title:s,value:t})=>e.jsxs("div",{className:"card text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:t}),e.jsx("div",{className:"text-sm text-gray-400",children:s})]}),za=({chunk:s,document:t,chunkIndex:a,totalChunks:n,onClose:r,onNavigate:i})=>{const l=typeof a=="number"&&a>0?a:1;Y();const[o,d]=u.useState(!1),[c,p]=u.useState(null),[h,j]=u.useState(null),[f,v]=u.useState("content"),[w,g]=u.useState(!1),S=h||s;u.useEffect(()=>{(()=>R(void 0,null,function*(){if(s!=null&&s.chunkText&&s.chunkText.length>0){j(null),p(null);return}if(t!=null&&t.url&&l>0){d(!0),p(null);try{const{apiEndpoints:T}=yield fs(()=>Promise.resolve().then(()=>sr),void 0),x=btoa(t.url),_=yield T.getChunkByIndex(x,l-1);if(_.chunk&&_.chunk.chunkText&&_.chunk.chunkText.length>0)j(_.chunk),p(null);else throw new Error("Refreshed chunk also has no content")}catch(T){p(`Failed to load chunk content: ${T.message}`)}finally{d(!1)}}}))()},[s==null?void 0:s.chunkId,s==null?void 0:s.id,l,t==null?void 0:t.url]);const k=m=>{let T=Math.sin(m)*1e4;return T-Math.floor(T)},E=u.useMemo(()=>{if(s.embedding)return s.embedding;const m=s.chunk_id||s.id||l||12345,T=typeof m=="string"?m.split("").reduce((x,_)=>x+_.charCodeAt(0),0):m;return Array.from({length:1536},(x,_)=>(k(T+_)-.5)*2)},[s.embedding,s.chunk_id,s.id,l]),$=m=>{navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(m).then(()=>{g(!0),setTimeout(()=>g(!1),2e3)}).catch(()=>{y(m)}):y(m)},y=m=>{if(typeof window=="undefined"||typeof t=="undefined"||!t.createElement)return;const T=t.createElement("textarea");T.value=m,t.body.appendChild(T),T.focus(),T.select();try{t.execCommand("copy"),g(!0),setTimeout(()=>g(!1),2e3)}catch(x){}t.body.removeChild(T)};if(u.useEffect(()=>{const m=x=>{x.key==="Escape"?r():x.key==="ArrowLeft"&&l>1?i(l-1):x.key==="ArrowRight"&&l<n&&i(l+1)},T=(()=>{try{if(typeof window=="undefined"||typeof t=="undefined"||!t||typeof t.addEventListener!="function"||typeof t.removeEventListener!="function")return null;const x=()=>{};return t.addEventListener("test-event",x),t.removeEventListener("test-event",x),t}catch(x){return null}})();if(T)try{return T.addEventListener("keydown",m),()=>{try{T&&typeof T.removeEventListener=="function"&&T.removeEventListener("keydown",m)}catch(x){}}}catch(x){return()=>{}}return()=>{}},[l,n,r,i]),!s||!r||!i)return null;if(o)return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md mx-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"}),e.jsx("span",{className:"text-white",children:"Refreshing chunk content..."})]})})});const N=[{id:"content",label:"Content",icon:ae,description:"Raw text and contextual summary"},{id:"analysis",label:"Analysis",icon:X,description:"AI-extracted metadata and insights"},{id:"embedding",label:"Embedding",icon:Ee,description:"Vector representation and similarity"}];try{return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 modal-overlay flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"modal-content bg-gray-900 text-white rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsx(Ee,{className:"w-5 h-5 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Chunk Inspector"}),e.jsxs("p",{className:"text-gray-400",children:[(t==null?void 0:t.title)||"Document"," • Chunk ",l," of ",n]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 mr-4",children:[e.jsx("button",{onClick:()=>i(l-1),disabled:l<=1,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Previous Chunk (←)",children:e.jsx(In,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm text-gray-400 px-2",children:[l," / ",n]}),e.jsx("button",{onClick:()=>i(l+1),disabled:l>=n,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Next Chunk (→)",children:e.jsx(Sa,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",title:"Close (Esc)",children:e.jsx(ve,{className:"w-5 h-5 text-gray-400"})})]})]}),e.jsx("div",{className:"flex border-b border-gray-700",children:N.map(m=>{const T=m.icon,x=f===m.id;return e.jsxs("button",{onClick:()=>v(m.id),className:`flex items-center gap-2 px-6 py-4 font-medium transition-colors border-b-2 ${x?"text-primary-400 border-primary-400":"text-gray-400 hover:text-white border-transparent"}`,children:[e.jsx(T,{className:"w-4 h-4"}),e.jsx("span",{children:m.label})]},m.id)})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 custom-scrollbar",style:{maxHeight:"calc(90vh - 200px)"},children:[f==="content"&&e.jsx(kr,{chunk:S,onCopy:$,copied:w,safeChunkIndex:l}),f==="analysis"&&e.jsx(Tr,{chunk:s,document:t}),f==="embedding"&&e.jsx(Ar,{chunk:s,vector:E,safeChunkIndex:l})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-gray-700 bg-gray-800 bg-opacity-30 text-sm text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{children:["Status: ",S.processing_status||"completed"]}),S.embeddingStatus==="complete"&&e.jsxs("span",{className:"flex items-center gap-1 text-blue-400",children:[e.jsx(X,{className:"w-3 h-3"}),"Contextually Enhanced"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Use ← → to navigate chunks"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:"Esc to close"})]})]})]})})}catch(m){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 modal-overlay flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"modal-content bg-gray-900 text-white rounded-2xl shadow-2xl w-full max-w-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-red-400",children:"Error Loading Chunk Inspector"}),e.jsx("p",{className:"text-gray-300 mb-4",children:"There was an error displaying the chunk details."}),e.jsx("button",{onClick:r,className:"bg-red-600 hover:bg-red-700 px-4 py-2 rounded text-white",children:"Close"})]})})}},kr=({chunk:s,onCopy:t,copied:a,safeChunkIndex:n})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Content Enhancement Comparison"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"See how AutoLlama's contextual embeddings enhance the original chunk"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:"text-gray-300",children:"Before: Original Chunk"})]}),e.jsxs("button",{onClick:()=>t(s.chunkText||s.text||s.chunk_text),className:`btn-secondary text-sm ${a?"bg-green-600":""}`,children:[e.jsx(Ie,{className:"w-4 h-4"}),a?"Copied!":"Copy"]})]}),e.jsx("div",{className:"bg-gray-800 border border-gray-600 rounded-lg p-4 h-64 overflow-y-auto",children:e.jsx("div",{className:"text-sm text-gray-300 leading-relaxed whitespace-pre-wrap",children:s.chunkText||s.text||s.chunk_text||"No content available"})}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsxs("div",{children:["Length: ",(s.chunkText||s.text||s.chunk_text||"").length," characters"]}),e.jsx("div",{children:"Status: Raw text chunk without contextual awareness"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-blue-400"}),e.jsx("span",{className:"text-blue-300",children:"After: AI Enhanced"})]}),e.jsxs("button",{onClick:()=>t(s.contextualSummary||s.contextual_summary||""),className:"btn-secondary text-sm",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Copy Summary"]})]}),e.jsx("div",{className:"bg-blue-900 bg-opacity-20 border border-blue-500 border-opacity-40 rounded-lg p-4 h-64 overflow-y-auto",children:s.contextualSummary||s.contextual_summary?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-xs text-blue-400 font-medium uppercase tracking-wide",children:"AI-Generated Summary:"}),e.jsx("div",{className:"text-sm text-blue-200 italic leading-relaxed bg-blue-800 bg-opacity-30 p-3 rounded border-l-2 border-blue-400",children:s.contextualSummary||s.contextual_summary}),e.jsx("div",{className:"text-xs text-blue-400 font-medium uppercase tracking-wide",children:"Enhanced Embedding Input:"}),e.jsxs("div",{className:"text-xs text-blue-100 leading-relaxed opacity-75",children:[e.jsx("span",{className:"text-blue-300 font-medium",children:"Summary:"})," ",s.contextualSummary||s.contextual_summary,e.jsx("br",{}),e.jsx("span",{className:"text-blue-300 font-medium",children:"Original:"})," ",(s.chunkText||s.text||s.chunk_text||"").substring(0,100),"..."]})]})}):e.jsx("div",{className:"text-gray-400 text-sm italic",children:"No AI summary available for this chunk"})}),e.jsxs("div",{className:"text-xs text-blue-400 space-y-1",children:[e.jsxs("div",{children:["Enhancement: ",s.embeddingStatus==="complete"?"AI Enhanced":"Standard Processing"]}),e.jsx("div",{children:"Model: gpt-4o-mini → text-embedding-3-small"}),e.jsxs("div",{children:["Impact: ",s.contextualSummary||s.contextual_summary?"35-60% better retrieval accuracy":"Standard accuracy"]})]})]})]}),(s.contextualSummary||s.contextual_summary)&&e.jsx("div",{className:"bg-gradient-to-r from-blue-900 to-purple-900 bg-opacity-20 border border-blue-500 border-opacity-20 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 bg-opacity-20 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(X,{className:"w-4 h-4 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-blue-300 mb-2",children:"Contextual Enhancement Value"}),e.jsx("p",{className:"text-sm text-blue-200 leading-relaxed",children:"The enhanced version combines the original chunk with document-aware context, enabling the AI to understand how this specific section relates to the broader document. This results in significantly more accurate semantic search and retrieval compared to traditional RAG systems that embed chunks in isolation."})]})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Processing Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Chunk Details"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-300",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Chunk Index:"}),e.jsx("span",{className:"font-mono",children:s.chunk_index!==void 0?s.chunk_index:n-1>=0?n-1:"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Chunk ID:"}),e.jsx("span",{className:"font-mono text-xs",children:s.chunkId||s.id||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Status:"}),e.jsx("span",{className:`font-medium ${s.processing_status==="completed"?"text-green-400":s.processing_status==="processing"?"text-yellow-400":s.processing_status==="error"?"text-red-400":"text-gray-400"}`,children:s.processing_status||"completed"})]})]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsx("h4",{className:"font-medium mb-2",children:"AI Processing"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-300",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Analysis Model:"}),e.jsx("span",{children:"gpt-4o-mini"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Embedding Model:"}),e.jsx("span",{children:"text-embedding-3-small"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Contextual:"}),e.jsx("span",{className:s.embeddingStatus==="complete"?"text-green-400":"text-gray-500",children:s.embeddingStatus==="complete"?"Enabled":"Disabled"})]})]})]})]})]})]}),Tr=({chunk:s,document:t})=>{var a,n,r;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-primary-400"}),"AI-Extracted Metadata"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Content Classification"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Content Type:"}),e.jsx("span",{children:s.contentType||(t==null?void 0:t.contentType)||"article"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Technical Level:"}),e.jsx("span",{children:s.technicalLevel||"intermediate"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Category:"}),e.jsx("span",{children:s.category||(t==null?void 0:t.category)||"General"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Sentiment & Emotion"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Sentiment:"}),e.jsx("span",{className:`font-medium ${s.sentiment==="positive"?"text-green-400":s.sentiment==="negative"?"text-red-400":"text-gray-300"}`,children:s.sentiment||"neutral"})]}),s.emotions&&s.emotions.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Emotions:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.emotions.map((i,l)=>e.jsx("span",{className:"px-2 py-1 bg-primary-600 bg-opacity-20 text-primary-300 text-xs rounded-full",children:i},l))})]})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Topics & Concepts"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Main Topics"}),s.mainTopics&&s.mainTopics.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:s.mainTopics.map((i,l)=>e.jsx("span",{className:"px-3 py-1 bg-blue-600 bg-opacity-20 text-blue-300 text-sm rounded-full",children:i},l))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No topics identified"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Key Concepts"}),s.keyConcepts?e.jsx("div",{className:"flex flex-wrap gap-2",children:(()=>{try{const i=JSON.parse(s.keyConcepts.replace(/'/g,'"'));return Array.isArray(i)?i.map((l,o)=>e.jsx("span",{className:"px-3 py-1 bg-green-600 bg-opacity-20 text-green-300 text-sm rounded-full",children:l},o)):[]}catch(i){return e.jsx("p",{className:"text-gray-500 text-sm",children:"No key concepts identified"})}})()}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No key concepts identified"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Named Entities"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"font-bold mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-blue-400",children:"👥"}),"People"]}),(a=s.keyEntities)!=null&&a.people&&s.keyEntities.people.length>0?e.jsx("div",{className:"space-y-1",children:s.keyEntities.people.map((i,l)=>e.jsx("div",{className:"text-sm text-gray-300",children:i},l))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"None identified"})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"font-bold mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-green-400",children:"🏢"}),"Organizations"]}),(n=s.keyEntities)!=null&&n.organizations&&s.keyEntities.organizations.length>0?e.jsx("div",{className:"space-y-1",children:s.keyEntities.organizations.map((i,l)=>e.jsx("div",{className:"text-sm text-gray-300",children:i},l))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"None identified"})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"font-bold mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-yellow-400",children:"📍"}),"Locations"]}),(r=s.keyEntities)!=null&&r.locations&&s.keyEntities.locations.length>0?e.jsx("div",{className:"space-y-1",children:s.keyEntities.locations.map((i,l)=>e.jsx("div",{className:"text-sm text-gray-300",children:i},l))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"None identified"})]})]})]})]})},Ar=({chunk:s,vector:t,safeChunkIndex:a})=>e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx(Fa,{vector:t,title:`Chunk ${s.chunk_index!==void 0?s.chunk_index+1:a!==void 0?a:"N/A"} Embedding`})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Embedding Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Model:"}),e.jsx("span",{children:"text-embedding-3-small"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Dimensions:"}),e.jsx("span",{children:t.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Magnitude:"}),e.jsx("span",{children:Math.sqrt(t.reduce((n,r)=>n+r*r,0)).toFixed(4)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Contextual:"}),e.jsx("span",{className:s.embeddingStatus==="complete"?"text-green-400":"text-gray-500",children:s.embeddingStatus==="complete"?"Enhanced":"Standard"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Vector Statistics"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Min Value:"}),e.jsx("span",{className:"font-mono",children:Math.min(...t).toFixed(6)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Max Value:"}),e.jsx("span",{className:"font-mono",children:Math.max(...t).toFixed(6)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Mean:"}),e.jsx("span",{className:"font-mono",children:(t.reduce((n,r)=>n+r,0)/t.length).toFixed(6)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Non-zero:"}),e.jsxs("span",{children:[t.filter(n=>n!==0).length," / ",t.length]})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Similarity Analysis"}),e.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"This embedding can be used to find similar chunks through vector similarity search in Qdrant."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{className:"btn-secondary text-sm",children:[e.jsx(Ee,{className:"w-4 h-4"}),"Find Similar Chunks"]}),e.jsxs("button",{className:"btn-secondary text-sm",children:[e.jsx(st,{className:"w-4 h-4"}),"Search in Qdrant"]}),e.jsxs("button",{className:"btn-secondary text-sm",children:[e.jsx(Ie,{className:"w-4 h-4"}),"Copy Vector"]})]})]})]});class Ba extends hs.Component{constructor(a){super(a);Is(this,"handleRetry",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(a){return{hasError:!0}}componentDidCatch(a,n){this.setState({error:a,errorInfo:n})}render(){if(this.state.hasError){const{onClose:a,fallbackTitle:n="Something went wrong"}=this.props;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 modal-overlay flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"modal-content bg-gray-900 text-white rounded-2xl shadow-2xl w-full max-w-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-red-600 bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsx(Rn,{className:"w-5 h-5 text-red-400"})}),e.jsx("h2",{className:"text-xl font-bold text-red-400",children:n})]}),a&&e.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",title:"Close",children:e.jsx(ve,{className:"w-5 h-5 text-gray-400"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-gray-300 mb-4",children:"An error occurred while rendering this component. This might be due to a JavaScript error or missing data."}),this.state.error&&e.jsx("div",{className:"bg-red-900 bg-opacity-20 border border-red-500 border-opacity-30 rounded-lg p-3 mb-4",children:e.jsx("p",{className:"text-red-200 text-sm font-mono",children:this.state.error.toString()})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:this.handleRetry,className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded text-white font-medium transition-colors",children:[e.jsx(oe,{className:"w-4 h-4"}),"Try Again"]}),a&&e.jsx("button",{onClick:a,className:"bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded text-white font-medium transition-colors",children:"Close"})]}),!1]})})}return this.props.children}}const Er=s=>{if(!s)return null;try{if(s.startsWith("file://"))return s.replace("file://","");const n=new URL(s).pathname.split("/").pop();return n&&n.includes(".")?decodeURIComponent(n):s.replace(/^https?:\/\//,"")}catch(t){const a=s.split("/"),n=a[a.length-1];return n&&n.includes(".")?decodeURIComponent(n):s.replace(/^(https?:\/\/|file:\/\/)/,"")}},Pr=(s,t=50)=>{if(!s||s.length<=t)return s;const a=s.lastIndexOf(".");if(a>0&&s.length-a<8){const n=s.substring(0,a),r=s.substring(a),i=t-r.length-3;if(i>10)return`${n.substring(0,i)}...${r}`}return`${s.substring(0,t-3)}...`},$r=({document:s,chunks:t})=>{const a=()=>{const d={},c=t.filter(p=>(p.status==="completed"||p.status==="complete")&&p.index!==-1);return c.forEach(p=>{const h=p.mainTopics;h&&Array.isArray(h)&&h.length>0&&h.forEach(j=>{d[j]=(d[j]||0)+1})}),Object.entries(d).map(([p,h])=>({topic:p,frequency:h,confidence:Math.min(.95,.5+h/Math.max(c.length,1)*.45)})).sort((p,h)=>h.frequency-p.frequency).slice(0,6)},n=()=>{if(!t.length)return{contextual:0,entity:0,sentiment:0};const d=t.filter(j=>(j.status==="completed"||j.status==="complete")&&j.index!==-1);if(!d.length)return{contextual:0,entity:0,sentiment:0};const c=d.filter(j=>j.contextualSummary).length,p=d.filter(j=>{const f=j.keyEntities;return f&&typeof f=="object"&&Object.keys(f).length>0}).length,h=d.filter(j=>j.sentiment&&j.sentiment!=="neutral").length;return{contextual:Math.round(c/d.length*100),entity:Math.round(p/d.length*100),sentiment:Math.round(h/d.length*100)}},r=()=>{if(!t.length)return{strengths:[],observations:[],ragReadiness:[]};const d=t.filter(x=>(x.status==="completed"||x.status==="complete")&&x.index!==-1);if(!d.length)return{strengths:["Document processing initiated"],observations:["Analysis in progress - detailed insights available after processing completes"],ragReadiness:["Preparing for semantic search capabilities"]};const c=d.map(x=>x.sentiment).filter(Boolean),p=d.flatMap(x=>x.emotions||[]),h=d.flatMap(x=>{const _=x.keyEntities;return _?Object.values(_).flat():[]}),j=d.flatMap(x=>x.mainTopics||[]),f=d.map(x=>x.contentType).filter(Boolean),v=d.map(x=>x.technicalLevel).filter(Boolean),w=d.map(x=>x.category).filter(Boolean),g=[],S=[],k=[];if(h.length>d.length*.5){const x=[...new Set(h)];g.push(`Rich entity network (${x.length} unique entities identified)`)}if(j.length>d.length*.7){const x=[...new Set(j)];g.push(`Comprehensive topic coverage (${x.length} distinct topics)`)}d.filter(x=>x.contextualSummary).length>d.length*.8&&g.push("Enhanced contextual embeddings for improved retrieval accuracy");const E=c.filter(x=>x==="positive").length,$=c.filter(x=>x==="neutral").length;c.filter(x=>x==="negative").length,E>c.length*.6?g.push("Predominantly positive content tone"):$>c.length*.7&&g.push("Objective, informational content style");const y=[...new Set(f)],N=[...new Set(w)],m=[...new Set(v)];if(y.length>1?S.push(`Multi-format content: ${y.join(", ")}`):y[0]&&S.push(`Consistent ${y[0]} content type`),N.length>0&&S.push(`Primary subject areas: ${N.slice(0,3).join(", ")}`),m.length>1?S.push(`Varied complexity levels: ${m.join(", ")}`):m[0]&&S.push(`${m[0].charAt(0).toUpperCase()+m[0].slice(1)} technical level throughout`),p.length>0){const x=[...new Set(p)];S.push(`Emotional depth detected: ${x.slice(0,3).join(", ")}`)}const T=Math.round(d.filter(x=>x.contextualSummary).length/d.length*100);return T>70&&k.push(`${T}% contextual enhancement coverage`),h.length>0&&k.push(`Entity-relationship mapping for ${h.length} extracted entities`),j.length>0&&k.push(`Topic-based retrieval for ${[...new Set(j)].length} semantic themes`),k.push(`Optimized ${d.length}-chunk structure for vector search`),g.length===0&&g.push("Successfully processed and embedded for semantic search"),S.length===0&&S.push("Standard content structure with consistent formatting"),k.length===0&&k.push("Ready for AI-powered question answering"),{strengths:g,observations:S,ragReadiness:k}},i=a(),l=n(),o=r();return t.filter(d=>(d.status==="completed"||d.status==="complete")&&d.index!==-1),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"font-bold mb-4",children:"Topic Distribution"}),e.jsx("div",{className:"space-y-3",children:i.length>0?i.map((d,c)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:d.topic}),e.jsxs("span",{className:"text-gray-400",children:[d.frequency," mentions"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"h-2 bg-primary-500 rounded-full",style:{width:`${d.confidence*100}%`}})})]},c)):e.jsxs("div",{className:"text-center py-4 text-gray-400",children:[e.jsx(X,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),t.some(d=>d.status==="processing")?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Topics are being analyzed..."}),e.jsx("p",{className:"text-xs",children:"AI analysis in progress. Topics will appear as chunks complete processing."})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"No topics detected in chunks"}),e.jsx("p",{className:"text-xs",children:"Topics may not be available for this document"})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"font-bold mb-4",children:"Processing Quality"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Contextual Enhancement"}),e.jsxs("span",{className:"text-green-400",children:[l.contextual,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"h-2 bg-green-500 rounded-full",style:{width:`${l.contextual}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Entity Recognition"}),e.jsxs("span",{className:"text-blue-400",children:[l.entity,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"h-2 bg-blue-500 rounded-full",style:{width:`${l.entity}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Sentiment Analysis"}),e.jsxs("span",{className:"text-purple-400",children:[l.sentiment,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"h-2 bg-purple-500 rounded-full",style:{width:`${l.sentiment}%`}})})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"font-bold mb-4",children:"Comprehensive Analysis Report"}),e.jsxs("div",{className:"prose prose-invert max-w-none",children:[e.jsx("p",{className:"text-gray-300 leading-relaxed",children:(()=>{const d=t.filter(v=>(v.status==="completed"||v.status==="complete")&&v.index!==-1),c=t.length-d.length;if(d.length===0)return`This document is currently being processed using AutoLlama's advanced contextual embedding system. ${t.length} chunks are being analyzed for topics, entities, and semantic relationships.`;const p=[...new Set(d.flatMap(v=>v.mainTopics||[]))],h=[...new Set(d.map(v=>v.category).filter(Boolean))],j=[...new Set(d.map(v=>v.contentType).filter(Boolean))];let f=`Analysis of ${(s==null?void 0:s.title)||"this document"} reveals ${d.length} processed chunks`;return c>0&&(f+=` (${c} still processing)`),p.length>0&&(f+=` covering primary topics: ${p.slice(0,3).join(", ")}`,p.length>3&&(f+=` and ${p.length-3} others`)),h.length>0&&(f+=`. Content categorized as ${h.join(", ")}`),j.length>0&&(f+=` with ${j.join(", ")} formatting`),f+=". Enhanced with contextual embeddings for superior retrieval accuracy.",f})()}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-900 bg-opacity-20 border border-blue-700 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-blue-300 mb-2",children:"Strengths"}),e.jsx("ul",{className:"text-sm text-blue-200 space-y-1",children:o.strengths.length>0?o.strengths.map((d,c)=>e.jsxs("li",{children:["• ",d]},c)):e.jsx("li",{children:"• Content successfully processed"})})]}),e.jsxs("div",{className:"bg-yellow-900 bg-opacity-20 border border-yellow-700 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-yellow-300 mb-2",children:"Observations"}),e.jsx("ul",{className:"text-sm text-yellow-200 space-y-1",children:o.observations.length>0?o.observations.map((d,c)=>e.jsxs("li",{children:["• ",d]},c)):e.jsx("li",{children:"• Consistent content structure"})})]}),e.jsxs("div",{className:"bg-green-900 bg-opacity-20 border border-green-700 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-green-300 mb-2",children:"RAG Readiness"}),e.jsx("ul",{className:"text-sm text-green-200 space-y-1",children:o.ragReadiness.map((d,c)=>e.jsxs("li",{children:["• ",d]},c))})]})]})]})]})]})},Ir=()=>{const{selectedDocument:s,handleBackToDashboard:t,api:a}=Y(),[n,r]=u.useState([]),[i,l]=u.useState(!0),[o,d]=u.useState(null),[c,p]=u.useState(0),[h,j]=u.useState("overview");u.useEffect(()=>{s&&f()},[s]);const f=()=>R(void 0,null,function*(){if(s!=null&&s.url){l(!0);try{const g=btoa(s.url),S=yield a.documents.getChunks(g,{limit:1e3}),k=(S==null?void 0:S.chunks)||[];r(k)}catch(g){}finally{l(!1)}}}),v=(g,S)=>{const k=g.index!==void 0?g.index+1:S+1;p(k),d(g)},w=g=>R(void 0,null,function*(){try{p(g);const S=n.find($=>$.index===g-1);if(S){d(S);return}const k=btoa(s.url),E=yield a.documents.getChunkByIndex(k,g-1);E.chunk&&d(E.chunk)}catch(S){const k=n.length>0?Math.max(...n.map(E=>E.index!==void 0?E.index:-1)):-1;if(g-1<=k){const E=n.find($=>$.index>=0);E&&d(E)}}});return s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:t,className:"flex items-center gap-2 text-blue-400 hover:text-blue-300 transition-colors",children:[e.jsx(Mn,{className:"w-4 h-4"}),"Back to Dashboard"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:"btn-secondary",children:[e.jsx(ps,{className:"w-4 h-4"}),"Export Analysis"]}),e.jsxs("button",{className:"btn-secondary",children:[e.jsx(st,{className:"w-4 h-4"}),"Open Source"]})]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ae,{className:"w-6 h-6 text-primary-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-white",children:s.title||s.url||"Untitled Document"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-400 mb-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(je,{className:"w-4 h-4"}),s.processedAt?new Date(s.processedAt).toLocaleDateString():"Recently processed"]}),e.jsx("span",{children:s.contentType||"Document"}),e.jsxs("span",{children:[n.length," chunks"]}),s.url&&e.jsxs("span",{className:"flex items-center gap-1 text-gray-400",title:s.url,children:[e.jsx(Ta,{className:"w-4 h-4"}),Pr(Er(s.url),50)]}),s.usesContextualEmbedding&&e.jsxs("span",{className:"flex items-center gap-1 text-blue-400",children:[e.jsx(X,{className:"w-4 h-4"}),"Contextually Enhanced"]})]}),s.summary&&e.jsx("p",{className:"text-gray-300 leading-relaxed",children:s.summary})]})]})}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-800 bg-opacity-50 rounded-lg p-1",children:[e.jsx(Qt,{id:"overview",label:"Overview",icon:et,active:h==="overview",onClick:()=>j("overview")}),e.jsx(Qt,{id:"chunks",label:"Chunks",icon:ae,active:h==="chunks",onClick:()=>j("chunks"),badge:n.length}),e.jsx(Qt,{id:"analysis",label:"Analysis",icon:X,active:h==="analysis",onClick:()=>j("analysis")})]}),i?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Me,{className:"w-8 h-8 animate-spin text-primary-400 mr-3"}),e.jsx("span",{className:"text-lg",children:"Loading document analysis..."})]})}):e.jsxs(e.Fragment,{children:[h==="overview"&&e.jsx(Rr,{document:s,chunks:n}),h==="chunks"&&e.jsx(Mr,{chunks:n,onChunkSelect:v}),h==="analysis"&&e.jsx($r,{document:s,chunks:n})]}),o&&e.jsx(Ba,{onClose:()=>d(null),fallbackTitle:"Chunk Inspector Error",children:e.jsx(za,{chunk:o,document:s,chunkIndex:c,totalChunks:n.length>0?Math.max(...n.map(g=>g.index!==void 0?g.index:-1))+1:0,onClose:()=>d(null),onNavigate:w})})]}):e.jsx("div",{className:"card",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ae,{className:"w-16 h-16 text-gray-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"No Document Selected"}),e.jsx("p",{className:"text-gray-400",children:"Please select a document to view its details."})]})})},Qt=({id:s,label:t,icon:a,active:n,onClick:r,badge:i})=>e.jsxs("button",{onClick:r,className:`flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all duration-200 ${n?"bg-primary-600 text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:[e.jsx(a,{className:"w-4 h-4"}),e.jsx("span",{children:t}),i!==void 0&&e.jsx("span",{className:`px-2 py-1 text-xs rounded-full font-bold ${n?"bg-primary-800 text-primary-200":"bg-gray-600 text-gray-200"}`,children:i})]}),Rr=({document:s,chunks:t})=>{const a={total:t.length,completed:t.filter(r=>(r.status==="completed"||r.status==="complete")&&r.index!==-1).length,processing:t.filter(r=>r.status==="processing"||r.index===-1).length,failed:t.filter(r=>r.status==="error"||r.status==="failed").length},n=a.total>0?Math.round(a.completed/a.total*100):0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(yt,{title:"Total Chunks",value:a.total,icon:ae,color:"text-blue-400"}),e.jsx(yt,{title:"Completed",value:a.completed,icon:re,color:"text-green-400"}),e.jsx(yt,{title:"Processing",value:a.processing,icon:Me,color:"text-yellow-400",animated:a.processing>0}),e.jsx(yt,{title:"Failed",value:a.failed,icon:le,color:"text-red-400"})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-bold",children:"Processing Progress"}),e.jsxs("span",{className:"text-sm text-gray-400",children:[n,"% Complete"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all duration-300",style:{width:`${n}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"font-bold mb-4 flex items-center gap-2",children:[e.jsx(X,{className:"w-5 h-5 text-primary-400"}),"AI Analysis"]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Content Type:"}),e.jsx("span",{children:s.contentType||"article"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Technical Level:"}),e.jsx("span",{children:s.technicalLevel||"intermediate"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Sentiment:"}),e.jsx("span",{className:`${s.sentiment==="positive"?"text-green-400":s.sentiment==="negative"?"text-red-400":"text-gray-300"}`,children:s.sentiment||"neutral"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Contextual Embeddings:"}),e.jsx("span",{className:s.usesContextualEmbedding?"text-green-400":"text-gray-500",children:s.usesContextualEmbedding?"Enabled":"Disabled"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"font-bold mb-4 flex items-center gap-2",children:[e.jsx(et,{className:"w-5 h-5 text-primary-400"}),"Content Statistics"]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Characters:"}),e.jsx("span",{children:(()=>t.reduce((r,i)=>{var l;return r+(((l=i.text)==null?void 0:l.length)||0)},0).toLocaleString())()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Avg Chunk Size:"}),e.jsxs("span",{children:[t.length>0?Math.round(t.reduce((r,i)=>{var l;return r+(((l=i.text)==null?void 0:l.length)||0)},0)/t.length):0," characters"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Processing Time:"}),e.jsxs("span",{children:["~",Math.round(t.length*2.3)," seconds"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Storage Size:"}),e.jsxs("span",{children:["~",Math.round(t.length*1.5),"KB"]})]})]})]})]}),e.jsx(Ur,{chunks:t})]})},Mr=({chunks:s,onChunkSelect:t})=>{var i;const{settings:a}=Y();(i=a==null?void 0:a.ui)!=null&&i.chunksPerRow;const n={queued:{color:"bg-gray-500",text:"text-gray-200"},processing:{color:"bg-yellow-500 animate-pulse",text:"text-yellow-100"},completed:{color:"bg-green-500",text:"text-green-100"},error:{color:"bg-red-500",text:"text-red-100"}},r=()=>"grid gap-1.5 max-h-[28rem] overflow-y-auto custom-scrollbar p-3 border border-gray-700 rounded-lg bg-gray-800 bg-opacity-30 grid-cols-6 sm:grid-cols-8 md:grid-cols-12 lg:grid-cols-16 xl:grid-cols-20 2xl:grid-cols-24";return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"font-bold text-xl",children:"Document Chunks"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Click any chunk to inspect its details (responsive grid layout)"})]}),e.jsx("div",{className:r(),children:s.map((l,o)=>{let d="completed";l.status==="processing"?d="processing":l.status==="error"||l.status==="failed"?d="error":l.status==="queued"?d="queued":(l.status==="completed"||l.status==="complete")&&(d="completed");const c=n[d]||n.completed;return e.jsxs("button",{onClick:()=>t(l,o),className:`
                chunk-glow w-full aspect-square rounded-md flex items-center justify-center text-xs font-mono font-bold
                transition-all duration-300 cursor-pointer relative overflow-hidden
                ${c.color} ${c.text}
                ${d==="processing"?"chunk-pulse":""}
                ${d==="completed"?"chunk-completed":""}
                ${d==="error"?"chunk-error":""}
                ${d==="queued"?"chunk-queued":""}
              `,title:`Chunk ${o+1} - Status: ${l.status||"completed"}`,children:[e.jsx("span",{className:"relative z-10",children:o+1}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 to-transparent opacity-0 transition-opacity duration-300 group-hover:opacity-100"})]},l.chunk_id||o)})}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-center gap-6 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded"}),e.jsx("span",{className:"text-gray-400",children:"Completed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded animate-pulse"}),e.jsx("span",{className:"text-gray-400",children:"Processing"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-500 rounded"}),e.jsx("span",{className:"text-gray-400",children:"Queued"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),e.jsx("span",{className:"text-gray-400",children:"Failed"})]})]})})]})},yt=({title:s,value:t,icon:a,color:n,animated:r=!1})=>e.jsxs("div",{className:"card text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(a,{className:`w-6 h-6 ${n} ${r?"animate-spin":""}`})}),e.jsx("div",{className:`text-2xl font-bold ${n}`,children:t}),e.jsx("div",{className:"text-sm text-gray-400",children:s})]}),Ur=({chunks:s})=>{const[t,a]=u.useState(!1),[n,r]=u.useState(!1),[i,l]=u.useState(!1),[o,d]=u.useState(!1),c=s.filter(E=>(E.status==="completed"||E.status==="complete")&&E.index!==-1),p=[];c.forEach(E=>{E.mainTopics&&Array.isArray(E.mainTopics)?p.push(...E.mainTopics):E.main_topics&&Array.isArray(E.main_topics)&&p.push(...E.main_topics)});const h={people:[],locations:[],organizations:[]};c.forEach(E=>{const $=E.keyEntities||E.key_entities;$&&typeof $=="object"&&($.people&&Array.isArray($.people)&&h.people.push(...$.people),$.locations&&Array.isArray($.locations)&&h.locations.push(...$.locations),$.organizations&&Array.isArray($.organizations)&&h.organizations.push(...$.organizations))});const j=[...new Set(p)].filter(Boolean),f=[...new Set(h.people)].filter(Boolean),v=[...new Set(h.locations)].filter(Boolean),w=[...new Set(h.organizations)].filter(Boolean),g=j.length>0,S=f.length>0||v.length>0||w.length>0,k=s.some(E=>E.status==="processing"||E.index===-1);return!g&&!S&&!k?null:e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"font-bold mb-4",children:"Topics & Entities"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2 text-gray-300",children:"Main Topics"}),g?e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(t?j:j.slice(0,12)).map((E,$)=>e.jsx("span",{className:"px-3 py-1 bg-blue-600 bg-opacity-20 text-blue-300 text-sm rounded-full",children:E},$)),j.length>12&&e.jsx("button",{onClick:()=>a(!t),className:"px-3 py-1 bg-gray-600 bg-opacity-20 text-gray-400 text-sm rounded-full hover:bg-gray-600 hover:bg-opacity-40 hover:text-gray-300 transition-colors cursor-pointer",title:t?"Show less":`Show all ${j.length} topics`,children:t?"Show less":`+${j.length-12} more`})]}):e.jsx("div",{className:"text-sm text-gray-400",children:k?"Topics being analyzed...":"No topics detected"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2 text-gray-300",children:"Key Entities"}),S?e.jsxs("div",{className:"space-y-2 text-sm",children:[f.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"People:"}),e.jsx("span",{className:"ml-2",children:(n?f:f.slice(0,8)).join(", ")}),f.length>8&&e.jsx("button",{onClick:()=>r(!n),className:"text-gray-400 hover:text-gray-300 transition-colors cursor-pointer underline ml-1",title:n?"Show less":`Show all ${f.length} people`,children:n?" Show less":` +${f.length-8} more`})]}),w.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Organizations:"}),e.jsx("span",{className:"ml-2",children:(i?w:w.slice(0,8)).join(", ")}),w.length>8&&e.jsx("button",{onClick:()=>l(!i),className:"text-gray-400 hover:text-gray-300 transition-colors cursor-pointer underline ml-1",title:i?"Show less":`Show all ${w.length} organizations`,children:i?" Show less":` +${w.length-8} more`})]}),v.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Locations:"}),e.jsx("span",{className:"ml-2",children:(o?v:v.slice(0,8)).join(", ")}),v.length>8&&e.jsx("button",{onClick:()=>d(!o),className:"text-gray-400 hover:text-gray-300 transition-colors cursor-pointer underline ml-1",title:o?"Show less":`Show all ${v.length} locations`,children:o?" Show less":` +${v.length-8} more`})]})]}):e.jsx("div",{className:"text-sm text-gray-400",children:k?"Entities being extracted...":"No entities detected"})]})]})]})},Or=s=>s.includes("pdf")?ae:s.includes("image")?Un:Ta,Lr=s=>{if(s===0)return"0 Bytes";const t=1024,a=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,n)).toFixed(2))+" "+a[n]},Bs=({onSuccess:s,onError:t})=>{const{api:a,settings:n,updateSetting:r,uploadQueue:i,addToUploadQueue:l,updateUploadStatus:o,removeFromUploadQueue:d,clearCompletedUploads:c}=Y(),[p,h]=u.useState(!1),j=u.useRef(null),f=u.useCallback(_=>{_.preventDefault(),_.stopPropagation(),_.type==="dragenter"||_.type==="dragover"?h(!0):_.type==="dragleave"&&h(!1)},[]),v=u.useCallback(_=>{_.preventDefault(),_.stopPropagation(),h(!1),_.dataTransfer.files&&_.dataTransfer.files[0]&&g(Array.from(_.dataTransfer.files))},[]),w=_=>{_.target.files&&_.target.files.length>0&&g(Array.from(_.target.files))},g=_=>{var C;const I=_.filter(b=>S(b)),M=l(I);(C=n==null?void 0:n.processing)!=null&&C.autoStartProcessing&&M.forEach(b=>{k(b)})},S=_=>["application/pdf","text/plain","text/markdown","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/epub+zip","text/csv","application/json"].includes(_.type)&&_.size<=104857600,k=_=>R(void 0,null,function*(){o(_.id,{status:"uploading",progress:0});const I=10*1024*1024;return _.file.size>I?$(_):E(_)}),E=_=>R(void 0,null,function*(){var M,C;let I=null;try{const b=new FormData;b.append("file",_.file),b.append("enableContextual",n.processing.enableContextualEmbeddings),b.append("source","user");const A=new AbortController;I=setTimeout(()=>A.abort(),18e5),o(_.id,{abortController:A});const O=yield fetch("/api/process-file-stream",{method:"POST",body:b,signal:A.signal});if(!O.ok)throw new Error(`HTTP ${O.status}: ${O.statusText}`);yield y(O,_)}catch(b){I&&clearTimeout(I);let A="Upload failed";if(b.name==="AbortError"){if(((M=i.find(L=>L.id===_.id))==null?void 0:M.status)==="cancelled")return;A="Upload timeout - file too large or connection too slow"}else b.response?b.response.status===413?A="File too large (max 500MB)":b.response.status===415?A="Unsupported file type":(C=b.response.data)!=null&&C.message?A=b.response.data.message:A=`HTTP ${b.response.status}: ${b.response.statusText||"Upload failed"}`:b.message&&(A=b.message);o(_.id,{status:"error",error:A}),t&&t(_,b)}}),$=_=>R(void 0,null,function*(){var L;const M=_.file,C=Math.ceil(M.size/2097152);let b=0,A=Date.now(),O=new AbortController;o(_.id,{abortController:O,totalChunks:C,uploadedChunks:0,uploadSpeed:0,estimatedTimeRemaining:0});try{const B=yield fetch("/api/upload/initialize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:M.name,fileSize:M.size,fileType:M.type,totalChunks:C,enableContextual:n.processing.enableContextualEmbeddings,source:"user"}),signal:O.signal});if(!B.ok)throw new Error(`Failed to initialize upload: ${B.status}`);const{uploadId:z,sessionId:Z}=yield B.json();o(_.id,{uploadId:z,sessionId:Z,status:"uploading",progress:5});for(let te=0;te<C;te++){if(O.signal.aborted)throw new Error("Upload cancelled by user");const Ne=te*2097152,Ve=Math.min(Ne+2097152,M.size),Ot=M.slice(Ne,Ve),Pe=new FormData;Pe.append("chunk",Ot),Pe.append("uploadId",z),Pe.append("chunkIndex",te.toString()),Pe.append("totalChunks",C.toString());const Lt=Date.now(),rt=yield fetch("/api/upload/chunk",{method:"POST",body:Pe,signal:O.signal});if(!rt.ok)throw new Error(`Chunk upload failed: ${rt.status}`);b++;const Dt=Date.now()-Lt,Ft=Date.now()-A,it=b*2097152,He=it/(Ft/1e3),zt=(M.size-it)/He,lt=5+b/C*85;o(_.id,{uploadedChunks:b,progress:Math.min(lt,90),uploadSpeed:Math.round(He/1024),estimatedTimeRemaining:Math.round(zt),lastChunkTime:Dt}),te<C-1&&(yield new Promise(ct=>setTimeout(ct,50)))}const ee=yield fetch("/api/upload/finalize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uploadId:z,sessionId:Z}),signal:O.signal});if(!ee.ok)throw new Error(`Failed to finalize upload: ${ee.status}`);o(_.id,{status:"processing",progress:95,message:"Upload complete, starting processing..."});const de=yield fetch(`/api/upload/stream/${Z}`,{method:"GET",signal:O.signal});if(!de.ok)throw new Error(`Failed to connect to processing stream: ${de.status}`);yield y(de,_)}catch(B){let z="Upload failed";if(B.name==="AbortError"){if(((L=i.find(ee=>ee.id===_.id))==null?void 0:L.status)==="cancelled")return;z="Upload cancelled"}else B.message&&(z=B.message);o(_.id,{status:"error",error:z}),t&&t(_,B)}}),y=(_,I)=>R(void 0,null,function*(){const M=_.body.getReader(),C=new TextDecoder;let b="";try{for(;;){const{done:A,value:O}=yield M.read();if(A)break;b+=C.decode(O,{stream:!0});const L=b.split(`
`);b=L.pop()||"";for(const B of L)if(B.trim()!==""&&B.startsWith("data: "))try{const z=B.slice(6).trim();if(z==="")continue;const Z=JSON.parse(z);Z&&typeof Z=="object"&&N({event:Z.event,data:Z.data},I)}catch(z){}}if(b.trim()&&b.startsWith("data: "))try{const A=b.slice(6).trim();if(A){const O=JSON.parse(A);O&&typeof O=="object"&&N({event:O.event,data:O.data},I)}}catch(A){}}finally{M.releaseLock()}setTimeout(()=>{const A=i.find(O=>O.id===I.id);A&&A.status==="processing"&&o(I.id,{status:"processing",progress:Math.max(A.progress||0,95)})},1e3)}),N=(_,I)=>{if(!_||typeof _!="object")return;const M=_.event,C=_.data||{};if(M==="error"){const b={id:Date.now().toString(),message:C.message||"Upload failed",error_type:C.error_type||"unknown",recovery_suggestions:C.recovery_suggestions||["Try uploading again"],retry_recommended:C.retry_recommended||!1,severity:C.severity||"high",category:C.category||"processing",retryable:C.retryable||C.retry_recommended||!1,timestamp:new Date().toISOString()};o(I.id,{status:"error",error:b.message,error_type:b.error_type,recovery_suggestions:b.recovery_suggestions,retry_recommended:b.retry_recommended}),t&&t(I,b)}else if(M==="heartbeat_timeout")o(I.id,{status:"stuck",message:C.message||"Processing is taking longer than expected...",time_since_last_update:C.time_since_last_update,progress:C.total_progress||50});else if(M==="heartbeat")o(I.id,{last_heartbeat:C.timestamp,heartbeat_step:C.step});else if(M==="start")o(I.id,{status:"processing",sessionId:C.processingId,progress:5});else if(M==="upload")o(I.id,{status:"uploading",progress:Math.max(C.progress||5,5)});else if(M==="parse")o(I.id,{status:"processing",progress:Math.max(C.progress||40,30)});else if(M==="chunk")o(I.id,{status:"processing",progress:Math.max(C.progress||55,50)});else if(M==="analyze"){const b=C.progress||70;o(I.id,{status:"processing",progress:Math.max(b,60)})}else if(M==="embedding"){const b=C.progress||85;o(I.id,{status:"processing",progress:Math.max(b,80)})}else if(M==="qdrant")o(I.id,{status:"processing",progress:Math.max(C.progress||92,90)});else if(M==="complete")o(I.id,{status:"completed",progress:100}),s&&s(I,C);else{const b=C.progress||0;b>0&&o(I.id,{status:"processing",progress:Math.min(Math.max(b,5),95)})}},m=_=>{d(_)},T=_=>{k(_)},x=_=>{_.abortController&&(_.abortController.abort(),o(_.id,{status:"cancelled",error:"Upload cancelled by user",abortController:null}))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:`
          relative border-2 border-dashed rounded-xl p-8 text-center transition-all duration-200 cursor-pointer
          ${p?"border-primary-400 bg-primary-600 bg-opacity-10":"border-gray-600 hover:border-gray-500"}
        `,onDragEnter:f,onDragLeave:f,onDragOver:f,onDrop:v,onClick:()=>{var _;(_=j.current)==null||_.click()},children:[e.jsx("input",{ref:j,type:"file",multiple:!0,accept:".pdf,.txt,.md,.doc,.docx,.epub,.csv,.json",onChange:w,className:"hidden"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:`w-16 h-16 mx-auto rounded-full flex items-center justify-center ${p?"bg-primary-500 bg-opacity-20":"bg-gray-700"}`,children:e.jsx(Ue,{className:`w-8 h-8 ${p?"text-primary-400":"text-gray-400"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:p?"Drop files here!":"Upload Documents"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Drag and drop files here, or click to browse"}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("p",{children:"Supported: PDF, TXT, MD, DOC, DOCX, EPUB, CSV, JSON"}),e.jsx("p",{children:"Maximum size: 100MB per file"}),e.jsx("p",{className:"text-xs mt-1",children:"Large files (>10MB) use chunked upload with progress tracking"})]})]}),e.jsxs("button",{className:"btn-primary",children:[e.jsx(Ue,{className:"w-4 h-4"}),"Choose Files"]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-4",children:"Processing Options"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.processing.enableContextualEmbeddings,onChange:_=>r("processing","enableContextualEmbeddings",_.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Enable Contextual Embeddings"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.processing.autoStartProcessing||!1,onChange:_=>r("processing","autoStartProcessing",_.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Auto-start Processing"})]})]})]}),i.length>0&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-bold",children:"Upload Queue"}),e.jsxs("div",{className:"text-sm text-gray-400",children:[i.length," file",i.length!==1?"s":""]})]}),e.jsx("div",{className:"space-y-3",children:i.map(_=>e.jsx(Dr,{fileData:_,onRemove:()=>m(_.id),onRetry:()=>T(_),onUpload:()=>k(_),onStop:()=>x(_)},_.id))})]}),i.length>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(bt,{title:"Total Files",value:i.length,color:"text-blue-400"}),e.jsx(bt,{title:"Completed",value:i.filter(_=>_.status==="completed").length,color:"text-green-400"}),e.jsx(bt,{title:"Processing",value:i.filter(_=>_.status==="processing"||_.status==="uploading").length,color:"text-yellow-400"}),e.jsx(bt,{title:"Failed",value:i.filter(_=>_.status==="error"||_.status==="cancelled").length,color:"text-red-400"})]})]})},Dr=({fileData:s,onRemove:t,onRetry:a,onUpload:n,onStop:r})=>{const i=Or(s.type),l={pending:{color:"text-gray-400",bg:"bg-gray-600",icon:ae,action:"Upload"},uploading:{color:"text-blue-400",bg:"bg-blue-600",icon:Me,action:"Uploading..."},processing:{color:"text-yellow-400",bg:"bg-yellow-600",icon:Me,action:"Processing..."},completed:{color:"text-green-400",bg:"bg-green-600",icon:re,action:"Completed"},error:{color:"text-red-400",bg:"bg-red-600",icon:le,action:"Failed"},cancelled:{color:"text-orange-400",bg:"bg-orange-600",icon:ve,action:"Cancelled"}},o=l[s.status]||l.pending,d=o.icon;return e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(i,{className:"w-5 h-5 text-primary-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-white truncate",children:s.name}),e.jsx("span",{className:"text-xs text-gray-500",children:Lr(s.size)})]}),(s.status==="uploading"||s.status==="processing")&&e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2 mb-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${o.bg}`,style:{width:`${s.progress||0}%`}})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(d,{className:`w-4 h-4 ${o.color} ${s.status==="uploading"||s.status==="processing"?"animate-spin":""}`}),e.jsx("span",{className:o.color,children:o.action}),s.progress>0&&s.status!=="completed"&&e.jsxs("span",{className:"text-gray-400",children:["(",Math.round(s.progress),"%)"]})]}),s.status==="uploading"&&s.totalChunks&&e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500 mt-1",children:[e.jsxs("span",{children:[s.uploadedChunks||0,"/",s.totalChunks," chunks"]}),s.uploadSpeed>0&&e.jsxs("span",{children:[s.uploadSpeed," KB/s"]}),s.estimatedTimeRemaining>0&&e.jsxs("span",{children:["~",Math.ceil(s.estimatedTimeRemaining/1e3),"s remaining"]})]}),s.error&&e.jsx("div",{className:"text-sm text-red-400 mt-1",children:s.error})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="pending"&&e.jsx("button",{onClick:n,className:"btn-primary text-sm",children:"Upload"}),(s.status==="uploading"||s.status==="processing")&&e.jsx("button",{onClick:r,className:"btn-secondary text-sm bg-red-600 hover:bg-red-700 text-white",title:"Stop upload",children:"Stop"}),s.status==="error"&&e.jsx("button",{onClick:a,className:"btn-secondary text-sm",children:"Retry"}),s.status==="cancelled"&&e.jsx("button",{onClick:a,className:"btn-secondary text-sm",children:"Retry"}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-700 rounded transition-colors",title:"Remove",children:e.jsx(ve,{className:"w-4 h-4 text-gray-400"})})]})]})},bt=({title:s,value:t,color:a})=>e.jsxs("div",{className:"text-center p-4 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700",children:[e.jsx("div",{className:`text-2xl font-bold ${a}`,children:t}),e.jsx("div",{className:"text-sm text-gray-400",children:s})]});var Ut,G,Va,$e,Vs,Ha,qa,Ka,ys,ns,rs,is={},Ga=[],Fr=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,at=Array.isArray;function ye(s,t){for(var a in t)s[a]=t[a];return s}function bs(s){s&&s.parentNode&&s.parentNode.removeChild(s)}function ls(s,t,a){var n,r,i,l={};for(i in t)i=="key"?n=t[i]:i=="ref"?r=t[i]:l[i]=t[i];if(arguments.length>2&&(l.children=arguments.length>3?Ut.call(arguments,2):a),typeof s=="function"&&s.defaultProps!=null)for(i in s.defaultProps)l[i]===void 0&&(l[i]=s.defaultProps[i]);return Qe(s,l,n,r,null)}function Qe(s,t,a,n,r){var i={type:s,props:t,key:a,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r==null?++Va:r,__i:-1,__u:0};return r==null&&G.vnode!=null&&G.vnode(i),i}function Ye(s){return s.children}function be(s,t){this.props=s,this.context=t}function ze(s,t){if(t==null)return s.__?ze(s.__,s.__i+1):null;for(var a;t<s.__k.length;t++)if((a=s.__k[t])!=null&&a.__e!=null)return a.__e;return typeof s.type=="function"?ze(s):null}function Wa(s){var t,a;if((s=s.__)!=null&&s.__c!=null){for(s.__e=s.__c.base=null,t=0;t<s.__k.length;t++)if((a=s.__k[t])!=null&&a.__e!=null){s.__e=s.__c.base=a.__e;break}return Wa(s)}}function Hs(s){(!s.__d&&(s.__d=!0)&&$e.push(s)&&!Pt.__r++||Vs!=G.debounceRendering)&&((Vs=G.debounceRendering)||Ha)(Pt)}function Pt(){for(var s,t,a,n,r,i,l,o=1;$e.length;)$e.length>o&&$e.sort(qa),s=$e.shift(),o=$e.length,s.__d&&(a=void 0,r=(n=(t=s).__v).__e,i=[],l=[],t.__P&&((a=ye({},n)).__v=n.__v+1,G.vnode&&G.vnode(a),Za(t.__P,a,n,t.__n,t.__P.namespaceURI,32&n.__u?[r]:null,i,r==null?ze(n):r,!!(32&n.__u),l),a.__v=n.__v,a.__.__k[a.__i]=a,Vr(i,a,l),a.__e!=r&&Wa(a)));Pt.__r=0}function Qa(s,t,a,n,r,i,l,o,d,c,p){var h,j,f,v,w,g,S=n&&n.__k||Ga,k=t.length;for(d=zr(a,t,S,d,k),h=0;h<k;h++)(f=a.__k[h])!=null&&(j=f.__i==-1?is:S[f.__i]||is,f.__i=h,g=Za(s,f,j,r,i,l,o,d,c,p),v=f.__e,f.ref&&j.ref!=f.ref&&(j.ref&&js(j.ref,null,f),p.push(f.ref,f.__c||v,f)),w==null&&v!=null&&(w=v),4&f.__u||j.__k===f.__k?d=Ja(f,d,s):typeof f.type=="function"&&g!==void 0?d=g:v&&(d=v.nextSibling),f.__u&=-7);return a.__e=w,d}function zr(s,t,a,n,r){var i,l,o,d,c,p=a.length,h=p,j=0;for(s.__k=new Array(r),i=0;i<r;i++)(l=t[i])!=null&&typeof l!="boolean"&&typeof l!="function"?(d=i+j,(l=s.__k[i]=typeof l=="string"||typeof l=="number"||typeof l=="bigint"||l.constructor==String?Qe(null,l,null,null,null):at(l)?Qe(Ye,{children:l},null,null,null):l.constructor==null&&l.__b>0?Qe(l.type,l.props,l.key,l.ref?l.ref:null,l.__v):l).__=s,l.__b=s.__b+1,o=null,(c=l.__i=Br(l,a,d,h))!=-1&&(h--,(o=a[c])&&(o.__u|=2)),o==null||o.__v==null?(c==-1&&(r>p?j--:r<p&&j++),typeof l.type!="function"&&(l.__u|=4)):c!=d&&(c==d-1?j--:c==d+1?j++:(c>d?j--:j++,l.__u|=4))):s.__k[i]=null;if(h)for(i=0;i<p;i++)(o=a[i])!=null&&!(2&o.__u)&&(o.__e==n&&(n=ze(o)),Ya(o,o));return n}function Ja(s,t,a){var n,r;if(typeof s.type=="function"){for(n=s.__k,r=0;n&&r<n.length;r++)n[r]&&(n[r].__=s,t=Ja(n[r],t,a));return t}s.__e!=t&&(t&&s.type&&!a.contains(t)&&(t=ze(s)),a.insertBefore(s.__e,t||null),t=s.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function ge(s,t){return t=t||[],s==null||typeof s=="boolean"||(at(s)?s.some(function(a){ge(a,t)}):t.push(s)),t}function Br(s,t,a,n){var r,i,l,o=s.key,d=s.type,c=t[a],p=c!=null&&(2&c.__u)==0;if(c===null&&s.key==null||p&&o==c.key&&d==c.type)return a;if(n>(p?1:0)){for(r=a-1,i=a+1;r>=0||i<t.length;)if((c=t[l=r>=0?r--:i++])!=null&&!(2&c.__u)&&o==c.key&&d==c.type)return l}return-1}function qs(s,t,a){t[0]=="-"?s.setProperty(t,a==null?"":a):s[t]=a==null?"":typeof a!="number"||Fr.test(t)?a:a+"px"}function jt(s,t,a,n,r){var i,l;e:if(t=="style")if(typeof a=="string")s.style.cssText=a;else{if(typeof n=="string"&&(s.style.cssText=n=""),n)for(t in n)a&&t in a||qs(s.style,t,"");if(a)for(t in a)n&&a[t]==n[t]||qs(s.style,t,a[t])}else if(t[0]=="o"&&t[1]=="n")i=t!=(t=t.replace(Ka,"$1")),l=t.toLowerCase(),t=l in s||t=="onFocusOut"||t=="onFocusIn"?l.slice(2):t.slice(2),s.l||(s.l={}),s.l[t+i]=a,a?n?a.u=n.u:(a.u=ys,s.addEventListener(t,i?rs:ns,i)):s.removeEventListener(t,i?rs:ns,i);else{if(r=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in s)try{s[t]=a==null?"":a;break e}catch(o){}typeof a=="function"||(a==null||a===!1&&t[4]!="-"?s.removeAttribute(t):s.setAttribute(t,t=="popover"&&a==1?"":a))}}function Ks(s){return function(t){if(this.l){var a=this.l[t.type+s];if(t.t==null)t.t=ys++;else if(t.t<a.u)return;return a(G.event?G.event(t):t)}}}function Za(s,t,a,n,r,i,l,o,d,c){var p,h,j,f,v,w,g,S,k,E,$,y,N,m,T,x,_,I=t.type;if(t.constructor!=null)return null;128&a.__u&&(d=!!(32&a.__u),i=[o=t.__e=a.__e]),(p=G.__b)&&p(t);e:if(typeof I=="function")try{if(S=t.props,k="prototype"in I&&I.prototype.render,E=(p=I.contextType)&&n[p.__c],$=p?E?E.props.value:p.__:n,a.__c?g=(h=t.__c=a.__c).__=h.__E:(k?t.__c=h=new I(S,$):(t.__c=h=new be(S,$),h.constructor=I,h.render=qr),E&&E.sub(h),h.props=S,h.state||(h.state={}),h.context=$,h.__n=n,j=h.__d=!0,h.__h=[],h._sb=[]),k&&h.__s==null&&(h.__s=h.state),k&&I.getDerivedStateFromProps!=null&&(h.__s==h.state&&(h.__s=ye({},h.__s)),ye(h.__s,I.getDerivedStateFromProps(S,h.__s))),f=h.props,v=h.state,h.__v=t,j)k&&I.getDerivedStateFromProps==null&&h.componentWillMount!=null&&h.componentWillMount(),k&&h.componentDidMount!=null&&h.__h.push(h.componentDidMount);else{if(k&&I.getDerivedStateFromProps==null&&S!==f&&h.componentWillReceiveProps!=null&&h.componentWillReceiveProps(S,$),!h.__e&&h.shouldComponentUpdate!=null&&h.shouldComponentUpdate(S,h.__s,$)===!1||t.__v==a.__v){for(t.__v!=a.__v&&(h.props=S,h.state=h.__s,h.__d=!1),t.__e=a.__e,t.__k=a.__k,t.__k.some(function(M){M&&(M.__=t)}),y=0;y<h._sb.length;y++)h.__h.push(h._sb[y]);h._sb=[],h.__h.length&&l.push(h);break e}h.componentWillUpdate!=null&&h.componentWillUpdate(S,h.__s,$),k&&h.componentDidUpdate!=null&&h.__h.push(function(){h.componentDidUpdate(f,v,w)})}if(h.context=$,h.props=S,h.__P=s,h.__e=!1,N=G.__r,m=0,k){for(h.state=h.__s,h.__d=!1,N&&N(t),p=h.render(h.props,h.state,h.context),T=0;T<h._sb.length;T++)h.__h.push(h._sb[T]);h._sb=[]}else do h.__d=!1,N&&N(t),p=h.render(h.props,h.state,h.context),h.state=h.__s;while(h.__d&&++m<25);h.state=h.__s,h.getChildContext!=null&&(n=ye(ye({},n),h.getChildContext())),k&&!j&&h.getSnapshotBeforeUpdate!=null&&(w=h.getSnapshotBeforeUpdate(f,v)),x=p,p!=null&&p.type===Ye&&p.key==null&&(x=Xa(p.props.children)),o=Qa(s,at(x)?x:[x],t,a,n,r,i,l,o,d,c),h.base=t.__e,t.__u&=-161,h.__h.length&&l.push(h),g&&(h.__E=h.__=null)}catch(M){if(t.__v=null,d||i!=null)if(M.then){for(t.__u|=d?160:128;o&&o.nodeType==8&&o.nextSibling;)o=o.nextSibling;i[i.indexOf(o)]=null,t.__e=o}else{for(_=i.length;_--;)bs(i[_]);cs(t)}else t.__e=a.__e,t.__k=a.__k,M.then||cs(t);G.__e(M,t,a)}else i==null&&t.__v==a.__v?(t.__k=a.__k,t.__e=a.__e):o=t.__e=Hr(a.__e,t,a,n,r,i,l,d,c);return(p=G.diffed)&&p(t),128&t.__u?void 0:o}function cs(s){s&&s.__c&&(s.__c.__e=!0),s&&s.__k&&s.__k.forEach(cs)}function Vr(s,t,a){for(var n=0;n<a.length;n++)js(a[n],a[++n],a[++n]);G.__c&&G.__c(t,s),s.some(function(r){try{s=r.__h,r.__h=[],s.some(function(i){i.call(r)})}catch(i){G.__e(i,r.__v)}})}function Xa(s){return typeof s!="object"||s==null||s.__b&&s.__b>0?s:at(s)?s.map(Xa):ye({},s)}function Hr(s,t,a,n,r,i,l,o,d){var c,p,h,j,f,v,w,g=a.props,S=t.props,k=t.type;if(k=="svg"?r="http://www.w3.org/2000/svg":k=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),i!=null){for(c=0;c<i.length;c++)if((f=i[c])&&"setAttribute"in f==!!k&&(k?f.localName==k:f.nodeType==3)){s=f,i[c]=null;break}}if(s==null){if(k==null)return document.createTextNode(S);s=document.createElementNS(r,k,S.is&&S),o&&(G.__m&&G.__m(t,i),o=!1),i=null}if(k==null)g===S||o&&s.data==S||(s.data=S);else{if(i=i&&Ut.call(s.childNodes),g=a.props||is,!o&&i!=null)for(g={},c=0;c<s.attributes.length;c++)g[(f=s.attributes[c]).name]=f.value;for(c in g)if(f=g[c],c!="children"){if(c=="dangerouslySetInnerHTML")h=f;else if(!(c in S)){if(c=="value"&&"defaultValue"in S||c=="checked"&&"defaultChecked"in S)continue;jt(s,c,null,f,r)}}for(c in S)f=S[c],c=="children"?j=f:c=="dangerouslySetInnerHTML"?p=f:c=="value"?v=f:c=="checked"?w=f:o&&typeof f!="function"||g[c]===f||jt(s,c,f,g[c],r);if(p)o||h&&(p.__html==h.__html||p.__html==s.innerHTML)||(s.innerHTML=p.__html),t.__k=[];else if(h&&(s.innerHTML=""),Qa(t.type=="template"?s.content:s,at(j)?j:[j],t,a,n,k=="foreignObject"?"http://www.w3.org/1999/xhtml":r,i,l,i?i[0]:a.__k&&ze(a,0),o,d),i!=null)for(c=i.length;c--;)bs(i[c]);o||(c="value",k=="progress"&&v==null?s.removeAttribute("value"):v!=null&&(v!==s[c]||k=="progress"&&!v||k=="option"&&v!=g[c])&&jt(s,c,v,g[c],r),c="checked",w!=null&&w!=s[c]&&jt(s,c,w,g[c],r))}return s}function js(s,t,a){try{if(typeof s=="function"){var n=typeof s.__u=="function";n&&s.__u(),n&&t==null||(s.__u=s(t))}else s.current=t}catch(r){G.__e(r,a)}}function Ya(s,t,a){var n,r;if(G.unmount&&G.unmount(s),(n=s.ref)&&(n.current&&n.current!=s.__e||js(n,null,t)),(n=s.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(i){G.__e(i,t)}n.base=n.__P=null}if(n=s.__k)for(r=0;r<n.length;r++)n[r]&&Ya(n[r],t,a||typeof s.type!="function");a||bs(s.__e),s.__c=s.__=s.__e=void 0}function qr(s,t,a){return this.constructor(s,a)}function Kr(s,t,a){var n,r,i,l,o=ye({},s.props);for(i in s.type&&s.type.defaultProps&&(l=s.type.defaultProps),t)i=="key"?n=t[i]:i=="ref"?r=t[i]:o[i]=t[i]===void 0&&l!=null?l[i]:t[i];return arguments.length>2&&(o.children=arguments.length>3?Ut.call(arguments,2):a),Qe(s.type,o,n||s.key,r||s.ref,null)}Ut=Ga.slice,G={__e:function(s,t,a,n){for(var r,i,l;t=t.__;)if((r=t.__c)&&!r.__)try{if((i=r.constructor)&&i.getDerivedStateFromError!=null&&(r.setState(i.getDerivedStateFromError(s)),l=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(s,n||{}),l=r.__d),l)return r.__E=r}catch(o){s=o}throw s}},Va=0,be.prototype.setState=function(s,t){var a;a=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=ye({},this.state),typeof s=="function"&&(s=s(ye({},a),this.props)),s&&ye(a,s),s!=null&&this.__v&&(t&&this._sb.push(t),Hs(this))},be.prototype.forceUpdate=function(s){this.__v&&(this.__e=!0,s&&this.__h.push(s),Hs(this))},be.prototype.render=Ye,$e=[],Ha=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,qa=function(s,t){return s.__v.__b-t.__v.__b},Pt.__r=0,Ka=/(PointerCapture)$|Capture$/i,ys=0,ns=Ks(!1),rs=Ks(!0);var fe,Jt,Gs,en=[],ne=G,Ws=ne.__b,Qs=ne.__r,Js=ne.diffed,Zs=ne.__c,Xs=ne.unmount,Ys=ne.__;function Gr(){for(var s;s=en.shift();)if(s.__P&&s.__H)try{s.__H.__h.forEach(Et),s.__H.__h.forEach(os),s.__H.__h=[]}catch(t){s.__H.__h=[],ne.__e(t,s.__v)}}ne.__b=function(s){fe=null,Ws&&Ws(s)},ne.__=function(s,t){s&&t.__k&&t.__k.__m&&(s.__m=t.__k.__m),Ys&&Ys(s,t)},ne.__r=function(s){Qs&&Qs(s);var t=(fe=s.__c).__H;t&&(Jt===fe?(t.__h=[],fe.__h=[],t.__.forEach(function(a){a.__N&&(a.__=a.__N),a.u=a.__N=void 0})):(t.__h.forEach(Et),t.__h.forEach(os),t.__h=[])),Jt=fe},ne.diffed=function(s){Js&&Js(s);var t=s.__c;t&&t.__H&&(t.__H.__h.length&&(en.push(t)!==1&&Gs===ne.requestAnimationFrame||((Gs=ne.requestAnimationFrame)||Wr)(Gr)),t.__H.__.forEach(function(a){a.u&&(a.__H=a.u),a.u=void 0})),Jt=fe=null},ne.__c=function(s,t){t.some(function(a){try{a.__h.forEach(Et),a.__h=a.__h.filter(function(n){return!n.__||os(n)})}catch(n){t.some(function(r){r.__h&&(r.__h=[])}),t=[],ne.__e(n,a.__v)}}),Zs&&Zs(s,t)},ne.unmount=function(s){Xs&&Xs(s);var t,a=s.__c;a&&a.__H&&(a.__H.__.forEach(function(n){try{Et(n)}catch(r){t=r}}),a.__H=void 0,t&&ne.__e(t,a.__v))};var ea=typeof requestAnimationFrame=="function";function Wr(s){var t,a=function(){clearTimeout(n),ea&&cancelAnimationFrame(t),setTimeout(s)},n=setTimeout(a,35);ea&&(t=requestAnimationFrame(a))}function Et(s){var t=fe,a=s.__c;typeof a=="function"&&(s.__c=void 0,a()),fe=t}function os(s){var t=fe;s.__c=s.__(),fe=t}function Qr(s,t){for(var a in t)s[a]=t[a];return s}function ta(s,t){for(var a in s)if(a!=="__source"&&!(a in t))return!0;for(var n in t)if(n!=="__source"&&s[n]!==t[n])return!0;return!1}function sa(s,t){this.props=s,this.context=t}(sa.prototype=new be).isPureReactComponent=!0,sa.prototype.shouldComponentUpdate=function(s,t){return ta(this.props,s)||ta(this.state,t)};var aa=G.__b;G.__b=function(s){s.type&&s.type.__f&&s.ref&&(s.props.ref=s.ref,s.ref=null),aa&&aa(s)};var Jr=G.__e;G.__e=function(s,t,a,n){if(s.then){for(var r,i=t;i=i.__;)if((r=i.__c)&&r.__c)return t.__e==null&&(t.__e=a.__e,t.__k=a.__k),r.__c(s,t)}Jr(s,t,a,n)};var na=G.unmount;function tn(s,t,a){return s&&(s.__c&&s.__c.__H&&(s.__c.__H.__.forEach(function(n){typeof n.__c=="function"&&n.__c()}),s.__c.__H=null),(s=Qr({},s)).__c!=null&&(s.__c.__P===a&&(s.__c.__P=t),s.__c.__e=!0,s.__c=null),s.__k=s.__k&&s.__k.map(function(n){return tn(n,t,a)})),s}function sn(s,t,a){return s&&a&&(s.__v=null,s.__k=s.__k&&s.__k.map(function(n){return sn(n,t,a)}),s.__c&&s.__c.__P===t&&(s.__e&&a.appendChild(s.__e),s.__c.__e=!0,s.__c.__P=a)),s}function Zt(){this.__u=0,this.o=null,this.__b=null}function an(s){var t=s.__.__c;return t&&t.__a&&t.__a(s)}function vt(){this.i=null,this.l=null}G.unmount=function(s){var t=s.__c;t&&t.__R&&t.__R(),t&&32&s.__u&&(s.type=null),na&&na(s)},(Zt.prototype=new be).__c=function(s,t){var a=t.__c,n=this;n.o==null&&(n.o=[]),n.o.push(a);var r=an(n.__v),i=!1,l=function(){i||(i=!0,a.__R=null,r?r(o):o())};a.__R=l;var o=function(){if(!--n.__u){if(n.state.__a){var d=n.state.__a;n.__v.__k[0]=sn(d,d.__c.__P,d.__c.__O)}var c;for(n.setState({__a:n.__b=null});c=n.o.pop();)c.forceUpdate()}};n.__u++||32&t.__u||n.setState({__a:n.__b=n.__v.__k[0]}),s.then(l,l)},Zt.prototype.componentWillUnmount=function(){this.o=[]},Zt.prototype.render=function(s,t){if(this.__b){if(this.__v.__k){var a=document.createElement("div"),n=this.__v.__k[0].__c;this.__v.__k[0]=tn(this.__b,a,n.__O=n.__P)}this.__b=null}var r=t.__a&&ls(Ye,null,s.fallback);return r&&(r.__u&=-33),[ls(Ye,null,t.__a?null:s.children),r]};var ra=function(s,t,a){if(++a[1]===a[0]&&s.l.delete(t),s.props.revealOrder&&(s.props.revealOrder[0]!=="t"||!s.l.size))for(a=s.i;a;){for(;a.length>3;)a.pop()();if(a[1]<a[0])break;s.i=a=a[2]}};(vt.prototype=new be).__a=function(s){var t=this,a=an(t.__v),n=t.l.get(s);return n[0]++,function(r){var i=function(){t.props.revealOrder?(n.push(r),ra(t,s,n)):r()};a?a(i):i()}},vt.prototype.render=function(s){this.i=null,this.l=new Map;var t=ge(s.children);s.revealOrder&&s.revealOrder[0]==="b"&&t.reverse();for(var a=t.length;a--;)this.l.set(t[a],this.i=[1,0,this.i]);return s.children},vt.prototype.componentDidUpdate=vt.prototype.componentDidMount=function(){var s=this;this.l.forEach(function(t,a){ra(s,a,t)})};var Zr=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.element")||60103,Xr=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Yr=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,ei=/[A-Z0-9]/g,ti=typeof document!="undefined",si=function(s){return(typeof Symbol!="undefined"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(s)};be.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(s){Object.defineProperty(be.prototype,s,{configurable:!0,get:function(){return this["UNSAFE_"+s]},set:function(t){Object.defineProperty(this,s,{configurable:!0,writable:!0,value:t})}})});var ia=G.event;function ai(){}function ni(){return this.cancelBubble}function ri(){return this.defaultPrevented}G.event=function(s){return ia&&(s=ia(s)),s.persist=ai,s.isPropagationStopped=ni,s.isDefaultPrevented=ri,s.nativeEvent=s};var ii={enumerable:!1,configurable:!0,get:function(){return this.class}},la=G.vnode;G.vnode=function(s){typeof s.type=="string"&&function(t){var a=t.props,n=t.type,r={},i=n.indexOf("-")===-1;for(var l in a){var o=a[l];if(!(l==="value"&&"defaultValue"in a&&o==null||ti&&l==="children"&&n==="noscript"||l==="class"||l==="className")){var d=l.toLowerCase();l==="defaultValue"&&"value"in a&&a.value==null?l="value":l==="download"&&o===!0?o="":d==="translate"&&o==="no"?o=!1:d[0]==="o"&&d[1]==="n"?d==="ondoubleclick"?l="ondblclick":d!=="onchange"||n!=="input"&&n!=="textarea"||si(a.type)?d==="onfocus"?l="onfocusin":d==="onblur"?l="onfocusout":Yr.test(l)&&(l=d):d=l="oninput":i&&Xr.test(l)?l=l.replace(ei,"-$&").toLowerCase():o===null&&(o=void 0),d==="oninput"&&r[l=d]&&(l="oninputCapture"),r[l]=o}}n=="select"&&r.multiple&&Array.isArray(r.value)&&(r.value=ge(a.children).forEach(function(c){c.props.selected=r.value.indexOf(c.props.value)!=-1})),n=="select"&&r.defaultValue!=null&&(r.value=ge(a.children).forEach(function(c){c.props.selected=r.multiple?r.defaultValue.indexOf(c.props.value)!=-1:r.defaultValue==c.props.value})),a.class&&!a.className?(r.class=a.class,Object.defineProperty(r,"className",ii)):(a.className&&!a.class||a.class&&a.className)&&(r.class=r.className=a.className),t.props=r}(s),s.$$typeof=Zr,la&&la(s)};var ca=G.__r;G.__r=function(s){ca&&ca(s),s.__c};var oa=G.diffed;G.diffed=function(s){oa&&oa(s);var t=s.props,a=s.__e;a!=null&&s.type==="textarea"&&"value"in t&&t.value!==a.value&&(a.value=t.value==null?"":t.value)};var li=typeof dt=="object"&&dt&&dt.Object===Object&&dt,ci=li,oi=ci,di=typeof self=="object"&&self&&self.Object===Object&&self,ui=oi||di||Function("return this")(),hi=ui,mi=hi,pi=mi.Symbol,nn=pi,da=nn;da&&da.toStringTag;var ua=nn;ua&&ua.toStringTag;function xi(s,t){return Object.assign(s,t)}function gi(s,t){var a;return(a=s==null?void 0:s.key)!=null?a:t}function fi(s,t){const a=s._ptgLinkedRefs||(s._ptgLinkedRefs={});return a[t]||(a[t]=n=>{s.refs[t]=n})}function Ke(s){const t={};for(let a=0;a<s.length;a++)if(s[a]!=null){const n=gi(s[a],a.toString(36));t[n]=s[a]}return t}function yi(s,t){s=s||{},t=t||{};const a=l=>Object.hasOwn(t,l)?t[l]:s[l],n={};let r=[];for(const l in s)Object.hasOwn(t,l)?r.length&&(n[l]=r,r=[]):r.push(l);const i={};for(const l in t){if(Object.hasOwn(n,l))for(let o=0;o<n[l].length;o++){const d=n[l][o];i[n[l][o]]=a(d)}i[l]=a(l)}for(let l=0;l<r.length;l++)i[r[l]]=a(r[l]);return i}const bi=s=>s;class ji extends be{constructor(t,a){super(t,a),this.refs={},this.state={children:Ke(ge(ge(this.props.children))||[])},this.performAppear=this.performAppear.bind(this),this.performEnter=this.performEnter.bind(this),this.performLeave=this.performLeave.bind(this)}componentWillMount(){this.currentlyTransitioningKeys={},this.keysToAbortLeave=[],this.keysToEnter=[],this.keysToLeave=[]}componentDidMount(){const t=this.state.children;for(const a in t)t[a]&&this.performAppear(a)}componentWillReceiveProps(t){const a=Ke(ge(t.children)||[]),n=this.state.children;this.setState(i=>({children:yi(i.children,a)}));let r;for(r in a)if(Object.hasOwn(a,r)){const i=n&&Object.hasOwn(n,r);a[r]&&i&&this.currentlyTransitioningKeys[r]?(this.keysToEnter.push(r),this.keysToAbortLeave.push(r)):a[r]&&!i&&!this.currentlyTransitioningKeys[r]&&this.keysToEnter.push(r)}for(r in n)if(Object.hasOwn(n,r)){const i=a&&Object.hasOwn(a,r);n[r]&&!i&&!this.currentlyTransitioningKeys[r]&&this.keysToLeave.push(r)}}componentDidUpdate(){const{keysToEnter:t}=this;this.keysToEnter=[],t.forEach(this.performEnter);const{keysToLeave:a}=this;this.keysToLeave=[],a.forEach(this.performLeave)}_finishAbort(t){const a=this.keysToAbortLeave.indexOf(t);a!==-1&&this.keysToAbortLeave.splice(a,1)}performAppear(t){this.currentlyTransitioningKeys[t]=!0;const a=this.refs[t];a!=null&&a.componentWillAppear?a.componentWillAppear(this._handleDoneAppearing.bind(this,t)):this._handleDoneAppearing(t)}_handleDoneAppearing(t){const a=this.refs[t];a!=null&&a.componentDidAppear&&a.componentDidAppear(),delete this.currentlyTransitioningKeys[t],this._finishAbort(t);const n=Ke(ge(this.props.children)||[]);(!n||!Object.hasOwn(n,t))&&this.performLeave(t)}performEnter(t){this.currentlyTransitioningKeys[t]=!0;const a=this.refs[t];a!=null&&a.componentWillEnter?a.componentWillEnter(this._handleDoneEntering.bind(this,t)):this._handleDoneEntering(t)}_handleDoneEntering(t){const a=this.refs[t];a!=null&&a.componentDidEnter&&a.componentDidEnter(),delete this.currentlyTransitioningKeys[t],this._finishAbort(t);const n=Ke(ge(this.props.children)||[]);(!n||!Object.hasOwn(n,t))&&this.performLeave(t)}performLeave(t){if(this.keysToAbortLeave.indexOf(t)!==-1)return;this.currentlyTransitioningKeys[t]=!0;const n=this.refs[t];n!=null&&n.componentWillLeave?n.componentWillLeave(this._handleDoneLeaving.bind(this,t)):this._handleDoneLeaving(t)}_handleDoneLeaving(t){if(this.keysToAbortLeave.indexOf(t)!==-1)return;const n=this.refs[t];n!=null&&n.componentDidLeave&&n.componentDidLeave(),delete this.currentlyTransitioningKeys[t];const r=Ke(ge(this.props.children)||[]);if(r&&Object.hasOwn(r,t))this.performEnter(t);else{const i=xi({},this.state.children);delete i[t],this.setState({children:i})}}render(j,{children:h}){var f=j,{childFactory:t,transitionLeave:a,transitionName:n,transitionAppear:r,transitionEnter:i,transitionLeaveTimeout:l,transitionEnterTimeout:o,transitionAppearTimeout:d,component:c}=f,p=$s(f,["childFactory","transitionLeave","transitionName","transitionAppear","transitionEnter","transitionLeaveTimeout","transitionEnterTimeout","transitionAppearTimeout","component"]);const v=Object.entries(h).map(([w,g])=>{if(!g)return;const S=fi(this,w);return Kr(t(g),{ref:S,key:w})}).filter(Boolean);return ls(c,p,v)}}ji.defaultProps={component:"span",childFactory:bi};var vi={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(s){(function(){var t={}.hasOwnProperty;function a(){for(var i="",l=0;l<arguments.length;l++){var o=arguments[l];o&&(i=r(i,n(o)))}return i}function n(i){if(typeof i=="string"||typeof i=="number")return i;if(typeof i!="object")return"";if(Array.isArray(i))return a.apply(null,i);if(i.toString!==Object.prototype.toString&&!i.toString.toString().includes("[native code]"))return i.toString();var l="";for(var o in i)t.call(i,o)&&i[o]&&(l=r(l,o));return l}function r(i,l){return l?i?i+" "+l:i+l:i}s.exports?(a.default=a,s.exports=a):window.classNames=a})()})(vi);function J(s,t,a){return t in s?Object.defineProperty(s,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):s[t]=a,s}var Ni=typeof self!="undefined"?self:global;const wi=typeof navigator!="undefined";typeof global=="undefined"||typeof process=="undefined"||!process.versions||process.versions.node;const rn=Ni.Buffer,ln=!!rn,Si=s=>s!==void 0;function _i(s){return s===void 0||(s instanceof Map?s.size===0:Object.values(s).filter(Si).length===0)}function ce(s){let t=new Error(s);throw delete t.stack,t}function ha(s){let t=function(a){let n=0;return a.ifd0.enabled&&(n+=1024),a.exif.enabled&&(n+=2048),a.makerNote&&(n+=2048),a.userComment&&(n+=1024),a.gps.enabled&&(n+=512),a.interop.enabled&&(n+=100),a.ifd1.enabled&&(n+=1024),n+2048}(s);return s.jfif.enabled&&(t+=50),s.xmp.enabled&&(t+=2e4),s.iptc.enabled&&(t+=14e3),s.icc.enabled&&(t+=6e3),t}const Xt=s=>String.fromCharCode.apply(null,s),ma=typeof TextDecoder!="undefined"?new TextDecoder("utf-8"):void 0;class _e{static from(t,a){return t instanceof this&&t.le===a?t:new _e(t,void 0,void 0,a)}constructor(t,a=0,n,r){if(typeof r=="boolean"&&(this.le=r),Array.isArray(t)&&(t=new Uint8Array(t)),t===0)this.byteOffset=0,this.byteLength=0;else if(t instanceof ArrayBuffer){n===void 0&&(n=t.byteLength-a);let i=new DataView(t,a,n);this._swapDataView(i)}else if(t instanceof Uint8Array||t instanceof DataView||t instanceof _e){n===void 0&&(n=t.byteLength-a),(a+=t.byteOffset)+n>t.byteOffset+t.byteLength&&ce("Creating view outside of available memory in ArrayBuffer");let i=new DataView(t.buffer,a,n);this._swapDataView(i)}else if(typeof t=="number"){let i=new DataView(new ArrayBuffer(t));this._swapDataView(i)}else ce("Invalid input argument for BufferView: "+t)}_swapArrayBuffer(t){this._swapDataView(new DataView(t))}_swapBuffer(t){this._swapDataView(new DataView(t.buffer,t.byteOffset,t.byteLength))}_swapDataView(t){this.dataView=t,this.buffer=t.buffer,this.byteOffset=t.byteOffset,this.byteLength=t.byteLength}_lengthToEnd(t){return this.byteLength-t}set(t,a,n=_e){return t instanceof DataView||t instanceof _e?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t instanceof ArrayBuffer&&(t=new Uint8Array(t)),t instanceof Uint8Array||ce("BufferView.set(): Invalid data argument."),this.toUint8().set(t,a),new n(this,a,t.byteLength)}subarray(t,a){return a=a||this._lengthToEnd(t),new _e(this,t,a)}toUint8(){return new Uint8Array(this.buffer,this.byteOffset,this.byteLength)}getUint8Array(t,a){return new Uint8Array(this.buffer,this.byteOffset+t,a)}getString(t=0,a=this.byteLength){return r=this.getUint8Array(t,a),ma?ma.decode(r):ln?Buffer.from(r).toString("utf8"):decodeURIComponent(escape(Xt(r)));var r}getLatin1String(t=0,a=this.byteLength){let n=this.getUint8Array(t,a);return Xt(n)}getUnicodeString(t=0,a=this.byteLength){const n=[];for(let r=0;r<a&&t+r<this.byteLength;r+=2)n.push(this.getUint16(t+r));return Xt(n)}getInt8(t){return this.dataView.getInt8(t)}getUint8(t){return this.dataView.getUint8(t)}getInt16(t,a=this.le){return this.dataView.getInt16(t,a)}getInt32(t,a=this.le){return this.dataView.getInt32(t,a)}getUint16(t,a=this.le){return this.dataView.getUint16(t,a)}getUint32(t,a=this.le){return this.dataView.getUint32(t,a)}getFloat32(t,a=this.le){return this.dataView.getFloat32(t,a)}getFloat64(t,a=this.le){return this.dataView.getFloat64(t,a)}getFloat(t,a=this.le){return this.dataView.getFloat32(t,a)}getDouble(t,a=this.le){return this.dataView.getFloat64(t,a)}getUintBytes(t,a,n){switch(a){case 1:return this.getUint8(t,n);case 2:return this.getUint16(t,n);case 4:return this.getUint32(t,n);case 8:return this.getUint64&&this.getUint64(t,n)}}getUint(t,a,n){switch(a){case 8:return this.getUint8(t,n);case 16:return this.getUint16(t,n);case 32:return this.getUint32(t,n);case 64:return this.getUint64&&this.getUint64(t,n)}}toString(t){return this.dataView.toString(t,this.constructor.name)}ensureChunk(){}}function ds(s,t){ce(`${s} '${t}' was not loaded, try using full build of exifr.`)}class vs extends Map{constructor(t){super(),this.kind=t}get(t,a){return this.has(t)||ds(this.kind,t),a&&(t in a||function(n,r){ce(`Unknown ${n} '${r}'.`)}(this.kind,t),a[t].enabled||ds(this.kind,t)),super.get(t)}keyList(){return Array.from(this.keys())}}var Ci=new vs("file parser"),xe=new vs("segment parser"),ki=new vs("file reader");const pa=s=>new Promise((t,a)=>{let n=new FileReader;n.onloadend=()=>t(n.result||new ArrayBuffer),n.onerror=a,n.readAsArrayBuffer(s)}),Ns=new Map,Ti=new Map,Ai=new Map,Nt=["chunked","firstChunkSize","firstChunkSizeNode","firstChunkSizeBrowser","chunkSize","chunkLimit"],cn=["jfif","xmp","icc","iptc","ihdr"],us=["tiff",...cn],se=["ifd0","ifd1","exif","gps","interop"],wt=[...us,...se],St=["makerNote","userComment"],on=["translateKeys","translateValues","reviveValues","multiSegment"],_t=[...on,"sanitize","mergeOutput","silentErrors"];class dn{get translate(){return this.translateKeys||this.translateValues||this.reviveValues}}class Ge extends dn{get needed(){return this.enabled||this.deps.size>0}constructor(t,a,n,r){if(super(),J(this,"enabled",!1),J(this,"skip",new Set),J(this,"pick",new Set),J(this,"deps",new Set),J(this,"translateKeys",!1),J(this,"translateValues",!1),J(this,"reviveValues",!1),this.key=t,this.enabled=a,this.parse=this.enabled,this.applyInheritables(r),this.canBeFiltered=se.includes(t),this.canBeFiltered&&(this.dict=Ns.get(t)),n!==void 0)if(Array.isArray(n))this.parse=this.enabled=!0,this.canBeFiltered&&n.length>0&&this.translateTagSet(n,this.pick);else if(typeof n=="object"){if(this.enabled=!0,this.parse=n.parse!==!1,this.canBeFiltered){let{pick:i,skip:l}=n;i&&i.length>0&&this.translateTagSet(i,this.pick),l&&l.length>0&&this.translateTagSet(l,this.skip)}this.applyInheritables(n)}else n===!0||n===!1?this.parse=this.enabled=n:ce(`Invalid options argument: ${n}`)}applyInheritables(t){let a,n;for(a of on)n=t[a],n!==void 0&&(this[a]=n)}translateTagSet(t,a){if(this.dict){let n,r,{tagKeys:i,tagValues:l}=this.dict;for(n of t)typeof n=="string"?(r=l.indexOf(n),r===-1&&(r=i.indexOf(Number(n))),r!==-1&&a.add(Number(i[r]))):a.add(n)}else for(let n of t)a.add(n)}finalizeFilters(){!this.enabled&&this.deps.size>0?(this.enabled=!0,$t(this.pick,this.deps)):this.enabled&&this.pick.size>0&&$t(this.pick,this.deps)}}var ie={jfif:!1,tiff:!0,xmp:!1,icc:!1,iptc:!1,ifd0:!0,ifd1:!1,exif:!0,gps:!0,interop:!1,ihdr:void 0,makerNote:!1,userComment:!1,multiSegment:!1,skip:[],pick:[],translateKeys:!0,translateValues:!0,reviveValues:!0,sanitize:!0,mergeOutput:!0,silentErrors:!0,chunked:!0,firstChunkSize:void 0,firstChunkSizeNode:512,firstChunkSizeBrowser:65536,chunkSize:65536,chunkLimit:5},xa=new Map;class un extends dn{static useCached(t){let a=xa.get(t);return a!==void 0||(a=new this(t),xa.set(t,a)),a}constructor(t){super(),t===!0?this.setupFromTrue():t===void 0?this.setupFromUndefined():Array.isArray(t)?this.setupFromArray(t):typeof t=="object"?this.setupFromObject(t):ce(`Invalid options argument ${t}`),this.firstChunkSize===void 0&&(this.firstChunkSize=wi?this.firstChunkSizeBrowser:this.firstChunkSizeNode),this.mergeOutput&&(this.ifd1.enabled=!1),this.filterNestedSegmentTags(),this.traverseTiffDependencyTree(),this.checkLoadedPlugins()}setupFromUndefined(){let t;for(t of Nt)this[t]=ie[t];for(t of _t)this[t]=ie[t];for(t of St)this[t]=ie[t];for(t of wt)this[t]=new Ge(t,ie[t],void 0,this)}setupFromTrue(){let t;for(t of Nt)this[t]=ie[t];for(t of _t)this[t]=ie[t];for(t of St)this[t]=!0;for(t of wt)this[t]=new Ge(t,!0,void 0,this)}setupFromArray(t){let a;for(a of Nt)this[a]=ie[a];for(a of _t)this[a]=ie[a];for(a of St)this[a]=ie[a];for(a of wt)this[a]=new Ge(a,!1,void 0,this);this.setupGlobalFilters(t,void 0,se)}setupFromObject(t){let a;for(a of(se.ifd0=se.ifd0||se.image,se.ifd1=se.ifd1||se.thumbnail,Object.assign(this,t),Nt))this[a]=Yt(t[a],ie[a]);for(a of _t)this[a]=Yt(t[a],ie[a]);for(a of St)this[a]=Yt(t[a],ie[a]);for(a of us)this[a]=new Ge(a,ie[a],t[a],this);for(a of se)this[a]=new Ge(a,ie[a],t[a],this.tiff);this.setupGlobalFilters(t.pick,t.skip,se,wt),t.tiff===!0?this.batchEnableWithBool(se,!0):t.tiff===!1?this.batchEnableWithUserValue(se,t):Array.isArray(t.tiff)?this.setupGlobalFilters(t.tiff,void 0,se):typeof t.tiff=="object"&&this.setupGlobalFilters(t.tiff.pick,t.tiff.skip,se)}batchEnableWithBool(t,a){for(let n of t)this[n].enabled=a}batchEnableWithUserValue(t,a){for(let n of t){let r=a[n];this[n].enabled=r!==!1&&r!==void 0}}setupGlobalFilters(t,a,n,r=n){if(t&&t.length){for(let l of r)this[l].enabled=!1;let i=ga(t,n);for(let[l,o]of i)$t(this[l].pick,o),this[l].enabled=!0}else if(a&&a.length){let i=ga(a,n);for(let[l,o]of i)$t(this[l].skip,o)}}filterNestedSegmentTags(){let{ifd0:t,exif:a,xmp:n,iptc:r,icc:i}=this;this.makerNote?a.deps.add(37500):a.skip.add(37500),this.userComment?a.deps.add(37510):a.skip.add(37510),n.enabled||t.skip.add(700),r.enabled||t.skip.add(33723),i.enabled||t.skip.add(34675)}traverseTiffDependencyTree(){let{ifd0:t,exif:a,gps:n,interop:r}=this;r.needed&&(a.deps.add(40965),t.deps.add(40965)),a.needed&&t.deps.add(34665),n.needed&&t.deps.add(34853),this.tiff.enabled=se.some(i=>this[i].enabled===!0)||this.makerNote||this.userComment;for(let i of se)this[i].finalizeFilters()}get onlyTiff(){return!cn.map(t=>this[t].enabled).some(t=>t===!0)&&this.tiff.enabled}checkLoadedPlugins(){for(let t of us)this[t].enabled&&!xe.has(t)&&ds("segment parser",t)}}function ga(s,t){let a,n,r,i,l=[];for(r of t){for(i of(a=Ns.get(r),n=[],a))(s.includes(i[0])||s.includes(i[1]))&&n.push(i[0]);n.length&&l.push([r,n])}return l}function Yt(s,t){return s!==void 0?s:t!==void 0?t:void 0}function $t(s,t){for(let a of t)s.add(a)}J(un,"default",ie);class Le{static findPosition(t,a){let n=t.getUint16(a+2)+2,r=typeof this.headerLength=="function"?this.headerLength(t,a,n):this.headerLength,i=a+r,l=n-r;return{offset:a,length:n,headerLength:r,start:i,size:l,end:i+l}}static parse(t,a={}){return new this(t,new un({[this.type]:a}),t).parse()}normalizeInput(t){return t instanceof _e?t:new _e(t)}constructor(t,a={},n){J(this,"errors",[]),J(this,"raw",new Map),J(this,"handleError",r=>{if(!this.options.silentErrors)throw r;this.errors.push(r.message)}),this.chunk=this.normalizeInput(t),this.file=n,this.type=this.constructor.type,this.globalOptions=this.options=a,this.localOptions=a[this.type],this.canTranslate=this.localOptions&&this.localOptions.translate}translate(){this.canTranslate&&(this.translated=this.translateBlock(this.raw,this.type))}get output(){return this.translated?this.translated:this.raw?Object.fromEntries(this.raw):void 0}translateBlock(t,a){let n=Ai.get(a),r=Ti.get(a),i=Ns.get(a),l=this.options[a],o=l.reviveValues&&!!n,d=l.translateValues&&!!r,c=l.translateKeys&&!!i,p={};for(let[h,j]of t)o&&n.has(h)?j=n.get(h)(j):d&&r.has(h)&&(j=this.translateValue(j,r.get(h))),c&&i.has(h)&&(h=i.get(h)||h),p[h]=j;return p}translateValue(t,a){return a[t]||a.DEFAULT||t}assignToOutput(t,a){this.assignObjectToOutput(t,this.constructor.type,a)}assignObjectToOutput(t,a,n){if(this.globalOptions.mergeOutput)return Object.assign(t,n);t[a]?Object.assign(t[a],n):t[a]=n}}J(Le,"headerLength",4),J(Le,"type",void 0),J(Le,"multiSegment",!1),J(Le,"canHandle",()=>!1);function Ei(s){return s===192||s===194||s===196||s===219||s===221||s===218||s===254}function Pi(s){return s>=224&&s<=239}function $i(s,t,a){for(let[n,r]of xe)if(r.canHandle(s,t,a))return n}class fa extends class{constructor(t,a,n){J(this,"errors",[]),J(this,"ensureSegmentChunk",r=>R(this,null,function*(){let i=r.start,l=r.size||65536;if(this.file.chunked)if(this.file.available(i,l))r.chunk=this.file.subarray(i,l);else try{r.chunk=yield this.file.readChunk(i,l)}catch(o){ce(`Couldn't read segment: ${JSON.stringify(r)}. ${o.message}`)}else this.file.byteLength>i+l?r.chunk=this.file.subarray(i,l):r.size===void 0?r.chunk=this.file.subarray(i):ce("Segment unreachable: "+JSON.stringify(r));return r.chunk})),this.extendOptions&&this.extendOptions(t),this.options=t,this.file=a,this.parsers=n}injectSegment(t,a){this.options[t].enabled&&this.createParser(t,a)}createParser(t,a){let n=new(xe.get(t))(a,this.options,this.file);return this.parsers[t]=n}createParsers(t){for(let a of t){let{type:n,chunk:r}=a,i=this.options[n];if(i&&i.enabled){let l=this.parsers[n];l&&l.append||l||this.createParser(n,r)}}}readSegments(t){return R(this,null,function*(){let a=t.map(this.ensureSegmentChunk);yield Promise.all(a)})}}{constructor(...t){super(...t),J(this,"appSegments",[]),J(this,"jpegSegments",[]),J(this,"unknownSegments",[])}static canHandle(t,a){return a===65496}parse(){return R(this,null,function*(){yield this.findAppSegments(),yield this.readSegments(this.appSegments),this.mergeMultiSegments(),this.createParsers(this.mergedAppSegments||this.appSegments)})}setupSegmentFinderArgs(t){t===!0?(this.findAll=!0,this.wanted=new Set(xe.keyList())):(t=t===void 0?xe.keyList().filter(a=>this.options[a].enabled):t.filter(a=>this.options[a].enabled&&xe.has(a)),this.findAll=!1,this.remaining=new Set(t),this.wanted=new Set(t)),this.unfinishedMultiSegment=!1}findAppSegments(t=0,a){return R(this,null,function*(){this.setupSegmentFinderArgs(a);let{file:n,findAll:r,wanted:i,remaining:l}=this;if(!r&&this.file.chunked&&(r=Array.from(i).some(o=>{let d=xe.get(o),c=this.options[o];return d.multiSegment&&c.multiSegment}),r&&(yield this.file.readWhole())),t=this.findAppSegmentsInRange(t,n.byteLength),!this.options.onlyTiff&&n.chunked){let o=!1;for(;l.size>0&&!o&&(n.canReadNextChunk||this.unfinishedMultiSegment);){let{nextChunkOffset:d}=n,c=this.appSegments.some(p=>!this.file.available(p.offset||p.start,p.length||p.size));if(o=t>d&&!c?!(yield n.readNextChunk(t)):!(yield n.readNextChunk(d)),(t=this.findAppSegmentsInRange(t,n.byteLength))===void 0)return}}})}findAppSegmentsInRange(t,a){a-=2;let n,r,i,l,o,d,{file:c,findAll:p,wanted:h,remaining:j,options:f}=this;for(;t<a;t++)if(c.getUint8(t)===255){if(n=c.getUint8(t+1),Pi(n)){if(r=c.getUint16(t+2),i=$i(c,t,r),i&&h.has(i)&&(l=xe.get(i),o=l.findPosition(c,t),d=f[i],o.type=i,this.appSegments.push(o),!p&&(l.multiSegment&&d.multiSegment?(this.unfinishedMultiSegment=o.chunkNumber<o.chunkCount,this.unfinishedMultiSegment||j.delete(i)):j.delete(i),j.size===0)))break;f.recordUnknownSegments&&(o=Le.findPosition(c,t),o.marker=n,this.unknownSegments.push(o)),t+=r+1}else if(Ei(n)){if(r=c.getUint16(t+2),n===218&&f.stopAfterSos!==!1)return;f.recordJpegSegments&&this.jpegSegments.push({offset:t,length:r,marker:n}),t+=r+1}}return t}mergeMultiSegments(){if(!this.appSegments.some(a=>a.multiSegment))return;let t=function(a,n){let r,i,l,o=new Map;for(let d=0;d<a.length;d++)r=a[d],i=r[n],o.has(i)?l=o.get(i):o.set(i,l=[]),l.push(r);return Array.from(o)}(this.appSegments,"type");this.mergedAppSegments=t.map(([a,n])=>{let r=xe.get(a,this.options);return r.handleMultiSegments?{type:a,chunk:r.handleMultiSegments(n)}:n[0]})}getSegment(t){return this.appSegments.find(a=>a.type===t)}getOrFindSegment(t){return R(this,null,function*(){let a=this.getSegment(t);return a===void 0&&(yield this.findAppSegments(0,[t]),a=this.getSegment(t)),a})}}J(fa,"type","jpeg"),Ci.set("jpeg",fa);const Ii=[void 0,1,1,2,4,8,1,1,2,4,8,4,8,4];class Ri extends Le{parseHeader(){var t=this.chunk.getUint16();t===18761?this.le=!0:t===19789&&(this.le=!1),this.chunk.le=this.le,this.headerParsed=!0}parseTags(t,a,n=new Map){let{pick:r,skip:i}=this.options[a];r=new Set(r);let l=r.size>0,o=i.size===0,d=this.chunk.getUint16(t);t+=2;for(let c=0;c<d;c++){let p=this.chunk.getUint16(t);if(l){if(r.has(p)&&(n.set(p,this.parseTag(t,p,a)),r.delete(p),r.size===0))break}else!o&&i.has(p)||n.set(p,this.parseTag(t,p,a));t+=12}return n}parseTag(t,a,n){let{chunk:r}=this,i=r.getUint16(t+2),l=r.getUint32(t+4),o=Ii[i];if(o*l<=4?t+=8:t=r.getUint32(t+8),(i<1||i>13)&&ce(`Invalid TIFF value type. block: ${n.toUpperCase()}, tag: ${a.toString(16)}, type: ${i}, offset ${t}`),t>r.byteLength&&ce(`Invalid TIFF value offset. block: ${n.toUpperCase()}, tag: ${a.toString(16)}, type: ${i}, offset ${t} is outside of chunk size ${r.byteLength}`),i===1)return r.getUint8Array(t,l);if(i===2)return(d=function(c){for(;c.endsWith("\0");)c=c.slice(0,-1);return c}(d=r.getString(t,l)).trim())===""?void 0:d;var d;if(i===7)return r.getUint8Array(t,l);if(l===1)return this.parseTagValue(i,t);{let c=new(function(h){switch(h){case 1:return Uint8Array;case 3:return Uint16Array;case 4:return Uint32Array;case 5:return Array;case 6:return Int8Array;case 8:return Int16Array;case 9:return Int32Array;case 10:return Array;case 11:return Float32Array;case 12:return Float64Array;default:return Array}}(i))(l),p=o;for(let h=0;h<l;h++)c[h]=this.parseTagValue(i,t),t+=p;return c}}parseTagValue(t,a){let{chunk:n}=this;switch(t){case 1:return n.getUint8(a);case 3:return n.getUint16(a);case 4:return n.getUint32(a);case 5:return n.getUint32(a)/n.getUint32(a+4);case 6:return n.getInt8(a);case 8:return n.getInt16(a);case 9:return n.getInt32(a);case 10:return n.getInt32(a)/n.getInt32(a+4);case 11:return n.getFloat(a);case 12:return n.getDouble(a);case 13:return n.getUint32(a);default:ce(`Invalid tiff type ${t}`)}}}class es extends Ri{static canHandle(t,a){return t.getUint8(a+1)===225&&t.getUint32(a+4)===1165519206&&t.getUint16(a+8)===0}parse(){return R(this,null,function*(){this.parseHeader();let{options:t}=this;return t.ifd0.enabled&&(yield this.parseIfd0Block()),t.exif.enabled&&(yield this.safeParse("parseExifBlock")),t.gps.enabled&&(yield this.safeParse("parseGpsBlock")),t.interop.enabled&&(yield this.safeParse("parseInteropBlock")),t.ifd1.enabled&&(yield this.safeParse("parseThumbnailBlock")),this.createOutput()})}safeParse(t){let a=this[t]();return a.catch!==void 0&&(a=a.catch(this.handleError)),a}findIfd0Offset(){this.ifd0Offset===void 0&&(this.ifd0Offset=this.chunk.getUint32(4))}findIfd1Offset(){if(this.ifd1Offset===void 0){this.findIfd0Offset();let t=this.chunk.getUint16(this.ifd0Offset),a=this.ifd0Offset+2+12*t;this.ifd1Offset=this.chunk.getUint32(a)}}parseBlock(t,a){let n=new Map;return this[a]=n,this.parseTags(t,a,n),n}parseIfd0Block(){return R(this,null,function*(){if(this.ifd0)return;let{file:t}=this;this.findIfd0Offset(),this.ifd0Offset<8&&ce("Malformed EXIF data"),!t.chunked&&this.ifd0Offset>t.byteLength&&ce(`IFD0 offset points to outside of file.
this.ifd0Offset: ${this.ifd0Offset}, file.byteLength: ${t.byteLength}`),t.tiff&&(yield t.ensureChunk(this.ifd0Offset,ha(this.options)));let a=this.parseBlock(this.ifd0Offset,"ifd0");return a.size!==0?(this.exifOffset=a.get(34665),this.interopOffset=a.get(40965),this.gpsOffset=a.get(34853),this.xmp=a.get(700),this.iptc=a.get(33723),this.icc=a.get(34675),this.options.sanitize&&(a.delete(34665),a.delete(40965),a.delete(34853),a.delete(700),a.delete(33723),a.delete(34675)),a):void 0})}parseExifBlock(){return R(this,null,function*(){if(this.exif||(this.ifd0||(yield this.parseIfd0Block()),this.exifOffset===void 0))return;this.file.tiff&&(yield this.file.ensureChunk(this.exifOffset,ha(this.options)));let t=this.parseBlock(this.exifOffset,"exif");return this.interopOffset||(this.interopOffset=t.get(40965)),this.makerNote=t.get(37500),this.userComment=t.get(37510),this.options.sanitize&&(t.delete(40965),t.delete(37500),t.delete(37510)),this.unpack(t,41728),this.unpack(t,41729),t})}unpack(t,a){let n=t.get(a);n&&n.length===1&&t.set(a,n[0])}parseGpsBlock(){return R(this,null,function*(){if(this.gps||(this.ifd0||(yield this.parseIfd0Block()),this.gpsOffset===void 0))return;let t=this.parseBlock(this.gpsOffset,"gps");return t&&t.has(2)&&t.has(4)&&(t.set("latitude",ya(...t.get(2),t.get(1))),t.set("longitude",ya(...t.get(4),t.get(3)))),t})}parseInteropBlock(){return R(this,null,function*(){if(!this.interop&&(this.ifd0||(yield this.parseIfd0Block()),this.interopOffset!==void 0||this.exif||(yield this.parseExifBlock()),this.interopOffset!==void 0))return this.parseBlock(this.interopOffset,"interop")})}parseThumbnailBlock(t=!1){return R(this,null,function*(){if(!this.ifd1&&!this.ifd1Parsed&&(!this.options.mergeOutput||t))return this.findIfd1Offset(),this.ifd1Offset>0&&(this.parseBlock(this.ifd1Offset,"ifd1"),this.ifd1Parsed=!0),this.ifd1})}extractThumbnail(){return R(this,null,function*(){if(this.headerParsed||this.parseHeader(),this.ifd1Parsed||(yield this.parseThumbnailBlock(!0)),this.ifd1===void 0)return;let t=this.ifd1.get(513),a=this.ifd1.get(514);return this.chunk.getUint8Array(t,a)})}get image(){return this.ifd0}get thumbnail(){return this.ifd1}createOutput(){let t,a,n,r={};for(a of se)if(t=this[a],!_i(t))if(n=this.canTranslate?this.translateBlock(t,a):Object.fromEntries(t),this.options.mergeOutput){if(a==="ifd1")continue;Object.assign(r,n)}else r[a]=n;return this.makerNote&&(r.makerNote=this.makerNote),this.userComment&&(r.userComment=this.userComment),r}assignToOutput(t,a){if(this.globalOptions.mergeOutput)Object.assign(t,a);else for(let[n,r]of Object.entries(a))this.assignObjectToOutput(t,n,r)}}function ya(s,t,a,n){var r=s+t/60+a/3600;return n!=="S"&&n!=="W"||(r*=-1),r}J(es,"type","tiff"),J(es,"headerLength",10),xe.set("tiff",es);const ws={ifd0:!1,ifd1:!1,exif:!1,gps:!1,interop:!1,sanitize:!1,reviveValues:!0,translateKeys:!1,translateValues:!1,mergeOutput:!1};Object.assign({},ws,{firstChunkSize:4e4,gps:[1,2,3,4]});Object.assign({},ws,{tiff:!1,ifd1:!0,mergeOutput:!1});Object.assign({},ws,{firstChunkSize:4e4,ifd0:[274]});if(typeof navigator=="object"){let s=navigator.userAgent;s.includes("iPad")||s.includes("iPhone")?s.match(/OS (\d+)_(\d+)/):s.includes("OS X 10")&&s.match(/OS X 10[_.](\d+)/),s.includes("Chrome/")?s.match(/Chrome\/(\d+)/):s.includes("Firefox/")&&s.match(/Firefox\/(\d+)/)}class Mi extends _e{constructor(...t){super(...t),J(this,"ranges",new Ui),this.byteLength!==0&&this.ranges.add(0,this.byteLength)}_tryExtend(t,a,n){if(t===0&&this.byteLength===0&&n){let r=new DataView(n.buffer||n,n.byteOffset,n.byteLength);this._swapDataView(r)}else{let r=t+a;if(r>this.byteLength){let{dataView:i}=this._extend(r);this._swapDataView(i)}}}_extend(t){let a;a=ln?rn.allocUnsafe(t):new Uint8Array(t);let n=new DataView(a.buffer,a.byteOffset,a.byteLength);return a.set(new Uint8Array(this.buffer,this.byteOffset,this.byteLength),0),{uintView:a,dataView:n}}subarray(t,a,n=!1){return a=a||this._lengthToEnd(t),n&&this._tryExtend(t,a),this.ranges.add(t,a),super.subarray(t,a)}set(t,a,n=!1){n&&this._tryExtend(a,t.byteLength,t);let r=super.set(t,a);return this.ranges.add(a,r.byteLength),r}ensureChunk(t,a){return R(this,null,function*(){this.chunked&&(this.ranges.available(t,a)||(yield this.readChunk(t,a)))})}available(t,a){return this.ranges.available(t,a)}}class Ui{constructor(){J(this,"list",[])}get length(){return this.list.length}add(t,a,n=0){let r=t+a,i=this.list.filter(l=>ba(t,l.offset,r)||ba(t,l.end,r));if(i.length>0){t=Math.min(t,...i.map(o=>o.offset)),r=Math.max(r,...i.map(o=>o.end)),a=r-t;let l=i.shift();l.offset=t,l.length=a,l.end=r,this.list=this.list.filter(o=>!i.includes(o))}else this.list.push({offset:t,length:a,end:r})}available(t,a){let n=t+a;return this.list.some(r=>r.offset<=t&&n<=r.end)}}function ba(s,t,a){return s<=t&&t<=a}class Oi extends Mi{constructor(t,a){super(0),J(this,"chunksRead",0),this.input=t,this.options=a}readWhole(){return R(this,null,function*(){this.chunked=!1,yield this.readChunk(this.nextChunkOffset)})}readChunked(){return R(this,null,function*(){this.chunked=!0,yield this.readChunk(0,this.options.firstChunkSize)})}readNextChunk(){return R(this,arguments,function*(t=this.nextChunkOffset){if(this.fullyRead)return this.chunksRead++,!1;let a=this.options.chunkSize,n=yield this.readChunk(t,a);return!!n&&n.byteLength===a})}readChunk(t,a){return R(this,null,function*(){if(this.chunksRead++,(a=this.safeWrapAddress(t,a))!==0)return this._readChunk(t,a)})}safeWrapAddress(t,a){return this.size!==void 0&&t+a>this.size?Math.max(0,this.size-t):a}get nextChunkOffset(){if(this.ranges.list.length!==0)return this.ranges.list[0].length}get canReadNextChunk(){return this.chunksRead<this.options.chunkLimit}get fullyRead(){return this.size!==void 0&&this.nextChunkOffset===this.size}read(){return this.options.chunked?this.readChunked():this.readWhole()}close(){}}ki.set("blob",class extends Oi{readWhole(){return R(this,null,function*(){this.chunked=!1;let s=yield pa(this.input);this._swapArrayBuffer(s)})}readChunked(){return this.chunked=!0,this.size=this.input.size,super.readChunked()}_readChunk(s,t){return R(this,null,function*(){let a=t?s+t:void 0,n=this.input.slice(s,a),r=yield pa(n);return this.set(r,s,!0)})}});u.createContext({uppy:void 0,status:"init",progress:0});var Li={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Be=u;function Di(s,t){return s===t&&(s!==0||1/s===1/t)||s!==s&&t!==t}var Fi=typeof Object.is=="function"?Object.is:Di,zi=Be.useState,Bi=Be.useEffect,Vi=Be.useLayoutEffect,Hi=Be.useDebugValue;function qi(s,t){var a=t(),n=zi({inst:{value:a,getSnapshot:t}}),r=n[0].inst,i=n[1];return Vi(function(){r.value=a,r.getSnapshot=t,ts(r)&&i({inst:r})},[s,a,t]),Bi(function(){return ts(r)&&i({inst:r}),s(function(){ts(r)&&i({inst:r})})},[s]),Hi(a),a}function ts(s){var t=s.getSnapshot;s=s.value;try{var a=t();return!Fi(s,a)}catch(n){return!0}}function Ki(s,t){return t()}var Gi=typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"?Ki:qi;Li.useSyncExternalStore=Be.useSyncExternalStore!==void 0?Be.useSyncExternalStore:Gi;var Wi={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nt=u;function Qi(s,t){return s===t&&(s!==0||1/s===1/t)||s!==s&&t!==t}var Ji=typeof Object.is=="function"?Object.is:Qi,Zi=nt.useSyncExternalStore,Xi=nt.useRef,Yi=nt.useEffect,el=nt.useMemo,tl=nt.useDebugValue;Wi.useSyncExternalStoreWithSelector=function(s,t,a,n,r){var i=Xi(null);if(i.current===null){var l={hasValue:!1,value:null};i.current=l}else l=i.current;i=el(function(){function d(f){if(!c){if(c=!0,p=f,f=n(f),r!==void 0&&l.hasValue){var v=l.value;if(r(v,f))return h=v}return h=f}if(v=h,Ji(p,f))return v;var w=n(f);return r!==void 0&&r(v,w)?(p=f,v):(p=f,h=w)}var c=!1,p,h,j=a===void 0?null:a;return[function(){return d(t())},j===null?void 0:function(){return d(j())}]},[t,a,n,r]);var o=Zi(s,i[0],i[1]);return Yi(function(){l.hasValue=!0,l.value=o},[o]),tl(o),o};const ja=({onSuccess:s,onError:t})=>{const{api:a,settings:n,updateSetting:r}=Y(),[i,l]=u.useState(""),[o,d]=u.useState(!1),[c,p]=u.useState([]),[h,j]=u.useState(""),f=u.useRef(null),v=Oa("process-url-stream",{onMessage:N=>{S(N)},autoConnect:!1}),w=N=>{try{const m=new URL(N);return m.protocol==="http:"||m.protocol==="https:"}catch(m){return!1}},g=()=>R(void 0,null,function*(){if(!i.trim()){j("Please enter a URL");return}if(!w(i)){j("Please enter a valid HTTP/HTTPS URL");return}j(""),d(!0);const N={id:$(),url:i.trim(),status:"processing",progress:0,startTime:new Date,sessionId:null,error:null};p(m=>[N,...m]);try{v.connect();const m=yield a.processing.processUrlStream({url:i.trim(),enableContextual:n.processing.enableContextualEmbeddings,source:"user"});p(T=>T.map(x=>x.id===N.id?V(D({},x),{sessionId:m.sessionId}):x)),s&&s({url:i.trim(),sessionId:m.sessionId}),l("")}catch(m){p(T=>T.map(x=>x.id===N.id?V(D({},x),{status:"error",error:m.message||"Processing failed",endTime:new Date}):x)),t&&t({url:i.trim()},m)}finally{d(!1)}}),S=N=>{try{if(!N||typeof N!="object")return;N.type==="progress"&&N.sessionId&&p(m=>m.map(T=>{var x;return T.sessionId===N.sessionId?V(D({},T),{status:N.status||T.status,progress:((x=N.progress)==null?void 0:x.percentage)||T.progress,error:N.error||T.error,endTime:N.status==="completed"||N.status==="error"?new Date:T.endTime}):T}))}catch(m){}},k=N=>{p(m=>m.filter(T=>T.id!==N))},E=N=>{var m;l(N.url),(m=f.current)==null||m.focus()},$=()=>Math.random().toString(36).substr(2,9),y=N=>{N.key==="Enter"&&!o&&g()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"font-bold mb-4 flex items-center gap-2",children:[e.jsx(Rt,{className:"w-5 h-5 text-primary-400"}),"Process URL"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"relative",children:[e.jsx(Na,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{ref:f,type:"url",placeholder:"https://example.com/article",value:i,onChange:N=>{l(N.target.value),j("")},onKeyPress:y,className:`input-primary pl-10 ${h?"border-red-500":""}`,disabled:o})]}),h&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-red-400 text-sm",children:[e.jsx(le,{className:"w-4 h-4"}),h]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.processing.enableContextualEmbeddings,onChange:N=>r("processing","enableContextualEmbeddings",N.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{children:"Enable Contextual Embeddings"})]})}),e.jsx("button",{onClick:g,disabled:o||!i.trim(),className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:o?e.jsxs(e.Fragment,{children:[e.jsx(Me,{className:"w-4 h-4 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{className:"w-4 h-4"}),"Process URL"]})})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Quick Start Templates"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[{label:"GitHub Repository",template:"https://github.com/",icon:"🔧"},{label:"Research Paper",template:"https://arxiv.org/",icon:"📄"},{label:"Documentation",template:"https://docs.",icon:"📚"},{label:"Blog Article",template:"https://",icon:"✍️"}].map((N,m)=>e.jsxs("button",{onClick:()=>l(N.template),className:"flex items-center gap-3 p-3 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700 hover:border-gray-600 transition-colors text-left",children:[e.jsx("span",{className:"text-xl",children:N.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:N.label}),e.jsx("div",{className:"text-xs text-gray-400",children:N.template})]})]},m))})]}),c.length>0&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-bold",children:"Processing History"}),e.jsxs("div",{className:"text-sm text-gray-400",children:[c.length," item",c.length!==1?"s":""]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto custom-scrollbar",children:c.map(N=>e.jsx(sl,{item:N,onRemove:()=>k(N.id),onRetry:()=>E(N)},N.id))})]}),c.length>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Ct,{title:"Total URLs",value:c.length,color:"text-blue-400"}),e.jsx(Ct,{title:"Completed",value:c.filter(N=>N.status==="completed").length,color:"text-green-400"}),e.jsx(Ct,{title:"Processing",value:c.filter(N=>N.status==="processing").length,color:"text-yellow-400"}),e.jsx(Ct,{title:"Failed",value:c.filter(N=>N.status==="error").length,color:"text-red-400"})]})]})},sl=({item:s,onRemove:t,onRetry:a})=>{const n={processing:{color:"text-yellow-400",bg:"bg-yellow-600",icon:Me,action:"Processing..."},completed:{color:"text-green-400",bg:"bg-green-600",icon:re,action:"Completed"},error:{color:"text-red-400",bg:"bg-red-600",icon:le,action:"Failed"}},r=n[s.status]||n.processing,i=r.icon,l=(o,d)=>d?`${Math.round((d-o)/1e3)}s`:"In progress...";return e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Rt,{className:"w-5 h-5 text-primary-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-white truncate",children:s.url}),e.jsx("button",{onClick:()=>window.open(s.url,"_blank"),className:"p-1 hover:bg-gray-700 rounded transition-colors",title:"Open URL",children:e.jsx(st,{className:"w-3 h-3 text-gray-400"})})]}),s.status==="processing"&&e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2 mb-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${r.bg}`,style:{width:`${s.progress||0}%`}})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(i,{className:`w-4 h-4 ${r.color} ${s.status==="processing"?"animate-spin":""}`}),e.jsx("span",{className:r.color,children:r.action}),s.progress>0&&s.status==="processing"&&e.jsxs("span",{className:"text-gray-400",children:["(",Math.round(s.progress),"%)"]}),e.jsx("span",{className:"text-gray-500",children:l(s.startTime,s.endTime)})]}),s.error&&e.jsx("div",{className:"text-sm text-red-400 mt-1",children:s.error})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="error"&&e.jsx("button",{onClick:a,className:"btn-secondary text-sm",children:"Retry"}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-700 rounded transition-colors",title:"Remove",children:e.jsx(ve,{className:"w-4 h-4 text-gray-400"})})]})]})},Ct=({title:s,value:t,color:a})=>e.jsxs("div",{className:"text-center p-4 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700",children:[e.jsx("div",{className:`text-2xl font-bold ${a}`,children:t}),e.jsx("div",{className:"text-sm text-gray-400",children:s})]}),al=()=>{const{api:s,documents:t,systemStats:a,refreshDocuments:n}=Y(),[r,i]=u.useState("files"),[l,o]=u.useState([]),[d,c]=u.useState({totalProcessed:0,successfulProcessing:0,failedProcessing:0,averageTime:0});u.useEffect(()=>{p();const v=setInterval(p,5e3);return()=>clearInterval(v)},[]);const p=()=>R(void 0,null,function*(){try{const[v,w]=yield Promise.all([s.processing.getQueue(),s.processing.getStats()]);o(v||[]),c(g=>D(D({},g),w))}catch(v){}}),h=(v,w)=>R(void 0,null,function*(){setTimeout(()=>{n()},1e3),c(g=>V(D({},g),{totalProcessed:g.totalProcessed+1}))}),j=(v,w)=>{c(g=>V(D({},g),{totalProcessed:g.totalProcessed+1,failedProcessing:g.failedProcessing+1}))},f=[{id:"files",label:"File Upload",icon:Ue,description:"Upload and process documents",component:Bs},{id:"urls",label:"URL Processing",icon:Rt,description:"Process content from URLs",component:ja},{id:"queue",label:"Processing Queue",icon:Te,description:"Monitor processing status",component:va}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(kt,{title:"Total Documents",value:(t==null?void 0:t.length)||0,icon:ae,color:"text-blue-400",change:"+12 today"}),e.jsx(kt,{title:"Processing Queue",value:l.length,icon:Te,color:"text-yellow-400",change:l.length>0?`${l.filter(v=>v.status==="processing").length} active`:"Empty"}),e.jsx(kt,{title:"Success Rate",value:`${d.totalProcessed>0?Math.round((d.totalProcessed-d.failedProcessing)/d.totalProcessed*100):100}%`,icon:tt,color:"text-green-400",change:`${d.failedProcessing} failed`}),e.jsx(kt,{title:"Avg Processing Time",value:`${d.averageTime||45}s`,icon:je,color:"text-purple-400",change:"Per document"})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"flex items-center gap-2 mb-6 bg-gray-800 bg-opacity-50 rounded-lg p-1",children:f.map(v=>{const w=v.icon,g=r===v.id;return e.jsxs("button",{onClick:()=>i(v.id),className:`flex items-center gap-2 px-4 py-3 rounded-md text-sm font-medium transition-all duration-200 flex-1 ${g?"bg-primary-600 text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:[e.jsx(w,{className:"w-4 h-4"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{children:v.label}),e.jsx("div",{className:"text-xs opacity-75",children:v.description})]})]},v.id)})}),e.jsxs("div",{className:"min-h-[500px]",children:[r==="files"&&e.jsx(Bs,{onSuccess:h,onError:j}),r==="urls"&&e.jsx(ja,{onSuccess:h,onError:j}),r==="queue"&&e.jsx(va,{queue:l,onRefresh:p})]})]}),e.jsx(nl,{documents:(t==null?void 0:t.slice(0,5))||[]})]})},va=({queue:s,onRefresh:t})=>{const{api:a}=Y(),n=(l,o)=>R(void 0,null,function*(){try{yield a.processing.stopProcessing(l),t&&t()}catch(d){}}),r=l=>{switch(l){case"queued":return"text-gray-400";case"processing":return"text-yellow-400";case"completed":return"text-green-400";case"error":return"text-red-400";default:return"text-gray-400"}},i=l=>{switch(l){case"queued":return je;case"processing":return Te;case"completed":return ae;case"error":return Te;default:return je}};return s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Te,{className:"w-16 h-16 text-gray-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"No Active Processing"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Upload files or process URLs to see them appear in the queue."}),e.jsxs("button",{onClick:t,className:"btn-primary",children:[e.jsx(Te,{className:"w-4 h-4"}),"Refresh Queue"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Active Processing Queue"}),e.jsxs("button",{onClick:t,className:"btn-secondary text-sm",children:[e.jsx(Te,{className:"w-4 h-4"}),"Refresh"]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto custom-scrollbar",children:s.map((l,o)=>{const d=i(l.status),c=r(l.status);return e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(d,{className:`w-5 h-5 ${c} ${l.status==="processing"?"animate-spin":""}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-white truncate",children:l.title||l.url||l.filename||"Unknown Item"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[l.completedChunks||0," / ",l.totalChunks||0," chunks"]})]}),l.status==="processing"&&l.progress&&e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2 mb-2",children:e.jsx("div",{className:"h-2 bg-yellow-500 rounded-full transition-all duration-300",style:{width:`${l.progress||0}%`}})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:c,children:l.status==="processing"?"Processing...":l.status==="completed"?"Completed":l.status==="error"?"Failed":"Queued"}),l.progress&&e.jsxs("span",{className:"text-gray-400",children:["(",Math.round(l.progress),"%)"]}),l.estimatedTime&&e.jsxs("span",{className:"text-gray-500",children:["• ~",l.estimatedTime,"s remaining"]})]}),l.error&&e.jsx("div",{className:"text-sm text-red-400 mt-1",children:l.error})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:l.startedAt||l.createdAt?new Date(l.startedAt||l.createdAt).toLocaleTimeString():"Pending"}),(l.status==="processing"||l.status==="queued")&&l.id&&e.jsxs("button",{onClick:()=>n(l.id,l.title||l.filename||"Unknown Item"),className:"px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-white text-sm font-medium flex items-center gap-1 min-w-fit",title:"Stop processing",children:[e.jsx(On,{className:"w-4 h-4"}),"Stop"]})]})]},l.id||o)})})]})},nl=({documents:s})=>!s||s.length===0?null:e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"font-bold mb-4 flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-primary-400"}),"Recent Activity"]}),e.jsx("div",{className:"space-y-3",children:s.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-800 bg-opacity-30 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(ae,{className:"w-4 h-4 text-primary-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-white truncate",children:t.title||t.url||"Untitled Document"}),e.jsxs("div",{className:"text-sm text-gray-400",children:[t.chunkCount||0," chunks • ",t.contentType||"document"]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:t.processedAt?new Date(t.processedAt).toLocaleDateString():"Recently"})]},t.id||a))})]}),kt=({title:s,value:t,icon:a,color:n,change:r})=>e.jsxs("div",{className:"card text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(a,{className:`w-6 h-6 ${n}`})}),e.jsx("div",{className:`text-2xl font-bold ${n} mb-1`,children:t}),e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:s}),r&&e.jsx("div",{className:"text-xs text-gray-500",children:r})]}),rl=()=>{const{api:s,settings:t}=Y(),[a,n]=u.useState([]),[r,i]=u.useState(""),[l,o]=u.useState(!1),[d,c]=u.useState("gpt-4o-mini"),[p,h]=u.useState(!0),[j,f]=u.useState(null),v=u.useRef(null),w=u.useRef(null),g=u.useRef(null),[S,k]=u.useState(!0),[E,$]=u.useState(0);u.useEffect(()=>{if(a.length>E&&S){const b=a[a.length-1];b&&(b.type==="assistant"||a.length===1)&&y()}$(a.length)},[a,S,E]);const y=()=>{setTimeout(()=>{var b;(b=v.current)==null||b.scrollIntoView({behavior:"smooth"})},100)};u.useEffect(()=>{m()},[]);const N=()=>{const b=g.current;if(b){const{scrollTop:A,scrollHeight:O,clientHeight:L}=b,B=A+L>=O-50;k(B)}},m=()=>{const b={id:C(),type:"assistant",content:"👋 Hi! I'm your AutoLlama AI assistant. I can help you search and understand your processed documents using advanced RAG (Retrieval-Augmented Generation). What would you like to know?",timestamp:new Date,sources:[]};n([b]),f(C())},T=()=>R(void 0,null,function*(){if(!r.trim()||l)return;const b={id:C(),type:"user",content:r.trim(),timestamp:new Date};n(A=>[...A,b]),i(""),o(!0),setTimeout(()=>{var A;(A=w.current)==null||A.focus()},50);try{const A=yield s.chat.sendMessage({message:r.trim(),model:d,ragEnabled:p,conversationId:j,systemContext:"You are AutoLlama's AI assistant. Use the knowledge base to provide helpful, accurate responses with source citations."}),O={id:C(),type:"assistant",content:A.content||A.message||"I apologize, but I encountered an issue processing your request.",timestamp:new Date,sources:A.sources||[],metadata:A.metadata||{}};n(L=>[...L,O])}catch(A){const O={id:C(),type:"assistant",content:`I encountered an error: ${A.message||"Unable to process your request"}. Please try again or check your connection settings.`,timestamp:new Date,isError:!0};n(L=>[...L,O])}finally{o(!1)}}),x=b=>{b.key==="Enter"&&!b.shiftKey&&(b.preventDefault(),b.stopPropagation(),T())},_=b=>{b.preventDefault(),b.stopPropagation(),T()},I=()=>{n([]),f(C()),m()},M=b=>{navigator.clipboard.writeText(b)},C=()=>Math.random().toString(36).substr(2,9);return e.jsxs("div",{className:"flex flex-col h-full max-h-[80vh] bg-gray-900 rounded-xl border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700 bg-gray-800 bg-opacity-50 rounded-t-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsx(X,{className:"w-5 h-5 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-white",children:"AutoLlama Chat"}),e.jsx("p",{className:"text-sm text-gray-400",children:"RAG-powered AI assistant • Connected to your knowledge base"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"RAG:"}),e.jsx("button",{onClick:()=>h(!p),className:`relative w-10 h-6 rounded-full transition-colors ${p?"bg-primary-600":"bg-gray-600"}`,children:e.jsx("div",{className:`absolute w-4 h-4 bg-white rounded-full top-1 transition-transform ${p?"translate-x-5":"translate-x-1"}`})})]}),e.jsxs("select",{value:d,onChange:b=>c(b.target.value),className:"bg-gray-700 border border-gray-600 rounded-md px-3 py-1 text-sm text-white",children:[e.jsx("option",{value:"gpt-4o-mini",children:"GPT-4o Mini"}),e.jsx("option",{value:"gpt-4o",children:"GPT-4o"}),e.jsx("option",{value:"gpt-3.5-turbo",children:"GPT-3.5 Turbo"})]}),e.jsx("button",{onClick:I,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",title:"Clear conversation",children:e.jsx(ka,{className:"w-4 h-4 text-gray-400"})})]})]}),e.jsxs("div",{ref:g,onScroll:N,className:"flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar",children:[a.map(b=>e.jsx(il,{message:b,onCopy:()=>M(b.content)},b.id)),l&&e.jsxs("div",{className:"flex items-center gap-3 p-4",children:[e.jsx("div",{className:"w-8 h-8 bg-primary-600 bg-opacity-20 rounded-full flex items-center justify-center",children:e.jsx(Aa,{className:"w-4 h-4 text-primary-400"})}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(oe,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"AutoLlama is thinking..."})]})]}),e.jsx("div",{ref:v})]}),e.jsxs("div",{className:"p-4 border-t border-gray-700 bg-gray-800 bg-opacity-30 rounded-b-xl",children:[e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"flex-1 relative",children:e.jsx("textarea",{ref:w,value:r,onChange:b=>i(b.target.value),onKeyPress:x,placeholder:"Ask me anything about your processed documents...",className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 resize-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",rows:Math.min(Math.max(r.split(`
`).length,1),4),disabled:l})}),e.jsx("button",{onClick:_,disabled:!r.trim()||l,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",type:"button",children:e.jsx(Ln,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-gray-500",children:[e.jsx("span",{children:"Press Enter to send, Shift+Enter for new line"}),e.jsxs("span",{className:`flex items-center gap-1 ${p?"text-green-400":"text-gray-500"}`,children:[e.jsx(X,{className:"w-3 h-3"}),p?"RAG Active":"RAG Disabled"]})]})]})]})},il=({message:s,onCopy:t})=>{const a=s.type==="user",n=s.isError;return e.jsxs("div",{className:`flex gap-3 ${a?"flex-row-reverse":"flex-row"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${a?"bg-blue-600 bg-opacity-20":n?"bg-red-600 bg-opacity-20":"bg-primary-600 bg-opacity-20"}`,children:a?e.jsx(Dn,{className:"w-4 h-4 text-blue-400"}):e.jsx(Aa,{className:`w-4 h-4 ${n?"text-red-400":"text-primary-400"}`})}),e.jsxs("div",{className:`flex-1 max-w-[80%] ${a?"text-right":"text-left"}`,children:[e.jsxs("div",{className:`inline-block p-4 rounded-2xl ${a?"bg-blue-600 bg-opacity-20 text-blue-100":n?"bg-red-600 bg-opacity-20 text-red-100 border border-red-500 border-opacity-30":"bg-gray-800 bg-opacity-50 text-gray-100"}`,children:[e.jsx("div",{className:"whitespace-pre-wrap leading-relaxed",children:s.content}),s.sources&&s.sources.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-600 border-opacity-50",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Sources:"}),e.jsx("div",{className:"space-y-1",children:s.sources.map((r,i)=>e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(st,{className:"w-3 h-3 text-gray-400"}),e.jsx("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 underline truncate max-w-xs",children:r.title||r.url}),r.score&&e.jsxs("span",{className:"text-gray-500",children:["(",Math.round(r.score*100),"%)"]})]},i))})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-gray-500",children:[e.jsx("span",{children:s.timestamp.toLocaleTimeString()}),e.jsx("button",{onClick:t,className:"hover:text-gray-300 transition-colors",title:"Copy message",children:e.jsx(Ie,{className:"w-3 h-3"})})]})]})]})},ll=()=>{const{api:s,documents:t,systemStats:a}=Y(),[n,r]=u.useState({totalQueries:0,averageResponseTime:0,knowledgeBaseSize:0,ragAccuracy:0}),[i,l]=u.useState(!0);u.useEffect(()=>{o()},[]);const o=()=>R(void 0,null,function*(){try{const p=yield s.chat.getStats();r(h=>D(D({},h),p))}catch(p){r({totalQueries:0,averageResponseTime:1.2,knowledgeBaseSize:(t==null?void 0:t.length)||0,ragAccuracy:92})}}),d=["Summarize the main points from my recent uploads","What topics do I have the most content about?","Find information about machine learning in my documents","What are the key insights from my research papers?","Show me content related to AI and automation"],c=p=>{l(!1)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(Tt,{title:"Knowledge Base",value:`${n.knowledgeBaseSize||(t==null?void 0:t.length)||0} docs`,icon:ae,color:"text-blue-400",description:"Processed documents"}),e.jsx(Tt,{title:"RAG Accuracy",value:`${n.ragAccuracy||92}%`,icon:tt,color:"text-green-400",description:"Answer relevance"}),e.jsx(Tt,{title:"Response Time",value:`${n.averageResponseTime||1.2}s`,icon:ke,color:"text-yellow-400",description:"Average speed"}),e.jsx(Tt,{title:"Total Queries",value:n.totalQueries||0,icon:Je,color:"text-purple-400",description:"Chat sessions"})]}),i?e.jsx(cl,{sampleQuestions:d,onQuestionSelect:c,onStartChat:()=>l(!1),knowledgeBaseSize:(t==null?void 0:t.length)||0}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsx(rl,{})}),e.jsx("div",{className:"space-y-4",children:e.jsx(ol,{documents:t,onQuestionSelect:c,sampleQuestions:d})})]})]})},cl=({sampleQuestions:s,onQuestionSelect:t,onStartChat:a,knowledgeBaseSize:n})=>e.jsxs("div",{className:"card text-center space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-20 h-20 bg-primary-600 bg-opacity-20 rounded-full flex items-center justify-center mx-auto",children:e.jsx(X,{className:"w-10 h-10 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold mb-2",children:"AutoLlama RAG Chat"}),e.jsx("p",{className:"text-xl text-gray-400",children:"Your AI assistant powered by your processed documents"})]})]}),e.jsxs("div",{className:"bg-gray-800 bg-opacity-50 rounded-lg p-6 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[e.jsx(ae,{className:"w-6 h-6 text-blue-400"}),e.jsx("span",{className:"text-lg font-medium",children:"Knowledge Base Ready"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-400",children:n}),e.jsx("div",{className:"text-gray-400",children:"Documents"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-400",children:"RAG"}),e.jsx("div",{className:"text-gray-400",children:"Enhanced"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-400",children:"GPT-4o"}),e.jsx("div",{className:"text-gray-400",children:"Powered"})]})]})]}),e.jsxs("div",{className:"space-y-4 max-w-3xl mx-auto",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-300",children:"Try asking about:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:s.map((r,i)=>e.jsx("button",{onClick:()=>t(r),className:"p-4 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700 hover:border-primary-500 hover:bg-primary-600 hover:bg-opacity-10 transition-all text-left group",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Je,{className:"w-5 h-5 text-gray-400 group-hover:text-primary-400 mt-1 flex-shrink-0"}),e.jsxs("span",{className:"text-gray-300 group-hover:text-white text-sm",children:['"',r,'"']})]})},i))})]}),e.jsxs("button",{onClick:a,className:"btn-primary text-lg px-8 py-3",children:[e.jsx(Je,{className:"w-5 h-5"}),"Start Chatting"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto text-sm",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(Ee,{className:"w-8 h-8 text-blue-400 mx-auto"}),e.jsx("h4",{className:"font-bold text-white",children:"Semantic Search"}),e.jsx("p",{className:"text-gray-400",children:"Find relevant information across all your documents using advanced vector search"})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(X,{className:"w-8 h-8 text-green-400 mx-auto"}),e.jsx("h4",{className:"font-bold text-white",children:"Context-Aware"}),e.jsx("p",{className:"text-gray-400",children:"Responses include contextual understanding of your document relationships"})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(tt,{className:"w-8 h-8 text-purple-400 mx-auto"}),e.jsx("h4",{className:"font-bold text-white",children:"Source Citations"}),e.jsx("p",{className:"text-gray-400",children:"Every answer includes links to the source documents for verification"})]})]})]}),ol=({documents:s,onQuestionSelect:t,sampleQuestions:a})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"font-bold mb-3 flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4 text-yellow-400"}),"Quick Questions"]}),e.jsx("div",{className:"space-y-2",children:a.slice(0,3).map((n,r)=>e.jsxs("button",{onClick:()=>t(n),className:"w-full text-left p-2 text-sm bg-gray-800 bg-opacity-50 rounded-md hover:bg-gray-700 transition-colors",children:['"',n.substring(0,50),'..."']},r))})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"font-bold mb-3 flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4 text-blue-400"}),"Recent Documents"]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto custom-scrollbar",children:s==null?void 0:s.slice(0,5).map((n,r)=>e.jsxs("div",{className:"p-2 bg-gray-800 bg-opacity-30 rounded-md",children:[e.jsx("div",{className:"font-medium text-white text-sm truncate",children:n.title||n.url||"Untitled"}),e.jsxs("div",{className:"text-xs text-gray-400",children:[n.chunkCount||0," chunks • ",n.contentType||"document"]})]},r))})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"font-bold mb-3 flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-primary-400"}),"RAG Features"]}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),e.jsx("span",{children:"Contextual embeddings active"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsx("span",{children:"Vector similarity search"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full"}),e.jsx("span",{children:"Source citation included"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),e.jsx("span",{children:"Real-time knowledge base"})]})]})]})]}),Tt=({title:s,value:t,icon:a,color:n,description:r})=>e.jsxs("div",{className:"card text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(a,{className:`w-6 h-6 ${n}`})}),e.jsx("div",{className:`text-2xl font-bold ${n} mb-1`,children:t}),e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:s}),e.jsx("div",{className:"text-xs text-gray-500",children:r})]}),hn=u.createContext(),Y=()=>{const s=u.useContext(hn);if(!s)throw new Error("useAppContext must be used within AppProvider");return s};if(typeof window!="undefined"){const s=window.onerror;window.onerror=function(t,a,n,r,i){return t&&t.includes("severity")?!0:s?s.call(this,t,a,n,r,i):!1}}function dl(){var lt,ct;const[s,t]=u.useState("dashboard"),[a,n]=u.useState(null),[r,i]=u.useState(null),[l,o]=u.useState([]),[d,c]=u.useState(0),[p,h]=u.useState(!1),[j,f]=u.useState([]),[v,w]=u.useState({}),[g,S]=u.useState(""),[k,E]=u.useState([]),[$,y]=u.useState([]),N=u.useRef(new Map),m=u.useRef(new Set),T=P=>{const F=N.current.get(P);F&&(F.close(),N.current.delete(P))},x=(P,F)=>{const U=setTimeout(()=>{m.current.delete(U),P()},F);return m.current.add(U),U};u.useEffect(()=>()=>{N.current.forEach((P,F)=>{P.close()}),N.current.clear(),m.current.forEach(P=>{clearTimeout(P)}),m.current.clear()},[]);const _=Gn(),I=gs(),M=Oa("/api/stream",{onMessage:P=>{C(P)},onError:P=>{}}),C=P=>{switch(P.type||P.step){case"connection":break;case"system_update":P.data&&(I.utils.invalidateCache.stats(),w(U=>{var K,q,ue,Bt,Vt,_s,Cs,ks,Ts,As;return V(D({},U),{database:V(D({},U.database),{status:((K=P.data.database)==null?void 0:K.status)||"unknown",healthy:((q=P.data.database)==null?void 0:q.healthy)||!1}),knowledgeBase:V(D({},U.knowledgeBase),{qdrant_status:((ue=P.data.qdrant)==null?void 0:ue.status)==="connected"?"active":"inactive",total_documents:((Bt=P.data.qdrant)==null?void 0:Bt.documents)||((Vt=U.knowledgeBase)==null?void 0:Vt.total_documents)||0,total_chunks:((_s=P.data.qdrant)==null?void 0:_s.chunks)||((Cs=U.knowledgeBase)==null?void 0:Cs.total_chunks)||0,contextual_documents:((ks=U.knowledgeBase)==null?void 0:ks.contextual_documents)||0}),processing:{activeSessions:((Ts=P.data.processing)==null?void 0:Ts.activeSessions)||0,totalProcessing:((As=P.data.processing)==null?void 0:As.totalProcessing)||0},lastUpdated:new Date})}),setTimeout(()=>{I.stats.getKnowledgeBase().then(U=>{w(K=>V(D({},K),{knowledgeBase:D(D({},K.knowledgeBase),U)}))}).catch(U=>{})},100));break;case"processing_progress":Z(P.sessionId,P.progress);break;case"chunk_update":ee(P.chunkId,P.status);break;case"system_stats":w(U=>D(D({},U),P.stats));break;case"document_created":I.utils.invalidateCache.stats(),I.utils.invalidateCache.documents(),z(),B(),x(()=>{I.utils.invalidateCache.stats(),z()},500);break;case"processing_complete":case"file_processing_complete":case"session_complete":case"content_processed":P.sessionId&&Lt(P.sessionId),I.utils.invalidateCache.stats(),I.utils.invalidateCache.documents(),z(),B();break;case"chunk_processing_complete":P.chunkData&&P.chunkData.currentChunk===P.chunkData.totalChunks&&(I.utils.invalidateCache.stats(),I.utils.invalidateCache.documents(),B(),z());break}};u.useEffect(()=>{b(),A(),x(()=>{Pe()},1e3),x(()=>{B()},2e3)},[]),u.useEffect(()=>{var K;const P=$.some(q=>q.status==="processing"||q.status==="uploading")||((K=v.processing)==null?void 0:K.totalProcessing)>0,F=P?8e3:15e3,U=setInterval(()=>{P&&I.utils.invalidateCache.stats(),z(),(P||Date.now()%3e4<F)&&B()},F);return()=>{clearInterval(U)}},[$,(lt=v.processing)==null?void 0:lt.totalProcessing]),u.useEffect(()=>{const P=F=>{var K;if($.some(q=>q.status==="processing"||q.status==="uploading")||((K=v.processing)==null?void 0:K.totalProcessing)>0){const q="Processing is currently active. Refreshing the page will interrupt the upload/processing. Are you sure you want to continue?";return F.preventDefault(),F.returnValue=q,q}};return window.addEventListener("beforeunload",P),()=>{window.removeEventListener("beforeunload",P)}},[$,(ct=v.processing)==null?void 0:ct.totalProcessing]);const b=()=>R(this,null,function*(){try{I.utils.invalidateCache.stats(),I.utils.invalidateCache.documents(),yield Promise.all([B(),z(),L()])}catch(P){}}),A=()=>{try{const P=localStorage.getItem("autollama_upload_sessions");P&&JSON.parse(P).forEach(U=>{(U.status==="processing"||U.status==="uploading")&&(de(V(D({},U),{status:"reconnecting",reconnected:!0})),O(U.sessionId))})}catch(P){localStorage.removeItem("autollama_upload_sessions")}},O=P=>R(this,null,function*(){try{const F=yield fetch(`/api/upload-session/${P}`);if(F.ok){const U=yield F.json();if(U.status==="processing"){te(P,"processing"),T(P);const K=new EventSource(`/api/session-stream/${P}`);N.current.set(P,K),K.onmessage=q=>{const ue=JSON.parse(q.data);C(ue)},K.onerror=()=>{T(P),te(P,"failed")}}else te(P,U.status),U.status==="completed"&&(B(),z())}else te(P,"failed")}catch(F){te(P,"failed")}}),L=()=>R(this,null,function*(){try{const P=yield fetch("/api/cleanup-status");if(P.ok){const F=yield P.json();if(F.success&&F.current_stuck_sessions>0&&window.confirm(`Found ${F.current_stuck_sessions} interrupted processing session(s). Would you like to clean them up and allow new uploads?`)){const K=yield fetch("/api/cleanup-sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({threshold:5})});if(K.ok){const q=yield K.json()}}}}catch(P){}}),B=u.useCallback((P=!1)=>R(this,null,function*(){var F,U;try{I.utils.invalidateCache.documents();const K=Math.min(20,((U=(F=_.settings)==null?void 0:F.ui)==null?void 0:U.documentsPerPage)||20),q=yield I.documents.getAll({limit:K,offset:0}),ue=(q==null?void 0:q.documents)||[];ue.slice(0,5).forEach((Bt,Vt)=>{}),f(ue)}catch(K){}}),[]),z=u.useCallback(()=>R(this,null,function*(){try{I.utils.invalidateCache.stats();const[P,F,U]=yield Promise.all([I.stats.getKnowledgeBase(),I.stats.getDatabase(),I.stats.getHealth()]);w({knowledgeBase:P,database:F,health:U,lastUpdated:new Date})}catch(P){}}),[]);u.useEffect(()=>{const F=setInterval(()=>{if(performance.memory){const U=performance.memory.usedJSHeapSize/performance.memory.jsHeapSizeLimit;Math.round(performance.memory.usedJSHeapSize/1024/1024),Math.round(performance.memory.jsHeapSizeLimit/1024/1024),U>.8&&(I.utils.invalidateCache.all(),window.gc&&window.gc())}},3e4);return()=>clearInterval(F)},[I]);const Z=(P,F)=>{f(U=>U.map(K=>K.sessionId===P?V(D({},K),{processingProgress:F}):K))},ee=(P,F)=>{a&&n(U=>{var K;return V(D({},U),{chunks:((K=U.chunks)==null?void 0:K.map(q=>q.chunk_id===P?V(D({},q),{status:F}):q))||[]})})},de=P=>{const F=P.map(U=>({id:rt(),file:U,name:U.name,size:U.size,type:U.type,status:"pending",progress:0,error:null,sessionId:null,timestamp:new Date}));return y(U=>[...U,...F]),F},te=(P,F)=>{y(U=>{const K=U.map(q=>q.id===P?D(D({},q),F):q);return F.status==="completed"&&x(()=>{y(q=>q.filter(ue=>ue.id!==P))},3e3),Ne(K),K})},Ne=P=>{try{const F=P.filter(U=>U.status==="processing"||U.status==="uploading").map(U=>({id:U.id,name:U.name,size:U.size,type:U.type,status:U.status,progress:U.progress,sessionId:U.sessionId,timestamp:U.timestamp}));localStorage.setItem("autollama_upload_sessions",JSON.stringify(F))}catch(F){}},Ve=P=>{y(F=>F.filter(U=>U.id!==P))},Ot=()=>{y(P=>P.filter(F=>F.status!=="completed"))},Pe=()=>R(this,null,function*(){try{const P=yield I.data.getInProgress(),F=new Set(P.map(U=>U.id));y(U=>{const K=U.filter(q=>!!(q.status!=="processing"||q.sessionId&&F.has(q.sessionId)));return K.length!==U.length&&Ne(K),K})}catch(P){}}),Lt=P=>{T(P),y(F=>{const U=F.map(q=>q.sessionId===P&&q.status==="processing"?V(D({},q),{status:"completed"}):q),K=U.find(q=>q.sessionId===P&&q.status==="completed");return K&&x(()=>{y(q=>q.filter(ue=>ue.id!==K.id))},3e3),Ne(U),U})},rt=()=>Math.random().toString(36).substr(2,9),Dt=P=>R(this,null,function*(){if(n(P),t("document"),!P.chunks)try{const F=btoa(P.url),U=yield I.documents.getChunks(F,{limit:1e3});n(K=>V(D({},K),{chunks:(U==null?void 0:U.chunks)||[]}))}catch(F){}}),Ft=()=>{t("dashboard"),n(null),i(null),o([]),c(0)},it=(P,F=[],U=0)=>{i(P),o(F),c(U+1)},He=P=>{P>=1&&P<=l.length&&(c(P),i(l[P-1]))},Ss=P=>{S(P),P.trim()&&s!=="search"&&t("search"),!P.trim()&&s==="search"&&t("dashboard")},zt={currentView:s,selectedDocument:a,selectedChunk:r,selectedChunks:l,chunkIndex:d,showSettings:p,documents:j,systemStats:v,searchQuery:g,searchResults:k,uploadQueue:$,settings:_.settings,connectionStatus:_.connectionStatus,updateSetting:_.updateSetting,updateCategory:_.updateCategory,api:I,sse:M,setCurrentView:t,setShowSettings:h,handleDocumentSelect:Dt,handleBackToDashboard:Ft,handleChunkSelect:it,handleChunkNavigate:He,handleSearchQueryChange:Ss,refreshDocuments:B,loadSystemStats:z,addToUploadQueue:de,updateUploadStatus:te,removeFromUploadQueue:Ve,clearCompletedUploads:Ot};return e.jsx(hn.Provider,{value:zt,children:e.jsx(fn,{children:e.jsxs("div",{className:"min-h-screen bg-gray-900 text-white bg-pattern",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 opacity-50"}),e.jsx("div",{className:"relative z-10",children:e.jsxs(yn,{children:[e.jsx(qe,{path:"/",element:e.jsx(At,{})}),e.jsx(qe,{path:"/dashboard",element:e.jsx(At,{})}),e.jsx(qe,{path:"/document/:id",element:e.jsx(At,{})}),e.jsx(qe,{path:"/search",element:e.jsx(At,{})}),e.jsx(qe,{path:"*",element:e.jsx(bn,{to:"/",replace:!0})})]})}),p&&e.jsx(wr,{}),r&&s!=="document"&&e.jsx(Ba,{onClose:()=>{i(null),o([]),c(0)},fallbackTitle:"Chunk Inspector Error",children:e.jsx(za,{chunk:r,document:{url:r.url||r.source},chunkIndex:d,totalChunks:l.length||1,onClose:()=>{i(null),o([]),c(0)},onNavigate:He})}),e.jsx(hl,{})]})})})}const At=()=>{const{currentView:s,showSettings:t,setShowSettings:a}=Y();return e.jsxs("div",{className:"w-full max-w-7xl mx-auto p-4 md:p-8",children:[e.jsx(ul,{}),e.jsxs("main",{className:"mt-8",children:[s==="dashboard"&&e.jsx(ur,{}),s==="document"&&e.jsx(Ir,{}),s==="search"&&e.jsx(br,{}),s==="processing"&&e.jsx(al,{}),s==="chat"&&e.jsx(ll,{})]})]})},ul=()=>{const{searchQuery:s,handleSearchQueryChange:t,setShowSettings:a,setCurrentView:n,systemStats:r,sse:i}=Y();return e.jsxs("header",{className:"text-center mb-8",children:[e.jsx("div",{className:"mb-6",children:e.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-2 flex items-center justify-center gap-3",children:e.jsx("button",{onClick:()=>n("dashboard"),className:"flex items-center gap-3 hover:opacity-80 transition-opacity cursor-pointer bg-transparent border-none",children:e.jsx("span",{className:"text-gradient",children:"AutoLlama.io"})})})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-4",children:[e.jsxs("div",{className:"relative w-full sm:w-80",children:[e.jsx(Ee,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search documents, chunks, topics...",value:s,onChange:l=>{t&&t(l.target.value)},className:"input-primary pl-10"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>n("chat"),className:"btn-primary",children:[e.jsx(Je,{className:"w-5 h-5"}),"AI Chat"]}),e.jsxs("button",{onClick:()=>n("processing"),className:"btn-secondary",children:[e.jsx(ae,{className:"w-5 h-5"}),"Process"]}),e.jsx("button",{onClick:()=>a(!0),className:"btn-secondary",title:"Settings",children:e.jsx(Ze,{className:"w-5 h-5"})})]})]})]})},hl=()=>(Y(),e.jsx("footer",{className:"text-center p-4 text-xs text-gray-500 relative z-10 border-t border-gray-800 mt-16",children:e.jsxs("div",{className:"flex flex-wrap justify-center items-center gap-4",children:[e.jsx("span",{children:"The Digital Pasture"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:"Version 2.3"})]})}));ss.createRoot(document.getElementById("root")).render(e.jsx(hs.StrictMode,{children:e.jsx(dl,{})}));export{e as j,Y as u};
