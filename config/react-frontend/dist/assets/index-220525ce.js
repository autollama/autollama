var ct=Object.defineProperty,it=Object.defineProperties;var lt=Object.getOwnPropertyDescriptors;var je=Object.getOwnPropertySymbols;var ut=Object.prototype.hasOwnProperty,dt=Object.prototype.propertyIsEnumerable;var Pe=(e,t,s)=>t in e?ct(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,w=(e,t)=>{for(var s in t||(t={}))ut.call(t,s)&&Pe(e,s,t[s]);if(je)for(var s of je(t))dt.call(t,s)&&Pe(e,s,t[s]);return e},M=(e,t)=>it(e,lt(t));var E=(e,t,s)=>new Promise((n,a)=>{var i=p=>{try{g(s.next(p))}catch(r){a(r)}},l=p=>{try{g(s.throw(p))}catch(r){a(r)}},g=p=>p.done?n(p.value):Promise.resolve(p.value).then(i,l);g((s=s.apply(e,t)).next())});import{r as o,a as ht,R as U,B as mt,b as gt,c as ie,N as pt}from"./vendor-146ef102.js";import{a as me}from"./utils-d9662bcb.js";import{S as ft,M as yt,F as St,a as bt}from"./icons-521df13f.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function s(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=s(a);fetch(a.href,i)}})();var Oe={exports:{}},ge={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ct=o,kt=Symbol.for("react.element"),wt=Symbol.for("react.fragment"),vt=Object.prototype.hasOwnProperty,xt=Ct.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Et={key:!0,ref:!0,__self:!0,__source:!0};function $e(e,t,s){var n,a={},i=null,l=null;s!==void 0&&(i=""+s),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(l=t.ref);for(n in t)vt.call(t,n)&&!Et.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)a[n]===void 0&&(a[n]=t[n]);return{$$typeof:kt,type:e,key:i,ref:l,props:a,_owner:xt.current}}ge.Fragment=wt;ge.jsx=$e;ge.jsxs=$e;Oe.exports=ge;var h=Oe.exports,Se={},Te=ht;Se.createRoot=Te.createRoot,Se.hydrateRoot=Te.hydrateRoot;const _t="modulepreload",At=function(e){return"/"+e},De={},te=function(t,s,n){if(!s||s.length===0)return t();const a=document.getElementsByTagName("link");return Promise.all(s.map(i=>{if(i=At(i),i in De)return;De[i]=!0;const l=i.endsWith(".css"),g=l?'[rel="stylesheet"]':"";if(!!n)for(let A=a.length-1;A>=0;A--){const T=a[A];if(T.href===i&&(!l||T.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${g}`))return;const r=document.createElement("link");if(r.rel=l?"stylesheet":_t,l||(r.as="script",r.crossOrigin=""),r.href=i,document.head.appendChild(r),l)return new Promise((A,T)=>{r.addEventListener("load",A),r.addEventListener("error",()=>T(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>t()).catch(i=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i})};class It{constructor(){this.storageKey="autollama-settings",this.defaultSettings={connections:{openaiApiKey:"",claudeApiKey:"",qdrantUrl:"",qdrantApiKey:"",databaseUrl:"",testConnections:!1},pipeline:{pipelineUrl:"http://autollama-on-hstgr:9099",apiKey:"0p3n-w3bu!",collectionName:"autollama-content",maxResults:5,similarityThreshold:.3,debugMode:!0},processing:{enableContextualEmbeddings:!0,contextualModel:"gpt-4o-mini",contextBatchSize:5,chunkSize:1200,chunkOverlap:200,processingTimeout:3e4,autoStartProcessing:!0},system:{theme:"dark",sseUpdateInterval:5e3,cacheTimeout:3e5,debugLogging:!0,showProcessingDetails:!0,autoRefreshDocuments:!0},search:{enableBM25:!0,enableSemantic:!0,hybridSearchWeight:.5,maxSearchResults:20,searchTimeout:1e4,enableSearchHistory:!0},ui:{documentsPerPage:50,chunksPerRow:10,showVectorHeatmaps:!0,showContextualSummaries:!0,animationsEnabled:!0,compactMode:!1,customFavicon:!1,faviconUploadTime:null}}}loadSettings(){try{const t=localStorage.getItem(this.storageKey);if(t){const s=JSON.parse(t);return this.mergeWithDefaults(s)}}catch(t){}return w({},this.defaultSettings)}loadSettingsFromDatabase(){return E(this,null,function*(){try{const t=yield fetch("/api/settings");if(t.ok){const s=yield t.json();if(s.success&&s.settings){const n=s.settings,a=w({},this.defaultSettings);return n.openai_api_key&&(a.connections.openaiApiKey=n.openai_api_key),n.claude_api_key&&(a.connections.claudeApiKey=n.claude_api_key),n.qdrant_url&&(a.connections.qdrantUrl=n.qdrant_url),n.qdrant_api_key&&(a.connections.qdrantApiKey=n.qdrant_api_key),n.database_url&&(a.connections.databaseUrl=n.database_url),a}}}catch(t){}return this.loadSettings()})}saveSettings(t){try{return localStorage.setItem(this.storageKey,JSON.stringify(t)),!0}catch(s){return!1}}saveConnectionsToDatabase(t){return E(this,null,function*(){try{const s={};t.openaiApiKey&&t.openaiApiKey.trim()&&(s.openai_api_key=t.openaiApiKey),t.claudeApiKey&&t.claudeApiKey.trim()&&(s.claude_api_key=t.claudeApiKey),t.qdrantUrl&&t.qdrantUrl.trim()&&(s.qdrant_url=t.qdrantUrl),t.qdrantApiKey&&t.qdrantApiKey.trim()&&(s.qdrant_api_key=t.qdrantApiKey),t.databaseUrl&&t.databaseUrl.trim()&&(s.database_url=t.databaseUrl);const n=yield fetch("/api/settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({settings:s})});if(n.ok){const a=yield n.json();return!0}else{const a=yield n.json();return!1}}catch(s){return!1}})}mergeWithDefaults(t){const s=w({},this.defaultSettings);return Object.keys(t).forEach(n=>{s[n]&&typeof s[n]=="object"?s[n]=w(w({},s[n]),t[n]):s[n]=t[n]}),s}getSetting(t,s){var a;return(a=this.loadSettings()[t])==null?void 0:a[s]}updateSetting(t,s,n){const a=this.loadSettings();return a[t]||(a[t]={}),a[t][s]=n,this.saveSettings(a)}updateCategory(t,s){const n=this.loadSettings();return n[t]=w(w({},n[t]),s),this.saveSettings(n)}resetSettings(){try{return localStorage.removeItem(this.storageKey),!0}catch(t){return!1}}exportSettings(){const t=this.loadSettings(),s=JSON.stringify(t,null,2),n=new Blob([s],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(n),a.download=`autollama-settings-${new Date().toISOString().split("T")[0]}.json`,a.click()}importSettings(t){return E(this,null,function*(){try{const s=yield t.text(),n=JSON.parse(s),a=this.mergeWithDefaults(n);return!!this.saveSettings(a)}catch(s){return!1}})}validateConnections(t=null){return E(this,null,function*(){var n,a;const s=t||this.loadSettings();try{const i=yield fetch("/api/settings/test-connections",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({connections:s.connections})});if(i.ok){const l=yield i.json();return{openai:((n=l.connections)==null?void 0:n.openai)||!1,qdrant:((a=l.connections)==null?void 0:a.qdrant)||!1}}else return{openai:!1,qdrant:!1}}catch(i){return{openai:!1,qdrant:!1}}})}}const Z=new It,Rt=()=>{const[e,t]=o.useState(Z.loadSettings()),[s,n]=o.useState(!1),[a,i]=o.useState({openai:!1,qdrant:!1}),l=o.useCallback(()=>{t(Z.loadSettings())},[]),g=o.useCallback((R,S,v)=>{const P=Z.updateSetting(R,S,v);return P&&l(),P},[l]),p=o.useCallback((R,S)=>{const v=Z.updateCategory(R,S);return v&&l(),v},[l]),r=o.useCallback(()=>{const R=Z.resetSettings();return R&&l(),R},[l]),A=o.useCallback(()=>E(void 0,null,function*(){n(!0);try{const R=yield Z.validateConnections(e);return i(R),R}catch(R){return null}finally{n(!1)}}),[e]),T=o.useCallback(()=>{Z.exportSettings()},[]),O=o.useCallback(R=>E(void 0,null,function*(){n(!0);try{const S=yield Z.importSettings(R);return S&&l(),S}catch(S){return!1}finally{n(!1)}}),[l]);return o.useEffect(()=>{(typeof window=="undefined"||window.location.hostname==="localhost")&&A()},[A]),o.useEffect(()=>{const R=setInterval(()=>{(typeof window=="undefined"||window.location.hostname==="localhost")&&A()},3e5);return()=>clearInterval(R)},[A]),{settings:e,isLoading:s,connectionStatus:a,updateSetting:g,updateCategory:p,resetSettings:r,testConnections:A,exportSettings:T,importSettings:O,reloadSettings:l}};class jt{constructor(t=5*60*1e3){this.cache=new Map,this.defaultTTL=t,this.stats={hits:0,misses:0,sets:0,deletes:0}}generateKey(t,s={}){const n=JSON.stringify(s,Object.keys(s).sort());return`${t}:${n}`}get(t){const s=this.cache.get(t);return s?Date.now()>s.expiresAt?(this.cache.delete(t),this.stats.misses++,null):(this.stats.hits++,s.data):(this.stats.misses++,null)}set(t,s,n=null){const a=n===0?0:n!==null?n:this.defaultTTL,i=Date.now()+a;this.cache.set(t,{data:s,expiresAt:i,createdAt:Date.now()}),this.stats.sets++}delete(t){const s=this.cache.delete(t);return s&&this.stats.deletes++,s}clear(){const t=this.cache.size;this.cache.clear(),this.stats.deletes+=t}cleanup(){const t=Date.now();let s=0;for(const[n,a]of this.cache.entries())t>a.expiresAt&&(this.cache.delete(n),s++);return this.stats.deletes+=s,s}getStats(){return M(w({},this.stats),{size:this.cache.size,hitRate:this.stats.hits/(this.stats.hits+this.stats.misses)||0})}has(t){const s=this.cache.get(t);return s&&Date.now()<=s.expiresAt}}const J=new jt;setInterval(()=>{J.cleanup()},5*60*1e3);const _={realtime:2*1e3,documents:0,stats:0,settings:30*1e3,systemInfo:30*1e3,schemas:60*1e3},Pt=(e,t,s=null)=>E(void 0,null,function*(){const n=J.get(e);if(n)return n;try{const a=yield t();return J.set(e,a,s),a}catch(a){throw a}}),le={documents:()=>{Array.from(J.cache.keys()).forEach(t=>{(t.includes("documents")||t.includes("chunks")||t.includes("search"))&&J.delete(t)})},stats:()=>{Array.from(J.cache.keys()).forEach(t=>{(t.includes("stats")||t.includes("health"))&&J.delete(t)})},processing:()=>{Array.from(J.cache.keys()).forEach(t=>{(t.includes("in-progress")||t.includes("recent")||t.includes("queue"))&&J.delete(t)})},all:()=>J.clear()},Tt={LOW:"low",MEDIUM:"medium",HIGH:"high"},Y={API:"api",NETWORK:"network",VALIDATION:"validation",AUTHENTICATION:"authentication",PERMISSION:"permission",PROCESSING:"processing",UI:"ui",UNKNOWN:"unknown"};class Dt{constructor(){this.errorLog=[],this.maxLogSize=50,this.errorCallbacks=new Set}handle(t,s={}){try{const n=this.createSafeError(t,s);return this.safeLog(n),this.safeNotify(n),this.safeConsoleLog(n),n}catch(n){return{id:"emergency-"+Date.now(),message:"Error handling failed",severity:"medium",category:"unknown",timestamp:new Date().toISOString()}}}createSafeError(t,s){const n={id:"error-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),message:"Unknown error",severity:"medium",category:"unknown",timestamp:new Date().toISOString(),retryable:!1};try{t&&typeof t=="object"&&t.message?n.message=String(t.message):t&&typeof t=="string"&&(n.message=t)}catch(a){}try{s&&s.severity&&typeof s.severity=="string"&&(n.severity=s.severity)}catch(a){}try{s&&s.category&&typeof s.category=="string"&&(n.category=s.category)}catch(a){}return n}safeLog(t){try{t&&typeof t=="object"&&t.id&&(this.errorLog.unshift(t),this.errorLog.length>this.maxLogSize&&(this.errorLog=this.errorLog.slice(0,this.maxLogSize)))}catch(s){}}safeNotify(t){try{this.errorCallbacks.forEach(s=>{try{typeof s=="function"&&s(t)}catch(n){}})}catch(s){}}safeConsoleLog(t){try{if(!t||typeof t!="object")return;const s=t.message||"Unknown error",n=t.severity||"medium"}catch(s){}}onError(t){try{if(typeof t=="function")return this.errorCallbacks.add(t),()=>{try{this.errorCallbacks.delete(t)}catch(s){}}}catch(s){}return()=>{}}getStats(){try{const t={total:0,last24h:0,byCategory:{},bySeverity:{}};if(Array.isArray(this.errorLog)){t.total=this.errorLog.length;let s=0;for(let n=0;n<this.errorLog.length;n++)try{const a=this.errorLog[n];if(a&&typeof a=="object"){s++;const i=a.category||"unknown";t.byCategory[i]=(t.byCategory[i]||0)+1;const l=a.severity||"medium";t.bySeverity[l]=(t.bySeverity[l]||0)+1}}catch(a){}t.last24h=s}return t}catch(t){return{total:0,last24h:0,byCategory:{},bySeverity:{}}}}clearErrors(){try{this.errorLog=[]}catch(t){this.errorLog=[]}}}const ue=new Dt,Mt=(e,t={})=>ue.handle(e,M(w({},t),{category:Y.API})),se=Mt,Ot=e=>{try{if(!e||typeof e!="object")return"An unexpected error occurred. Please try again.";switch(e.category||"unknown"){case Y.NETWORK:return"Connection error. Please check your internet connection and try again.";case Y.API:return"Server error. Please try again in a moment.";case Y.VALIDATION:return"Please check your input and try again.";case Y.PROCESSING:return"Processing error. Please try again.";default:return"An unexpected error occurred. Please try again."}}catch(t){return"An error occurred. Please try again."}},$t=(s,...n)=>E(void 0,[s,...n],function*(e,t={}){const{maxAttempts:a=3,delay:i=1e3}=t;for(let l=1;l<=a;l++)try{return yield e()}catch(g){if(l===a)throw ue.handle(g,{action:"RetryFailed",attempts:l,category:Y.API}),g;i>0&&(yield new Promise(p=>setTimeout(p,i*l)))}});class Nt{constructor(){this.metrics=new Map,this.thresholds={api:2e3,render:100,navigation:1e3},this.isRecording=!0}startTimer(t,s="general"){if(!this.isRecording)return;const n=`${s}:${t}`;this.metrics.set(n,{name:t,category:s,startTime:performance.now(),startMark:`${n}-start`}),typeof performance.mark=="function"&&performance.mark(`${n}-start`)}endTimer(t,s="general",n={}){if(!this.isRecording)return null;const a=`${s}:${t}`,i=this.metrics.get(a);if(!i)return null;const g=performance.now()-i.startTime,p=`${a}-end`;typeof performance.mark=="function"&&(performance.mark(p),typeof performance.measure=="function"&&performance.measure(a,i.startMark,p));const r={name:i.name,category:i.category,duration:g,timestamp:new Date().toISOString(),metadata:n,threshold:this.thresholds[s]||this.thresholds.general,isSlowOperation:g>(this.thresholds[s]||1e3)};return r.isSlowOperation,this.metrics.delete(a),r}timeFunction(i,l){return E(this,arguments,function*(t,s,n="function",a={}){this.startTimer(s,n);try{const g=yield t();return this.endTimer(s,n,a),g}catch(g){throw this.endTimer(s,n,M(w({},a),{error:g.message})),g}})}timeApiCall(a,i){return E(this,arguments,function*(t,s,n={}){return this.timeFunction(t,s,"api",w({endpoint:s},n))})}getStats(){const t=performance.getEntriesByType("measure"),s={total:t.length,byCategory:{},slowOperations:0,averageDuration:0};let n=0;return t.forEach(a=>{const[i]=a.name.split(":");s.byCategory[i]||(s.byCategory[i]={count:0,totalDuration:0,averageDuration:0,slowCount:0});const l=s.byCategory[i];l.count++,l.totalDuration+=a.duration,a.duration>(this.thresholds[i]||1e3)&&(l.slowCount++,s.slowOperations++),n+=a.duration}),s.averageDuration=t.length>0?n/t.length:0,Object.values(s.byCategory).forEach(a=>{a.averageDuration=a.count>0?a.totalDuration/a.count:0}),s}clearData(){typeof performance.clearMarks=="function"&&performance.clearMarks(),typeof performance.clearMeasures=="function"&&performance.clearMeasures(),this.metrics.clear()}setRecording(t){this.isRecording=t}}const re=new Nt,b=me.create({baseURL:"/api",timeout:3e4,headers:{"Content-Type":"application/json"}}),ee=me.create({baseURL:"/bm25",timeout:1e4,headers:{"Content-Type":"application/json"}});b.interceptors.request.use(e=>{var t;return e.metadata={startTime:performance.now(),endpoint:`${(t=e.method)==null?void 0:t.toUpperCase()} ${e.url}`},e},e=>(se(e,{action:"RequestInterceptor"}),Promise.reject(e)));b.interceptors.response.use(e=>{if(e.config.metadata){const t=performance.now()-e.config.metadata.startTime;re.endTimer(e.config.metadata.endpoint,"api",{status:e.status,duration:t})}return e},e=>{var t,s,n,a,i;if((t=e.config)!=null&&t.metadata){const l=performance.now()-e.config.metadata.startTime;re.endTimer(e.config.metadata.endpoint,"api",{status:((s=e.response)==null?void 0:s.status)||"error",duration:l,error:!0})}return se(e,{action:"ResponseInterceptor",endpoint:(n=e.config)==null?void 0:n.url,method:(a=e.config)==null?void 0:a.method}),((i=e.response)==null?void 0:i.status)>=500&&le.all(),Promise.reject(e)});ee.interceptors.request.use(e=>e,e=>Promise.reject(e));ee.interceptors.response.use(e=>e,e=>Promise.reject(e));const I={getDocuments:(e={})=>b.get("/documents",{params:e}),getDocumentChunks:(e,t={})=>b.get("/document-chunks",{params:w({url:atob(e)},t)}),getChunkByIndex:(e,t)=>E(void 0,null,function*(){const s=atob(e);try{const n=yield b.get("/document-chunks",{params:{url:s,limit:2e3}});if(n.data.chunks&&n.data.chunks.length>0){const a=n.data.chunks,i=a.map(A=>A.chunkIndex!==void 0?A.chunkIndex:-1),l=[...new Set(i)],g=l.length>1||l.length===1&&l[0]>0;let p=null;if(g?p=a.find(A=>A.chunkIndex===t):t>=0&&t<a.length&&(p=a[t]),p)return{chunk:p};const r=g?`Chunk with index ${t} not found. Available range: ${Math.min(...i)} to ${Math.max(...i)}`:`Array position ${t} out of bounds. Document has ${a.length} chunks (0-${a.length-1})`;throw new Error(r)}throw new Error("No chunks returned from API")}catch(n){throw n}}),getDocumentSummary:e=>b.get(`/document/${e}/summary`),processUrl:e=>b.post("/process-url",e),processUrlStream:e=>b.post("/process-url-stream",e),processFile:e=>b.post("/process-file",e,{headers:{"Content-Type":"multipart/form-data"}}),processFileStream:e=>b.post("/process-file-stream",e,{headers:{"Content-Type":"multipart/form-data"}}),search:e=>b.get("/search",{params:e}),searchGrouped:e=>b.get("/search/grouped",{params:e}),getKnowledgeBaseStats:()=>b.get("/knowledge-base/stats"),getDatabaseStats:()=>b.get("/database/stats"),getHealth:()=>me.get("/health"),getPipelineHealth:()=>b.get("/pipeline/health"),getQdrantActivity:()=>b.get("/qdrant/activity"),getRecentRecords:(e={})=>b.get("/documents",{params:e}),getInProgress:()=>b.get("/in-progress"),getCompletedUploads:(e={})=>b.get("/in-progress",{params:e}),stopProcessing:e=>b.post(`/stop-processing/${e}`),cancelJob:e=>b.post(`/cancel-job/${e}`),getChunks:(e={})=>b.get("/chunks",{params:e}),getChunkingSettings:()=>b.get("/chunking-settings"),updateChunkingSettings:e=>b.put("/chunking-settings",e),getRagSettings:()=>b.get("/settings/rag"),updateRagSettings:e=>b.put("/settings/rag",e),getCleanupStatus:()=>b.get("/cleanup-status"),checkStuckSessions:()=>b.get("/upload-sessions/check-stuck"),cleanupSessions:(e={})=>b.post("/cleanup-sessions",e),advancedCleanup:(e={})=>b.post("/cleanup-sessions/advanced",e),cleanupStuckSessions:(e={})=>b.post("/upload-sessions/cleanup-stuck",e),getAdminSessionStats:()=>b.get("/admin/session-stats"),getSystemHealth:()=>b.get("/system/status")},Q={sendMessage:e=>b.post("/chat/message",e),getConversation:e=>b.get(`/chat/conversation/${e}`),getConversations:(e={})=>b.get("/chat/conversations",{params:e}),deleteConversation:e=>b.delete(`/chat/conversation/${e}`),getStats:()=>b.get("/chat/stats"),searchRAG:(e,t={})=>b.post("/chat/rag-search",w({query:e},t)),pipelineQuery:e=>b.post("/chat/pipeline",e),getPipelineStatus:()=>b.get("/chat/pipeline/status")},W={search:(e,t,s=10)=>ee.post(`/search/${e}`,{query:t,filename:e,top_k:s}),createIndex:(e,t,s=!0)=>ee.post(`/index/${e}`,{chunks:t,filename:e,replace_existing:s}),getStats:()=>ee.get("/stats"),deleteIndex:e=>ee.delete(`/index/${e}`),getHealth:()=>ee.get("/health")},Ne=(e,t,s=null)=>{const n=e.startsWith("/")?e:`/api/${e}`,a=performance.now();try{const i=new EventSource(n,{withCredentials:!1});return i.onmessage=l=>{try{const g=JSON.parse(l.data);if(g.type==="ping")return;t(g)}catch(g){const p=se(g,{action:"SSE_Parse",endpoint:n});t({type:"error",message:"Failed to parse SSE data",errorId:p.id,severity:"medium",category:"sse_parse",timestamp:new Date().toISOString()})}},i.onerror=l=>{const g=se(l,{action:"SSE_Connection",endpoint:n,readyState:i.readyState});s&&s(l,g)},i.onopen=()=>{const l=performance.now()-a;re.endTimer(`SSE_${e}`,"sse",{endpoint:n,connectionTime:l})},re.startTimer(`SSE_${e}`,"sse"),i}catch(i){throw se(i,{action:"SSE_Create",endpoint:n}),i}},Le=(e,t,s=null)=>(...n)=>{const a=`${e}:${JSON.stringify(n)}`;return Pt(a,()=>t(...n),s)},Ue=(e,t=3)=>(...s)=>E(void 0,null,function*(){return $t(()=>e(...s),{maxAttempts:t})}),qe=(e,t)=>(...s)=>E(void 0,null,function*(){return re.timeApiCall(()=>t(...s),e,{args:s.length})}),Be=(e,t,s={})=>{const{useCache:n=!0,ttl:a=null,useRetry:i=!0,maxAttempts:l=3,useMonitoring:g=!0}=s;let p=t;return g&&(p=qe(e,p)),i&&(p=Ue(p,l)),n&&(p=Le(e,p,a)),p},ae={invalidateCache:{documents:()=>le.documents(),stats:()=>le.stats(),processing:()=>le.processing(),all:()=>le.all()},batchApiCalls:e=>E(void 0,null,function*(){const t=performance.now();try{const s=yield Promise.all(e.map(a=>a())),n=performance.now()-t;return s}catch(s){throw se(s,{action:"BatchApiCalls",callCount:e.length}),s}}),sequentialApiCalls:(e,t=100)=>E(void 0,null,function*(){const s=[];for(let n=0;n<e.length;n++)try{const a=yield e[n]();s.push(a),n<e.length-1&&t>0&&(yield new Promise(i=>setTimeout(i,t)))}catch(a){throw se(a,{action:"SequentialApiCall",callIndex:n,totalCalls:e.length}),a}return s}),checkHealth:()=>E(void 0,null,function*(){try{return{status:"healthy",response:(yield me.get("/health",{timeout:5e3})).data,timestamp:new Date().toISOString()}}catch(e){return{status:"unhealthy",error:e.message,timestamp:new Date().toISOString()}}}),getApiStats:()=>({performance:re.getStats(),errors:ue.getStats(),cache:{}})},ns=Object.freeze(Object.defineProperty({__proto__:null,api:b,apiEndpoints:I,apiUtils:ae,bm25Api:ee,bm25Endpoints:W,chatEndpoints:Q,createCachedApiCall:Le,createEnhancedApiCall:Be,createMonitoredApiCall:qe,createRetryableApiCall:Ue,createSSEConnection:Ne},Symbol.toStringTag,{value:"Module"})),Lt=(e,t={})=>{const[s,n]=o.useState(null),[a,i]=o.useState(!1),[l,g]=o.useState(null),[p,r]=o.useState([]),A=o.useRef(null),T=o.useRef(new Set),{autoConnect:O=!0,maxHistorySize:R=10,onMessage:S=null,onError:v=null,onConnect:P=null,onDisconnect:$=null}=t,q=o.useCallback((k,z)=>{const V=setTimeout(()=>{T.current.delete(V),k()},z);return T.current.add(V),V},[]),G=o.useCallback(k=>{n(k),g(null),r(z=>[...z,M(w({},k),{timestamp:new Date})].slice(-R)),S&&S(k)},[S,R]),L=o.useCallback(k=>{g(k),i(!1),v&&v(k),$&&$()},[v,$]),d=o.useCallback(()=>{A.current&&A.current.close();try{return A.current=Ne(e,G,L),A.current.onopen=()=>{i(!0),g(null),P&&P()},!0}catch(k){return g(k),!1}},[e,G,L,P]),C=o.useCallback(()=>{A.current&&(A.current.close(),A.current=null,i(!1),$&&$())},[$]),x=o.useCallback((k=1)=>{if(k>3)return!1;const H=1e3*Math.pow(2,k-1);return q(()=>{d()||x(k+1)},H),!0},[d,q]),B=o.useCallback(()=>{r([])},[]);return o.useEffect(()=>(O&&e&&d(),()=>{C(),T.current.forEach(k=>{clearTimeout(k)}),T.current.clear()}),[e,O,d,C]),o.useEffect(()=>{if(l&&a===!1&&O&&e){const k=q(()=>{x()},2e3);return()=>{T.current.delete(k),clearTimeout(k)}}},[l,a,O,x,e,q]),{data:s,isConnected:a,error:l,messageHistory:p,connect:d,disconnect:C,reconnect:x,clearHistory:B}},Ut=(e="Unknown")=>{const[t,s]=o.useState([]),[n,a]=o.useState(!1),i=o.useRef(null);o.useEffect(()=>(i.current=ue.onError(S=>{(S.context.component===e||S.context.component==="Global")&&(s(v=>[S,...v.slice(0,9)]),a(!0))}),()=>{i.current&&i.current()}),[e]);const l=o.useCallback((S,v={})=>ue.handle(S,w({component:e},v)),[e]),g=o.useCallback((S,v="API Call")=>l(S,{action:v,category:Y.API}),[l]),p=o.useCallback((S,v="Unknown")=>l(S,{action:`Validation: ${v}`,category:Y.VALIDATION,severity:Tt.MEDIUM}),[l]),r=o.useCallback((S,v="Processing")=>l(S,{action:v,category:Y.PROCESSING}),[l]),A=o.useCallback(()=>{s([]),a(!1)},[]),T=o.useCallback(S=>{s(v=>v.filter(P=>P.id!==S)),a(v=>t.length>1)},[t.length]),O=o.useCallback(()=>t.filter(S=>!(!S||typeof S!="object"||!S.id)).map(S=>{try{const v={id:String(S.id||"unknown"),message:String(S.message||"Unknown error occurred"),severity:String(S.severity||"medium"),timestamp:String(S.timestamp||new Date().toISOString()),retryable:!!S.retryable};try{const P=Ot(S);P&&typeof P=="string"&&(v.message=P)}catch(P){}return v}catch(v){return{id:"error-processing-"+Date.now(),message:"Error processing error message",severity:"medium",timestamp:new Date().toISOString(),retryable:!1}}}),[t]),R={hasError:n,errorCount:t.length,latestError:t[0]||null,errors:t,messages:O()};return M(w({},R),{handleError:l,handleApiError:g,handleValidationError:p,handleProcessingError:r,clearErrors:A,clearError:T})},qt=()=>{const[e,t]=o.useState({totalCalls:0,averageResponseTime:0,slowCalls:0,errorRate:0,recentCalls:[]}),s=o.useCallback((n,a)=>E(void 0,null,function*(){const i=performance.now();let l=!0,g=null;try{return yield n()}catch(p){throw l=!1,g=p.message,p}finally{const p=performance.now()-i;t(r=>{const T=[{endpoint:a,duration:Math.round(p),success:l,error:g,timestamp:new Date().toISOString()},...r.recentCalls.slice(0,19)],O=r.totalCalls+1,R=r.slowCalls+(p>2e3?1:0),S=T.filter(v=>!v.success).length;return{totalCalls:O,averageResponseTime:Math.round(T.reduce((v,P)=>v+P.duration,0)/T.length),slowCalls:R,errorRate:Math.round(S/T.length*100),recentCalls:T}})}}),[]);return{metrics:e,timeApiCall:s}},Ce=e=>e?{id:e.id||e.chunk_id||ke(),title:e.title||e.url||"Untitled Document",url:e.url||"",contentType:e.content_type||e.contentType||"document",processedAt:e.processed_at||e.processedAt||e.created_time||e.created_at,chunkCount:e.chunk_count||e.chunkCount||0,status:e.status||e.embedding_status||"completed",processingStatus:e.processing_status||e.embedding_status||"completed",sentiment:e.sentiment||"neutral",technicalLevel:e.technical_level||e.technicalLevel||"intermediate",summary:e.summary||"",mainTopics:e.main_topics||e.mainTopics||[],keyEntities:e.key_entities||e.keyEntities||{},usesContextualEmbedding:e.uses_contextual_embedding||e.usesContextualEmbedding||!1,uploadSource:e.upload_source||e.uploadSource||"user"}:null,be=e=>e?{id:e.chunk_id||e.id||ke(),index:e.chunk_index!==void 0?e.chunk_index:e.index!==void 0?e.index:0,text:e.chunkText||e.chunk_text||e.text||"",url:e.url||"",title:e.title||"Untitled",status:e.processing_status||e.status||"completed",sentiment:e.sentiment||"neutral",technicalLevel:e.technical_level||e.technicalLevel||"intermediate",contentType:e.content_type||e.contentType||"text",mainTopics:e.main_topics||e.mainTopics||[],keyEntities:e.key_entities||e.keyEntities||{},contextualSummary:e.contextual_summary||e.contextualSummary||null,usesContextualEmbedding:e.uses_contextual_embedding||e.usesContextualEmbedding||!1,embedding:e.embedding||null,people:e.people||[],organizations:e.organizations||[],locations:e.locations||[],emotions:e.emotions||[],keyConcepts:e.key_concepts||e.keyConcepts||[]}:null,Me=e=>!e||!Array.isArray(e)?[]:e.map(t=>({id:t.id||ke(),score:t.score||0,document:Ce(t.document||t),chunk:t.chunk?be(t.chunk):null,highlight:t.highlight||"",type:t.type||"document"})),ke=()=>Math.random().toString(36).substr(2,9),He=()=>{const[e,t]=o.useState(!1),[s,n]=o.useState(null),a=o.useRef(null),{handleApiError:i,clearErrors:l}=Ut("useAPI"),{timeApiCall:g,metrics:p}=qt(),r=o.useCallback((k,z,...V)=>E(void 0,[k,z,...V],function*(d,C,x={},...B){t(!0),n(null),l(),a.current&&a.current.abort(),a.current=new AbortController;try{const H=Be(C,d,{useCache:x.useCache!==!1,ttl:x.ttl||_.documents,useRetry:x.useRetry!==!1,maxAttempts:x.maxAttempts||3,useMonitoring:x.useMonitoring!==!1}),N=yield g(()=>H(...B),C);return(N==null?void 0:N.data)||N}catch(H){if(H.name==="AbortError")return null;const N=i(H,C);throw n(N),H}finally{t(!1),a.current=null}}),[i,l,g]),A={getAll:o.useCallback(d=>E(void 0,null,function*(){const C=yield r(I.getDocuments,"documents",{ttl:_.documents},d);return{documents:(Array.isArray(C)?C:(C==null?void 0:C.documents)||[]).map(Ce)||[]}}),[r]),getChunks:o.useCallback((d,C)=>E(void 0,null,function*(){var B;const x=yield r(I.getDocumentChunks,`document-chunks-${d}`,{ttl:_.documents},d,C);return M(w({},x),{chunks:((B=x==null?void 0:x.chunks)==null?void 0:B.map(be))||[]})}),[r]),getSummary:o.useCallback(d=>r(I.getDocumentSummary,`document-summary-${d}`,{ttl:_.documents},d),[r])},T={processUrl:o.useCallback(d=>r(I.processUrl,"process-url",{useCache:!1},d),[r]),processUrlStream:o.useCallback(d=>r(I.processUrlStream,"process-url-stream",{useCache:!1},d),[r]),processFile:o.useCallback(d=>r(I.processFile,"process-file",{useCache:!1},d),[r]),processFileStream:o.useCallback(d=>r(I.processFileStream,"process-file-stream",{useCache:!1},d),[r]),getQueue:o.useCallback(()=>r(I.getInProgress,"processing-queue",{ttl:_.realtime}),[r]),stopProcessing:o.useCallback(d=>r(I.stopProcessing,"stop-processing",{useCache:!1},d),[r]),cancelJob:o.useCallback(d=>r(I.cancelJob,"cancel-job",{useCache:!1},d),[r]),getStats:o.useCallback(()=>r(I.getCompletedUploads,"processing-stats",{ttl:_.stats}),[r])},O={search:o.useCallback(d=>E(void 0,null,function*(){const C=yield r(I.search,"search",{ttl:_.documents},d);return Me(C)}),[r]),searchGrouped:o.useCallback(d=>E(void 0,null,function*(){const C=yield r(I.searchGrouped,"search-grouped",{ttl:_.documents},d);return Me(C)}),[r]),bm25Search:o.useCallback((d,C,x)=>r(W.search,`bm25-${d}`,{ttl:_.documents},d,C,x),[r])},R={getKnowledgeBase:o.useCallback(()=>E(void 0,null,function*(){const d=yield r(I.getKnowledgeBaseStats,"kb-stats",{ttl:_.stats});return(d==null?void 0:d.stats)||d}),[r]),getDatabase:o.useCallback(()=>E(void 0,null,function*(){const d=yield r(I.getDatabaseStats,"db-stats",{ttl:_.stats});return(d==null?void 0:d.stats)||d}),[r]),getHealth:o.useCallback(()=>r(I.getHealth,"health",{ttl:_.realtime}),[r]),getPipelineHealth:o.useCallback(()=>r(I.getPipelineHealth,"pipeline-health",{ttl:_.realtime}),[r]),getQdrantActivity:o.useCallback(()=>r(I.getQdrantActivity,"qdrant-activity",{ttl:_.realtime}),[r]),getBM25Stats:o.useCallback(()=>r(W.getStats,"bm25-stats",{ttl:_.stats}),[r]),getBM25Health:o.useCallback(()=>r(W.getHealth,"bm25-health",{ttl:_.realtime}),[r])},S={getRecentRecords:o.useCallback(d=>r(I.getRecentRecords,"recent-records",{ttl:_.realtime},d),[r]),getInProgress:o.useCallback(()=>r(I.getInProgress,"in-progress",{ttl:_.realtime}),[r]),getCompletedUploads:o.useCallback(d=>r(I.getCompletedUploads,"completed-uploads",{ttl:_.stats},d),[r]),getChunks:o.useCallback(d=>E(void 0,null,function*(){const C=yield r(I.getChunks,"chunks",{ttl:_.documents},d);return(C==null?void 0:C.map(be))||[]}),[r])},v={createIndex:o.useCallback((d,C,x)=>r(W.createIndex,`bm25-create-${d}`,{useCache:!1},d,C,x),[r]),deleteIndex:o.useCallback(d=>r(W.deleteIndex,`bm25-delete-${d}`,{useCache:!1},d),[r]),search:o.useCallback((d,C,x)=>r(W.search,`bm25-search-${d}`,{ttl:_.documents},d,C,x),[r]),getStats:o.useCallback(()=>r(W.getStats,"bm25-stats",{ttl:_.stats}),[r]),getHealth:o.useCallback(()=>r(W.getHealth,"bm25-health",{ttl:_.realtime}),[r])},P={sendMessage:o.useCallback(d=>r(Q.sendMessage,"chat-message",{useCache:!1},d),[r]),getConversation:o.useCallback(d=>r(Q.getConversation,`conversation-${d}`,{ttl:_.documents},d),[r]),getConversations:o.useCallback(d=>r(Q.getConversations,"conversations",{ttl:_.stats},d),[r]),deleteConversation:o.useCallback(d=>r(Q.deleteConversation,`delete-conversation-${d}`,{useCache:!1},d),[r]),getStats:o.useCallback(()=>r(Q.getStats,"chat-stats",{ttl:_.stats}),[r]),searchRAG:o.useCallback((d,C)=>r(Q.searchRAG,"rag-search",{ttl:_.documents},d,C),[r]),pipelineQuery:o.useCallback(d=>r(Q.pipelineQuery,"pipeline-query",{useCache:!1},d),[r]),getPipelineStatus:o.useCallback(()=>r(Q.getPipelineStatus,"pipeline-status",{ttl:_.realtime}),[r])},$=o.useCallback(()=>{a.current&&a.current.abort()},[]),q={getChunkingSettings:o.useCallback(()=>r(I.getChunkingSettings,"chunking-settings",{ttl:_.stats}),[r]),updateChunkingSettings:o.useCallback(d=>r(I.updateChunkingSettings,"update-chunking-settings",{useCache:!1},d),[r])},G={getCleanupStatus:o.useCallback(()=>r(I.getCleanupStatus,"cleanup-status",{ttl:_.realtime}),[r]),checkStuckSessions:o.useCallback(()=>r(I.checkStuckSessions,"stuck-sessions",{ttl:_.realtime}),[r]),cleanupSessions:o.useCallback(d=>r(I.cleanupSessions,"cleanup-sessions",{useCache:!1},d),[r]),advancedCleanup:o.useCallback(d=>r(I.advancedCleanup,"advanced-cleanup",{useCache:!1},d),[r]),cleanupStuckSessions:o.useCallback(d=>r(I.cleanupStuckSessions,"cleanup-stuck-sessions",{useCache:!1},d),[r]),getSessionStats:o.useCallback(()=>r(I.getAdminSessionStats,"admin-session-stats",{ttl:_.realtime}),[r]),getSystemHealth:o.useCallback(()=>r(I.getSystemHealth,"admin-system-health",{ttl:_.realtime}),[r])},L={invalidateCache:ae.invalidateCache,batchApiCalls:ae.batchApiCalls,sequentialApiCalls:ae.sequentialApiCalls,checkHealth:ae.checkHealth,getApiStats:ae.getApiStats};return{loading:e,error:s,performanceMetrics:p,documents:A,processing:T,search:O,stats:R,data:S,bm25:v,chat:P,settings:q,admin:G,utils:L,cancelRequest:$,clearError:l}},as=()=>{const[e,t]=o.useState({bm25:[],semantic:[],combined:[]}),[s,n]=o.useState(!1),[a,i]=o.useState(null),l=He(),g=o.useCallback((A,...T)=>E(void 0,[A,...T],function*(p,r={}){var q,G;const{filename:O="default",maxResults:R=10,bm25Weight:S=.5,semanticWeight:v=.5,enableBM25:P=!0,enableSemantic:$=!0}=r;n(!0),i(null);try{const L=[];P&&L.push(l.bm25.search(O,p,R).then(k=>({type:"bm25",data:(k==null?void 0:k.results)||[]})).catch(k=>({type:"bm25",data:[],error:M(w({},k),{severity:"medium",category:"search"})}))),$&&L.push(l.search.search({q:p,limit:R,type:"semantic"}).then(k=>({type:"semantic",data:(k==null?void 0:k.results)||[]})).catch(k=>({type:"semantic",data:[],error:M(w({},k),{severity:"medium",category:"search"})})));const d=yield Promise.all(L),C=((q=d.find(k=>k.type==="bm25"))==null?void 0:q.data)||[],x=((G=d.find(k=>k.type==="semantic"))==null?void 0:G.data)||[],B=Bt(C,x,S,v);return t({bm25:C,semantic:x,combined:B.slice(0,R)}),{bm25:C,semantic:x,combined:B.slice(0,R)}}catch(L){throw i(L.message),L}finally{n(!1)}}),[l]);return{results:e,loading:s,error:a,hybridSearch:g}},Bt=(e,t,s,n)=>{const a=new Map;return e.forEach((i,l)=>{const g=i.chunk_id||i.id;a.set(g,M(w({},i),{bm25Score:i.score||0,bm25Rank:l+1,semanticScore:0,semanticRank:null,combinedScore:(i.score||0)*s,source:"bm25"}))}),t.forEach((i,l)=>{const g=i.chunk_id||i.id;if(a.has(g)){const p=a.get(g);p.semanticScore=i.score||0,p.semanticRank=l+1,p.combinedScore=p.bm25Score*s+(i.score||0)*n,p.source="hybrid"}else a.set(g,M(w({},i),{bm25Score:0,bm25Rank:null,semanticScore:i.score||0,semanticRank:l+1,combinedScore:(i.score||0)*n,source:"semantic"}))}),Array.from(a.values()).sort((i,l)=>l.combinedScore-i.combinedScore)},Ht=U.lazy(()=>te(()=>import("./index-41762d79.js"),["assets/index-41762d79.js","assets/vendor-146ef102.js","assets/icons-521df13f.js","assets/utils-d9662bcb.js"])),Ft=U.lazy(()=>te(()=>import("./index-8003e28a.js"),["assets/index-8003e28a.js","assets/vendor-146ef102.js","assets/icons-521df13f.js","assets/utils-d9662bcb.js"])),Kt=U.lazy(()=>te(()=>import("./index-caee326d.js"),["assets/index-caee326d.js","assets/vendor-146ef102.js","assets/icons-521df13f.js","assets/utils-d9662bcb.js"]).then(e=>({default:e.SettingsModal}))),zt=U.lazy(()=>te(()=>import("./index-9abcf17e.js"),["assets/index-9abcf17e.js","assets/vendor-146ef102.js","assets/ChunkInspector-a70ce0cb.js","assets/icons-521df13f.js","assets/ErrorBoundary-07f84f3a.js","assets/utils-d9662bcb.js"]).then(e=>({default:e.DocumentViewer}))),Vt=U.lazy(()=>te(()=>import("./index-45e1de8e.js"),["assets/index-45e1de8e.js","assets/vendor-146ef102.js","assets/icons-521df13f.js","assets/utils-d9662bcb.js"])),Jt=U.lazy(()=>te(()=>import("./index-510e92dd.js"),["assets/index-510e92dd.js","assets/vendor-146ef102.js","assets/icons-521df13f.js","assets/utils-d9662bcb.js"])),Gt=U.lazy(()=>te(()=>import("./ChunkInspector-a70ce0cb.js").then(e=>e.a),["assets/ChunkInspector-a70ce0cb.js","assets/vendor-146ef102.js","assets/icons-521df13f.js"])),Qt=U.lazy(()=>te(()=>import("./ErrorBoundary-07f84f3a.js"),["assets/ErrorBoundary-07f84f3a.js","assets/vendor-146ef102.js","assets/icons-521df13f.js","assets/utils-d9662bcb.js"])),Fe=o.createContext(),we=()=>{const e=o.useContext(Fe);if(!e)throw new Error("useAppContext must be used within AppProvider");return e};if(typeof window!="undefined"){const e=window.onerror;window.onerror=function(t,s,n,a,i){return t&&t.includes("severity")?!0:e?e.call(this,t,s,n,a,i):!1}}function Wt(){var _e,Ae;typeof window!="undefined"&&(window.AUTOLLAMA_DEBUG=window.AUTOLLAMA_DEBUG||{},window.AUTOLLAMA_DEBUG.appStarted=!0);const[e,t]=o.useState("dashboard"),[s,n]=o.useState(null),[a,i]=o.useState(null),[l,g]=o.useState([]),[p,r]=o.useState(0),[A,T]=o.useState(!1),[O,R]=o.useState([]),[S,v]=o.useState(0),[P,$]=o.useState({}),[q,G]=o.useState(""),[L,d]=o.useState([]),[C,x]=o.useState([]),[B,k]=o.useState(new Set),z=o.useRef(new Map),V=o.useRef(new Set),H=c=>{const m=z.current.get(c);m&&(m.close(),z.current.delete(c))},N=(c,m)=>{const u=setTimeout(()=>{V.current.delete(u),c()},m);return V.current.add(u),u};o.useEffect(()=>()=>{z.current.forEach((c,m)=>{c.close()}),z.current.clear(),V.current.forEach(c=>{clearTimeout(c)}),V.current.clear()},[]);const oe=Rt(),j=He(),Ke=Lt("/api/stream",{onMessage:c=>{ve(c)},onError:c=>{}}),ve=c=>{const m=c.type||c.step;if(c.data&&typeof c.data=="object"&&c.data.data&&c.data.data.step==="document_created"){const u=c.data.data,f=[u.documentId,u.url,u.title].filter(Boolean);f.length>0&&(k(y=>{const D=new Set(y);return f.forEach(X=>D.add(X)),D}),j.utils.invalidateCache.stats(),j.utils.invalidateCache.documents(),K(),N(()=>{F()},250))}switch(m){case"connection":break;case"system_update":c.data&&(j.utils.invalidateCache.stats(),$(u=>{var f,y,D,X,de,ce,fe,ye,Ie,Re;return M(w({},u),{database:M(w({},u.database),{status:((f=c.data.database)==null?void 0:f.status)||"unknown",healthy:((y=c.data.database)==null?void 0:y.healthy)||!1}),knowledgeBase:M(w({},u.knowledgeBase),{qdrant_status:((D=c.data.qdrant)==null?void 0:D.status)==="connected"?"active":"inactive",total_documents:((X=c.data.qdrant)==null?void 0:X.documents)||((de=u.knowledgeBase)==null?void 0:de.total_documents)||0,total_chunks:((ce=c.data.qdrant)==null?void 0:ce.chunks)||((fe=u.knowledgeBase)==null?void 0:fe.total_chunks)||0,contextual_documents:((ye=u.knowledgeBase)==null?void 0:ye.contextual_documents)||0}),processing:{activeSessions:((Ie=c.data.processing)==null?void 0:Ie.activeSessions)||0,totalProcessing:((Re=c.data.processing)==null?void 0:Re.totalProcessing)||0},lastUpdated:new Date})}),setTimeout(()=>{j.stats.getKnowledgeBase().then(u=>{$(f=>M(w({},f),{knowledgeBase:w(w({},f.knowledgeBase),u)}))}).catch(u=>{})},100));break;case"processing_progress":if(c.data&&c.data.data&&c.data.data.step==="document_created"){const u=c.data.data,f=[u.documentId,u.url,u.title].filter(Boolean);f.length>0&&(k(y=>{const D=new Set(y);return f.forEach(X=>D.add(X)),D}),j.utils.invalidateCache.stats(),j.utils.invalidateCache.documents(),K(),N(()=>{F()},250))}Qe(c.sessionId,c.progress);break;case"chunk_update":We(c.chunkId,c.status);break;case"system_stats":$(u=>w(w({},u),c.stats));break;case"document_created":if(c.documentId||c.url){const u=c.documentId||c.url;k(f=>new Set([...f,u]))}j.utils.invalidateCache.stats(),j.utils.invalidateCache.documents(),K(),F(),N(()=>{j.utils.invalidateCache.stats(),K()},500);break;case"processing_complete":case"file_processing_complete":case"session_complete":case"content_processed":c.sessionId&&et(c.sessionId),j.utils.invalidateCache.stats(),j.utils.invalidateCache.documents(),K(),F();break;case"chunk_processing_complete":c.chunkData&&c.chunkData.currentChunk===c.chunkData.totalChunks&&(j.utils.invalidateCache.stats(),j.utils.invalidateCache.documents(),F(),K());break;case"session_updated":if(c.step==="document_created"){const u=[c.documentId,c.url,c.title].filter(Boolean);u.length>0&&k(f=>{const y=new Set(f);return u.forEach(D=>y.add(D)),y}),j.utils.invalidateCache.stats(),j.utils.invalidateCache.documents(),K(),N(()=>{F()},250)}break}};o.useEffect(()=>{ze(),Ve(),N(()=>{Ze()},1e3),N(()=>{F()},2e3)},[]),o.useEffect(()=>{var f;const c=C.some(y=>y.status==="processing"||y.status==="uploading")||((f=P.processing)==null?void 0:f.totalProcessing)>0,m=c?8e3:15e3,u=setInterval(()=>{c&&j.utils.invalidateCache.stats(),K(),(c||Date.now()%3e4<m)&&F()},m);return()=>{clearInterval(u)}},[C,(_e=P.processing)==null?void 0:_e.totalProcessing]),o.useEffect(()=>{const c=m=>{var f;if(C.some(y=>y.status==="processing"||y.status==="uploading")||((f=P.processing)==null?void 0:f.totalProcessing)>0){const y="Processing is currently active. Refreshing the page will interrupt the upload/processing. Are you sure you want to continue?";return m.preventDefault(),m.returnValue=y,y}};return window.addEventListener("beforeunload",c),()=>{window.removeEventListener("beforeunload",c)}},[C,(Ae=P.processing)==null?void 0:Ae.totalProcessing]);const ze=()=>E(this,null,function*(){try{j.utils.invalidateCache.stats(),j.utils.invalidateCache.documents(),yield Promise.all([F(),K(),Ge()])}catch(c){}}),Ve=()=>{try{const c=localStorage.getItem("autollama_upload_sessions");c&&JSON.parse(c).forEach(u=>{(u.status==="processing"||u.status==="uploading")&&(xe(M(w({},u),{status:"reconnecting",reconnected:!0})),Je(u.sessionId))})}catch(c){localStorage.removeItem("autollama_upload_sessions")}},Je=c=>E(this,null,function*(){try{const m=yield fetch(`/api/upload-session/${c}`);if(m.ok){const u=yield m.json();if(u.status==="processing"){ne(c,"processing"),H(c);const f=new EventSource(`/api/session-stream/${c}`);z.current.set(c,f),f.onmessage=y=>{const D=JSON.parse(y.data);ve(D)},f.onerror=()=>{H(c),ne(c,"failed")}}else ne(c,u.status),u.status==="completed"&&(F(),K())}else ne(c,"failed")}catch(m){ne(c,"failed")}}),Ge=()=>E(this,null,function*(){try{const c=yield fetch("/api/cleanup-status");if(c.ok){const m=yield c.json();if(m.success&&m.current_stuck_sessions>0&&window.confirm(`Found ${m.current_stuck_sessions} interrupted processing session(s). Would you like to clean them up and allow new uploads?`)){const f=yield fetch("/api/cleanup-sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({threshold:5})});if(f.ok){const y=yield f.json()}}}}catch(c){}}),F=o.useCallback((c=!1)=>E(this,null,function*(){var m,u,f;try{j.utils.invalidateCache.documents();const y=Math.min(30,((u=(m=oe.settings)==null?void 0:m.ui)==null?void 0:u.documentsPerPage)||30),D=yield j.documents.getAll({limit:y,offset:0}),X=(D==null?void 0:D.documents)||[],de=((f=D==null?void 0:D.pagination)==null?void 0:f.total)||0,ce=X.map(Ce);ce.slice(0,5).forEach((fe,ye)=>{}),R(ce),v(de)}catch(y){}}),[]),K=o.useCallback(()=>E(this,null,function*(){try{j.utils.invalidateCache.stats();const[c,m,u]=yield Promise.all([j.stats.getKnowledgeBase(),j.stats.getDatabase(),j.stats.getHealth()]);$({knowledgeBase:c,database:m,health:u,lastUpdated:new Date})}catch(c){}}),[]);o.useEffect(()=>{const m=setInterval(()=>{if(performance.memory){const u=performance.memory.usedJSHeapSize/performance.memory.jsHeapSizeLimit;Math.round(performance.memory.usedJSHeapSize/1024/1024),Math.round(performance.memory.jsHeapSizeLimit/1024/1024),u>.8&&(j.utils.invalidateCache.all(),window.gc&&window.gc())}},3e4);return()=>clearInterval(m)},[j]);const Qe=(c,m)=>{R(u=>u.map(f=>f.sessionId===c?M(w({},f),{processingProgress:m}):f))},We=(c,m)=>{s&&n(u=>{var f;return M(w({},u),{chunks:((f=u.chunks)==null?void 0:f.map(y=>y.chunk_id===c?M(w({},y),{status:m}):y))||[]})})},xe=c=>{const m=c.map(u=>({id:tt(),file:u,name:u.name,size:u.size,type:u.type,status:"pending",progress:0,error:null,sessionId:null,timestamp:new Date}));return x(u=>[...u,...m]),m},ne=(c,m)=>{x(u=>{const f=u.map(y=>y.id===c?w(w({},y),m):y);return m.status==="completed"&&N(()=>{x(y=>y.filter(D=>D.id!==c))},3e3),pe(f),f})},pe=c=>{try{const m=c.filter(u=>u.status==="processing"||u.status==="uploading").map(u=>({id:u.id,name:u.name,size:u.size,type:u.type,status:u.status,progress:u.progress,sessionId:u.sessionId,timestamp:u.timestamp}));localStorage.setItem("autollama_upload_sessions",JSON.stringify(m))}catch(m){}},Ye=c=>{x(m=>m.filter(u=>u.id!==c))},Xe=()=>{x(c=>c.filter(m=>m.status!=="completed"))},Ze=()=>E(this,null,function*(){try{const c=yield j.data.getInProgress(),m=new Set(c.map(u=>u.id));x(u=>{const f=u.filter(y=>!!(y.status!=="processing"||y.sessionId&&m.has(y.sessionId)));return f.length!==u.length&&pe(f),f})}catch(c){}}),et=c=>{H(c),x(m=>{const u=m.map(y=>y.sessionId===c&&y.status==="processing"?M(w({},y),{status:"completed"}):y),f=u.find(y=>y.sessionId===c&&y.status==="completed");return f&&N(()=>{x(y=>y.filter(D=>D.id!==f.id))},3e3),pe(u),u})},tt=()=>Math.random().toString(36).substr(2,9),st=c=>E(this,null,function*(){if(n(c),t("document"),!c.chunks)try{const m=btoa(c.url),u=yield j.documents.getChunks(m,{limit:1e3});n(f=>M(w({},f),{chunks:(u==null?void 0:u.chunks)||[]}))}catch(m){}}),nt=()=>{t("dashboard"),n(null),i(null),g([]),r(0)},at=(c,m=[],u=0)=>{i(c),g(m),r(u+1)},Ee=c=>{c>=1&&c<=l.length&&(r(c),i(l[c-1]))},rt=c=>{G(c),c.trim()&&e!=="search"&&t("search"),!c.trim()&&e==="search"&&t("dashboard")},ot={currentView:e,selectedDocument:s,selectedChunk:a,selectedChunks:l,chunkIndex:p,showSettings:A,documents:O,totalDocumentCount:S,systemStats:P,searchQuery:q,searchResults:L,uploadQueue:C,newlyCreatedDocumentIds:B,settings:oe.settings,connectionStatus:oe.connectionStatus,updateSetting:oe.updateSetting,updateCategory:oe.updateCategory,api:j,sse:Ke,setCurrentView:t,setShowSettings:T,handleDocumentSelect:st,handleBackToDashboard:nt,handleChunkSelect:at,handleChunkNavigate:Ee,handleSearchQueryChange:rt,refreshDocuments:F,loadSystemStats:K,clearNewlyCreatedFlag:c=>{k(m=>{const u=new Set(m);return u.delete(c),u})},addToUploadQueue:xe,updateUploadStatus:ne,removeFromUploadQueue:Ye,clearCompletedUploads:Xe};return h.jsx(Fe.Provider,{value:ot,children:h.jsx(mt,{children:h.jsxs("div",{className:"min-h-screen bg-gray-900 text-white bg-pattern",children:[h.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 opacity-50"}),h.jsx("div",{className:"relative z-10",children:h.jsxs(gt,{children:[h.jsx(ie,{path:"/",element:h.jsx(he,{})}),h.jsx(ie,{path:"/dashboard",element:h.jsx(he,{})}),h.jsx(ie,{path:"/document/:id",element:h.jsx(he,{})}),h.jsx(ie,{path:"/search",element:h.jsx(he,{})}),h.jsx(ie,{path:"*",element:h.jsx(pt,{to:"/",replace:!0})})]})}),A&&h.jsx(U.Suspense,{fallback:h.jsx("div",{className:"flex justify-center items-center h-64",children:h.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}),children:h.jsx(Kt,{})}),a&&e!=="document"&&h.jsx(U.Suspense,{fallback:h.jsx("div",{className:"flex justify-center items-center h-64",children:h.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}),children:h.jsx(Qt,{onClose:()=>{i(null),g([]),r(0)},fallbackTitle:"Chunk Inspector Error",children:h.jsx(Gt,{chunk:a,document:{url:a.url||a.source},chunkIndex:p,totalChunks:l.length||1,onClose:()=>{i(null),g([]),r(0)},onNavigate:Ee})})}),h.jsx(Xt,{})]})})})}const he=()=>{const{currentView:e,showSettings:t,setShowSettings:s}=we();return h.jsxs("div",{className:"w-full max-w-7xl mx-auto p-4 md:p-8",children:[h.jsx(Yt,{}),h.jsx("main",{className:"mt-8",children:h.jsxs(U.Suspense,{fallback:h.jsx("div",{className:"flex justify-center items-center h-64",children:h.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}),children:[e==="dashboard"&&h.jsx(Ht,{}),e==="document"&&h.jsx(zt,{}),e==="search"&&h.jsx(Ft,{}),e==="processing"&&h.jsx(Vt,{}),e==="chat"&&h.jsx(Jt,{})]})})]})},Yt=()=>{const{searchQuery:e,handleSearchQueryChange:t,setShowSettings:s,setCurrentView:n,systemStats:a,sse:i}=we();return h.jsxs("header",{className:"text-center mb-8",children:[h.jsx("div",{className:"mb-6",children:h.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-2 flex items-center justify-center gap-3",children:h.jsx("button",{onClick:()=>n("dashboard"),className:"flex items-center gap-3 hover:opacity-80 transition-opacity cursor-pointer bg-transparent border-none",children:h.jsx("span",{className:"text-gradient",children:"AutoLlama"})})})}),h.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-4",children:[h.jsxs("div",{className:"relative w-full sm:w-80",children:[h.jsx(ft,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),h.jsx("input",{type:"text",placeholder:"Search documents, chunks, topics...",value:e,onChange:l=>{t&&t(l.target.value)},className:"input-primary pl-10"})]}),h.jsxs("div",{className:"flex items-center gap-2",children:[h.jsxs("button",{onClick:()=>n("chat"),className:"btn-primary",children:[h.jsx(yt,{className:"w-5 h-5"}),"AI Chat"]}),h.jsxs("button",{onClick:()=>n("processing"),className:"btn-secondary",children:[h.jsx(St,{className:"w-5 h-5"}),"Process"]}),h.jsx("button",{onClick:()=>s(!0),className:"btn-secondary",title:"Settings",children:h.jsx(bt,{className:"w-5 h-5"})})]})]})]})},Xt=()=>(we(),h.jsx("footer",{className:"text-center p-4 text-xs text-gray-500 relative z-10 border-t border-gray-800 mt-16",children:h.jsxs("div",{className:"flex flex-wrap justify-center items-center gap-4",children:[h.jsx("span",{children:"Your Knowledge, Now Better"}),h.jsx("span",{children:"•"}),h.jsx("span",{children:"Version 2.3"})]})}));Se.createRoot(document.getElementById("root")).render(h.jsx(U.StrictMode,{children:h.jsx(Wt,{})}));export{te as _,as as a,He as b,Lt as c,ns as d,h as j,Z as s,we as u};
