var D=Object.defineProperty;var b=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,Q=Object.prototype.propertyIsEnumerable;var w=(s,a,n)=>a in s?D(s,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[a]=n,N=(s,a)=>{for(var n in a||(a={}))E.call(a,n)&&w(s,n,a[n]);if(b)for(var n of b(a))Q.call(a,n)&&w(s,n,a[n]);return s};var C=(s,a,n)=>new Promise((g,i)=>{var u=d=>{try{o(n.next(d))}catch(h){i(h)}},l=d=>{try{o(n.throw(d))}catch(h){i(h)}},o=d=>d.done?g(d.value):Promise.resolve(d.value).then(u,l);o((n=n.apply(s,a)).next())});import{u as T,j as e}from"./index-6c7ceae9.js";import{r as m}from"./vendor-77d0a172.js";import{a as y,L as j,C as S,A as k,E as $}from"./icons-fbec3f3a.js";import"./utils-d9662bcb.js";const _=()=>{const{api:s,sse:a,documents:n,uploadQueue:g}=T(),[i,u]=m.useState([]),[l,o]=m.useState(!1),[d,h]=m.useState(!1);m.useEffect(()=>{const t=setTimeout(()=>{v()},100),r=setInterval(v,1e4);return()=>{clearTimeout(t),clearInterval(r)}},[]),m.useEffect(()=>{a.data&&a.data.type==="processing_progress"&&q(a.data)},[a.data]);const v=()=>C(void 0,null,function*(){h(!0);try{const t=yield s.data.getInProgress();u(t||[])}catch(t){}finally{h(!1)}}),q=t=>{u(r=>r.map(p=>p.sessionId===t.sessionId?N(N({},p),t):p))},x=m.useMemo(()=>{const t=[...i];return g.forEach(r=>{(r.status==="processing"||r.status==="uploading")&&(t.some(f=>f.filename===r.name||f.sessionId&&f.sessionId===r.sessionId)||t.push({id:r.id,sessionId:r.sessionId||r.id,filename:r.name,url:`file://${r.name}`,status:r.status==="uploading"?"uploading":"processing",progress:r.progress||0,totalChunks:r.totalChunks||0,processedChunks:r.processedChunks||0,startTime:r.startTime||new Date,lastUpdate:new Date,source:"upload_queue"}))}),t},[i,g]),c=m.useMemo(()=>({total:x.length,processing:x.filter(t=>t.status==="processing"||t.status==="uploading").length,queued:x.filter(t=>t.status==="queued").length,completed:x.filter(t=>t.status==="completed").length,failed:x.filter(t=>t.status==="error").length}),[x]);return x.length===0?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-600 bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsx(y,{className:"w-5 h-5 text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"Processing Queue"}),e.jsx("p",{className:"text-sm text-gray-400",children:"All caught up! No items in queue."})]})]}),e.jsx("div",{className:"text-sm text-gray-500",children:"ðŸ¦™ Llama is resting"})]})}):e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between cursor-pointer",onClick:()=>o(!l),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-10 h-10 bg-yellow-600 bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsx(j,{className:`w-5 h-5 text-yellow-400 ${c.processing>0?"animate-spin":""}`})}),c.processing>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-yellow-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-white",children:c.processing})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg",children:"Processing Queue"}),e.jsxs("p",{className:"text-sm text-gray-400",children:[c.processing," processing â€¢ ",c.queued," queued â€¢ ",c.completed," completed"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{className:"w-4 h-4 text-yellow-400"}),e.jsx("span",{children:c.processing})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{children:c.queued})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{className:"w-4 h-4 text-green-400"}),e.jsx("span",{children:c.completed})]}),c.failed>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{className:"w-4 h-4 text-red-400"}),e.jsx("span",{children:c.failed})]})]}),e.jsx("div",{className:`transform transition-transform ${l?"rotate-180":""}`,children:"â–¼"})]})]}),l&&e.jsx("div",{className:"mt-6 space-y-3 border-t border-gray-700 pt-4",children:d?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(j,{className:"w-6 h-6 animate-spin text-primary-400"}),e.jsx("span",{className:"ml-2 text-gray-400",children:"Loading queue..."})]}):x.map((t,r)=>e.jsx(L,{item:t},t.sessionId||r))}),c.processing>0&&e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-sm text-yellow-400",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full animate-pulse"}),e.jsxs("span",{children:["Llama is actively processing ",c.processing," item",c.processing!==1?"s":""]})]})]})},L=({item:s})=>{var o;const[a,n]=m.useState(!1),g={queued:{icon:S,color:"text-gray-400",bg:"bg-gray-600",label:"Queued"},processing:{icon:j,color:"text-yellow-400",bg:"bg-yellow-600",label:"Processing",animate:!0},completed:{icon:y,color:"text-green-400",bg:"bg-green-600",label:"Completed"},error:{icon:k,color:"text-red-400",bg:"bg-red-600",label:"Failed"}},i=g[s.status]||g.queued,u=i.icon,l=s.progress||{};return e.jsxs("div",{className:"bg-gray-800 bg-opacity-50 rounded-lg p-4 border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:`w-8 h-8 ${i.bg} bg-opacity-20 rounded-lg flex items-center justify-center`,children:e.jsx(u,{className:`w-4 h-4 ${i.color} ${i.animate?"animate-spin":""}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium text-white truncate",children:s.title||s.url||`Session ${(o=s.sessionId)==null?void 0:o.slice(0,8)}`}),e.jsx("span",{className:"text-xs px-2 py-1 bg-gray-700 rounded-full text-gray-300",children:i.label})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-gray-400",children:[e.jsxs("span",{children:[l.currentChunk||0," / ",l.totalChunks||0," chunks"]}),l.percentage&&e.jsxs("span",{children:[Math.round(l.percentage),"% complete"]}),s.startTime&&e.jsxs("span",{children:["Started ",new Date(s.startTime).toLocaleTimeString()]})]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>n(!a),className:"p-1 hover:bg-gray-700 rounded",title:"View Details",children:e.jsx($,{className:"w-4 h-4 text-gray-400"})})})]}),s.status==="processing"&&l.percentage!==void 0&&e.jsx("div",{className:"mt-3 bg-gray-700 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-yellow-400 transition-all duration-300 ease-out",style:{width:`${l.percentage}%`}})}),a&&e.jsx("div",{className:"mt-4 p-3 bg-gray-900 bg-opacity-50 rounded border border-gray-600 text-sm",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Session ID:"}),e.jsx("span",{className:"ml-2 font-mono text-xs",children:s.sessionId})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Content Type:"}),e.jsx("span",{className:"ml-2",children:s.contentType||"Unknown"})]}),l.currentStep&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-gray-400",children:"Current Step:"}),e.jsx("span",{className:"ml-2",children:l.currentStep})]}),s.error&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-red-400",children:"Error:"}),e.jsx("span",{className:"ml-2 text-red-300",children:s.error})]})]})})]})};export{_ as default};
