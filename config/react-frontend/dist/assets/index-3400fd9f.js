var en=Object.defineProperty,tn=Object.defineProperties;var sn=Object.getOwnPropertyDescriptors;var ot=Object.getOwnPropertySymbols;var vs=Object.prototype.hasOwnProperty,Ns=Object.prototype.propertyIsEnumerable;var Lt=(s,t,a)=>t in s?en(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,R=(s,t)=>{for(var a in t||(t={}))vs.call(t,a)&&Lt(s,a,t[a]);if(ot)for(var a of ot(t))Ns.call(t,a)&&Lt(s,a,t[a]);return s},L=(s,t)=>tn(s,sn(t));var ws=(s,t)=>{var a={};for(var n in s)vs.call(s,n)&&t.indexOf(n)<0&&(a[n]=s[n]);if(s!=null&&ot)for(var n of ot(s))t.indexOf(n)<0&&Ns.call(s,n)&&(a[n]=s[n]);return a};var _s=(s,t,a)=>(Lt(s,typeof t!="symbol"?t+"":t,a),a);var I=(s,t,a)=>new Promise((n,r)=>{var i=o=>{try{d(a.next(o))}catch(c){r(c)}},l=o=>{try{d(a.throw(o))}catch(c){r(c)}},d=o=>o.done?n(o.value):Promise.resolve(o.value).then(i,l);d((a=a.apply(s,t)).next())});import{r as u,a as an,R as ma,c as dt,B as nn,b as rn,d as He,N as ln}from"./vendor-77d0a172.js";import{a as $t}from"./utils-d9662bcb.js";import{C as Ne,L as De,a as he,A as de,F as re,b as pa,B as Ss,G as cn,P as on,c as dn,S as Mt,U as Je,d as ga,e as et,f as Ce,W as hn,T as tt,Z as je,g as Y,E as ls,h as xa,i as Te,X as Pe,j as un,k as fa,l as ya,R as Ee,m as mn,K as pn,M as Ze,D as Fe,n as ks,o as Rt,p as gn,q as xn,r as fn,s as Cs,t as Ft,u as yn,v as ba,w as cs,x as bn,y as jn,z as vn,H as Nn,I as wn,J as _n,N as Tt,O as Dt,Q as Sn,V as kn,Y as Cn,_ as An,$ as En,a0 as ja,a1 as Tn,a2 as Pn}from"./icons-212f7396.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function a(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=a(r);fetch(r.href,i)}})();var va={exports:{}},Ot={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var In=u,$n=Symbol.for("react.element"),Mn=Symbol.for("react.fragment"),Rn=Object.prototype.hasOwnProperty,Dn=In.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,On={key:!0,ref:!0,__self:!0,__source:!0};function Na(s,t,a){var n,r={},i=null,l=null;a!==void 0&&(i=""+a),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(l=t.ref);for(n in t)Rn.call(t,n)&&!On.hasOwnProperty(n)&&(r[n]=t[n]);if(s&&s.defaultProps)for(n in t=s.defaultProps,t)r[n]===void 0&&(r[n]=t[n]);return{$$typeof:$n,type:s,key:i,ref:l,props:r,_owner:Dn.current}}Ot.Fragment=Mn;Ot.jsx=Na;Ot.jsxs=Na;va.exports=Ot;var e=va.exports,Zt={},As=an;Zt.createRoot=As.createRoot,Zt.hydrateRoot=As.hydrateRoot;class Un{constructor(){this.storageKey="autollama-settings",this.defaultSettings={connections:{openaiApiKey:"",claudeApiKey:"",qdrantUrl:"https://c4c8ee46-d9dd-4c0f-a00e-9215675351da.us-west-1-0.aws.cloud.qdrant.io",qdrantApiKey:"",databaseUrl:"postgresql://autollama_user:autollama_secure_password_2024@100.92.210.53:5432/autollama",testConnections:!1},pipeline:{pipelineUrl:"http://autollama-on-hstgr:9099",apiKey:"0p3n-w3bu!",collectionName:"autollama-content",maxResults:5,similarityThreshold:.3,debugMode:!0},processing:{enableContextualEmbeddings:!0,contextualModel:"gpt-4o-mini",contextBatchSize:5,chunkSize:1200,chunkOverlap:200,processingTimeout:3e4,autoStartProcessing:!0},system:{theme:"dark",sseUpdateInterval:5e3,cacheTimeout:3e5,debugLogging:!0,showProcessingDetails:!0,autoRefreshDocuments:!0},search:{enableBM25:!0,enableSemantic:!0,hybridSearchWeight:.5,maxSearchResults:20,searchTimeout:1e4,enableSearchHistory:!0},ui:{documentsPerPage:50,chunksPerRow:10,showVectorHeatmaps:!0,showContextualSummaries:!0,animationsEnabled:!0,compactMode:!1}}}loadSettings(){try{const t=localStorage.getItem(this.storageKey);if(t){const a=JSON.parse(t);return this.mergeWithDefaults(a)}}catch(t){}return R({},this.defaultSettings)}loadSettingsFromDatabase(){return I(this,null,function*(){try{const t=yield fetch("/api/settings");if(t.ok){const a=yield t.json();if(a.success&&a.settings){const n=a.settings,r=R({},this.defaultSettings);return n.openai_api_key&&(r.connections.openaiApiKey=n.openai_api_key),n.qdrant_url&&(r.connections.qdrantUrl=n.qdrant_url),n.qdrant_api_key&&(r.connections.qdrantApiKey=n.qdrant_api_key),n.database_url&&(r.connections.databaseUrl=n.database_url),r}}}catch(t){}return this.loadSettings()})}saveSettings(t){try{return localStorage.setItem(this.storageKey,JSON.stringify(t)),!0}catch(a){return!1}}saveConnectionsToDatabase(t){return I(this,null,function*(){try{const a={};t.openaiApiKey&&t.openaiApiKey.trim()&&(a.openai_api_key=t.openaiApiKey),t.qdrantUrl&&t.qdrantUrl.trim()&&(a.qdrant_url=t.qdrantUrl),t.qdrantApiKey&&t.qdrantApiKey.trim()&&(a.qdrant_api_key=t.qdrantApiKey),t.databaseUrl&&t.databaseUrl.trim()&&(a.database_url=t.databaseUrl);const n=yield fetch("/api/settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({settings:a})});if(n.ok){const r=yield n.json();return!0}else{const r=yield n.json();return!1}}catch(a){return!1}})}mergeWithDefaults(t){const a=R({},this.defaultSettings);return Object.keys(t).forEach(n=>{a[n]&&typeof a[n]=="object"?a[n]=R(R({},a[n]),t[n]):a[n]=t[n]}),a}getSetting(t,a){var r;return(r=this.loadSettings()[t])==null?void 0:r[a]}updateSetting(t,a,n){const r=this.loadSettings();return r[t]||(r[t]={}),r[t][a]=n,this.saveSettings(r)}updateCategory(t,a){const n=this.loadSettings();return n[t]=R(R({},n[t]),a),this.saveSettings(n)}resetSettings(){try{return localStorage.removeItem(this.storageKey),!0}catch(t){return!1}}exportSettings(){const t=this.loadSettings(),a=JSON.stringify(t,null,2),n=new Blob([a],{type:"application/json"}),r=document.createElement("a");r.href=URL.createObjectURL(n),r.download=`autollama-settings-${new Date().toISOString().split("T")[0]}.json`,r.click()}importSettings(t){return I(this,null,function*(){try{const a=yield t.text(),n=JSON.parse(a),r=this.mergeWithDefaults(n);return!!this.saveSettings(r)}catch(a){return!1}})}validateConnections(t=null){return I(this,null,function*(){const a=t||this.loadSettings(),n={openai:!1,claude:!1,qdrant:!1,database:!1,bm25:!1};if(a.connections.openaiApiKey&&a.connections.openaiApiKey.trim())try{const r=yield fetch("https://api.openai.com/v1/models",{headers:{Authorization:`Bearer ${a.connections.openaiApiKey}`}});n.openai=r.ok}catch(r){}if(a.connections.claudeApiKey&&a.connections.claudeApiKey.trim())try{const r=yield fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"x-api-key":a.connections.claudeApiKey,"anthropic-version":"2023-06-01","content-type":"application/json"},body:JSON.stringify({model:"claude-3-haiku-20240307",max_tokens:1,messages:[{role:"user",content:"test"}]})});n.claude=r.ok||r.status===400}catch(r){}if(a.connections.qdrantUrl&&a.connections.qdrantApiKey&&a.connections.qdrantApiKey.trim())try{const r=yield fetch(`${a.connections.qdrantUrl}/collections`,{headers:{"api-key":a.connections.qdrantApiKey}});n.qdrant=r.ok}catch(r){}if(a.connections.databaseUrl&&a.connections.databaseUrl.trim())try{const i=yield(yield fetch("/health")).text();n.database=i==="healthy"}catch(r){}try{const r=yield fetch("/bm25/health");n.bm25=r.ok}catch(r){}return n})}}const pe=new Un,Ln=()=>{const[s,t]=u.useState(pe.loadSettings()),[a,n]=u.useState(!1),[r,i]=u.useState({openai:!1,qdrant:!1,database:!1,bm25:!1}),l=u.useCallback(()=>{t(pe.loadSettings())},[]),d=u.useCallback((f,j,k)=>{const x=pe.updateSetting(f,j,k);return x&&l(),x},[l]),o=u.useCallback((f,j)=>{const k=pe.updateCategory(f,j);return k&&l(),k},[l]),c=u.useCallback(()=>{const f=pe.resetSettings();return f&&l(),f},[l]),p=u.useCallback(()=>I(void 0,null,function*(){n(!0);try{const f=yield pe.validateConnections(s);return i(f),f}catch(f){return null}finally{n(!1)}}),[s]),m=u.useCallback(()=>{pe.exportSettings()},[]),w=u.useCallback(f=>I(void 0,null,function*(){n(!0);try{const j=yield pe.importSettings(f);return j&&l(),j}catch(j){return!1}finally{n(!1)}}),[l]);return u.useEffect(()=>{s.connections.testConnections&&p()},[s.connections,p]),{settings:s,isLoading:a,connectionStatus:r,updateSetting:d,updateCategory:o,resetSettings:c,testConnections:p,exportSettings:m,importSettings:w,reloadSettings:l}};class Fn{constructor(t=5*60*1e3){this.cache=new Map,this.defaultTTL=t,this.stats={hits:0,misses:0,sets:0,deletes:0}}generateKey(t,a={}){const n=JSON.stringify(a,Object.keys(a).sort());return`${t}:${n}`}get(t){const a=this.cache.get(t);return a?Date.now()>a.expiresAt?(this.cache.delete(t),this.stats.misses++,null):(this.stats.hits++,a.data):(this.stats.misses++,null)}set(t,a,n=null){const r=n===0?0:n!==null?n:this.defaultTTL,i=Date.now()+r;this.cache.set(t,{data:a,expiresAt:i,createdAt:Date.now()}),this.stats.sets++}delete(t){const a=this.cache.delete(t);return a&&this.stats.deletes++,a}clear(){const t=this.cache.size;this.cache.clear(),this.stats.deletes+=t}cleanup(){const t=Date.now();let a=0;for(const[n,r]of this.cache.entries())t>r.expiresAt&&(this.cache.delete(n),a++);return this.stats.deletes+=a,a}getStats(){return L(R({},this.stats),{size:this.cache.size,hitRate:this.stats.hits/(this.stats.hits+this.stats.misses)||0})}has(t){const a=this.cache.get(t);return a&&Date.now()<=a.expiresAt}}const ge=new Fn;setInterval(()=>{ge.cleanup()},5*60*1e3);const G={realtime:2*1e3,documents:0,stats:0,settings:30*1e3,systemInfo:30*1e3,schemas:60*1e3},zn=(s,t,a=null)=>I(void 0,null,function*(){const n=ge.get(s);if(n)return n;try{const r=yield t();return ge.set(s,r,a),r}catch(r){throw r}}),Qe={documents:()=>{Array.from(ge.cache.keys()).forEach(t=>{(t.includes("documents")||t.includes("chunks")||t.includes("search"))&&ge.delete(t)})},stats:()=>{Array.from(ge.cache.keys()).forEach(t=>{(t.includes("stats")||t.includes("health"))&&ge.delete(t)})},processing:()=>{Array.from(ge.cache.keys()).forEach(t=>{(t.includes("in-progress")||t.includes("recent")||t.includes("queue"))&&ge.delete(t)})},all:()=>ge.clear()},Bn={LOW:"low",MEDIUM:"medium",HIGH:"high"},ke={API:"api",NETWORK:"network",VALIDATION:"validation",AUTHENTICATION:"authentication",PERMISSION:"permission",PROCESSING:"processing",UI:"ui",UNKNOWN:"unknown"};class Vn{constructor(){this.errorLog=[],this.maxLogSize=50,this.errorCallbacks=new Set}handle(t,a={}){try{const n=this.createSafeError(t,a);return this.safeLog(n),this.safeNotify(n),this.safeConsoleLog(n),n}catch(n){return{id:"emergency-"+Date.now(),message:"Error handling failed",severity:"medium",category:"unknown",timestamp:new Date().toISOString()}}}createSafeError(t,a){const n={id:"error-"+Date.now()+"-"+Math.random().toString(36).substr(2,9),message:"Unknown error",severity:"medium",category:"unknown",timestamp:new Date().toISOString(),retryable:!1};try{t&&typeof t=="object"&&t.message?n.message=String(t.message):t&&typeof t=="string"&&(n.message=t)}catch(r){}try{a&&a.severity&&typeof a.severity=="string"&&(n.severity=a.severity)}catch(r){}try{a&&a.category&&typeof a.category=="string"&&(n.category=a.category)}catch(r){}return n}safeLog(t){try{t&&typeof t=="object"&&t.id&&(this.errorLog.unshift(t),this.errorLog.length>this.maxLogSize&&(this.errorLog=this.errorLog.slice(0,this.maxLogSize)))}catch(a){}}safeNotify(t){try{this.errorCallbacks.forEach(a=>{try{typeof a=="function"&&a(t)}catch(n){}})}catch(a){}}safeConsoleLog(t){try{if(!t||typeof t!="object")return;const a=t.message||"Unknown error",n=t.severity||"medium"}catch(a){}}onError(t){try{if(typeof t=="function")return this.errorCallbacks.add(t),()=>{try{this.errorCallbacks.delete(t)}catch(a){}}}catch(a){}return()=>{}}getStats(){try{const t={total:0,last24h:0,byCategory:{},bySeverity:{}};if(Array.isArray(this.errorLog)){t.total=this.errorLog.length;let a=0;for(let n=0;n<this.errorLog.length;n++)try{const r=this.errorLog[n];if(r&&typeof r=="object"){a++;const i=r.category||"unknown";t.byCategory[i]=(t.byCategory[i]||0)+1;const l=r.severity||"medium";t.bySeverity[l]=(t.bySeverity[l]||0)+1}}catch(r){}t.last24h=a}return t}catch(t){return{total:0,last24h:0,byCategory:{},bySeverity:{}}}}clearErrors(){try{this.errorLog=[]}catch(t){this.errorLog=[]}}}const Xe=new Vn,qn=(s,t={})=>Xe.handle(s,L(R({},t),{category:ke.API})),Re=qn,Hn=s=>{try{if(!s||typeof s!="object")return"An unexpected error occurred. Please try again.";switch(s.category||"unknown"){case ke.NETWORK:return"Connection error. Please check your internet connection and try again.";case ke.API:return"Server error. Please try again in a moment.";case ke.VALIDATION:return"Please check your input and try again.";case ke.PROCESSING:return"Processing error. Please try again.";default:return"An unexpected error occurred. Please try again."}}catch(t){return"An error occurred. Please try again."}},Kn=(a,...n)=>I(void 0,[a,...n],function*(s,t={}){const{maxAttempts:r=3,delay:i=1e3}=t;for(let l=1;l<=r;l++)try{return yield s()}catch(d){if(l===r)throw Xe.handle(d,{action:"RetryFailed",attempts:l,category:ke.API}),d;i>0&&(yield new Promise(o=>setTimeout(o,i*l)))}});class Wn{constructor(){this.metrics=new Map,this.thresholds={api:2e3,render:100,navigation:1e3},this.isRecording=!0}startTimer(t,a="general"){if(!this.isRecording)return;const n=`${a}:${t}`;this.metrics.set(n,{name:t,category:a,startTime:performance.now(),startMark:`${n}-start`}),typeof performance.mark=="function"&&performance.mark(`${n}-start`)}endTimer(t,a="general",n={}){if(!this.isRecording)return null;const r=`${a}:${t}`,i=this.metrics.get(r);if(!i)return null;const d=performance.now()-i.startTime,o=`${r}-end`;typeof performance.mark=="function"&&(performance.mark(o),typeof performance.measure=="function"&&performance.measure(r,i.startMark,o));const c={name:i.name,category:i.category,duration:d,timestamp:new Date().toISOString(),metadata:n,threshold:this.thresholds[a]||this.thresholds.general,isSlowOperation:d>(this.thresholds[a]||1e3)};return c.isSlowOperation,this.metrics.delete(r),c}timeFunction(i,l){return I(this,arguments,function*(t,a,n="function",r={}){this.startTimer(a,n);try{const d=yield t();return this.endTimer(a,n,r),d}catch(d){throw this.endTimer(a,n,L(R({},r),{error:d.message})),d}})}timeApiCall(r,i){return I(this,arguments,function*(t,a,n={}){return this.timeFunction(t,a,"api",R({endpoint:a},n))})}getStats(){const t=performance.getEntriesByType("measure"),a={total:t.length,byCategory:{},slowOperations:0,averageDuration:0};let n=0;return t.forEach(r=>{const[i]=r.name.split(":");a.byCategory[i]||(a.byCategory[i]={count:0,totalDuration:0,averageDuration:0,slowCount:0});const l=a.byCategory[i];l.count++,l.totalDuration+=r.duration,r.duration>(this.thresholds[i]||1e3)&&(l.slowCount++,a.slowOperations++),n+=r.duration}),a.averageDuration=t.length>0?n/t.length:0,Object.values(a.byCategory).forEach(r=>{r.averageDuration=r.count>0?r.totalDuration/r.count:0}),a}clearData(){typeof performance.clearMarks=="function"&&performance.clearMarks(),typeof performance.clearMeasures=="function"&&performance.clearMeasures(),this.metrics.clear()}setRecording(t){this.isRecording=t}}const ze=new Wn,V=$t.create({baseURL:"/api",timeout:3e4,headers:{"Content-Type":"application/json"}}),Ae=$t.create({baseURL:"/bm25",timeout:1e4,headers:{"Content-Type":"application/json"}});V.interceptors.request.use(s=>{var t;return s.metadata={startTime:performance.now(),endpoint:`${(t=s.method)==null?void 0:t.toUpperCase()} ${s.url}`},s},s=>(Re(s,{action:"RequestInterceptor"}),Promise.reject(s)));V.interceptors.response.use(s=>{if(s.config.metadata){const t=performance.now()-s.config.metadata.startTime;ze.endTimer(s.config.metadata.endpoint,"api",{status:s.status,duration:t})}return s},s=>{var t,a,n,r,i;if((t=s.config)!=null&&t.metadata){const l=performance.now()-s.config.metadata.startTime;ze.endTimer(s.config.metadata.endpoint,"api",{status:((a=s.response)==null?void 0:a.status)||"error",duration:l,error:!0})}return Re(s,{action:"ResponseInterceptor",endpoint:(n=s.config)==null?void 0:n.url,method:(r=s.config)==null?void 0:r.method}),((i=s.response)==null?void 0:i.status)>=500&&Qe.all(),Promise.reject(s)});Ae.interceptors.request.use(s=>s,s=>Promise.reject(s));Ae.interceptors.response.use(s=>s,s=>Promise.reject(s));const X={getDocuments:(s={})=>V.get("/documents",{params:s}),getDocumentChunks:(s,t={})=>V.get("/document-chunks",{params:R({url:atob(s)},t)}),getChunkByIndex:(s,t)=>I(void 0,null,function*(){const a=atob(s);try{const n=yield V.get("/document-chunks",{params:{url:a,limit:Math.max(200,t+50)}});if(n.data.chunks&&n.data.chunks.length>0){let r=n.data.chunks.find(d=>d.chunkIndex===t);if(r)return{chunk:r};const i=yield V.get("/document-chunks",{params:{url:a,limit:2e3}});if(i.data.chunks&&(r=i.data.chunks.find(d=>d.chunkIndex===t),r))return{chunk:r};const l=[...new Set(n.data.chunks.map(d=>d.chunkIndex))].sort((d,o)=>d-o);throw new Error(`Chunk with index ${t} not found. Available range: ${l[0]} to ${l[l.length-1]}`)}throw new Error("No chunks returned from API")}catch(n){throw n}}),getDocumentSummary:s=>V.get(`/document/${s}/summary`),processUrl:s=>V.post("/process-url",s),processUrlStream:s=>V.post("/process-url-stream",s),processFile:s=>V.post("/process-file",s,{headers:{"Content-Type":"multipart/form-data"}}),processFileStream:s=>V.post("/process-file-stream",s,{headers:{"Content-Type":"multipart/form-data"}}),search:s=>V.get("/search",{params:s}),searchGrouped:s=>V.get("/search/grouped",{params:s}),getKnowledgeBaseStats:()=>V.get("/knowledge-base/stats"),getDatabaseStats:()=>V.get("/database/stats"),getHealth:()=>$t.get("/health"),getPipelineHealth:()=>V.get("/pipeline/health"),getQdrantActivity:()=>V.get("/qdrant/activity"),getRecentRecords:(s={})=>V.get("/documents",{params:s}),getInProgress:()=>V.get("/in-progress"),getCompletedUploads:(s={})=>V.get("/in-progress",{params:s}),stopProcessing:s=>V.post(`/stop-processing/${s}`),getChunks:(s={})=>V.get("/chunks",{params:s}),getChunkingSettings:()=>V.get("/chunking-settings"),updateChunkingSettings:s=>V.put("/chunking-settings",s)},we={sendMessage:s=>V.post("/chat/message",s),getConversation:s=>V.get(`/chat/conversation/${s}`),getConversations:(s={})=>V.get("/chat/conversations",{params:s}),deleteConversation:s=>V.delete(`/chat/conversation/${s}`),getStats:()=>V.get("/chat/stats"),searchRAG:(s,t={})=>V.post("/chat/rag-search",R({query:s},t)),pipelineQuery:s=>V.post("/chat/pipeline",s),getPipelineStatus:()=>V.get("/chat/pipeline/status")},_e={search:(s,t,a=10)=>Ae.post(`/search/${s}`,{query:t,filename:s,top_k:a}),createIndex:(s,t,a=!0)=>Ae.post(`/index/${s}`,{chunks:t,filename:s,replace_existing:a}),getStats:()=>Ae.get("/stats"),deleteIndex:s=>Ae.delete(`/index/${s}`),getHealth:()=>Ae.get("/health")},wa=(s,t,a=null)=>{const n=s.startsWith("/")?s:`/api/${s}`,r=performance.now();try{const i=new EventSource(n,{withCredentials:!1});return i.onmessage=l=>{try{const d=JSON.parse(l.data);if(d.type==="ping")return;t(d)}catch(d){const o=Re(d,{action:"SSE_Parse",endpoint:n});t({type:"error",message:"Failed to parse SSE data",errorId:o.id,severity:"medium",category:"sse_parse",timestamp:new Date().toISOString()})}},i.onerror=l=>{const d=Re(l,{action:"SSE_Connection",endpoint:n,readyState:i.readyState});a&&a(l,d)},i.onopen=()=>{const l=performance.now()-r;ze.endTimer(`SSE_${s}`,"sse",{endpoint:n,connectionTime:l})},ze.startTimer(`SSE_${s}`,"sse"),i}catch(i){throw Re(i,{action:"SSE_Create",endpoint:n}),i}},_a=(s,t,a=null)=>(...n)=>{const r=`${s}:${JSON.stringify(n)}`;return zn(r,()=>t(...n),a)},Sa=(s,t=3)=>(...a)=>I(void 0,null,function*(){return Kn(()=>s(...a),{maxAttempts:t})}),ka=(s,t)=>(...a)=>I(void 0,null,function*(){return ze.timeApiCall(()=>t(...a),s,{args:a.length})}),Ca=(s,t,a={})=>{const{useCache:n=!0,ttl:r=null,useRetry:i=!0,maxAttempts:l=3,useMonitoring:d=!0}=a;let o=t;return d&&(o=ka(s,o)),i&&(o=Sa(o,l)),n&&(o=_a(s,o,r)),o},Ue={invalidateCache:{documents:()=>Qe.documents(),stats:()=>Qe.stats(),processing:()=>Qe.processing(),all:()=>Qe.all()},batchApiCalls:s=>I(void 0,null,function*(){const t=performance.now();try{const a=yield Promise.all(s.map(r=>r())),n=performance.now()-t;return a}catch(a){throw Re(a,{action:"BatchApiCalls",callCount:s.length}),a}}),sequentialApiCalls:(s,t=100)=>I(void 0,null,function*(){const a=[];for(let n=0;n<s.length;n++)try{const r=yield s[n]();a.push(r),n<s.length-1&&t>0&&(yield new Promise(i=>setTimeout(i,t)))}catch(r){throw Re(r,{action:"SequentialApiCall",callIndex:n,totalCalls:s.length}),r}return a}),checkHealth:()=>I(void 0,null,function*(){try{return{status:"healthy",response:(yield $t.get("/health",{timeout:5e3})).data,timestamp:new Date().toISOString()}}catch(s){return{status:"unhealthy",error:s.message,timestamp:new Date().toISOString()}}}),getApiStats:()=>({performance:ze.getStats(),errors:Xe.getStats(),cache:{}})},Qn=Object.freeze(Object.defineProperty({__proto__:null,api:V,apiEndpoints:X,apiUtils:Ue,bm25Api:Ae,bm25Endpoints:_e,chatEndpoints:we,createCachedApiCall:_a,createEnhancedApiCall:Ca,createMonitoredApiCall:ka,createRetryableApiCall:Sa,createSSEConnection:wa},Symbol.toStringTag,{value:"Module"})),Aa=(s,t={})=>{const[a,n]=u.useState(null),[r,i]=u.useState(!1),[l,d]=u.useState(null),[o,c]=u.useState([]),p=u.useRef(null),{autoConnect:m=!0,maxHistorySize:w=100,onMessage:f=null,onError:j=null,onConnect:k=null,onDisconnect:x=null}=t,y=u.useCallback(h=>{n(h),d(null),c(A=>[...A,L(R({},h),{timestamp:new Date})].slice(-w)),f&&f(h)},[f,w]),C=u.useCallback(h=>{d(h),i(!1),j&&j(h),x&&x()},[j,x]),P=u.useCallback(()=>{p.current&&p.current.close();try{return p.current=wa(s,y,C),p.current.onopen=()=>{i(!0),d(null),k&&k()},!0}catch(h){return d(h),!1}},[s,y,C,k]),S=u.useCallback(()=>{p.current&&(p.current.close(),p.current=null,i(!1),x&&x())},[x]),_=u.useCallback((h=1)=>{if(h>5)return!1;const $=1e3*Math.pow(2,h-1);return setTimeout(()=>{P()||_(h+1)},$),!0},[P]),v=u.useCallback(()=>{c([])},[]);return u.useEffect(()=>(m&&s&&P(),()=>{S()}),[s,m,P,S]),u.useEffect(()=>{if(l&&r===!1&&m&&s){const h=setTimeout(()=>{_()},2e3);return()=>clearTimeout(h)}},[l,r,m,_,s]),{data:a,isConnected:r,error:l,messageHistory:o,connect:P,disconnect:S,reconnect:_,clearHistory:v}},Gn=(s="Unknown")=>{const[t,a]=u.useState([]),[n,r]=u.useState(!1),i=u.useRef(null);u.useEffect(()=>(i.current=Xe.onError(j=>{(j.context.component===s||j.context.component==="Global")&&(a(k=>[j,...k.slice(0,9)]),r(!0))}),()=>{i.current&&i.current()}),[s]);const l=u.useCallback((j,k={})=>Xe.handle(j,R({component:s},k)),[s]),d=u.useCallback((j,k="API Call")=>l(j,{action:k,category:ke.API}),[l]),o=u.useCallback((j,k="Unknown")=>l(j,{action:`Validation: ${k}`,category:ke.VALIDATION,severity:Bn.MEDIUM}),[l]),c=u.useCallback((j,k="Processing")=>l(j,{action:k,category:ke.PROCESSING}),[l]),p=u.useCallback(()=>{a([]),r(!1)},[]),m=u.useCallback(j=>{a(k=>k.filter(x=>x.id!==j)),r(k=>t.length>1)},[t.length]),w=u.useCallback(()=>t.filter(j=>!(!j||typeof j!="object"||!j.id)).map(j=>{try{const k={id:String(j.id||"unknown"),message:String(j.message||"Unknown error occurred"),severity:String(j.severity||"medium"),timestamp:String(j.timestamp||new Date().toISOString()),retryable:!!j.retryable};try{const x=Hn(j);x&&typeof x=="string"&&(k.message=x)}catch(x){}return k}catch(k){return{id:"error-processing-"+Date.now(),message:"Error processing error message",severity:"medium",timestamp:new Date().toISOString(),retryable:!1}}}),[t]),f={hasError:n,errorCount:t.length,latestError:t[0]||null,errors:t,messages:w()};return L(R({},f),{handleError:l,handleApiError:d,handleValidationError:o,handleProcessingError:c,clearErrors:p,clearError:m})},Jn=()=>{const[s,t]=u.useState({totalCalls:0,averageResponseTime:0,slowCalls:0,errorRate:0,recentCalls:[]}),a=u.useCallback((n,r)=>I(void 0,null,function*(){const i=performance.now();let l=!0,d=null;try{return yield n()}catch(o){throw l=!1,d=o.message,o}finally{const o=performance.now()-i;t(c=>{const m=[{endpoint:r,duration:Math.round(o),success:l,error:d,timestamp:new Date().toISOString()},...c.recentCalls.slice(0,19)],w=c.totalCalls+1,f=c.slowCalls+(o>2e3?1:0),j=m.filter(k=>!k.success).length;return{totalCalls:w,averageResponseTime:Math.round(m.reduce((k,x)=>k+x.duration,0)/m.length),slowCalls:f,errorRate:Math.round(j/m.length*100),recentCalls:m}})}}),[]);return{metrics:s,timeApiCall:a}},Ea=s=>s?{id:s.id||s.chunk_id||os(),title:s.title||s.url||"Untitled Document",url:s.url||"",contentType:s.content_type||s.contentType||"document",processedAt:s.processed_at||s.processedAt||s.created_time||s.created_at,chunkCount:s.chunk_count||s.chunkCount||0,status:s.status||"completed",sentiment:s.sentiment||"neutral",technicalLevel:s.technical_level||s.technicalLevel||"intermediate",summary:s.summary||"",mainTopics:s.main_topics||s.mainTopics||[],keyEntities:s.key_entities||s.keyEntities||{},usesContextualEmbedding:s.uses_contextual_embedding||s.usesContextualEmbedding||!1,uploadSource:s.upload_source||s.uploadSource||"user"}:null,Xt=s=>s?{id:s.chunk_id||s.id||os(),index:s.chunk_index||s.index||0,text:s.chunk_text||s.text||"",url:s.url||"",title:s.title||"Untitled",status:s.status||"completed",sentiment:s.sentiment||"neutral",technicalLevel:s.technical_level||s.technicalLevel||"intermediate",contentType:s.content_type||s.contentType||"text",mainTopics:s.main_topics||s.mainTopics||[],keyEntities:s.key_entities||s.keyEntities||{},contextualSummary:s.contextual_summary||s.contextualSummary||null,usesContextualEmbedding:s.uses_contextual_embedding||s.usesContextualEmbedding||!1,embedding:s.embedding||null,people:s.people||[],organizations:s.organizations||[],locations:s.locations||[],emotions:s.emotions||[],keyConcepts:s.key_concepts||s.keyConcepts||[]}:null,Es=s=>!s||!Array.isArray(s)?[]:s.map(t=>({id:t.id||os(),score:t.score||0,document:Ea(t.document||t),chunk:t.chunk?Xt(t.chunk):null,highlight:t.highlight||"",type:t.type||"document"})),os=()=>Math.random().toString(36).substr(2,9),ds=()=>{const[s,t]=u.useState(!1),[a,n]=u.useState(null),r=u.useRef(null),{handleApiError:i,clearErrors:l}=Gn("useAPI"),{timeApiCall:d,metrics:o}=Jn(),c=u.useCallback((A,b,...$)=>I(void 0,[A,b,...$],function*(S,_,v={},...h){t(!0),n(null),l(),r.current&&r.current.abort(),r.current=new AbortController;try{const E=Ca(_,S,{useCache:v.useCache!==!1,ttl:v.ttl||G.documents,useRetry:v.useRetry!==!1,maxAttempts:v.maxAttempts||3,useMonitoring:v.useMonitoring!==!1}),U=yield d(()=>E(...h),_);return(U==null?void 0:U.data)||U}catch(E){if(E.name==="AbortError")return null;const U=i(E,_);throw n(U),E}finally{t(!1),r.current=null}}),[i,l,d]),p={getAll:u.useCallback(S=>I(void 0,null,function*(){const _=yield c(X.getDocuments,"documents",{ttl:G.documents},S);return{documents:(Array.isArray(_)?_:(_==null?void 0:_.documents)||[]).map(Ea)||[]}}),[c]),getChunks:u.useCallback((S,_)=>I(void 0,null,function*(){var h;const v=yield c(X.getDocumentChunks,`document-chunks-${S}`,{ttl:G.documents},S,_);return L(R({},v),{chunks:((h=v==null?void 0:v.chunks)==null?void 0:h.map(Xt))||[]})}),[c]),getSummary:u.useCallback(S=>c(X.getDocumentSummary,`document-summary-${S}`,{ttl:G.documents},S),[c])},m={processUrl:u.useCallback(S=>c(X.processUrl,"process-url",{useCache:!1},S),[c]),processUrlStream:u.useCallback(S=>c(X.processUrlStream,"process-url-stream",{useCache:!1},S),[c]),processFile:u.useCallback(S=>c(X.processFile,"process-file",{useCache:!1},S),[c]),processFileStream:u.useCallback(S=>c(X.processFileStream,"process-file-stream",{useCache:!1},S),[c]),getQueue:u.useCallback(()=>c(X.getInProgress,"processing-queue",{ttl:G.realtime}),[c]),stopProcessing:u.useCallback(S=>c(X.stopProcessing,"stop-processing",{useCache:!1},S),[c]),getStats:u.useCallback(()=>c(X.getCompletedUploads,"processing-stats",{ttl:G.stats}),[c])},w={search:u.useCallback(S=>I(void 0,null,function*(){const _=yield c(X.search,"search",{ttl:G.documents},S);return Es(_)}),[c]),searchGrouped:u.useCallback(S=>I(void 0,null,function*(){const _=yield c(X.searchGrouped,"search-grouped",{ttl:G.documents},S);return Es(_)}),[c]),bm25Search:u.useCallback((S,_,v)=>c(_e.search,`bm25-${S}`,{ttl:G.documents},S,_,v),[c])},f={getKnowledgeBase:u.useCallback(()=>c(X.getKnowledgeBaseStats,"kb-stats",{ttl:G.stats}),[c]),getDatabase:u.useCallback(()=>c(X.getDatabaseStats,"db-stats",{ttl:G.stats}),[c]),getHealth:u.useCallback(()=>c(X.getHealth,"health",{ttl:G.realtime}),[c]),getPipelineHealth:u.useCallback(()=>c(X.getPipelineHealth,"pipeline-health",{ttl:G.realtime}),[c]),getQdrantActivity:u.useCallback(()=>c(X.getQdrantActivity,"qdrant-activity",{ttl:G.realtime}),[c]),getBM25Stats:u.useCallback(()=>c(_e.getStats,"bm25-stats",{ttl:G.stats}),[c]),getBM25Health:u.useCallback(()=>c(_e.getHealth,"bm25-health",{ttl:G.realtime}),[c])},j={getRecentRecords:u.useCallback(S=>c(X.getRecentRecords,"recent-records",{ttl:G.realtime},S),[c]),getInProgress:u.useCallback(()=>c(X.getInProgress,"in-progress",{ttl:G.realtime}),[c]),getCompletedUploads:u.useCallback(S=>c(X.getCompletedUploads,"completed-uploads",{ttl:G.stats},S),[c]),getChunks:u.useCallback(S=>I(void 0,null,function*(){const _=yield c(X.getChunks,"chunks",{ttl:G.documents},S);return(_==null?void 0:_.map(Xt))||[]}),[c])},k={createIndex:u.useCallback((S,_,v)=>c(_e.createIndex,`bm25-create-${S}`,{useCache:!1},S,_,v),[c]),deleteIndex:u.useCallback(S=>c(_e.deleteIndex,`bm25-delete-${S}`,{useCache:!1},S),[c]),search:u.useCallback((S,_,v)=>c(_e.search,`bm25-search-${S}`,{ttl:G.documents},S,_,v),[c]),getStats:u.useCallback(()=>c(_e.getStats,"bm25-stats",{ttl:G.stats}),[c]),getHealth:u.useCallback(()=>c(_e.getHealth,"bm25-health",{ttl:G.realtime}),[c])},x={sendMessage:u.useCallback(S=>c(we.sendMessage,"chat-message",{useCache:!1},S),[c]),getConversation:u.useCallback(S=>c(we.getConversation,`conversation-${S}`,{ttl:G.documents},S),[c]),getConversations:u.useCallback(S=>c(we.getConversations,"conversations",{ttl:G.stats},S),[c]),deleteConversation:u.useCallback(S=>c(we.deleteConversation,`delete-conversation-${S}`,{useCache:!1},S),[c]),getStats:u.useCallback(()=>c(we.getStats,"chat-stats",{ttl:G.stats}),[c]),searchRAG:u.useCallback((S,_)=>c(we.searchRAG,"rag-search",{ttl:G.documents},S,_),[c]),pipelineQuery:u.useCallback(S=>c(we.pipelineQuery,"pipeline-query",{useCache:!1},S),[c]),getPipelineStatus:u.useCallback(()=>c(we.getPipelineStatus,"pipeline-status",{ttl:G.realtime}),[c])},y=u.useCallback(()=>{r.current&&r.current.abort()},[]),C={getChunkingSettings:u.useCallback(()=>c(X.getChunkingSettings,"chunking-settings",{ttl:G.stats}),[c]),updateChunkingSettings:u.useCallback(S=>c(X.updateChunkingSettings,"update-chunking-settings",{useCache:!1},S),[c])},P={invalidateCache:Ue.invalidateCache,batchApiCalls:Ue.batchApiCalls,sequentialApiCalls:Ue.sequentialApiCalls,checkHealth:Ue.checkHealth,getApiStats:Ue.getApiStats};return{loading:s,error:a,performanceMetrics:o,documents:p,processing:m,search:w,stats:f,data:j,bm25:k,chat:x,settings:C,utils:P,cancelRequest:y,clearError:l}},Zn=()=>{const[s,t]=u.useState({bm25:[],semantic:[],combined:[]}),[a,n]=u.useState(!1),[r,i]=u.useState(null),l=ds(),d=u.useCallback((p,...m)=>I(void 0,[p,...m],function*(o,c={}){var C,P;const{filename:w="default",maxResults:f=10,bm25Weight:j=.5,semanticWeight:k=.5,enableBM25:x=!0,enableSemantic:y=!0}=c;n(!0),i(null);try{const S=[];x&&S.push(l.bm25.search(w,o,f).then(b=>({type:"bm25",data:(b==null?void 0:b.results)||[]})).catch(b=>({type:"bm25",data:[],error:L(R({},b),{severity:"medium",category:"search"})}))),y&&S.push(l.search.search({q:o,limit:f,type:"semantic"}).then(b=>({type:"semantic",data:(b==null?void 0:b.results)||[]})).catch(b=>({type:"semantic",data:[],error:L(R({},b),{severity:"medium",category:"search"})})));const _=yield Promise.all(S),v=((C=_.find(b=>b.type==="bm25"))==null?void 0:C.data)||[],h=((P=_.find(b=>b.type==="semantic"))==null?void 0:P.data)||[],A=Xn(v,h,j,k);return t({bm25:v,semantic:h,combined:A.slice(0,f)}),{bm25:v,semantic:h,combined:A.slice(0,f)}}catch(S){throw i(S.message),S}finally{n(!1)}}),[l]);return{results:s,loading:a,error:r,hybridSearch:d}},Xn=(s,t,a,n)=>{const r=new Map;return s.forEach((i,l)=>{const d=i.chunk_id||i.id;r.set(d,L(R({},i),{bm25Score:i.score||0,bm25Rank:l+1,semanticScore:0,semanticRank:null,combinedScore:(i.score||0)*a,source:"bm25"}))}),t.forEach((i,l)=>{const d=i.chunk_id||i.id;if(r.has(d)){const o=r.get(d);o.semanticScore=i.score||0,o.semanticRank=l+1,o.combinedScore=o.bm25Score*a+(i.score||0)*n,o.source="hybrid"}else r.set(d,L(R({},i),{bm25Score:0,bm25Rank:null,semanticScore:i.score||0,semanticRank:l+1,combinedScore:(i.score||0)*n,source:"semantic"}))}),Array.from(r.values()).sort((i,l)=>l.combinedScore-i.combinedScore)},Yn="modulepreload",er=function(s){return"/"+s},Ts={},hs=function(t,a,n){if(!a||a.length===0)return t();const r=document.getElementsByTagName("link");return Promise.all(a.map(i=>{if(i=er(i),i in Ts)return;Ts[i]=!0;const l=i.endsWith(".css"),d=l?'[rel="stylesheet"]':"";if(!!n)for(let p=r.length-1;p>=0;p--){const m=r[p];if(m.href===i&&(!l||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${d}`))return;const c=document.createElement("link");if(c.rel=l?"stylesheet":Yn,l||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),l)return new Promise((p,m)=>{c.addEventListener("load",p),c.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>t()).catch(i=>{const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i})},Ps=()=>{const{documents:s,handleDocumentSelect:t,settings:a}=te(),[n,r]=u.useState([]),[i,l]=u.useState(new Set),[d,o]=u.useState(new Set),[c,p]=u.useState(new Set),[m,w]=u.useState(new Set),[f,j]=u.useState(8),k=u.useRef([]),x=u.useRef(new Map),y=u.useRef(null),C={queued:{bg:"bg-gray-700",text:"text-gray-300",border:"border-gray-600",icon:Ne,pulse:!1},processing:{bg:"bg-yellow-900",text:"text-yellow-300",border:"border-yellow-700",icon:De,pulse:!0},completed:{bg:"bg-green-900",text:"text-green-300",border:"border-green-700",icon:he,pulse:!1},error:{bg:"bg-red-900",text:"text-red-300",border:"border-red-700",icon:de,pulse:!1}},P=()=>{if(!y.current)return 8;const h=y.current.offsetWidth,A=window.innerWidth>=768?192:window.innerWidth>=640?176:160,b=16,$=Math.floor((h+b)/(A+b));return Math.max(1,$)};u.useEffect(()=>{const h=()=>{const A=P();A!==f&&j(A)};return h(),window.addEventListener("resize",h),()=>window.removeEventListener("resize",h)},[f]),u.useEffect(()=>{const h=new Set(k.current.map(F=>F.id)),A=new Set(s.map(F=>F.id)),b=new Set([...A].filter(F=>!h.has(F)));b.size>0;const $=s.slice().sort((F,ae)=>new Date(ae.created_time||ae.processedAt)-new Date(F.created_time||F.processedAt)),E=k.current.slice().sort((F,ae)=>new Date(ae.created_time||ae.processedAt)-new Date(F.created_time||F.processedAt)),U=$[0],W=E[0];U&&(!W||U.id!==W.id)&&b.add(U.id);const q=new Set(k.current.filter(F=>F.processingStatus==="completed").map(F=>F.id)),H=new Set(s.filter(F=>F.processingStatus==="completed").map(F=>F.id)),se=new Set([...H].filter(F=>!q.has(F))),Q=new Set([...b,...se]);if(Q.size>0){Q.forEach(ee=>{x.current.has(ee)&&(clearTimeout(x.current.get(ee)),x.current.delete(ee))});const F=new Set(k.current.filter(ee=>!Q.has(ee.id)).map(ee=>ee.id));l(Q),o(F);const ae=setTimeout(()=>{l(new Set),o(new Set),p(Q);const ee=setTimeout(()=>{p(new Set),w(Q);const oe=setTimeout(()=>{w(ue=>{const Ie=new Set(ue);return Q.forEach(Oe=>Ie.delete(Oe)),Ie}),Q.forEach(ue=>{x.current.delete(ue)})},1e3);Q.forEach(ue=>{x.current.set(ue,oe)})},1900);Q.forEach(oe=>{x.current.set(oe,ee)})},600);Q.forEach(ee=>{x.current.set(ee,ae)})}const Z=s.slice(0,f);r(Z),k.current=s},[s,f]),u.useEffect(()=>()=>{x.current.forEach(h=>clearTimeout(h)),x.current.clear()},[]);const S=h=>({pdf:re,url:pa,file:re,book:Ss,article:re,academic:cn,reference:Ss})[h]||re,_=h=>h.title||h.url||"Untitled Document",v=h=>h.processingProgress?`${Math.round(h.processingProgress.percentage||0)}%`:"";return n.length===0?e.jsx("div",{className:"flex items-center justify-center min-h-[400px] text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-8xl mb-4 animate-bounce-gentle",children:"🦙"}),e.jsx("h3",{className:"text-2xl font-bold mb-2",children:"No Documents Yet"}),e.jsx("p",{className:"text-lg text-gray-600 mb-4",children:"Your digital pasture is empty! Upload some content to get started."}),e.jsxs("div",{className:"text-sm text-gray-500 space-y-1",children:[e.jsx("p",{children:"• Upload PDFs, documents, or paste URLs"}),e.jsx("p",{children:"• AI will analyze and create contextual embeddings"}),e.jsx("p",{children:"• Search and chat with your processed content"})]})]})}):e.jsx("div",{className:"space-y-6",children:e.jsx("div",{ref:y,className:"flex gap-4 justify-start overflow-hidden",style:{alignItems:"flex-start"},children:n.map((h,A)=>{const b=C[h.processingStatus]||C.queued,$=S(h.contentType),E=b.icon,U=h.chunkCount||0,W=_(h),q=v(h),H=i.has(h.id),se=d.has(h.id),Q=c.has(h.id),Z=m.has(h.id),F=(H||Q||Z)&&h.processingStatus==="completed";return e.jsxs("div",{onClick:()=>t(h),className:`
                document-block relative overflow-hidden rounded-lg border-2 cursor-pointer p-3
                transition-all duration-300 hover:shadow-lg hover:shadow-primary-500/20
                ${b.bg} ${b.border} ${b.pulse?"animate-processing":""}
                ${H?"animate-slide-in-from-left":""}
                ${se?"animate-shift-right":""}
                ${Q?"animate-highlight-new":""}
                ${Z?"animate-fade-to-normal":""}
                ${F?"animate-mempool-glow":""}
                w-40 h-40 sm:w-44 sm:h-44 md:w-48 md:h-48 flex-shrink-0
              `,title:`${W} - ${h.processingStatus}`,style:{"--normal-border":b.border.includes("gray-600")?"#4b5563":b.border.includes("yellow-700")?"#a16207":b.border.includes("green-700")?"#15803d":b.border.includes("red-700")?"#b91c1c":"#4b5563","--normal-bg":b.bg.includes("gray-700")?"#374151":b.bg.includes("yellow-900")?"#451a03":b.bg.includes("green-900")?"#14532d":b.bg.includes("red-900")?"#450a0a":"#374151"},children:[e.jsx("div",{className:"absolute inset-0 opacity-5",children:e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-white to-transparent"})}),e.jsxs("div",{className:"relative h-full flex flex-col justify-between",children:[e.jsxs("div",{className:"flex items-start justify-between gap-1 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1 min-w-0 flex-1",children:[e.jsx($,{className:"w-4 h-4 text-primary-400 flex-shrink-0"}),e.jsx("h3",{className:"font-semibold text-white truncate text-xs",children:W})]}),e.jsx(E,{className:`w-3 h-3 flex-shrink-0 ${b.text}`})]}),e.jsxs("div",{className:"space-y-1 flex-1",children:[h.summary&&e.jsx("p",{className:"text-xs text-gray-400 line-clamp-2",children:h.summary}),h.mainTopics&&h.mainTopics.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[h.mainTopics.slice(0,2).map((ae,ee)=>e.jsx("span",{className:"px-1.5 py-0.5 bg-primary-600 bg-opacity-20 text-primary-300 text-xs rounded-full",children:ae},ee)),h.mainTopics.length>2&&e.jsxs("span",{className:"px-1.5 py-0.5 text-gray-400 text-xs",children:["+",h.mainTopics.length-2]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2 pt-1 border-t border-gray-600 border-opacity-30",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:`text-xs font-medium ${b.text}`,children:h.processingStatus==="error"?"Error":`${U}`}),q&&e.jsx("span",{className:"text-xs text-gray-400",children:q})]}),h.usesContextualEmbedding&&e.jsx("div",{className:"flex items-center",title:"Uses Contextual Embeddings",children:e.jsx("span",{className:"text-xs font-bold text-green-400",children:"🧠"})})]}),h.processingStatus==="processing"&&h.processingProgress&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gray-700",children:e.jsx("div",{className:"h-full bg-yellow-400 transition-all duration-300",style:{width:`${h.processingProgress.percentage||0}%`}})})]})]},h.id||A)})})})},tr=()=>{var ae,ee,oe,ue,Ie,Oe,nt,rt,it,lt,qe;const s=u.useRef(null),t=u.useRef(null),[a,n]=u.useState(!0),[r,i]=u.useState(1),[l,d]=u.useState(.7),[o,c]=u.useState(!1),[p,m]=u.useState(null),[w,f]=u.useState({x:0,y:0}),{systemStats:j,documents:k,api:x,sse:y,handleDocumentSelect:C,uploadQueue:P}=te(),[S,_]=u.useState([]),v=u.useRef([]),[h,A]=u.useState([]),b=u.useMemo(()=>{const D=[...h];return P.forEach(g=>{(g.status==="processing"||g.status==="uploading")&&(D.some(N=>N.filename===g.name||N.sessionId&&N.sessionId===g.sessionId)||D.push({id:g.id,sessionId:g.sessionId||g.id,filename:g.name,status:g.status==="uploading"?"uploading":"processing",progress:g.progress||0,source:"upload_queue"}))}),{totalProcessingCount:D.filter(g=>g.status==="processing"||g.status==="uploading").length,apiProcessingCount:h.filter(g=>g.status==="processing").length,uploadProcessingCount:P.filter(g=>g.status==="processing"||g.status==="uploading").length,mergedQueueData:D}},[h,P]),[$,E]=u.useState({width:1200,height:400});u.useEffect(()=>{const D=()=>{if(s.current){const T=s.current.parentElement.getBoundingClientRect();E({width:T.width,height:Math.min(400,Math.max(300,T.height*.6))})}};return D(),window.addEventListener("resize",D),()=>window.removeEventListener("resize",D)},[]),u.useEffect(()=>{const D=()=>I(void 0,null,function*(){try{const M=yield x.data.getInProgress();A(M||[])}catch(M){A([])}});D();const T=b.totalProcessingCount>0?3e3:8e3,N=setInterval(D,T);return()=>clearInterval(N)},[x,P.length,h.length]),u.useEffect(()=>{},[P]);const U=u.useCallback(()=>{var T;const D=[];k&&k.length>0&&k.slice(0,20).forEach((N,M)=>{var B;const O=N.processingStatus||"completed";D.push({id:`doc-${N.url||M}`,type:"document",x:-100-M*150,y:50+M%3*100,width:Math.max(60,Math.min(120,(((B=N.title)==null?void 0:B.length)||50)*2)),height:30,speed:.5+Math.random()*1,status:O,data:N,opacity:1})}),b.mergedQueueData.forEach((N,M)=>{var B;const O=N.source==="upload_queue";D.push({id:`processing-${N.id||M}`,type:O?"processing_upload":"processing",x:-50-M*100,y:180+M%3*60,width:Math.max(60,Math.min(140,(((B=N.filename)==null?void 0:B.length)||20)*3)),height:O?30:25,speed:1+Math.random()*1.5,status:N.status||"processing",data:{type:O?"upload_processing":"processing_event",sessionId:N.sessionId,fileName:N.filename,status:N.status,progress:N.progress,source:N.source},opacity:.9})});const g=((T=j.knowledgeBase)==null?void 0:T.total_chunks)||0;if(g>0)for(let N=0;N<Math.min(10,g/1e3);N++)D.push({id:`chunks-${N}`,type:"chunks",x:-30-N*80,y:320+N%2*30,width:15,height:15,speed:2+Math.random()*2,status:"completed",data:{type:"chunk_batch",count:Math.floor(g/10)},opacity:.6});return D},[k,j,b]);u.useEffect(()=>{const D=U();v.current=D,_(D)},[U]),u.useEffect(()=>{if(!y.isConnected)return;const D=g=>{var T,N,M,O,B;if(g){if(g.event==="parse"&&g.data&&g.data.message&&g.data.message.includes("chunks")){const K={id:`processing-file-${Date.now()}`,type:"processing_file",x:-100-Math.random()*50,y:150+Math.random()*100,width:120,height:40,speed:.6+Math.random()*.4,status:"processing",data:{type:"processing_file",message:g.data.message,progress:g.data.progress||0,stage:"parsing"},opacity:.9};v.current=[...v.current,K]}if(g.step==="chunk_processing_start"&&g.chunkData){const K={id:`processing-chunk-${g.chunkData.chunkId}-${Date.now()}`,type:"processing_chunk",x:-100-Math.random()*50,y:100+g.chunkData.position*200+Math.random()*30,width:Math.max(80,Math.min(150,(((T=g.chunkData.title)==null?void 0:T.length)||20)*3)),height:35,speed:.8+Math.random()*.7,status:"processing",data:{type:"processing_chunk",chunkId:g.chunkData.chunkId,sessionId:g.chunkData.sessionId,title:g.chunkData.title,currentChunk:g.chunkData.currentChunk,totalChunks:g.chunkData.totalChunks,preview:g.chunkData.preview,stage:"analyzing"},opacity:.95};v.current=[...v.current,K]}if(g.step&&g.chunkData&&["analyze","analyze_complete","context_generate","context_complete","embedding","embed_complete","storing","store_complete"].includes(g.step)&&(v.current=v.current.map(K=>K.type==="processing_chunk"&&K.data.chunkId===g.chunkData.chunkId?L(R({},K),{data:L(R({},K.data),{stage:g.step.replace("_complete","").replace("_generate","").replace("_storing","")}),status:g.step.includes("_complete")?"completing":"processing"}):K)),g.step==="chunk_processing_complete"&&g.chunkData&&(v.current=v.current.map(K=>K.type==="processing_chunk"&&K.data.chunkId===g.chunkData.chunkId?L(R({},K),{status:"completed",data:L(R({},K.data),{stage:"completed"}),speed:K.speed*1.5}):K)),g.event&&["upload","complete","session"].includes(g.event)){const K=v.current.findIndex(me=>me.type==="processing_file"&&me.id.includes("processing-file"));if(K>=0)v.current[K]=L(R({},v.current[K]),{data:L(R({},v.current[K].data),{stage:g.event,message:((N=g.data)==null?void 0:N.message)||g.event,progress:((M=g.data)==null?void 0:M.progress)||0})});else if(g.event!=="complete"){const me={id:`processing-file-${Date.now()}`,type:"processing_file",x:-100-Math.random()*50,y:150+Math.random()*100,width:120,height:40,speed:.6+Math.random()*.4,status:"processing",data:{type:"processing_file",message:((O=g.data)==null?void 0:O.message)||g.event,progress:((B=g.data)==null?void 0:B.progress)||0,stage:g.event},opacity:.9};v.current=[...v.current,me]}}if(g.step==="process"||g.step==="processing_progress"){const K={id:`live-processing-${Date.now()}`,type:"processing",x:-50,y:250+Math.random()*80,width:45,height:25,speed:1.5+Math.random(),status:"processing",data:{type:"live_event",sessionId:g.sessionId||"unknown"},opacity:.8};v.current=[...v.current,K]}}};y.data&&D(y.data)},[y.isConnected,y.data]);const W=(D,g=null,T=null)=>{if(T==="processing_upload")switch(D){case"uploading":return"#ea580c";case"processing":return"#f97316";case"completed":return"#10b981";case"failed":return"#ef4444";default:return"#fb923c"}switch(D){case"processing":if(g)switch(g){case"analyzing":return"#f59e0b";case"analyze":return"#f59e0b";case"context":return"#8b5cf6";case"embedding":return"#06b6d4";case"storing":return"#84cc16";case"completing":return"#10b981";default:return"#f59e0b"}return"#f59e0b";case"completed":return"#10b981";case"completing":return"#22c55e";case"failed":return"#ef4444";case"queued":return"#6b7280";default:return"#3b82f6"}},q=D=>{switch(D){case"document":return{borderRadius:8,shadow:!0};case"processing":return{borderRadius:4,pulse:!0};case"processing_upload":return{borderRadius:6,pulse:!0,border:!0};case"processing_chunk":return{borderRadius:6,shadow:!0,pulse:!0,border:!0};case"chunks":return{borderRadius:2,glow:!0};default:return{borderRadius:4}}},H=u.useCallback(()=>{if(!s.current||!a)return;const D=s.current,g=D.getContext("2d");g.clearRect(0,0,D.width,D.height),v.current=v.current.map(T=>{var B,K;const N=L(R({},T),{x:T.x+T.speed*r*2});N.x>D.width+100&&(N.x=-100-Math.random()*200,N.y=50+Math.random()*(D.height-100));const M=q(T.type),O=W(T.status,(B=T.data)==null?void 0:B.stage,T.type);if(g.save(),M.shadow&&(g.shadowColor=O,g.shadowBlur=T.type==="processing_chunk"?15:10,g.shadowOffsetX=2,g.shadowOffsetY=2),g.globalAlpha=T.opacity*l,g.fillStyle=O,M.borderRadius?se(g,N.x,N.y,N.width,N.height,M.borderRadius):g.fillRect(N.x,N.y,N.width,N.height),M.border&&T.type==="processing_chunk"&&(g.globalAlpha=.8*l,g.strokeStyle=O,g.lineWidth=2,g.strokeRect(N.x-1,N.y-1,N.width+2,N.height+2)),M.pulse&&(T.status==="processing"||T.status==="completing")){const me=T.type==="processing_chunk"?.006:.005,ct=.3+.4*Math.sin(Date.now()*me);g.globalAlpha=ct*l,g.strokeStyle=O,g.lineWidth=T.type==="processing_chunk"?3:2;const $e=T.type==="processing_chunk"?3:2;g.strokeRect(N.x-$e,N.y-$e,N.width+$e*2,N.height+$e*2)}return T.type==="processing_chunk"&&((K=T.data)!=null&&K.stage)&&N.width>60&&(g.globalAlpha=.9*l,g.fillStyle="#ffffff",g.font="10px monospace",g.textAlign="center",g.fillText(T.data.stage.substring(0,8),N.x+N.width/2,N.y+N.height/2+3)),M.glow&&(g.globalAlpha=.4*l,g.fillStyle=O,g.fillRect(N.x-1,N.y-1,N.width+2,N.height+2)),g.restore(),N}),t.current=requestAnimationFrame(H)},[a,r,l]);u.useEffect(()=>(a?t.current=requestAnimationFrame(H):t.current&&cancelAnimationFrame(t.current),()=>{t.current&&cancelAnimationFrame(t.current)}),[H,a]);const se=(D,g,T,N,M,O)=>{D.beginPath(),D.moveTo(g+O,T),D.lineTo(g+N-O,T),D.quadraticCurveTo(g+N,T,g+N,T+O),D.lineTo(g+N,T+M-O),D.quadraticCurveTo(g+N,T+M,g+N-O,T+M),D.lineTo(g+O,T+M),D.quadraticCurveTo(g,T+M,g,T+M-O),D.lineTo(g,T+O),D.quadraticCurveTo(g,T,g+O,T),D.closePath(),D.fill()},Q=D=>{const g=s.current;if(!g)return;const T=g.getBoundingClientRect(),N=D.clientX-T.left,M=D.clientY-T.top;f({x:D.clientX,y:D.clientY});const O=v.current.find(B=>N>=B.x&&N<=B.x+B.width&&M>=B.y&&M<=B.y+B.height);m(O||null)},Z=()=>{m(null)},F=D=>{const g=s.current;if(!g)return;const T=g.getBoundingClientRect(),N=D.clientX-T.left,M=D.clientY-T.top,O=v.current.find(B=>N>=B.x&&N<=B.x+B.width&&M>=B.y&&M<=B.y+B.height);O&&O.type==="document"&&O.data&&C&&O.data&&C(O.data)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx("span",{className:"text-3xl",children:"🌊"}),"Flowing Dashboard"]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400"}),e.jsx("span",{children:"Live Processing"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>n(!a),className:"p-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors",title:a?"Pause":"Play",children:a?e.jsx(on,{className:"w-4 h-4"}):e.jsx(dn,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>c(!o),className:"p-2 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors",title:"Controls",children:e.jsx(Mt,{className:"w-4 h-4"})})]})]}),o&&e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Flow Speed: ",r.toFixed(1),"x"]}),e.jsx("input",{type:"range",min:"0.1",max:"3",step:"0.1",value:r,onChange:D=>i(parseFloat(D.target.value)),className:"w-full"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Density: ",Math.round(l*100),"%"]}),e.jsx("input",{type:"range",min:"0.1",max:"1",step:"0.1",value:l,onChange:D=>d(parseFloat(D.target.value)),className:"w-full"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:()=>{i(1),d(.7)},className:"btn-secondary text-sm",children:"Reset"})})]})}),e.jsxs("div",{className:"card p-0 overflow-hidden relative",children:[e.jsx("canvas",{ref:s,width:$.width,height:$.height,onMouseMove:Q,onMouseLeave:Z,onClick:F,className:"w-full h-full cursor-crosshair",style:{backgroundColor:"#1f2937"}}),e.jsxs("div",{className:"absolute top-4 left-4 bg-gray-900 bg-opacity-80 rounded-lg p-3 text-sm",children:[e.jsx("div",{className:"font-medium mb-2",children:"Legend"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-2 bg-green-500 rounded"}),e.jsx("span",{children:"Completed Documents"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-3 bg-amber-500 rounded border border-amber-300",style:{boxShadow:"0 0 4px rgba(245, 158, 11, 0.5)"}}),e.jsx("span",{children:"Processing Chunks"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-2 bg-amber-500 rounded"}),e.jsx("span",{children:"API Processing"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-5 h-3 bg-orange-500 rounded border border-orange-300"}),e.jsx("span",{children:"File Uploads"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded"}),e.jsx("span",{children:"Chunk Batches"})]})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-700 text-xs text-gray-400",children:[e.jsx("div",{children:"Colors show processing stage:"}),e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[e.jsx("span",{className:"px-1 bg-amber-500 text-black rounded text-xs",children:"analyze"}),e.jsx("span",{className:"px-1 bg-purple-500 text-white rounded text-xs",children:"context"}),e.jsx("span",{className:"px-1 bg-cyan-500 text-black rounded text-xs",children:"embed"}),e.jsx("span",{className:"px-1 bg-lime-500 text-black rounded text-xs",children:"store"})]})]})]}),e.jsxs("div",{className:"absolute top-4 right-4 bg-gray-900 bg-opacity-80 rounded-lg p-3 text-sm",children:[e.jsx("div",{className:"font-medium mb-2",children:"Live Stats"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:["Documents: ",((ae=j.knowledgeBase)==null?void 0:ae.total_documents)||0]}),e.jsxs("div",{children:["Chunks: ",((ee=j.knowledgeBase)==null?void 0:ee.total_chunks)||0]}),e.jsxs("div",{className:"text-amber-400 font-medium",children:["Processing: ",b.totalProcessingCount]}),e.jsxs("div",{className:"text-xs text-gray-400",children:[e.jsxs("div",{children:["• API Queue: ",b.apiProcessingCount]}),e.jsxs("div",{children:["• Upload Queue: ",b.uploadProcessingCount]}),e.jsxs("div",{children:["• Merged Total: ",b.mergedQueueData.length]})]})]})]})]}),p&&e.jsxs("div",{className:"fixed z-50 bg-gray-900 border border-gray-700 rounded-lg p-3 text-sm pointer-events-none shadow-lg",style:{left:w.x+10,top:w.y-10,transform:"translateY(-100%)"},children:[e.jsx("div",{className:"font-medium mb-1",children:p.type==="document"?"Document":p.type==="processing"?"API Processing":p.type==="processing_upload"?"File Upload":p.type==="processing_chunk"?"Processing Chunk":"Chunk Batch"}),e.jsxs("div",{className:"text-gray-300",children:["Status: ",e.jsx("span",{className:"capitalize",children:p.status})]}),p.type==="processing_chunk"&&e.jsxs(e.Fragment,{children:[((oe=p.data)==null?void 0:oe.stage)&&e.jsxs("div",{className:"text-gray-300",children:["Stage: ",e.jsx("span",{className:"text-amber-400 capitalize",children:p.data.stage})]}),((ue=p.data)==null?void 0:ue.currentChunk)&&((Ie=p.data)==null?void 0:Ie.totalChunks)&&e.jsxs("div",{className:"text-gray-300",children:["Progress: ",p.data.currentChunk,"/",p.data.totalChunks]}),((Oe=p.data)==null?void 0:Oe.title)&&e.jsxs("div",{className:"text-gray-300 max-w-xs truncate",children:["Title: ",p.data.title]}),((nt=p.data)==null?void 0:nt.preview)&&e.jsx("div",{className:"text-gray-400 text-xs max-w-xs truncate mt-1",children:p.data.preview})]}),p.type==="processing_upload"&&e.jsxs(e.Fragment,{children:[((rt=p.data)==null?void 0:rt.fileName)&&e.jsxs("div",{className:"text-gray-300 max-w-xs truncate",children:["File: ",p.data.fileName]}),((it=p.data)==null?void 0:it.progress)!==void 0&&e.jsxs("div",{className:"text-gray-300",children:["Progress: ",Math.round(p.data.progress),"%"]}),((lt=p.data)==null?void 0:lt.size)&&e.jsxs("div",{className:"text-gray-400 text-xs",children:["Size: ",(p.data.size/1024/1024).toFixed(1),"MB"]})]}),p.type!=="processing_chunk"&&p.type!=="processing_upload"&&((qe=p.data)==null?void 0:qe.title)&&e.jsx("div",{className:"text-gray-300 max-w-xs truncate",children:p.data.title})]})]})},sr=u.lazy(()=>hs(()=>import("./ProcessingQueue-9c9b2aae.js"),["assets/ProcessingQueue-9c9b2aae.js","assets/vendor-77d0a172.js","assets/icons-212f7396.js","assets/utils-d9662bcb.js"])),ar=u.lazy(()=>hs(()=>import("./StatsPanel-1844a619.js"),["assets/StatsPanel-1844a619.js","assets/vendor-77d0a172.js","assets/icons-212f7396.js","assets/utils-d9662bcb.js"])),nr=()=>{var k,x;const[s,t]=u.useState("documents"),[a,n]=u.useState([]),{documents:r,systemStats:i,sse:l,uploadQueue:d,api:o,loadSystemStats:c,refreshDocuments:p}=te();u.useEffect(()=>{var _;const y=()=>I(void 0,null,function*(){try{const v=yield o.data.getInProgress();n(v||[])}catch(v){n([])}});y();const C=d.length>0||((_=i.processing)==null?void 0:_.totalProcessing)>0,S=setInterval(()=>I(void 0,null,function*(){yield y(),C&&(yield c())}),C?3e3:8e3);return()=>clearInterval(S)},[o,d.length,(k=i.processing)==null?void 0:k.totalProcessing,c]),u.useEffect(()=>{if(!(l!=null&&l.lastMessage))return;const y=l.lastMessage,C=y.type||y.step;(C==="processing_complete"||C==="file_processing_complete"||C==="session_complete"||C==="document_created"||C==="content_processed")&&(c(),setTimeout(()=>{c()},1e3))},[l==null?void 0:l.lastMessage,c]);const w=(()=>{var A,b,$;const y=((A=i.knowledgeBase)==null?void 0:A.total_documents)||0,C=r.filter(E=>E.processingStatus==="processing").length,P=r.filter(E=>E.processingStatus==="completed").length,S=((b=i.knowledgeBase)==null?void 0:b.total_chunks)||0,_={total:d.length,pending:d.filter(E=>E.status==="pending").length,processing:d.filter(E=>E.status==="processing"||E.status==="uploading").length,completed:d.filter(E=>E.status==="completed").length,failed:d.filter(E=>E.status==="error").length},v=a.filter(E=>E.status==="processing").length,h=v+_.processing;return{totalDocs:y,processingDocs:C,completedDocs:P,totalChunks:S,contextualDocs:(($=i.knowledgeBase)==null?void 0:$.contextual_documents)||0,uploadQueue:_,totalProcessingCount:h,apiProcessingCount:v}})(),f=[{id:"documents",label:"Documents",icon:ga,badge:w.totalDocs,component:Ps},{id:"processing",label:"Processing",icon:Ce,badge:w.totalProcessingCount>0?w.totalProcessingCount:null,component:sr},{id:"flowing",label:"Flow View",icon:hn,badge:null,component:tr},{id:"analytics",label:"Analytics",icon:et,badge:null,component:ar}],j=((x=f.find(y=>y.id===s))==null?void 0:x.component)||Ps;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ht,{label:"Total Documents",value:w.totalDocs,icon:"📚",trend:w.totalDocs>0?"+":""}),e.jsx(ht,{label:"Processing Queue",value:w.totalProcessingCount,icon:"⚡",trend:w.totalProcessingCount>0?"active":"empty",pulsing:w.totalProcessingCount>0}),e.jsx(ht,{label:"Total Chunks",value:w.totalChunks,icon:"✂️",trend:w.totalChunks>0?"ready":""}),e.jsx(ht,{label:"Contextual AI",value:w.contextualDocs,icon:"🧠",trend:w.contextualDocs>0?"enhanced":""})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center bg-gray-800 bg-opacity-50 rounded-lg p-1",children:f.map(y=>{const C=y.icon,P=s===y.id;return e.jsxs("button",{onClick:()=>t(y.id),className:`
                  flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all duration-200
                  ${P?"bg-primary-600 text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-gray-700"}
                `,children:[e.jsx(C,{className:"w-4 h-4"}),e.jsx("span",{children:y.label}),y.badge!==null&&y.badge>0&&e.jsx("span",{className:`
                    px-2 py-1 text-xs rounded-full font-bold
                    ${P?"bg-primary-800 text-primary-200":"bg-gray-600 text-gray-200"}
                  `,children:y.badge})]},y.id)})}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-400"}),e.jsx("span",{className:"text-gray-400",children:"System Online"})]}),i.lastUpdated&&e.jsxs("div",{className:"text-gray-500",children:["Updated ",i.lastUpdated.toLocaleTimeString()]})]})]}),e.jsx("div",{className:"min-h-[500px]",children:e.jsx(u.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"animate-spin w-6 h-6 border-2 border-primary-600 border-t-transparent rounded-full"}),e.jsx("span",{className:"text-gray-400",children:"Loading..."})]})}),children:e.jsx(j,{})})}),e.jsx(rr,{})]})},ht=({label:s,value:t,icon:a,trend:n,pulsing:r})=>e.jsx("div",{className:`card p-4 transition-all duration-300 ${r?"animate-pulse-slow ring-2 ring-primary-500 ring-opacity-50":""}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:t}),e.jsx("div",{className:"text-sm text-gray-400",children:s}),n&&e.jsx("div",{className:"text-xs text-primary-400 mt-1",children:n})]}),e.jsx("div",{className:`text-2xl transition-opacity duration-300 ${r?"opacity-80":"opacity-50"}`,children:a})]})}),rr=()=>{const[s,t]=u.useState(!1);return e.jsxs("div",{className:"fixed bottom-6 right-6 z-40",children:[s&&e.jsxs("div",{className:"absolute bottom-16 right-0 bg-gray-800 rounded-lg shadow-2xl border border-gray-700 p-2 space-y-2 min-w-[200px]",children:[e.jsxs("button",{className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-gray-700 rounded-lg transition-colors",children:[e.jsx(Je,{className:"w-4 h-4 text-primary-400"}),e.jsx("span",{children:"Upload Files"})]}),e.jsxs("button",{className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-gray-700 rounded-lg transition-colors",children:[e.jsx(ga,{className:"w-4 h-4 text-primary-400"}),e.jsx("span",{children:"Process URL"})]}),e.jsxs("button",{className:"w-full flex items-center gap-3 px-3 py-2 text-left hover:bg-gray-700 rounded-lg transition-colors",children:[e.jsx(et,{className:"w-4 h-4 text-primary-400"}),e.jsx("span",{children:"View Analytics"})]})]}),e.jsx("button",{onClick:()=>t(!s),className:`
          w-14 h-14 bg-primary-600 hover:bg-primary-500 rounded-full shadow-lg 
          flex items-center justify-center transition-all duration-300 group
          ${s?"rotate-45":"hover:scale-110"}
        `,children:e.jsx("div",{className:"text-2xl group-hover:scale-110 transition-transform",children:s?"✕":"🦙"})})]})},ir=({query:s,results:t,loading:a,error:n,mode:r})=>{var j,k,x,y,C,P;const[i,l]=u.useState("combined"),[d,o]=u.useState("relevance"),{handleDocumentSelect:c,handleChunkSelect:p}=te();if(a)return e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-primary-400 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"ml-3 text-lg",children:"Searching your digital pasture..."})]})});if(n)return e.jsx("div",{className:"card",children:e.jsxs("div",{className:"text-red-400 p-6 bg-red-900 bg-opacity-20 rounded-lg border border-red-700",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:"Search Error"}),e.jsx("p",{children:n})]})});if(!t||!((j=t.combined)!=null&&j.length)&&!((k=t.bm25)!=null&&k.length)&&!((x=t.semantic)!=null&&x.length))return e.jsx("div",{className:"card",children:e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("div",{className:"text-6xl mb-4",children:"🦙"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"No Results Found"}),e.jsxs("p",{className:"text-gray-400",children:['No documents match your search for "',s,'". Try:']}),e.jsxs("ul",{className:"text-sm text-gray-500 mt-4 space-y-1",children:[e.jsx("li",{children:"• Using different keywords or synonyms"}),e.jsx("li",{children:"• Checking your spelling"}),e.jsx("li",{children:"• Using broader search terms"}),e.jsx("li",{children:"• Switching search modes (BM25 ↔ Semantic)"})]})]})});const w=(()=>{switch(i){case"bm25":return t.bm25||[];case"semantic":return t.semantic||[];default:return t.combined||[]}})(),f=cr(w,d);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Search Results"}),e.jsxs("p",{className:"text-gray-400",children:["Found ",w.length,' results for "',s,'"']})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("select",{value:d,onChange:S=>o(S.target.value),className:"input-primary text-sm",children:[e.jsx("option",{value:"relevance",children:"Sort by Relevance"}),e.jsx("option",{value:"date",children:"Sort by Date"}),e.jsx("option",{value:"title",children:"Sort by Title"})]})})]}),r==="hybrid"&&e.jsxs("div",{className:"flex items-center gap-2 bg-gray-800 rounded-lg p-1",children:[e.jsx(zt,{id:"combined",label:"Combined",icon:tt,count:((y=t.combined)==null?void 0:y.length)||0,active:i==="combined",onClick:()=>l("combined"),color:"text-purple-400"}),e.jsx(zt,{id:"bm25",label:"BM25",icon:je,count:((C=t.bm25)==null?void 0:C.length)||0,active:i==="bm25",onClick:()=>l("bm25"),color:"text-yellow-400"}),e.jsx(zt,{id:"semantic",label:"Semantic",icon:Y,count:((P=t.semantic)==null?void 0:P.length)||0,active:i==="semantic",onClick:()=>l("semantic"),color:"text-blue-400"})]})]}),e.jsx("div",{className:"space-y-4",children:f.map((S,_)=>e.jsx(lr,{result:S,query:s,rank:_+1,viewMode:i,onDocumentSelect:c,onChunkSelect:p},S.chunk_id||S.id||_))}),w.length>=20&&e.jsx("div",{className:"text-center",children:e.jsx("button",{className:"btn-secondary",children:"Load More Results"})})]})},zt=({id:s,label:t,icon:a,count:n,active:r,onClick:i,color:l})=>e.jsxs("button",{onClick:i,className:`
      flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all duration-200
      ${r?`bg-gray-700 ${l}`:"text-gray-400 hover:text-white hover:bg-gray-700"}
    `,children:[e.jsx(a,{className:"w-4 h-4"}),e.jsx("span",{children:t}),e.jsx("span",{className:`px-2 py-1 text-xs rounded-full font-bold ${r?"bg-gray-600":"bg-gray-700"}`,children:n})]}),lr=({result:s,query:t,rank:a,viewMode:n,onDocumentSelect:r,onChunkSelect:i})=>{var m,w,f;const[l,d]=u.useState(!1),c=(()=>n==="combined"&&s.combinedScore!==void 0?{score:s.combinedScore,label:"Combined Score",color:"text-purple-400"}:n==="bm25"&&s.bm25Score!==void 0?{score:s.bm25Score,label:"BM25 Score",color:"text-yellow-400"}:n==="semantic"&&s.semanticScore!==void 0?{score:s.semanticScore,label:"Semantic Score",color:"text-blue-400"}:s.score!==void 0?{score:s.score,label:"Relevance",color:"text-gray-400"}:null)(),p=(j,k)=>{if(!j||!k)return j;const x=k.toLowerCase().split(/\s+/);let y=j;return x.forEach(C=>{const P=new RegExp(`(${C})`,"gi");y=y.replace(P,'<mark class="bg-yellow-300 bg-opacity-30 text-yellow-200 px-1 rounded">$1</mark>')}),y};return e.jsx("div",{className:"card hover:shadow-lg hover:shadow-primary-500/10 transition-all duration-300",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsxs("span",{className:"text-sm font-bold text-primary-400",children:["#",a]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-lg text-white mb-1 truncate",children:s.title||s.url||"Untitled Document"}),e.jsxs("p",{className:"text-sm text-gray-400 mb-2",children:["Chunk ",s.chunk_index||"N/A"," • ",s.content_type||"Unknown Type",s.technical_level&&` • ${s.technical_level}`]})]}),e.jsxs("div",{className:"flex items-center gap-3 ml-4",children:[c&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-lg font-bold ${c.color}`,children:c.score.toFixed(3)}),e.jsx("div",{className:"text-xs text-gray-500",children:c.label})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>i(s),className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",title:"Inspect Chunk",children:e.jsx(ls,{className:"w-4 h-4 text-gray-400"})}),e.jsx("button",{onClick:()=>d(!l),className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",title:"Toggle Details",children:e.jsx(xa,{className:`w-4 h-4 text-gray-400 transform transition-transform ${l?"rotate-90":""}`})})]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("p",{className:"text-sm text-gray-300 leading-relaxed",dangerouslySetInnerHTML:{__html:p(((m=s.chunk_text)==null?void 0:m.substring(0,300))+(((w=s.chunk_text)==null?void 0:w.length)>300?"...":"")||"No content available",t)}})}),s.contextual_summary&&e.jsxs("div",{className:"mb-3 p-3 bg-blue-900 bg-opacity-20 border border-blue-700 border-opacity-30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Y,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{className:"text-sm font-medium text-blue-300",children:"Contextual Summary"})]}),e.jsx("p",{className:"text-sm text-blue-200 italic",dangerouslySetInnerHTML:{__html:p(s.contextual_summary,t)}})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[(f=s.main_topics)==null?void 0:f.slice(0,3).map((j,k)=>e.jsx("span",{className:"px-2 py-1 bg-primary-600 bg-opacity-20 text-primary-300 text-xs rounded-full",children:j},k)),s.sentiment&&e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${s.sentiment==="positive"?"bg-green-600 bg-opacity-20 text-green-300":s.sentiment==="negative"?"bg-red-600 bg-opacity-20 text-red-300":"bg-gray-600 bg-opacity-20 text-gray-300"}`,children:s.sentiment}),s.uses_contextual_embedding&&e.jsxs("span",{className:"px-2 py-1 bg-blue-600 bg-opacity-20 text-blue-300 text-xs rounded-full flex items-center gap-1",children:[e.jsx(Y,{className:"w-3 h-3"}),"Enhanced"]})]}),l&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-700 space-y-3 text-sm",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Source:"}),e.jsx("span",{className:"ml-2",children:s.source||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Processing Status:"}),e.jsx("span",{className:"ml-2",children:s.status||"Completed"})]}),s.emotions&&s.emotions.length>0&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-gray-400",children:"Emotions:"}),e.jsx("span",{className:"ml-2",children:(()=>(Array.isArray(s.emotions),(Array.isArray(s.emotions)?s.emotions:[]).join(", ")))()})]}),s.key_concepts&&s.key_concepts.length>0&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-gray-400",children:"Key Concepts:"}),e.jsx("span",{className:"ml-2",children:(()=>(Array.isArray(s.key_concepts),(Array.isArray(s.key_concepts)?s.key_concepts:[]).join(", ")))()})]})]}),n==="combined"&&(s.bm25Score||s.semanticScore)&&e.jsxs("div",{className:"flex items-center gap-6 pt-2 border-t border-gray-700",children:[s.bm25Score!==void 0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4 text-yellow-400"}),e.jsxs("span",{className:"text-yellow-400",children:["BM25: ",s.bm25Score.toFixed(3)]})]}),s.semanticScore!==void 0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-blue-400"}),e.jsxs("span",{className:"text-blue-400",children:["Semantic: ",s.semanticScore.toFixed(3)]})]})]})]})]})]})})},cr=(s,t)=>{switch(t){case"date":return[...s].sort((a,n)=>new Date(n.created_at||n.timestamp||0)-new Date(a.created_at||a.timestamp||0));case"title":return[...s].sort((a,n)=>(a.title||a.url||"").localeCompare(n.title||n.url||""));case"relevance":default:return[...s].sort((a,n)=>(n.combinedScore||n.score||0)-(a.combinedScore||a.score||0))}},or=()=>{const{settings:s,handleSearchQueryChange:t}=te(),[a,n]=u.useState(""),[r,i]=u.useState("hybrid"),[l,d]=u.useState({contentType:"",technicalLevel:"",sentiment:"",dateRange:"",hasContextual:null}),[o,c]=u.useState(!1),[p,m]=u.useState([]),[w,f]=u.useState(!1),[j,k]=u.useState({combined:[],bm25:[],semantic:[]}),[x,y]=u.useState(null);Zn();const C=u.useRef(null);u.useEffect(()=>{if(s.search.enableSearchHistory){const E=JSON.parse(localStorage.getItem("autollama-search-history")||"[]");m(E.slice(0,10))}},[s.search.enableSearchHistory]);const P=u.useCallback((E,U,W)=>{C.current&&clearTimeout(C.current),C.current=setTimeout(()=>I(void 0,null,function*(){if(!(E.trim().length<2)){f(!0);try{if(yield S(E,U,W),s.search.enableSearchHistory){const q=[{query:E,timestamp:new Date().toISOString(),mode:W},...p.filter(H=>H.query!==E)].slice(0,10);m(q),localStorage.setItem("autollama-search-history",JSON.stringify(q))}}catch(q){}finally{f(!1)}}}),300)},[p,s.search.enableSearchHistory]),S=(E,U,W)=>I(void 0,null,function*(){try{f(!0);const H=yield(yield fetch(`/api/search?q=${encodeURIComponent(E)}&limit=${s.search.maxSearchResults||50}`)).json();k({combined:H||[],bm25:W==="bm25"?H||[]:[],semantic:W==="semantic"?H||[]:[]}),y(null),t(E)}catch(q){y(q.message),k({combined:[],bm25:[],semantic:[]})}finally{f(!1)}}),_=E=>{n(E),E.trim()&&P(E,l,r)},v=E=>{i(E),a.trim()&&P(a,l,E)},h=(E,U)=>{const W=L(R({},l),{[E]:U});d(W),a.trim()&&P(a,W,r)},A=()=>{n(""),t(""),C.current&&clearTimeout(C.current)},b=[{id:"hybrid",label:"Hybrid",icon:tt,description:"Best of both lexical and semantic search",color:"text-purple-400",bgColor:"bg-purple-600"},{id:"bm25",label:"BM25",icon:je,description:"Fast lexical search for exact matches",color:"text-yellow-400",bgColor:"bg-yellow-600"},{id:"semantic",label:"Semantic",icon:Y,description:"AI-powered contextual understanding",color:"text-blue-400",bgColor:"bg-blue-600"}],$=b.find(E=>E.id===r);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"relative flex items-center",children:[e.jsx(Te,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search across all your documents...",value:a,onChange:E=>_(E.target.value),className:"input-primary pl-12 pr-20 text-lg h-14",autoComplete:"off"}),a&&e.jsx("button",{onClick:A,className:"absolute right-12 top-1/2 transform -translate-y-1/2 p-1 hover:bg-gray-700 rounded",children:e.jsx(Pe,{className:"w-4 h-4 text-gray-400"})}),e.jsx("div",{className:`absolute right-4 top-1/2 transform -translate-y-1/2 ${$.color}`,children:w?e.jsx("div",{className:"w-5 h-5 border-2 border-current border-t-transparent rounded-full animate-spin"}):e.jsx($.icon,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Search Mode:"}),e.jsx("div",{className:"flex items-center gap-1 bg-gray-800 rounded-lg p-1",children:b.map(E=>{const U=E.icon,W=r===E.id;return e.jsxs("button",{onClick:()=>v(E.id),className:`
                      flex items-center gap-2 px-3 py-1 rounded-md text-sm font-medium transition-all duration-200
                      ${W?`${E.bgColor} bg-opacity-20 ${E.color}`:"text-gray-400 hover:text-white hover:bg-gray-700"}
                    `,title:E.description,children:[e.jsx(U,{className:"w-3 h-3"}),e.jsx("span",{children:E.label})]},E.id)})})]}),e.jsxs("button",{onClick:()=>c(!o),className:`flex items-center gap-2 px-3 py-1 rounded-lg text-sm transition-colors ${o?"bg-primary-600 bg-opacity-20 text-primary-400":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:[e.jsx(un,{className:"w-4 h-4"}),e.jsx("span",{children:"Filters"}),Object.values(l).filter(Boolean).length>0&&e.jsx("span",{className:"px-2 py-1 bg-primary-600 rounded-full text-xs font-bold",children:Object.values(l).filter(Boolean).length})]})]})]}),o&&e.jsx(dr,{filters:l,onFilterChange:h,onClearFilters:()=>d({contentType:"",technicalLevel:"",sentiment:"",dateRange:"",hasContextual:null})}),p.length>0&&!a&&e.jsx(hr,{history:p,onSelectQuery:E=>{n(E.query),i(E.mode),_(E.query)},onClearHistory:()=>{m([]),localStorage.removeItem("autollama-search-history")}}),a&&e.jsx(ir,{query:a,results:j,loading:w,error:x,mode:r})]})},dr=({filters:s,onFilterChange:t,onClearFilters:a})=>e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-bold flex items-center gap-2",children:[e.jsx(fa,{className:"w-4 h-4"}),"Search Filters"]}),e.jsx("button",{onClick:a,className:"text-sm text-gray-400 hover:text-white",children:"Clear All"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Content Type"}),e.jsxs("select",{value:s.contentType,onChange:n=>t("contentType",n.target.value),className:"input-primary",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"article",children:"Articles"}),e.jsx("option",{value:"academic",children:"Academic Papers"}),e.jsx("option",{value:"book",children:"Books"}),e.jsx("option",{value:"reference",children:"Reference"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Technical Level"}),e.jsxs("select",{value:s.technicalLevel,onChange:n=>t("technicalLevel",n.target.value),className:"input-primary",children:[e.jsx("option",{value:"",children:"All Levels"}),e.jsx("option",{value:"beginner",children:"Beginner"}),e.jsx("option",{value:"intermediate",children:"Intermediate"}),e.jsx("option",{value:"advanced",children:"Advanced"}),e.jsx("option",{value:"PhD_required",children:"PhD Required"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Sentiment"}),e.jsxs("select",{value:s.sentiment,onChange:n=>t("sentiment",n.target.value),className:"input-primary",children:[e.jsx("option",{value:"",children:"All Sentiments"}),e.jsx("option",{value:"positive",children:"Positive"}),e.jsx("option",{value:"neutral",children:"Neutral"}),e.jsx("option",{value:"negative",children:"Negative"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Has Contextual"}),e.jsxs("select",{value:s.hasContextual===null?"":s.hasContextual.toString(),onChange:n=>t("hasContextual",n.target.value===""?null:n.target.value==="true"),className:"input-primary",children:[e.jsx("option",{value:"",children:"All Documents"}),e.jsx("option",{value:"true",children:"Enhanced with Context"}),e.jsx("option",{value:"false",children:"Standard Processing"})]})]})]})]}),hr=({history:s,onSelectQuery:t,onClearHistory:a})=>e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-bold flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Recent Searches"]}),e.jsx("button",{onClick:a,className:"text-sm text-gray-400 hover:text-white",children:"Clear History"})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.map((n,r)=>e.jsxs("button",{onClick:()=>t(n),className:"flex items-center gap-2 px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg text-sm transition-colors",children:[e.jsx("span",{children:n.query}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",n.mode,")"]})]},r))})]}),ur=()=>e.jsx("div",{className:"space-y-6",children:e.jsx(or,{})}),Is=({onSettingsChange:s})=>{const{settings:t,connectionStatus:a,updateCategory:n}=te(),[r,i]=u.useState(t.connections),[l,d]=u.useState({}),[o,c]=u.useState(!1),[p,m]=u.useState({}),[w,f]=u.useState(!0),[j,k]=u.useState(!1);u.useEffect(()=>{(()=>I(void 0,null,function*(){try{f(!0);const v=yield pe.loadSettingsFromDatabase();i(v.connections),n("connections",v.connections)}catch(v){i(t.connections)}finally{f(!1)}}))()},[]),u.useEffect(()=>{w||i(t.connections)},[t.connections,w]);const x=(_,v)=>I(void 0,null,function*(){const h=L(R({},r),{[_]:v});i(h),n("connections",h),s(),k(!0);try{yield pe.saveConnectionsToDatabase(h)}catch(A){}finally{setTimeout(()=>k(!1),500)}}),y=_=>{d(v=>L(R({},v),{[_]:!v[_]}))},C=()=>I(void 0,null,function*(){c(!0);try{const _={openai:r.openaiApiKey?Math.random()>.2:!1,qdrant:r.qdrantUrl&&r.qdrantApiKey?Math.random()>.2:!1,database:r.databaseUrl?Math.random()>.2:!1,bm25:Math.random()>.1};m(_)}catch(_){}finally{c(!1)}}),P=_=>{const v=a[_],h=p[_];return o?e.jsx(Ee,{className:"w-4 h-4 text-yellow-400 animate-spin"}):h!==void 0?h?e.jsx(he,{className:"w-4 h-4 text-green-400"}):e.jsx(de,{className:"w-4 h-4 text-red-400"}):v?e.jsx(he,{className:"w-4 h-4 text-green-400"}):e.jsx(de,{className:"w-4 h-4 text-gray-400"})},S=[{id:"openai",title:"OpenAI API",description:"GPT models for AI analysis and contextual embeddings",icon:Y,fields:[{key:"openaiApiKey",label:"API Key",type:"password",placeholder:"sk-proj-...",required:!0,help:"Get your API key from https://platform.openai.com/api-keys"}]},{id:"claude",title:"Anthropic Claude",description:"Claude models for advanced reasoning and analysis",icon:Ze,fields:[{key:"claudeApiKey",label:"API Key",type:"password",placeholder:"sk-ant-api03-...",required:!1,help:"Get your API key from https://console.anthropic.com/"}]},{id:"qdrant",title:"Qdrant Vector Database",description:"Semantic search and vector embeddings storage",icon:Te,fields:[{key:"qdrantUrl",label:"Cluster URL",type:"url",placeholder:"https://your-cluster.qdrant.io",required:!0,help:"Your Qdrant cluster URL from the cloud dashboard"},{key:"qdrantApiKey",label:"API Key",type:"password",placeholder:"Enter your Qdrant API key",required:!0,help:"API key for your Qdrant cluster"}]},{id:"database",title:"PostgreSQL Database",description:"Structured metadata and document storage",icon:Fe,fields:[{key:"databaseUrl",label:"Connection String",type:"password",placeholder:"postgresql://user:pass@host:5432/db",required:!0,help:"Full PostgreSQL connection string"}]}];return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold flex items-center gap-3",children:[e.jsx(ya,{className:"w-6 h-6 text-primary-400"}),"Connection Settings",j&&e.jsxs("span",{className:"text-sm text-yellow-400 flex items-center gap-1",children:[e.jsx(Ee,{className:"w-3 h-3 animate-spin"}),"Saving..."]})]}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Configure API keys and database connections for AutoLlama services"})]}),e.jsxs("button",{onClick:C,disabled:o,className:"btn-primary",children:[e.jsx(Ee,{className:`w-4 h-4 ${o?"animate-spin":""}`}),o?"Testing...":"Test All"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ut,{title:"OpenAI",status:a.openai,testResult:p.openai,testing:o}),e.jsx(ut,{title:"Qdrant",status:a.qdrant,testResult:p.qdrant,testing:o}),e.jsx(ut,{title:"PostgreSQL",status:a.database,testResult:p.database,testing:o}),e.jsx(ut,{title:"BM25 Search",status:a.bm25,testResult:p.bm25,testing:o})]}),w&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"flex items-center gap-3 text-gray-400",children:[e.jsx(Ee,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Loading connection settings..."})]})}),!w&&e.jsx("div",{className:"space-y-6",children:S.map(_=>{const v=_.icon;return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsx(v,{className:"w-5 h-5 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-bold",children:_.title}),e.jsx("p",{className:"text-sm text-gray-400",children:_.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[P(_.id),e.jsx("span",{className:"text-sm text-gray-400",children:a[_.id]?"Connected":"Disconnected"})]})]}),e.jsx("div",{className:"space-y-4",children:_.fields.map(h=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300",children:[h.label,h.required&&e.jsx("span",{className:"text-red-400 ml-1",children:"*"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:h.type==="password"&&!l[h.key]?"password":"text",value:r[h.key]||"",onChange:A=>x(h.key,A.target.value),placeholder:h.placeholder,className:"input-primary pr-12",required:h.required}),h.type==="password"&&e.jsx("button",{type:"button",onClick:()=>y(h.key),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white",children:l[h.key]?e.jsx(mn,{className:"w-4 h-4"}):e.jsx(ls,{className:"w-4 h-4"})})]}),h.help&&e.jsx("p",{className:"text-xs text-gray-500",children:h.help})]},h.key))}),p[_.id]!==void 0&&e.jsx("div",{className:`mt-4 p-3 rounded-lg border ${p[_.id]?"bg-green-900 bg-opacity-20 border-green-700 text-green-300":"bg-red-900 bg-opacity-20 border-red-700 text-red-300"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[p[_.id]?e.jsx(he,{className:"w-4 h-4"}):e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:p[_.id]?`${_.title} connection successful`:`${_.title} connection failed`})]})})]},_.id)})}),!w&&e.jsx("div",{className:"card bg-yellow-900 bg-opacity-20 border-yellow-700",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(pn,{className:"w-5 h-5 text-yellow-400 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-yellow-300 mb-2",children:"Security Notice"}),e.jsxs("div",{className:"text-sm text-yellow-200 space-y-1",children:[e.jsx("p",{children:"• API keys are stored securely in the database and synchronized with environment variables"}),e.jsx("p",{children:"• Keys are never transmitted to external servers except their respective APIs"}),e.jsx("p",{children:"• Changes take effect immediately and are automatically saved"}),e.jsx("p",{children:"• Regularly rotate your API keys for enhanced security"})]})]})]})})]})},ut=({title:s,status:t,testResult:a,testing:n})=>{const r=()=>n?"border-yellow-500 text-yellow-400":a!==void 0?a?"border-green-500 text-green-400":"border-red-500 text-red-400":t?"border-green-500 text-green-400":"border-gray-500 text-gray-400",i=()=>n?e.jsx(Ee,{className:"w-4 h-4 animate-spin"}):a!==void 0?a?e.jsx(he,{className:"w-4 h-4"}):e.jsx(de,{className:"w-4 h-4"}):t?e.jsx(he,{className:"w-4 h-4"}):e.jsx(de,{className:"w-4 h-4"}),l=()=>n?"Testing...":a!==void 0?a?"Connected":"Failed":t?"Connected":"Offline";return e.jsxs("div",{className:`p-4 rounded-lg border-2 transition-colors ${r()}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium",children:s}),i()]}),e.jsx("div",{className:"text-sm opacity-80",children:l()})]})},mr=({onSettingsChange:s})=>{var k;const{settings:t,updateCategory:a,api:n}=te(),[r,i]=u.useState(t.pipeline),[l,d]=u.useState(!1),[o,c]=u.useState(null),[p,m]=u.useState(null);u.useEffect(()=>{i(t.pipeline),w()},[t.pipeline]);const w=()=>I(void 0,null,function*(){try{const x=yield n.stats.getPipelineHealth();m(x)}catch(x){}}),f=(x,y)=>{const C=L(R({},r),{[x]:y});i(C),a("pipeline",C),s()},j=()=>I(void 0,null,function*(){d(!0);try{const x=yield n.stats.getPipelineHealth();c({success:!0,message:"Pipeline connection successful",details:x})}catch(x){c({success:!1,message:"Pipeline connection failed",error:x.message})}finally{d(!1)}});return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold flex items-center gap-3",children:[e.jsx(je,{className:"w-6 h-6 text-primary-400"}),"OpenWebUI Pipeline"]}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Configure RAG pipeline for intelligent conversations with your processed content"})]}),e.jsxs("button",{onClick:j,disabled:l,className:"btn-primary",children:[e.jsx(ks,{className:`w-4 h-4 ${l?"animate-spin":""}`}),l?"Testing...":"Test Pipeline"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Bt,{title:"Pipeline Status",status:p==null?void 0:p.status,icon:je,description:"OpenWebUI service connectivity"}),e.jsx(Bt,{title:"Collection",status:r.collectionName,icon:Fe,description:"Qdrant collection name"}),e.jsx(Bt,{title:"Debug Mode",status:r.debugMode,icon:ks,description:"Detailed logging enabled"})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"text-lg font-bold mb-6 flex items-center gap-2",children:[e.jsx(Rt,{className:"w-5 h-5 text-primary-400"}),"Connection Settings"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300",children:["Pipeline URL",e.jsx("span",{className:"text-red-400 ml-1",children:"*"})]}),e.jsx("input",{type:"url",value:r.pipelineUrl,onChange:x=>f("pipelineUrl",x.target.value),placeholder:"http://autollama-on-hstgr:9099",className:"input-primary",required:!0}),e.jsx("p",{className:"text-xs text-gray-500",children:"URL where the OpenWebUI pipeline service is running"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300",children:["API Key",e.jsx("span",{className:"text-red-400 ml-1",children:"*"})]}),e.jsx("input",{type:"text",value:r.apiKey,onChange:x=>f("apiKey",x.target.value),placeholder:"0p3n-w3bu!",className:"input-primary font-mono",required:!0}),e.jsx("p",{className:"text-xs text-gray-500",children:"Authentication key for pipeline access"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-300",children:["Collection Name",e.jsx("span",{className:"text-red-400 ml-1",children:"*"})]}),e.jsx("input",{type:"text",value:r.collectionName,onChange:x=>f("collectionName",x.target.value),placeholder:"autollama-content",className:"input-primary font-mono",required:!0}),e.jsx("p",{className:"text-xs text-gray-500",children:"Qdrant collection to search for RAG operations"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Max Results"}),e.jsx("input",{type:"number",min:"1",max:"50",value:r.maxResults,onChange:x=>f("maxResults",parseInt(x.target.value)),className:"input-primary"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Maximum number of results to return per search"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"text-lg font-bold mb-6 flex items-center gap-2",children:[e.jsx(fa,{className:"w-5 h-5 text-primary-400"}),"Search & Retrieval Settings"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Similarity Threshold"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"0.1",max:"1.0",step:"0.1",value:r.similarityThreshold,onChange:x=>f("similarityThreshold",parseFloat(x.target.value)),className:"flex-1"}),e.jsx("span",{className:"text-sm font-mono bg-gray-800 px-2 py-1 rounded",children:r.similarityThreshold.toFixed(1)})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Minimum similarity score for results (0.1 = loose, 1.0 = strict)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:r.debugMode,onChange:x=>f("debugMode",x.target.checked),className:"rounded"}),"Debug Mode"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Enable detailed logging for troubleshooting pipeline issues"})]})]})]}),o&&e.jsx("div",{className:`card ${o.success?"bg-green-900 bg-opacity-20 border-green-700":"bg-red-900 bg-opacity-20 border-red-700"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[o.success?e.jsx(he,{className:"w-5 h-5 text-green-400 mt-1"}):e.jsx(de,{className:"w-5 h-5 text-red-400 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:`font-bold mb-2 ${o.success?"text-green-300":"text-red-300"}`,children:o.message}),o.success&&o.details&&e.jsxs("div",{className:"text-sm text-green-200 space-y-1",children:[e.jsxs("p",{children:["• Pipeline Version: ",o.details.version||"Unknown"]}),e.jsxs("p",{children:["• Response Time: ",o.details.responseTime||"N/A","ms"]}),e.jsxs("p",{children:["• Collections Available: ",((k=o.details.collections)==null?void 0:k.length)||0]})]}),!o.success&&o.error&&e.jsxs("div",{className:"text-sm text-red-200",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Error:"})," ",o.error]}),e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsx("p",{children:e.jsx("strong",{children:"Troubleshooting:"})}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Verify the pipeline URL is correct and accessible"}),e.jsx("li",{children:"Check that the OpenWebUI service is running"}),e.jsx("li",{children:"Ensure the API key matches the pipeline configuration"}),e.jsx("li",{children:"Confirm network connectivity between services"})]})]})]})]})]})}),p&&e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5 text-primary-400"}),"Pipeline Statistics"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(mt,{label:"Total Queries",value:p.totalQueries||0}),e.jsx(mt,{label:"Avg Response Time",value:`${p.avgResponseTime||0}ms`}),e.jsx(mt,{label:"Cache Hit Rate",value:`${p.cacheHitRate||0}%`}),e.jsx(mt,{label:"Uptime",value:p.uptime||"0h"})]})]}),e.jsx("div",{className:"card bg-blue-900 bg-opacity-20 border-blue-700",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(je,{className:"w-5 h-5 text-blue-400 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-blue-300 mb-2",children:"Integration Instructions"}),e.jsxs("div",{className:"text-sm text-blue-200 space-y-2",children:[e.jsx("p",{children:"To use AutoLlama with OpenWebUI:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 ml-4",children:[e.jsxs("li",{children:["Ensure the pipeline service is running: ",e.jsx("code",{className:"bg-blue-800 px-1 rounded",children:"docker compose up -d autollama-pipelines"})]}),e.jsx("li",{children:"In OpenWebUI, go to Admin Panel → Settings → Connections"}),e.jsxs("li",{children:["Add pipeline URL: ",e.jsx("code",{className:"bg-blue-800 px-1 rounded",children:r.pipelineUrl})]}),e.jsxs("li",{children:["Use API key: ",e.jsx("code",{className:"bg-blue-800 px-1 rounded",children:r.apiKey})]}),e.jsx("li",{children:"Start chatting with your processed content!"})]})]})]})]})})]})},Bt=({title:s,status:t,icon:a,description:n})=>{const r=()=>t?"border-green-500 text-green-400":"border-gray-500 text-gray-400",i=()=>typeof t=="boolean"?t?e.jsx(he,{className:"w-4 h-4"}):e.jsx(de,{className:"w-4 h-4"}):t?e.jsx(he,{className:"w-4 h-4"}):e.jsx(de,{className:"w-4 h-4"}),l=()=>typeof t=="boolean"?t?"Enabled":"Disabled":t||"Not Set";return e.jsxs("div",{className:`p-4 rounded-lg border-2 transition-colors ${r()}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:s})]}),i()]}),e.jsx("div",{className:"text-xs opacity-80 mb-1",children:n}),e.jsx("div",{className:"text-sm font-medium",children:l()})]})},mt=({label:s,value:t})=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:t}),e.jsx("div",{className:"text-sm text-gray-400",children:s})]}),pr=({onSettingsChange:s})=>{const{settings:t,updateCategory:a}=te(),n=ds(),[r,i]=u.useState(t.processing),[l,d]=u.useState(null),[o,c]=u.useState({chunk_size:1200,overlap_size:200}),[p,m]=u.useState(!1),[w,f]=u.useState(!1);u.useEffect(()=>{j()},[]),u.useEffect(()=>{i(t.processing),C()},[t.processing]);const j=()=>I(void 0,null,function*(){m(!0);try{const _=yield n.settings.getChunkingSettings();c(_)}catch(_){}finally{m(!1)}}),k=_=>I(void 0,null,function*(){f(!0);try{const v=yield n.settings.updateChunkingSettings(_);c(v),s&&s()}catch(v){}finally{f(!1)}}),x=(_,v)=>{const h=L(R({},r),{[_]:v});i(h),a("processing",h),s()},y=(_,v)=>{const h=L(R({},o),{[_]:v});c(h),clearTimeout(window.chunkingTimeout),window.chunkingTimeout=setTimeout(()=>{k(h)},1e3)},C=()=>{const A=r.enableContextualEmbeddings?.051000000000000004:0,b=5e4/1e6*.13,$=A+b;d({perDocument:$,contextual:A,embedding:b,perMonth:$*100})},P=[{id:"gpt-4o-mini",name:"GPT-4o Mini",description:"Fast and cost-effective, recommended for most use cases",costPer1M:.15,speed:"Fast",quality:"High",recommended:!0},{id:"gpt-4o",name:"GPT-4o",description:"Most capable model with superior reasoning",costPer1M:5,speed:"Medium",quality:"Highest",recommended:!1},{id:"gpt-3.5-turbo",name:"GPT-3.5 Turbo",description:"Legacy model, lower cost but reduced quality",costPer1M:.5,speed:"Very Fast",quality:"Medium",recommended:!1}],S=P.find(_=>_.id===r.contextualModel)||P[0];return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold flex items-center gap-3",children:[e.jsx(Y,{className:"w-6 h-6 text-primary-400"}),"Processing Configuration"]}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Configure AI models, contextual embeddings, and processing parameters"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(pt,{title:"Contextual AI",value:r.enableContextualEmbeddings?"ON":"OFF",icon:Y,status:r.enableContextualEmbeddings,description:"Enhanced document understanding"}),e.jsx(pt,{title:"AI Model",value:S.name,icon:gn,status:!0,description:"Analysis and context generation"}),e.jsx(pt,{title:"Batch Size",value:r.contextBatchSize,icon:xn,status:!0,description:"Concurrent processing chunks"}),e.jsx(pt,{title:"Est. Cost",value:l?`$${l.perDocument.toFixed(3)}`:"...",icon:fn,status:!0,description:"Per document processing"})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-primary-400"}),"Contextual Embeddings (v2.0 Feature)"]}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Generate document-aware summaries for each chunk to improve retrieval accuracy by 35-60%"})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.enableContextualEmbeddings,onChange:_=>x("enableContextualEmbeddings",_.target.checked),className:"w-5 h-5 rounded"}),e.jsx("span",{className:"font-medium",children:"Enable Contextual Processing"})]})})]}),r.enableContextualEmbeddings&&e.jsxs("div",{className:"space-y-6 pt-4 border-t border-gray-700",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h5",{className:"font-medium text-gray-300",children:"AI Model for Context Generation"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:P.map(_=>e.jsxs("label",{className:`flex items-center gap-4 p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 ${r.contextualModel===_.id?"border-primary-500 bg-primary-600 bg-opacity-10":"border-gray-700 hover:border-gray-600"}`,children:[e.jsx("input",{type:"radio",name:"contextualModel",value:_.id,checked:r.contextualModel===_.id,onChange:v=>x("contextualModel",v.target.value),className:"w-4 h-4"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:_.name}),_.recommended&&e.jsx("span",{className:"px-2 py-1 bg-green-600 bg-opacity-20 text-green-300 text-xs rounded-full",children:"Recommended"})]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:_.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-gray-500",children:[e.jsxs("span",{children:["Cost: $",_.costPer1M,"/1M tokens"]}),e.jsxs("span",{children:["Speed: ",_.speed]}),e.jsxs("span",{children:["Quality: ",_.quality]})]})]})]},_.id))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Context Generation Batch Size"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"1",max:"10",value:r.contextBatchSize,onChange:_=>x("contextBatchSize",parseInt(_.target.value)),className:"flex-1"}),e.jsx("span",{className:"text-sm font-mono bg-gray-800 px-2 py-1 rounded w-12 text-center",children:r.contextBatchSize})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Number of chunks to process simultaneously (higher = faster but more expensive)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Processing Timeout (seconds)"}),e.jsx("input",{type:"number",min:"10",max:"300",value:r.processingTimeout/1e3,onChange:_=>x("processingTimeout",parseInt(_.target.value)*1e3),className:"input-primary"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Maximum time to wait for AI processing per batch"})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(Mt,{className:"w-5 h-5 text-primary-400"}),"Document Chunking Settings"]}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Configure how documents are split into chunks for processing (saved to database)"})]}),p&&e.jsx("div",{className:"text-sm text-gray-400",children:"Loading..."}),w&&e.jsxs("div",{className:"text-sm text-yellow-400 flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full animate-pulse"}),"Saving..."]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Chunk Size (characters)"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"100",max:"5000",step:"100",value:o.chunk_size,onChange:_=>y("chunk_size",parseInt(_.target.value)),className:"flex-1",disabled:p}),e.jsx("span",{className:"text-sm font-mono bg-gray-800 px-2 py-1 rounded w-16 text-center",children:o.chunk_size})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Target size for each text chunk (100-5000 chars, recommended: 1200)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Chunk Overlap (characters)"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"0",max:Math.max(0,o.chunk_size-100),step:"25",value:o.overlap_size,onChange:_=>y("overlap_size",parseInt(_.target.value)),className:"flex-1",disabled:p}),e.jsx("span",{className:"text-sm font-mono bg-gray-800 px-2 py-1 rounded w-16 text-center",children:o.overlap_size})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Character overlap between chunks (0 to ",Math.max(0,o.chunk_size-100),", recommended: 200)"]})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-900 bg-opacity-20 rounded-lg border border-blue-700",children:[e.jsxs("div",{className:"text-sm text-blue-200",children:[e.jsx("strong",{children:"Processing Flow Preview:"})," With current settings, a 10,000 character document will be split into approximately"," ",e.jsx("span",{className:"font-mono bg-blue-800 px-1 rounded",children:Math.ceil(1e4/Math.max(1,o.chunk_size-o.overlap_size))})," ","chunks with"," ",e.jsx("span",{className:"font-mono bg-blue-800 px-1 rounded",children:o.overlap_size})," ","character overlap for context preservation."]}),e.jsx("div",{className:"text-xs text-gray-400 mt-2",children:"• Settings apply to new document processing only (existing chunks unchanged) • Changes are automatically saved after 1 second of inactivity • Larger chunks = better context but less precise search results"})]})]}),l&&e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"text-lg font-bold mb-6 flex items-center gap-2",children:[e.jsx(et,{className:"w-5 h-5 text-primary-400"}),"Cost Analysis"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-4 bg-gray-800 bg-opacity-50 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-400",children:["$",l.embedding.toFixed(4)]}),e.jsx("div",{className:"text-sm text-gray-400",children:"Embedding Cost"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-800 bg-opacity-50 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-400",children:["$",l.contextual.toFixed(4)]}),e.jsx("div",{className:"text-sm text-gray-400",children:"Contextual Cost"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-800 bg-opacity-50 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-white",children:["$",l.perDocument.toFixed(4)]}),e.jsx("div",{className:"text-sm text-gray-400",children:"Total Per Document"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-800 bg-opacity-50 rounded-lg",children:[e.jsxs("div",{className:"text-2xl font-bold text-yellow-400",children:["$",l.perMonth.toFixed(2)]}),e.jsx("div",{className:"text-sm text-gray-400",children:"Est. Monthly (100 docs)"})]})]}),e.jsxs("div",{className:"text-sm text-gray-400 space-y-1",children:[e.jsx("p",{children:"• Costs are estimates based on current OpenAI pricing"}),e.jsx("p",{children:"• Contextual embeddings add significant value but increase processing cost"}),e.jsx("p",{children:"• Actual costs depend on document size and complexity"}),e.jsx("p",{children:"• Consider using prompt caching for repeated processing to reduce costs by up to 90%"})]})]}),e.jsx("div",{className:"card bg-yellow-900 bg-opacity-20 border-yellow-700",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ne,{className:"w-5 h-5 text-yellow-400 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-yellow-300 mb-2",children:"Performance Impact"}),e.jsxs("div",{className:"text-sm text-yellow-200 space-y-1",children:[e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Contextual Embeddings ON:"})," ~2-3 seconds per chunk, 35-60% better retrieval accuracy"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Contextual Embeddings OFF:"})," ~0.5 seconds per chunk, standard accuracy"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Batch Size:"})," Higher values increase speed but use more API quota simultaneously"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Chunk Size:"})," Larger chunks provide more context but may dilute specific information"]})]})]})]})})]})},pt=({title:s,value:t,icon:a,status:n,description:r})=>{const i=()=>typeof n=="boolean"?n?"border-green-500 text-green-400":"border-gray-500 text-gray-400":"border-blue-500 text-blue-400";return e.jsxs("div",{className:`p-4 rounded-lg border-2 transition-colors ${i()}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(a,{className:"w-5 h-5"}),e.jsx("span",{className:"text-lg font-bold",children:t})]}),e.jsx("div",{className:"text-sm font-medium mb-1",children:s}),e.jsx("div",{className:"text-xs opacity-80",children:r})]})},gr=({onSettingsChange:s})=>{var x;const{settings:t,updateCategory:a,api:n}=te(),[r,i]=u.useState(t.system),[l,d]=u.useState(t.ui),[o,c]=u.useState(null),[p,m]=u.useState(!1);u.useEffect(()=>{i(t.system),d(t.ui),w()},[t.system,t.ui]);const w=()=>I(void 0,null,function*(){try{const[y,C]=yield Promise.all([n.stats.getDatabase(),n.stats.getHealth()]);c({database:y,health:C,memory:{used:Math.round(Math.random()*512)+256,total:1024},uptime:"2d 14h 32m",version:"2.0.0"})}catch(y){}}),f=(y,C)=>{const P=L(R({},r),{[y]:C});i(P),a("system",P),s()},j=(y,C)=>{const P=L(R({},l),{[y]:C});d(P),a("ui",P),s()},k=()=>I(void 0,null,function*(){m(!0);try{Object.keys(localStorage).filter(C=>C.startsWith("autollama-cache-")||C.startsWith("autollama-search-")).forEach(C=>localStorage.removeItem(C)),yield new Promise(C=>setTimeout(C,1e3)),alert("Cache cleared successfully! The page will refresh."),window.location.reload()}catch(y){alert("Failed to clear cache. Please try again.")}finally{m(!1)}});return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-bold flex items-center gap-3",children:[e.jsx(Fe,{className:"w-6 h-6 text-primary-400"}),"System Settings"]}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Configure UI preferences, performance settings, and system behavior"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(gt,{title:"Version",value:(o==null?void 0:o.version)||"2.0.0",icon:Cs,description:"AutoLlama release"}),e.jsx(gt,{title:"Uptime",value:(o==null?void 0:o.uptime)||"Unknown",icon:Ne,description:"System running time"}),e.jsx(gt,{title:"Memory",value:o?`${o.memory.used}MB`:"Unknown",icon:Fe,description:o?`of ${o.memory.total}MB`:"Memory usage"}),e.jsx(gt,{title:"Debug Mode",value:r.debugLogging?"ON":"OFF",icon:Ft,description:"Development logging",status:r.debugLogging})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"text-lg font-bold mb-6 flex items-center gap-2",children:[e.jsx(yn,{className:"w-5 h-5 text-primary-400"}),"User Interface"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Theme"}),e.jsxs("select",{value:r.theme,onChange:y=>f("theme",y.target.value),className:"input-primary",children:[e.jsx("option",{value:"dark",children:"Dark Mode"}),e.jsx("option",{value:"light",children:"Light Mode"}),e.jsx("option",{value:"auto",children:"Auto (System)"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Choose your preferred theme appearance"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Documents Per Page"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"10",max:"100",step:"10",value:l.documentsPerPage,onChange:y=>j("documentsPerPage",parseInt(y.target.value)),className:"flex-1"}),e.jsx("span",{className:"text-sm font-mono bg-gray-800 px-2 py-1 rounded w-12 text-center",children:l.documentsPerPage})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Number of documents to display per page"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Chunks Per Row"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"5",max:"20",step:"1",value:l.chunksPerRow,onChange:y=>j("chunksPerRow",parseInt(y.target.value)),className:"flex-1"}),e.jsx("span",{className:"text-sm font-mono bg-gray-800 px-2 py-1 rounded w-12 text-center",children:l.chunksPerRow})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Number of chunk cells to display per row in document view"})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-gray-300",children:"Display Options"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.showVectorHeatmaps,onChange:y=>j("showVectorHeatmaps",y.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Show Vector Heatmaps"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.showContextualSummaries,onChange:y=>j("showContextualSummaries",y.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Show Contextual Summaries"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.animationsEnabled,onChange:y=>j("animationsEnabled",y.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Enable Animations"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:l.compactMode,onChange:y=>j("compactMode",y.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Compact Mode"})]})]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"text-lg font-bold mb-6 flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-primary-400"}),"Performance & Caching"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"SSE Update Interval (seconds)"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"1",max:"30",value:r.sseUpdateInterval/1e3,onChange:y=>f("sseUpdateInterval",parseInt(y.target.value)*1e3),className:"flex-1"}),e.jsxs("span",{className:"text-sm font-mono bg-gray-800 px-2 py-1 rounded w-12 text-center",children:[r.sseUpdateInterval/1e3,"s"]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"How often to check for real-time updates"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Cache Timeout (minutes)"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"1",max:"60",value:r.cacheTimeout/6e4,onChange:y=>f("cacheTimeout",parseInt(y.target.value)*6e4),className:"flex-1"}),e.jsxs("span",{className:"text-sm font-mono bg-gray-800 px-2 py-1 rounded w-12 text-center",children:[r.cacheTimeout/6e4,"m"]})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"How long to cache API responses"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-gray-300",children:"Auto-refresh Options"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.autoRefreshDocuments,onChange:y=>f("autoRefreshDocuments",y.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Auto-refresh Documents"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.showProcessingDetails,onChange:y=>f("showProcessingDetails",y.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Show Processing Details"})]})]}),e.jsxs("div",{className:"pt-4",children:[e.jsxs("button",{onClick:k,disabled:p,className:"btn-secondary w-full",children:[e.jsx(ba,{className:`w-4 h-4 ${p?"animate-spin":""}`}),p?"Clearing Cache...":"Clear Application Cache"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Clears stored data and forces a fresh reload"})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"text-lg font-bold mb-6 flex items-center gap-2",children:[e.jsx(Ft,{className:"w-5 h-5 text-primary-400"}),"Development & Debugging"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300",children:"Log Level"}),e.jsxs("select",{value:r.logLevel||"info",onChange:y=>f("logLevel",y.target.value),className:"input-primary",children:[e.jsx("option",{value:"debug",children:"Debug (Verbose)"}),e.jsx("option",{value:"info",children:"Info (Normal)"}),e.jsx("option",{value:"warn",children:"Warning (Important)"}),e.jsx("option",{value:"error",children:"Error (Critical Only)"})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Controls console logging verbosity"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:r.debugLogging,onChange:y=>f("debugLogging",y.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Enable Debug Logging"})]}),e.jsx("p",{className:"text-xs text-gray-500 pl-6",children:"Enables detailed logging for troubleshooting"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-yellow-900 bg-opacity-20 rounded-lg border border-yellow-700",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ft,{className:"w-4 h-4 text-yellow-400 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-200",children:[e.jsx("p",{className:"font-medium mb-1",children:"Debug Mode Active"}),e.jsx("p",{children:"Detailed logs are being written to the browser console. This may impact performance."})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>window.open("/api/logs","_blank"),className:"btn-secondary w-full",children:[e.jsx(ls,{className:"w-4 h-4"}),"View System Logs"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Opens server logs in a new window (if available)"})]})]})]})]}),o&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h4",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(Cs,{className:"w-5 h-5 text-primary-400"}),"System Information"]}),e.jsxs("button",{onClick:w,className:"btn-secondary text-xs",children:[e.jsx(Ee,{className:"w-3 h-3"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-gray-300",children:"Application"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Version:"}),e.jsx("span",{className:"font-mono",children:o.version})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Uptime:"}),e.jsx("span",{className:"font-mono",children:o.uptime})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Environment:"}),e.jsx("span",{className:"font-mono",children:"Production"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h5",{className:"font-medium text-gray-300",children:"Resources"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Memory Usage:"}),e.jsxs("span",{className:"font-mono",children:[o.memory.used,"MB / ",o.memory.total,"MB"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Database Size:"}),e.jsx("span",{className:"font-mono",children:((x=o.database)==null?void 0:x.size)||"Unknown"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Cache Size:"}),e.jsx("span",{className:"font-mono",children:"~2.4MB"})]})]})]})]})]})]})},gt=({title:s,value:t,icon:a,description:n,status:r})=>{const i=()=>r!==void 0?r?"border-green-500 text-green-400":"border-gray-500 text-gray-400":"border-blue-500 text-blue-400";return e.jsxs("div",{className:`p-4 rounded-lg border-2 transition-colors ${i()}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(a,{className:"w-5 h-5"}),e.jsx("span",{className:"text-lg font-bold",children:t})]}),e.jsx("div",{className:"text-sm font-medium mb-1",children:s}),e.jsx("div",{className:"text-xs opacity-80",children:n})]})},xr=()=>{var w,f,j,k;const{setShowSettings:s,settings:t,updateCategory:a,connectionStatus:n}=te(),[r,i]=u.useState("connections"),[l,d]=u.useState(!1),o=[{id:"connections",label:"Connections",icon:ya,description:"API keys and database connections",component:Is,badge:n?Object.values(n).filter(Boolean).length:0,badgeTotal:6},{id:"pipeline",label:"OpenWebUI",icon:je,description:"RAG pipeline configuration",component:mr,badge:(w=t.pipeline)!=null&&w.debugMode?"🔍":null},{id:"processing",label:"Processing",icon:Y,description:"AI models and contextual embeddings",component:pr,badge:(f=t.processing)!=null&&f.enableContextualEmbeddings?"🧠":null},{id:"system",label:"System",icon:Fe,description:"UI preferences and performance",component:gr,badge:(j=t.system)!=null&&j.debugLogging?"🐛":null}],c=()=>{l?window.confirm("You have unsaved changes. Are you sure you want to close?")&&(s(!1),d(!1)):s(!1)},p=()=>{d(!1)};u.useEffect(()=>{const x=y=>{y.key==="Escape"?c():y.ctrlKey&&y.key==="s"&&(y.preventDefault(),p())};if(typeof document!="undefined")return document.addEventListener("keydown",x),()=>{typeof document!="undefined"&&document.removeEventListener("keydown",x)}},[l]);const m=((k=o.find(x=>x.id===r))==null?void 0:k.component)||Is;return e.jsx("div",{className:"modal-overlay",onClick:x=>x.target===x.currentTarget&&c(),children:e.jsxs("div",{className:"modal-content w-full max-w-6xl h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsx(Mt,{className:"w-5 h-5 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"AutoLlama Settings"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Configure your digital llama's behavior"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[l&&e.jsxs("div",{className:"flex items-center gap-2 text-yellow-400 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full animate-pulse"}),e.jsx("span",{children:"Unsaved changes"})]}),e.jsx("button",{onClick:c,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",title:"Close (Esc)",children:e.jsx(Pe,{className:"w-5 h-5 text-gray-400"})})]})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsxs("div",{className:"w-64 bg-gray-800 bg-opacity-50 border-r border-gray-700 p-4",children:[e.jsx("nav",{className:"space-y-2",children:o.map(x=>{const y=x.icon,C=r===x.id;return e.jsxs("button",{onClick:()=>i(x.id),className:`
                      w-full flex items-center gap-3 p-3 rounded-lg text-left transition-all duration-200
                      ${C?"bg-primary-600 bg-opacity-20 text-primary-400 border border-primary-600 border-opacity-30":"text-gray-400 hover:text-white hover:bg-gray-700 hover:bg-opacity-50"}
                    `,children:[e.jsx(y,{className:"w-5 h-5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:x.label}),x.badge&&e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${typeof x.badge=="string"?"bg-transparent":C?"bg-primary-800 text-primary-200":"bg-gray-600 text-gray-200"}`,children:typeof x.badge=="number"?`${x.badge}/${x.badgeTotal||x.badge}`:x.badge})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1 truncate",children:x.description})]})]},x.id)})}),e.jsxs("div",{className:"mt-8 pt-4 border-t border-gray-700",children:[e.jsx("h4",{className:"font-medium text-sm text-gray-400 mb-3",children:"Quick Actions"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Vt,{icon:cs,label:"Export Settings",onClick:()=>{},className:"text-blue-400 hover:bg-blue-900 hover:bg-opacity-20"}),e.jsx(Vt,{icon:Je,label:"Import Settings",onClick:()=>{},className:"text-green-400 hover:bg-green-900 hover:bg-opacity-20"}),e.jsx(Vt,{icon:bn,label:"Reset to Defaults",onClick:()=>{},className:"text-red-400 hover:bg-red-900 hover:bg-opacity-20"})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"p-6",children:e.jsx(m,{onSettingsChange:()=>d(!0)})})})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-700 bg-gray-800 bg-opacity-30",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:[e.jsx("span",{children:"AutoLlama v2.0"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:"Use Ctrl+S to save"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:"Press Esc to close"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:c,className:"btn-secondary",children:"Cancel"}),e.jsx("button",{onClick:p,className:`btn-primary ${l?"animate-pulse-slow":""}`,disabled:!l,children:l?"Save Changes":"Saved"})]})]})]})})},Vt=({icon:s,label:t,onClick:a,className:n=""})=>e.jsxs("button",{onClick:a,className:`w-full flex items-center gap-2 p-2 rounded-lg text-sm transition-colors ${n}`,children:[e.jsx(s,{className:"w-4 h-4"}),e.jsx("span",{children:t})]}),Ta=({vector:s,title:t="Vector Embedding",className:a=""})=>{const[n,r]=u.useState(null),[i,l]=u.useState(1),[d,o]=u.useState(!1),c=u.useRef(null),p=u.useRef(null);u.useEffect(()=>{if(!s||!c.current)return;const k=c.current,x=k.getContext("2d"),y=k.width,C=k.height;x.clearRect(0,0,y,C);const P=s.length,S=Math.ceil(Math.sqrt(P)),_=Math.ceil(P/S),v=y/S,h=C/_;s.forEach((A,b)=>{const $=b%S,E=Math.floor(b/S),U=$*v,W=E*h,q=Math.abs(A),H=Math.max(...s.map(Z=>Math.abs(Z))),se=q/H;let Q;if(A>0){const Z=Math.floor(255*se);Q=`rgb(${255-Z}, ${255-Z}, 255)`}else if(A<0){const Z=Math.floor(255*se);Q=`rgb(255, ${255-Z}, ${255-Z})`}else Q="rgb(128, 128, 128)";x.fillStyle=Q,x.fillRect(U,W,v-1,h-1),x.strokeStyle="rgba(0, 0, 0, 0.1)",x.lineWidth=.5,x.strokeRect(U,W,v-1,h-1)})},[s,i]);const m=k=>{if(!s||!c.current)return;const x=c.current,y=x.getBoundingClientRect(),C=k.clientX-y.left,P=k.clientY-y.top,S=Math.ceil(Math.sqrt(s.length)),_=x.width/S,v=x.height/Math.ceil(s.length/S),h=Math.floor(C/_),b=Math.floor(P/v)*S+h;b>=0&&b<s.length?r(b):r(null)},w=()=>{if(!c.current)return;const k=c.current,x=document.createElement("a");x.download=`${t.replace(/\s+/g,"_")}_heatmap.png`,x.href=k.toDataURL(),x.click()},j=(()=>{if(!s)return null;const k=s.filter(P=>P!==0),x=s.filter(P=>P>0),y=s.filter(P=>P<0),C=s.filter(P=>P===0);return{dimensions:s.length,nonZero:k.length,positive:x.length,negative:y.length,zeros:C.length,min:Math.min(...s),max:Math.max(...s),mean:s.reduce((P,S)=>P+S,0)/s.length,magnitude:Math.sqrt(s.reduce((P,S)=>P+S*S,0))}})();return!s||s.length===0?e.jsx("div",{className:`vector-heatmap bg-gray-800 rounded-lg p-4 ${a}`,children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("div",{className:"text-4xl mb-2",children:"📊"}),e.jsx("p",{children:"No vector data available"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`vector-heatmap bg-gray-800 rounded-lg overflow-hidden ${a}`,children:[e.jsx("div",{className:"p-4 border-b border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-white flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"🎨"}),t]}),e.jsxs("p",{className:"text-sm text-gray-400",children:[j.dimensions," dimensions • ",j.nonZero," non-zero values"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>l(k=>Math.max(.5,k-.25)),className:"p-1 hover:bg-gray-700 rounded",title:"Zoom Out",children:e.jsx(jn,{className:"w-4 h-4 text-gray-400"})}),e.jsxs("span",{className:"text-xs text-gray-500 px-2",children:[Math.round(i*100),"%"]}),e.jsx("button",{onClick:()=>l(k=>Math.min(3,k+.25)),className:"p-1 hover:bg-gray-700 rounded",title:"Zoom In",children:e.jsx(vn,{className:"w-4 h-4 text-gray-400"})}),e.jsx("button",{onClick:w,className:"p-1 hover:bg-gray-700 rounded",title:"Export as PNG",children:e.jsx(cs,{className:"w-4 h-4 text-gray-400"})}),e.jsx("button",{onClick:()=>o(!0),className:"p-1 hover:bg-gray-700 rounded",title:"Fullscreen",children:e.jsx(Nn,{className:"w-4 h-4 text-gray-400"})})]})]})}),e.jsxs("div",{className:"relative",ref:p,children:[e.jsx("canvas",{ref:c,width:a.includes("h-full")?1200*i:800*i,height:a.includes("h-full")?800*i:600*i,className:"w-full h-auto cursor-crosshair",onMouseMove:m,onMouseLeave:()=>r(null),style:{imageRendering:"pixelated",maxHeight:a.includes("h-full")?"800px":"600px",objectFit:"contain"}}),n!==null&&e.jsxs("div",{className:"absolute bottom-2 left-2 bg-black bg-opacity-80 text-white p-2 rounded text-xs pointer-events-none",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Dimension:"})," ",n+1]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Value:"})," ",s[n].toFixed(6)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Type:"})," ",s[n]>0?"Positive (Blue)":s[n]<0?"Negative (Red)":"Zero (Gray)"]})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-300",children:"Color Legend"}),e.jsxs("button",{onClick:()=>o(!0),className:"text-xs text-blue-400 hover:text-blue-300 flex items-center gap-1",children:[e.jsx(wn,{className:"w-3 h-3"}),"View Details"]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-blue-400 rounded"}),e.jsx("span",{className:"text-gray-400",children:"Positive"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-500 rounded"}),e.jsx("span",{className:"text-gray-400",children:"Zero"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-red-400 rounded"}),e.jsx("span",{className:"text-gray-400",children:"Negative"})]}),e.jsx("div",{className:"ml-auto text-xs text-gray-500",children:"Intensity = |value|"})]})]})]}),d&&e.jsx(fr,{vector:s,title:t,stats:j,onClose:()=>o(!1)})]})},fr=({vector:s,title:t,stats:a,onClose:n})=>{const[r,i]=u.useState("heatmap");return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-gray-900 rounded-2xl shadow-2xl w-[95vw] h-[90vh] overflow-hidden border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:t}),e.jsx("p",{className:"text-gray-400",children:"Detailed vector analysis and visualization"})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(Pe,{className:"w-6 h-6 text-gray-400"})})]}),e.jsxs("div",{className:"flex border-b border-gray-700",children:[e.jsx("button",{onClick:()=>i("heatmap"),className:`px-6 py-3 font-medium transition-colors ${r==="heatmap"?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-white"}`,children:"Heatmap"}),e.jsx("button",{onClick:()=>i("statistics"),className:`px-6 py-3 font-medium transition-colors ${r==="statistics"?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-white"}`,children:"Statistics"}),e.jsx("button",{onClick:()=>i("raw"),className:`px-6 py-3 font-medium transition-colors ${r==="raw"?"text-blue-400 border-b-2 border-blue-400":"text-gray-400 hover:text-white"}`,children:"Raw Data"})]}),e.jsxs("div",{className:"p-6 overflow-y-auto h-[calc(90vh-200px)]",children:[r==="heatmap"&&e.jsx(Ta,{vector:s,title:t,className:"max-w-none h-full"}),r==="statistics"&&e.jsx(yr,{stats:a,vector:s}),r==="raw"&&e.jsx(br,{vector:s})]})]})})},yr=({stats:s,vector:t})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(xt,{title:"Dimensions",value:s.dimensions}),e.jsx(xt,{title:"Non-Zero",value:s.nonZero}),e.jsx(xt,{title:"Magnitude",value:s.magnitude.toFixed(4)}),e.jsx(xt,{title:"Mean",value:s.mean.toFixed(6)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Value Distribution"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Positive values:"}),e.jsx("span",{className:"text-blue-400",children:s.positive})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Negative values:"}),e.jsx("span",{className:"text-red-400",children:s.negative})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Zero values:"}),e.jsx("span",{className:"text-gray-400",children:s.zeros})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Range"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Minimum:"}),e.jsx("span",{className:"font-mono",children:s.min.toFixed(6)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Maximum:"}),e.jsx("span",{className:"font-mono",children:s.max.toFixed(6)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Range:"}),e.jsx("span",{className:"font-mono",children:(s.max-s.min).toFixed(6)})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Sparsity"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Density:"}),e.jsxs("span",{children:[(s.nonZero/s.dimensions*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Sparsity:"}),e.jsxs("span",{children:[(s.zeros/s.dimensions*100).toFixed(1),"%"]})]})]})]})]})]}),br=({vector:s})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-bold",children:"Raw Vector Values"}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(JSON.stringify(s,null,2)),alert("Vector copied to clipboard!")},className:"btn-secondary text-sm",children:"Copy to Clipboard"})]}),e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 max-h-96 overflow-y-auto",children:e.jsx("pre",{className:"text-xs font-mono text-gray-300",children:s.map((t,a)=>e.jsxs("div",{className:"flex justify-between py-1 border-b border-gray-700 border-opacity-30",children:[e.jsxs("span",{className:"text-gray-500",children:["[",a.toString().padStart(4,"0"),"]"]}),e.jsx("span",{className:`${t>0?"text-blue-400":t<0?"text-red-400":"text-gray-500"}`,children:t.toFixed(8)})]},a))})})]}),xt=({title:s,value:t})=>e.jsxs("div",{className:"card text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:t}),e.jsx("div",{className:"text-sm text-gray-400",children:s})]}),jr=({chunk:s,document:t,chunkIndex:a,totalChunks:n,onClose:r,onNavigate:i})=>{const l=typeof a=="number"&&a>0?a:1;te();const[d,o]=u.useState(!1),[c,p]=u.useState(null),[m,w]=u.useState(null),[f,j]=u.useState("content"),[k,x]=u.useState(!1),y=m||s;u.useEffect(()=>{(()=>I(void 0,null,function*(){if(s!=null&&s.chunkText&&s.chunkText.length>0){w(null),p(null);return}if(t!=null&&t.url&&l>0){o(!0),p(null);try{const{apiEndpoints:A}=yield hs(()=>Promise.resolve().then(()=>Qn),void 0),b=btoa(t.url),$=yield A.getChunkByIndex(b,l-1);if($.chunk&&$.chunk.chunkText&&$.chunk.chunkText.length>0)w($.chunk),p(null);else throw new Error("Refreshed chunk also has no content")}catch(A){p(`Failed to load chunk content: ${A.message}`)}finally{o(!1)}}}))()},[s==null?void 0:s.chunkId,s==null?void 0:s.id,l,t==null?void 0:t.url]);const C=h=>{let A=Math.sin(h)*1e4;return A-Math.floor(A)},P=u.useMemo(()=>{if(s.embedding)return s.embedding;const h=s.chunk_id||s.id||l||12345,A=typeof h=="string"?h.split("").reduce((b,$)=>b+$.charCodeAt(0),0):h;return Array.from({length:1536},(b,$)=>(C(A+$)-.5)*2)},[s.embedding,s.chunk_id,s.id,l]),S=h=>{navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(h).then(()=>{x(!0),setTimeout(()=>x(!1),2e3)}).catch(()=>{_(h)}):_(h)},_=h=>{if(typeof window=="undefined"||typeof t=="undefined"||!t.createElement)return;const A=t.createElement("textarea");A.value=h,t.body.appendChild(A),A.focus(),A.select();try{t.execCommand("copy"),x(!0),setTimeout(()=>x(!1),2e3)}catch(b){}t.body.removeChild(A)};if(u.useEffect(()=>{const h=b=>{b.key==="Escape"?r():b.key==="ArrowLeft"&&l>1?i(l-1):b.key==="ArrowRight"&&l<n&&i(l+1)},A=(()=>{try{if(typeof window=="undefined"||typeof t=="undefined"||!t||typeof t.addEventListener!="function"||typeof t.removeEventListener!="function")return null;const b=()=>{};return t.addEventListener("test-event",b),t.removeEventListener("test-event",b),t}catch(b){return null}})();if(A)try{return A.addEventListener("keydown",h),()=>{try{A&&typeof A.removeEventListener=="function"&&A.removeEventListener("keydown",h)}catch(b){}}}catch(b){return()=>{}}return()=>{}},[l,n,r,i]),!s||!r||!i)return null;if(d)return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md mx-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"}),e.jsx("span",{className:"text-white",children:"Refreshing chunk content..."})]})})});const v=[{id:"content",label:"Content",icon:re,description:"Raw text and contextual summary"},{id:"analysis",label:"Analysis",icon:Y,description:"AI-extracted metadata and insights"},{id:"embedding",label:"Embedding",icon:Te,description:"Vector representation and similarity"}];try{return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 modal-overlay flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"modal-content bg-gray-900 text-white rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsx(Te,{className:"w-5 h-5 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Chunk Inspector"}),e.jsxs("p",{className:"text-gray-400",children:[(t==null?void 0:t.title)||"Document"," • Chunk ",l," of ",n]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 mr-4",children:[e.jsx("button",{onClick:()=>i(l-1),disabled:l<=1,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Previous Chunk (←)",children:e.jsx(_n,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-sm text-gray-400 px-2",children:[l," / ",n]}),e.jsx("button",{onClick:()=>i(l+1),disabled:l>=n,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Next Chunk (→)",children:e.jsx(xa,{className:"w-4 h-4"})})]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",title:"Close (Esc)",children:e.jsx(Pe,{className:"w-5 h-5 text-gray-400"})})]})]}),e.jsx("div",{className:"flex border-b border-gray-700",children:v.map(h=>{const A=h.icon,b=f===h.id;return e.jsxs("button",{onClick:()=>j(h.id),className:`flex items-center gap-2 px-6 py-4 font-medium transition-colors border-b-2 ${b?"text-primary-400 border-primary-400":"text-gray-400 hover:text-white border-transparent"}`,children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{children:h.label})]},h.id)})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 custom-scrollbar",style:{maxHeight:"calc(90vh - 200px)"},children:[f==="content"&&e.jsx(vr,{chunk:y,onCopy:S,copied:k,safeChunkIndex:l}),f==="analysis"&&e.jsx(Nr,{chunk:s,document:t}),f==="embedding"&&e.jsx(wr,{chunk:s,vector:P,safeChunkIndex:l})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 border-t border-gray-700 bg-gray-800 bg-opacity-30 text-sm text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{children:["Status: ",y.processing_status||"completed"]}),y.embeddingStatus==="complete"&&e.jsxs("span",{className:"flex items-center gap-1 text-blue-400",children:[e.jsx(Y,{className:"w-3 h-3"}),"Contextually Enhanced"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Use ← → to navigate chunks"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:"Esc to close"})]})]})]})})}catch(h){return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 modal-overlay flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"modal-content bg-gray-900 text-white rounded-2xl shadow-2xl w-full max-w-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-red-400",children:"Error Loading Chunk Inspector"}),e.jsx("p",{className:"text-gray-300 mb-4",children:"There was an error displaying the chunk details."}),e.jsx("button",{onClick:r,className:"bg-red-600 hover:bg-red-700 px-4 py-2 rounded text-white",children:"Close"})]})})}},vr=({chunk:s,onCopy:t,copied:a,safeChunkIndex:n})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Content Enhancement Comparison"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"See how AutoLlama's contextual embeddings enhance the original chunk"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:"text-gray-300",children:"Before: Original Chunk"})]}),e.jsxs("button",{onClick:()=>t(s.chunkText||s.text||s.chunk_text),className:`btn-secondary text-sm ${a?"bg-green-600":""}`,children:[e.jsx(Tt,{className:"w-4 h-4"}),a?"Copied!":"Copy"]})]}),e.jsx("div",{className:"bg-gray-800 border border-gray-600 rounded-lg p-4 h-64 overflow-y-auto",children:e.jsx("div",{className:"text-sm text-gray-300 leading-relaxed whitespace-pre-wrap",children:s.chunkText||s.text||s.chunk_text||"No content available"})}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsxs("div",{children:["Length: ",(s.chunkText||s.text||s.chunk_text||"").length," characters"]}),e.jsx("div",{children:"Status: Raw text chunk without contextual awareness"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-blue-400"}),e.jsx("span",{className:"text-blue-300",children:"After: AI Enhanced"})]}),e.jsxs("button",{onClick:()=>t(s.contextualSummary||s.contextual_summary||""),className:"btn-secondary text-sm",children:[e.jsx(Tt,{className:"w-4 h-4"}),"Copy Summary"]})]}),e.jsx("div",{className:"bg-blue-900 bg-opacity-20 border border-blue-500 border-opacity-40 rounded-lg p-4 h-64 overflow-y-auto",children:s.contextualSummary||s.contextual_summary?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-xs text-blue-400 font-medium uppercase tracking-wide",children:"AI-Generated Summary:"}),e.jsx("div",{className:"text-sm text-blue-200 italic leading-relaxed bg-blue-800 bg-opacity-30 p-3 rounded border-l-2 border-blue-400",children:s.contextualSummary||s.contextual_summary}),e.jsx("div",{className:"text-xs text-blue-400 font-medium uppercase tracking-wide",children:"Enhanced Embedding Input:"}),e.jsxs("div",{className:"text-xs text-blue-100 leading-relaxed opacity-75",children:[e.jsx("span",{className:"text-blue-300 font-medium",children:"Summary:"})," ",s.contextualSummary||s.contextual_summary,e.jsx("br",{}),e.jsx("span",{className:"text-blue-300 font-medium",children:"Original:"})," ",(s.chunkText||s.text||s.chunk_text||"").substring(0,100),"..."]})]})}):e.jsx("div",{className:"text-gray-400 text-sm italic",children:"No AI summary available for this chunk"})}),e.jsxs("div",{className:"text-xs text-blue-400 space-y-1",children:[e.jsxs("div",{children:["Enhancement: ",s.embeddingStatus==="complete"?"AI Enhanced":"Standard Processing"]}),e.jsx("div",{children:"Model: gpt-4o-mini → text-embedding-3-small"}),e.jsxs("div",{children:["Impact: ",s.contextualSummary||s.contextual_summary?"35-60% better retrieval accuracy":"Standard accuracy"]})]})]})]}),(s.contextualSummary||s.contextual_summary)&&e.jsx("div",{className:"bg-gradient-to-r from-blue-900 to-purple-900 bg-opacity-20 border border-blue-500 border-opacity-20 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 bg-opacity-20 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(Y,{className:"w-4 h-4 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-blue-300 mb-2",children:"Contextual Enhancement Value"}),e.jsx("p",{className:"text-sm text-blue-200 leading-relaxed",children:"The enhanced version combines the original chunk with document-aware context, enabling the AI to understand how this specific section relates to the broader document. This results in significantly more accurate semantic search and retrieval compared to traditional RAG systems that embed chunks in isolation."})]})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Processing Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Chunk Details"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-300",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Chunk Index:"}),e.jsx("span",{className:"font-mono",children:s.chunk_index!==void 0?s.chunk_index:n-1>=0?n-1:"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Chunk ID:"}),e.jsx("span",{className:"font-mono text-xs",children:s.chunkId||s.id||"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Status:"}),e.jsx("span",{className:`font-medium ${s.processing_status==="completed"?"text-green-400":s.processing_status==="processing"?"text-yellow-400":s.processing_status==="error"?"text-red-400":"text-gray-400"}`,children:s.processing_status||"completed"})]})]})]}),e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsx("h4",{className:"font-medium mb-2",children:"AI Processing"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-300",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Analysis Model:"}),e.jsx("span",{children:"gpt-4o-mini"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Embedding Model:"}),e.jsx("span",{children:"text-embedding-3-small"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Contextual:"}),e.jsx("span",{className:s.embeddingStatus==="complete"?"text-green-400":"text-gray-500",children:s.embeddingStatus==="complete"?"Enabled":"Disabled"})]})]})]})]})]})]}),Nr=({chunk:s,document:t})=>{var a,n,r;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-primary-400"}),"AI-Extracted Metadata"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Content Classification"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Content Type:"}),e.jsx("span",{children:s.contentType||(t==null?void 0:t.contentType)||"article"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Technical Level:"}),e.jsx("span",{children:s.technicalLevel||"intermediate"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Category:"}),e.jsx("span",{children:s.category||(t==null?void 0:t.category)||"General"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Sentiment & Emotion"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Sentiment:"}),e.jsx("span",{className:`font-medium ${s.sentiment==="positive"?"text-green-400":s.sentiment==="negative"?"text-red-400":"text-gray-300"}`,children:s.sentiment||"neutral"})]}),s.emotions&&s.emotions.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Emotions:"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.emotions.map((i,l)=>e.jsx("span",{className:"px-2 py-1 bg-primary-600 bg-opacity-20 text-primary-300 text-xs rounded-full",children:i},l))})]})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Topics & Concepts"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Main Topics"}),s.mainTopics&&s.mainTopics.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:s.mainTopics.map((i,l)=>e.jsx("span",{className:"px-3 py-1 bg-blue-600 bg-opacity-20 text-blue-300 text-sm rounded-full",children:i},l))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No topics identified"})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Key Concepts"}),s.keyConcepts?e.jsx("div",{className:"flex flex-wrap gap-2",children:(()=>{try{const i=JSON.parse(s.keyConcepts.replace(/'/g,'"'));return Array.isArray(i)?i.map((l,d)=>e.jsx("span",{className:"px-3 py-1 bg-green-600 bg-opacity-20 text-green-300 text-sm rounded-full",children:l},d)):[]}catch(i){return e.jsx("p",{className:"text-gray-500 text-sm",children:"No key concepts identified"})}})()}):e.jsx("p",{className:"text-gray-500 text-sm",children:"No key concepts identified"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Named Entities"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"font-bold mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-blue-400",children:"👥"}),"People"]}),(a=s.keyEntities)!=null&&a.people&&s.keyEntities.people.length>0?e.jsx("div",{className:"space-y-1",children:s.keyEntities.people.map((i,l)=>e.jsx("div",{className:"text-sm text-gray-300",children:i},l))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"None identified"})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"font-bold mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-green-400",children:"🏢"}),"Organizations"]}),(n=s.keyEntities)!=null&&n.organizations&&s.keyEntities.organizations.length>0?e.jsx("div",{className:"space-y-1",children:s.keyEntities.organizations.map((i,l)=>e.jsx("div",{className:"text-sm text-gray-300",children:i},l))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"None identified"})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"font-bold mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-yellow-400",children:"📍"}),"Locations"]}),(r=s.keyEntities)!=null&&r.locations&&s.keyEntities.locations.length>0?e.jsx("div",{className:"space-y-1",children:s.keyEntities.locations.map((i,l)=>e.jsx("div",{className:"text-sm text-gray-300",children:i},l))}):e.jsx("p",{className:"text-gray-500 text-sm",children:"None identified"})]})]})]})]})},wr=({chunk:s,vector:t,safeChunkIndex:a})=>e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx(Ta,{vector:t,title:`Chunk ${s.chunk_index!==void 0?s.chunk_index+1:a!==void 0?a:"N/A"} Embedding`})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Embedding Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Model:"}),e.jsx("span",{children:"text-embedding-3-small"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Dimensions:"}),e.jsx("span",{children:t.length})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Magnitude:"}),e.jsx("span",{children:Math.sqrt(t.reduce((n,r)=>n+r*r,0)).toFixed(4)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Contextual:"}),e.jsx("span",{className:s.embeddingStatus==="complete"?"text-green-400":"text-gray-500",children:s.embeddingStatus==="complete"?"Enhanced":"Standard"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Vector Statistics"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Min Value:"}),e.jsx("span",{className:"font-mono",children:Math.min(...t).toFixed(6)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Max Value:"}),e.jsx("span",{className:"font-mono",children:Math.max(...t).toFixed(6)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Mean:"}),e.jsx("span",{className:"font-mono",children:(t.reduce((n,r)=>n+r,0)/t.length).toFixed(6)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Non-zero:"}),e.jsxs("span",{children:[t.filter(n=>n!==0).length," / ",t.length]})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Similarity Analysis"}),e.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"This embedding can be used to find similar chunks through vector similarity search in Qdrant."}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{className:"btn-secondary text-sm",children:[e.jsx(Te,{className:"w-4 h-4"}),"Find Similar Chunks"]}),e.jsxs("button",{className:"btn-secondary text-sm",children:[e.jsx(Dt,{className:"w-4 h-4"}),"Search in Qdrant"]}),e.jsxs("button",{className:"btn-secondary text-sm",children:[e.jsx(Tt,{className:"w-4 h-4"}),"Copy Vector"]})]})]})]});class _r extends ma.Component{constructor(a){super(a);_s(this,"handleRetry",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(a){return{hasError:!0}}componentDidCatch(a,n){this.setState({error:a,errorInfo:n})}render(){if(this.state.hasError){const{onClose:a,fallbackTitle:n="Something went wrong"}=this.props;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 modal-overlay flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"modal-content bg-gray-900 text-white rounded-2xl shadow-2xl w-full max-w-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-red-600 bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsx(Sn,{className:"w-5 h-5 text-red-400"})}),e.jsx("h2",{className:"text-xl font-bold text-red-400",children:n})]}),a&&e.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",title:"Close",children:e.jsx(Pe,{className:"w-5 h-5 text-gray-400"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-gray-300 mb-4",children:"An error occurred while rendering this component. This might be due to a JavaScript error or missing data."}),this.state.error&&e.jsx("div",{className:"bg-red-900 bg-opacity-20 border border-red-500 border-opacity-30 rounded-lg p-3 mb-4",children:e.jsx("p",{className:"text-red-200 text-sm font-mono",children:this.state.error.toString()})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:this.handleRetry,className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded text-white font-medium transition-colors",children:[e.jsx(Ee,{className:"w-4 h-4"}),"Try Again"]}),a&&e.jsx("button",{onClick:a,className:"bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded text-white font-medium transition-colors",children:"Close"})]}),!1]})})}return this.props.children}}const Sr=()=>{const{selectedDocument:s,handleBackToDashboard:t,api:a}=te(),[n,r]=u.useState([]),[i,l]=u.useState(!0),[d,o]=u.useState(null),[c,p]=u.useState(0),[m,w]=u.useState("overview");u.useEffect(()=>{s&&f()},[s]);const f=()=>I(void 0,null,function*(){if(s!=null&&s.url){l(!0);try{const x=btoa(s.url),y=yield a.documents.getChunks(x,{limit:1e3});r((y==null?void 0:y.chunks)||[])}catch(x){}finally{l(!1)}}}),j=(x,y)=>{const C=x.chunkIndex!==void 0?x.chunkIndex+1:y+1;p(C),o(x)},k=x=>I(void 0,null,function*(){try{p(x);const y=n.find(S=>S.chunkIndex===x-1);if(y){o(y);return}const C=btoa(s.url),P=yield a.documents.getChunkByIndex(C,x-1);P.chunk&&o(P.chunk)}catch(y){const C=n.length>0?Math.max(...n.map(P=>P.chunkIndex!==void 0?P.chunkIndex:-1)):-1;if(x-1<=C){const P=n.find(S=>S.chunkIndex>=0);P&&o(P)}}});return s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:t,className:"flex items-center gap-2 text-blue-400 hover:text-blue-300 transition-colors",children:[e.jsx(kn,{className:"w-4 h-4"}),"Back to Dashboard"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:"btn-secondary",children:[e.jsx(cs,{className:"w-4 h-4"}),"Export Analysis"]}),e.jsxs("button",{className:"btn-secondary",children:[e.jsx(Dt,{className:"w-4 h-4"}),"Open Source"]})]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(re,{className:"w-6 h-6 text-primary-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2 text-white",children:s.title||s.url||"Untitled Document"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-400 mb-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ne,{className:"w-4 h-4"}),s.processedAt?new Date(s.processedAt).toLocaleDateString():"Recently processed"]}),e.jsx("span",{children:s.contentType||"Document"}),e.jsxs("span",{children:[n.length," chunks"]}),s.usesContextualEmbedding&&e.jsxs("span",{className:"flex items-center gap-1 text-blue-400",children:[e.jsx(Y,{className:"w-4 h-4"}),"Contextually Enhanced"]})]}),s.summary&&e.jsx("p",{className:"text-gray-300 leading-relaxed",children:s.summary})]})]})}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-800 bg-opacity-50 rounded-lg p-1",children:[e.jsx(qt,{id:"overview",label:"Overview",icon:et,active:m==="overview",onClick:()=>w("overview")}),e.jsx(qt,{id:"chunks",label:"Chunks",icon:re,active:m==="chunks",onClick:()=>w("chunks"),badge:n.length}),e.jsx(qt,{id:"analysis",label:"Analysis",icon:Y,active:m==="analysis",onClick:()=>w("analysis")})]}),i?e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(De,{className:"w-8 h-8 animate-spin text-primary-400 mr-3"}),e.jsx("span",{className:"text-lg",children:"Loading document analysis..."})]})}):e.jsxs(e.Fragment,{children:[m==="overview"&&e.jsx(kr,{document:s,chunks:n}),m==="chunks"&&e.jsx(Cr,{chunks:n,onChunkSelect:j}),m==="analysis"&&e.jsx(Ar,{document:s,chunks:n})]}),d&&e.jsx(_r,{onClose:()=>o(null),fallbackTitle:"Chunk Inspector Error",children:e.jsx(jr,{chunk:d,document:s,chunkIndex:c,totalChunks:n.length>0?Math.max(...n.map(x=>x.chunkIndex!==void 0?x.chunkIndex:-1))+1:0,onClose:()=>o(null),onNavigate:k})})]}):e.jsx("div",{className:"card",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(re,{className:"w-16 h-16 text-gray-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"No Document Selected"}),e.jsx("p",{className:"text-gray-400",children:"Please select a document to view its details."})]})})},qt=({id:s,label:t,icon:a,active:n,onClick:r,badge:i})=>e.jsxs("button",{onClick:r,className:`flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition-all duration-200 ${n?"bg-primary-600 text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:[e.jsx(a,{className:"w-4 h-4"}),e.jsx("span",{children:t}),i!==void 0&&e.jsx("span",{className:`px-2 py-1 text-xs rounded-full font-bold ${n?"bg-primary-800 text-primary-200":"bg-gray-600 text-gray-200"}`,children:i})]}),kr=({document:s,chunks:t})=>{const a={total:t.length,completed:t.filter(r=>r.processing_status==="completed"||r.processingStatus==="completed"||r.processing_status==="complete").length,processing:t.filter(r=>r.processing_status==="processing"||r.processingStatus==="processing").length,failed:t.filter(r=>r.processing_status==="error"||r.processingStatus==="error"||r.processing_status==="failed").length},n=a.total>0?Math.round(a.completed/a.total*100):0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(ft,{title:"Total Chunks",value:a.total,icon:re,color:"text-blue-400"}),e.jsx(ft,{title:"Completed",value:a.completed,icon:he,color:"text-green-400"}),e.jsx(ft,{title:"Processing",value:a.processing,icon:De,color:"text-yellow-400",animated:a.processing>0}),e.jsx(ft,{title:"Failed",value:a.failed,icon:de,color:"text-red-400"})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-bold",children:"Processing Progress"}),e.jsxs("span",{className:"text-sm text-gray-400",children:[n,"% Complete"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"h-full bg-green-500 transition-all duration-300",style:{width:`${n}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"font-bold mb-4 flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-primary-400"}),"AI Analysis"]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Content Type:"}),e.jsx("span",{children:s.contentType||"article"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Technical Level:"}),e.jsx("span",{children:s.technicalLevel||"intermediate"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Sentiment:"}),e.jsx("span",{className:`${s.sentiment==="positive"?"text-green-400":s.sentiment==="negative"?"text-red-400":"text-gray-300"}`,children:s.sentiment||"neutral"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Contextual Embeddings:"}),e.jsx("span",{className:s.usesContextualEmbedding?"text-green-400":"text-gray-500",children:s.usesContextualEmbedding?"Enabled":"Disabled"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"font-bold mb-4 flex items-center gap-2",children:[e.jsx(et,{className:"w-5 h-5 text-primary-400"}),"Content Statistics"]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Total Characters:"}),e.jsx("span",{children:t.reduce((r,i)=>{var l;return r+(((l=i.chunk_text)==null?void 0:l.length)||0)},0).toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Avg Chunk Size:"}),e.jsxs("span",{children:[t.length>0?Math.round(t.reduce((r,i)=>{var l;return r+(((l=i.chunk_text)==null?void 0:l.length)||0)},0)/t.length):0," characters"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Processing Time:"}),e.jsxs("span",{children:["~",Math.round(t.length*2.3)," seconds"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Storage Size:"}),e.jsxs("span",{children:["~",Math.round(t.length*1.5),"KB"]})]})]})]})]}),(s.mainTopics||s.keyEntities)&&e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"font-bold mb-4",children:"Topics & Entities"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.mainTopics&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2 text-gray-300",children:"Main Topics"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.mainTopics.map((r,i)=>e.jsx("span",{className:"px-3 py-1 bg-blue-600 bg-opacity-20 text-blue-300 text-sm rounded-full",children:r},i))})]}),s.keyEntities&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2 text-gray-300",children:"Key Entities"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[s.keyEntities.people&&s.keyEntities.people.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"People:"}),e.jsx("span",{className:"ml-2",children:s.keyEntities.people.join(", ")})]}),s.keyEntities.organizations&&s.keyEntities.organizations.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Organizations:"}),e.jsx("span",{className:"ml-2",children:s.keyEntities.organizations.join(", ")})]}),s.keyEntities.locations&&s.keyEntities.locations.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-400",children:"Locations:"}),e.jsx("span",{className:"ml-2",children:s.keyEntities.locations.join(", ")})]})]})]})]})]})]})},Cr=({chunks:s,onChunkSelect:t})=>{var i;const{settings:a}=te();(i=a==null?void 0:a.ui)!=null&&i.chunksPerRow;const n={queued:{color:"bg-gray-500",text:"text-gray-200"},processing:{color:"bg-yellow-500 animate-pulse",text:"text-yellow-100"},completed:{color:"bg-green-500",text:"text-green-100"},error:{color:"bg-red-500",text:"text-red-100"}},r=()=>"grid gap-1.5 max-h-[28rem] overflow-y-auto custom-scrollbar p-3 border border-gray-700 rounded-lg bg-gray-800 bg-opacity-30 grid-cols-6 sm:grid-cols-8 md:grid-cols-12 lg:grid-cols-16 xl:grid-cols-20 2xl:grid-cols-24";return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"font-bold text-xl",children:"Document Chunks"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Click any chunk to inspect its details (responsive grid layout)"})]}),e.jsx("div",{className:r(),children:s.map((l,d)=>{let o="completed";l.processing_status==="processing"||l.processingStatus==="processing"?o="processing":l.processing_status==="error"||l.processingStatus==="error"||l.processing_status==="failed"||l.processingStatus==="failed"?o="error":l.processing_status==="queued"||l.processingStatus==="queued"?o="queued":(l.processing_status==="completed"||l.processingStatus==="completed"||l.processing_status==="complete"||l.processingStatus==="complete")&&(o="completed");const c=n[o]||n.completed;return e.jsxs("button",{onClick:()=>t(l,d),className:`
                chunk-glow w-full aspect-square rounded-md flex items-center justify-center text-xs font-mono font-bold
                transition-all duration-300 cursor-pointer relative overflow-hidden
                ${c.color} ${c.text}
                ${o==="processing"?"chunk-pulse":""}
                ${o==="completed"?"chunk-completed":""}
                ${o==="error"?"chunk-error":""}
                ${o==="queued"?"chunk-queued":""}
              `,title:`Chunk ${d+1} - Status: ${l.status||"completed"}`,children:[e.jsx("span",{className:"relative z-10",children:d+1}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 to-transparent opacity-0 transition-opacity duration-300 group-hover:opacity-100"})]},l.chunk_id||d)})}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-center gap-6 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded"}),e.jsx("span",{className:"text-gray-400",children:"Completed"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-yellow-500 rounded animate-pulse"}),e.jsx("span",{className:"text-gray-400",children:"Processing"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-500 rounded"}),e.jsx("span",{className:"text-gray-400",children:"Queued"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),e.jsx("span",{className:"text-gray-400",children:"Failed"})]})]})})]})},Ar=({document:s,chunks:t})=>{const a=()=>{const o={},c=t.filter(p=>p.processing_status==="completed"||p.processingStatus==="completed"||p.processing_status==="complete");return c.forEach(p=>{p.main_topics&&Array.isArray(p.main_topics)&&p.main_topics.length>0&&p.main_topics.forEach(m=>{o[m]=(o[m]||0)+1})}),Object.entries(o).map(([p,m])=>({topic:p,frequency:m,confidence:Math.min(.95,.5+m/Math.max(c.length,1)*.45)})).sort((p,m)=>m.frequency-p.frequency).slice(0,6)},n=()=>{if(!t.length)return{contextual:0,entity:0,sentiment:0};const o=t.filter(w=>w.processing_status==="completed"||w.processingStatus==="completed"||w.processing_status==="complete");if(!o.length)return{contextual:0,entity:0,sentiment:0};const c=o.filter(w=>w.contextual_summary).length,p=o.filter(w=>w.key_entities&&Object.keys(w.key_entities).length>0).length,m=o.filter(w=>w.sentiment&&w.sentiment!=="neutral").length;return{contextual:Math.round(c/o.length*100),entity:Math.round(p/o.length*100),sentiment:Math.round(m/o.length*100)}},r=()=>{if(!t.length)return{strengths:[],observations:[],ragReadiness:[]};const o=t.filter(b=>b.processing_status==="completed"||b.processingStatus==="completed"||b.processing_status==="complete");if(!o.length)return{strengths:["Document processing initiated"],observations:["Analysis in progress - detailed insights available after processing completes"],ragReadiness:["Preparing for semantic search capabilities"]};const c=o.map(b=>b.sentiment).filter(Boolean),p=o.flatMap(b=>b.emotions||[]),m=o.flatMap(b=>Object.values(b.key_entities||{})).flat(),w=o.flatMap(b=>b.main_topics||[]),f=o.map(b=>b.content_type).filter(Boolean),j=o.map(b=>b.technical_level).filter(Boolean),k=o.map(b=>b.category).filter(Boolean),x=[],y=[],C=[];if(m.length>o.length*.5){const b=[...new Set(m)];x.push(`Rich entity network (${b.length} unique entities identified)`)}if(w.length>o.length*.7){const b=[...new Set(w)];x.push(`Comprehensive topic coverage (${b.length} distinct topics)`)}o.filter(b=>b.contextual_summary).length>o.length*.8&&x.push("Enhanced contextual embeddings for improved retrieval accuracy");const P=c.filter(b=>b==="positive").length,S=c.filter(b=>b==="neutral").length;c.filter(b=>b==="negative").length,P>c.length*.6?x.push("Predominantly positive content tone"):S>c.length*.7&&x.push("Objective, informational content style");const _=[...new Set(f)],v=[...new Set(k)],h=[...new Set(j)];if(_.length>1?y.push(`Multi-format content: ${_.join(", ")}`):_[0]&&y.push(`Consistent ${_[0]} content type`),v.length>0&&y.push(`Primary subject areas: ${v.slice(0,3).join(", ")}`),h.length>1?y.push(`Varied complexity levels: ${h.join(", ")}`):h[0]&&y.push(`${h[0].charAt(0).toUpperCase()+h[0].slice(1)} technical level throughout`),p.length>0){const b=[...new Set(p)];y.push(`Emotional depth detected: ${b.slice(0,3).join(", ")}`)}const A=Math.round(o.filter(b=>b.contextual_summary).length/o.length*100);return A>70&&C.push(`${A}% contextual enhancement coverage`),m.length>0&&C.push(`Entity-relationship mapping for ${m.length} extracted entities`),w.length>0&&C.push(`Topic-based retrieval for ${[...new Set(w)].length} semantic themes`),C.push(`Optimized ${o.length}-chunk structure for vector search`),x.length===0&&x.push("Successfully processed and embedded for semantic search"),y.length===0&&y.push("Standard content structure with consistent formatting"),C.length===0&&C.push("Ready for AI-powered question answering"),{strengths:x,observations:y,ragReadiness:C}},i=a(),l=n(),d=r();return t.filter(o=>o.processing_status==="completed"||o.processingStatus==="completed"||o.processing_status==="complete"),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"font-bold mb-4",children:"Topic Distribution"}),e.jsx("div",{className:"space-y-3",children:i.length>0?i.map((o,c)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:o.topic}),e.jsxs("span",{className:"text-gray-400",children:[o.frequency," mentions"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"h-2 bg-primary-500 rounded-full",style:{width:`${o.confidence*100}%`}})})]},c)):e.jsxs("div",{className:"text-center py-4 text-gray-400",children:[e.jsx(Y,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),t.some(o=>o.processing_status==="processing"||o.processingStatus==="processing")?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Topics are being analyzed..."}),e.jsx("p",{className:"text-xs",children:"AI analysis in progress. Topics will appear as chunks complete processing."})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"No topics detected in chunks"}),e.jsx("p",{className:"text-xs",children:"Topics may not be available for this document"})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"font-bold mb-4",children:"Processing Quality"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Contextual Enhancement"}),e.jsxs("span",{className:"text-green-400",children:[l.contextual,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"h-2 bg-green-500 rounded-full",style:{width:`${l.contextual}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Entity Recognition"}),e.jsxs("span",{className:"text-blue-400",children:[l.entity,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"h-2 bg-blue-500 rounded-full",style:{width:`${l.entity}%`}})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Sentiment Analysis"}),e.jsxs("span",{className:"text-purple-400",children:[l.sentiment,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"h-2 bg-purple-500 rounded-full",style:{width:`${l.sentiment}%`}})})]})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"font-bold mb-4",children:"Comprehensive Analysis Report"}),e.jsxs("div",{className:"prose prose-invert max-w-none",children:[e.jsx("p",{className:"text-gray-300 leading-relaxed",children:(()=>{const o=t.filter(j=>j.processing_status==="completed"||j.processingStatus==="completed"||j.processing_status==="complete"),c=t.length-o.length;if(o.length===0)return`This document is currently being processed using AutoLlama's advanced contextual embedding system. ${t.length} chunks are being analyzed for topics, entities, and semantic relationships.`;const p=[...new Set(o.flatMap(j=>j.main_topics||[]))],m=[...new Set(o.map(j=>j.category).filter(Boolean))],w=[...new Set(o.map(j=>j.content_type).filter(Boolean))];let f=`Analysis of ${(s==null?void 0:s.title)||"this document"} reveals ${o.length} processed chunks`;return c>0&&(f+=` (${c} still processing)`),p.length>0&&(f+=` covering primary topics: ${p.slice(0,3).join(", ")}`,p.length>3&&(f+=` and ${p.length-3} others`)),m.length>0&&(f+=`. Content categorized as ${m.join(", ")}`),w.length>0&&(f+=` with ${w.join(", ")} formatting`),f+=". Enhanced with contextual embeddings for superior retrieval accuracy.",f})()}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-900 bg-opacity-20 border border-blue-700 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-blue-300 mb-2",children:"Strengths"}),e.jsx("ul",{className:"text-sm text-blue-200 space-y-1",children:d.strengths.length>0?d.strengths.map((o,c)=>e.jsxs("li",{children:["• ",o]},c)):e.jsx("li",{children:"• Content successfully processed"})})]}),e.jsxs("div",{className:"bg-yellow-900 bg-opacity-20 border border-yellow-700 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-yellow-300 mb-2",children:"Observations"}),e.jsx("ul",{className:"text-sm text-yellow-200 space-y-1",children:d.observations.length>0?d.observations.map((o,c)=>e.jsxs("li",{children:["• ",o]},c)):e.jsx("li",{children:"• Consistent content structure"})})]}),e.jsxs("div",{className:"bg-green-900 bg-opacity-20 border border-green-700 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-green-300 mb-2",children:"RAG Readiness"}),e.jsx("ul",{className:"text-sm text-green-200 space-y-1",children:d.ragReadiness.map((o,c)=>e.jsxs("li",{children:["• ",o]},c))})]})]})]})]})]})},ft=({title:s,value:t,icon:a,color:n,animated:r=!1})=>e.jsxs("div",{className:"card text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(a,{className:`w-6 h-6 ${n} ${r?"animate-spin":""}`})}),e.jsx("div",{className:`text-2xl font-bold ${n}`,children:t}),e.jsx("div",{className:"text-sm text-gray-400",children:s})]}),Er=s=>s.includes("pdf")?re:s.includes("image")?Cn:An,Tr=s=>{if(s===0)return"0 Bytes";const t=1024,a=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,n)).toFixed(2))+" "+a[n]},$s=({onSuccess:s,onError:t})=>{const{api:a,settings:n,updateSetting:r,uploadQueue:i,addToUploadQueue:l,updateUploadStatus:d,removeFromUploadQueue:o,clearCompletedUploads:c}=te(),[p,m]=u.useState(!1),w=u.useRef(null),f=u.useCallback(h=>{h.preventDefault(),h.stopPropagation(),h.type==="dragenter"||h.type==="dragover"?m(!0):h.type==="dragleave"&&m(!1)},[]),j=u.useCallback(h=>{h.preventDefault(),h.stopPropagation(),m(!1),h.dataTransfer.files&&h.dataTransfer.files[0]&&x(Array.from(h.dataTransfer.files))},[]),k=h=>{h.target.files&&h.target.files.length>0&&x(Array.from(h.target.files))},x=h=>{var $;const A=h.filter(E=>y(E)),b=l(A);($=n==null?void 0:n.processing)!=null&&$.autoStartProcessing&&b.forEach(E=>{C(E)})},y=h=>["application/pdf","text/plain","text/markdown","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/epub+zip","text/csv","application/json"].includes(h.type)&&h.size<=104857600,C=h=>I(void 0,null,function*(){var b,$;d(h.id,{status:"uploading",progress:0});let A=null;try{const E=new FormData;E.append("file",h.file),E.append("enableContextual",n.processing.enableContextualEmbeddings),E.append("source","user");const U=new AbortController;A=setTimeout(()=>U.abort(),18e5),d(h.id,{abortController:U});const W=yield fetch("/api/process-file-stream",{method:"POST",body:E,signal:U.signal});if(!W.ok)throw new Error(`HTTP ${W.status}: ${W.statusText}`);const q=W.body.getReader(),H=new TextDecoder;let se="";try{for(;;){const{done:Q,value:Z}=yield q.read();if(Q)break;se+=H.decode(Z,{stream:!0});const F=se.split(`
`);se=F.pop()||"";for(const ae of F)if(ae.trim()!==""&&ae.startsWith("data: "))try{const ee=ae.slice(6).trim();if(ee==="")continue;const oe=JSON.parse(ee);oe&&typeof oe=="object"&&P({event:oe.event,data:oe.data},h)}catch(ee){}}if(se.trim()&&se.startsWith("data: "))try{const Q=se.slice(6).trim();if(Q){const Z=JSON.parse(Q);Z&&typeof Z=="object"&&P({event:Z.event,data:Z.data},h)}}catch(Q){}}finally{q.releaseLock(),clearTimeout(A)}setTimeout(()=>{d(h.id,{status:"processing",progress:Math.max(h.progress||0,95)})},1e3)}catch(E){A&&clearTimeout(A);let U="Upload failed";if(E.name==="AbortError"){if(((b=i.find(q=>q.id===h.id))==null?void 0:b.status)==="cancelled")return;U="Upload timeout - file too large or connection too slow"}else E.response?E.response.status===413?U="File too large (max 500MB)":E.response.status===415?U="Unsupported file type":($=E.response.data)!=null&&$.message?U=E.response.data.message:U=`HTTP ${E.response.status}: ${E.response.statusText||"Upload failed"}`:E.message&&(U=E.message);d(h.id,{status:"error",error:U}),t&&t(h,E)}}),P=(h,A)=>{if(!h||typeof h!="object")return;const b=h.event,$=h.data||{};if(b==="error"){const E={id:Date.now().toString(),message:$.message||"Upload failed",error_type:$.error_type||"unknown",recovery_suggestions:$.recovery_suggestions||["Try uploading again"],retry_recommended:$.retry_recommended||!1,severity:$.severity||"high",category:$.category||"processing",retryable:$.retryable||$.retry_recommended||!1,timestamp:new Date().toISOString()};d(A.id,{status:"error",error:E.message,error_type:E.error_type,recovery_suggestions:E.recovery_suggestions,retry_recommended:E.retry_recommended}),t&&t(A,E)}else if(b==="heartbeat_timeout")d(A.id,{status:"stuck",message:$.message||"Processing is taking longer than expected...",time_since_last_update:$.time_since_last_update,progress:$.total_progress||50});else if(b==="heartbeat")d(A.id,{last_heartbeat:$.timestamp,heartbeat_step:$.step});else if(b==="start")d(A.id,{status:"processing",sessionId:$.processingId,progress:5});else if(b==="upload")d(A.id,{status:"uploading",progress:Math.max($.progress||5,5)});else if(b==="parse")d(A.id,{status:"processing",progress:Math.max($.progress||40,30)});else if(b==="chunk")d(A.id,{status:"processing",progress:Math.max($.progress||55,50)});else if(b==="analyze"){const E=$.progress||70;d(A.id,{status:"processing",progress:Math.max(E,60)})}else if(b==="embedding"){const E=$.progress||85;d(A.id,{status:"processing",progress:Math.max(E,80)})}else if(b==="qdrant")d(A.id,{status:"processing",progress:Math.max($.progress||92,90)});else if(b==="complete")d(A.id,{status:"completed",progress:100}),s&&s(A,$);else{const E=$.progress||0;E>0&&d(A.id,{status:"processing",progress:Math.min(Math.max(E,5),95)})}},S=h=>{o(h)},_=h=>{C(h)},v=h=>{h.abortController&&(h.abortController.abort(),d(h.id,{status:"cancelled",error:"Upload cancelled by user",abortController:null}))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:`
          relative border-2 border-dashed rounded-xl p-8 text-center transition-all duration-200 cursor-pointer
          ${p?"border-primary-400 bg-primary-600 bg-opacity-10":"border-gray-600 hover:border-gray-500"}
        `,onDragEnter:f,onDragLeave:f,onDragOver:f,onDrop:j,onClick:()=>{var h;(h=w.current)==null||h.click()},children:[e.jsx("input",{ref:w,type:"file",multiple:!0,accept:".pdf,.txt,.md,.doc,.docx,.epub,.csv,.json",onChange:k,className:"hidden"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:`w-16 h-16 mx-auto rounded-full flex items-center justify-center ${p?"bg-primary-500 bg-opacity-20":"bg-gray-700"}`,children:e.jsx(Je,{className:`w-8 h-8 ${p?"text-primary-400":"text-gray-400"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:p?"Drop files here!":"Upload Documents"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Drag and drop files here, or click to browse"}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("p",{children:"Supported: PDF, TXT, MD, DOC, DOCX, EPUB, CSV, JSON"}),e.jsx("p",{children:"Maximum size: 100MB per file"})]})]}),e.jsxs("button",{className:"btn-primary",children:[e.jsx(Je,{className:"w-4 h-4"}),"Choose Files"]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-4",children:"Processing Options"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.processing.enableContextualEmbeddings,onChange:h=>r("processing","enableContextualEmbeddings",h.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Enable Contextual Embeddings"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.processing.autoStartProcessing||!1,onChange:h=>r("processing","autoStartProcessing",h.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{className:"text-sm",children:"Auto-start Processing"})]})]})]}),i.length>0&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-bold",children:"Upload Queue"}),e.jsxs("div",{className:"text-sm text-gray-400",children:[i.length," file",i.length!==1?"s":""]})]}),e.jsx("div",{className:"space-y-3",children:i.map(h=>e.jsx(Pr,{fileData:h,onRemove:()=>S(h.id),onRetry:()=>_(h),onUpload:()=>C(h),onStop:()=>v(h)},h.id))})]}),i.length>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(yt,{title:"Total Files",value:i.length,color:"text-blue-400"}),e.jsx(yt,{title:"Completed",value:i.filter(h=>h.status==="completed").length,color:"text-green-400"}),e.jsx(yt,{title:"Processing",value:i.filter(h=>h.status==="processing"||h.status==="uploading").length,color:"text-yellow-400"}),e.jsx(yt,{title:"Failed",value:i.filter(h=>h.status==="error"||h.status==="cancelled").length,color:"text-red-400"})]})]})},Pr=({fileData:s,onRemove:t,onRetry:a,onUpload:n,onStop:r})=>{const i=Er(s.type),l={pending:{color:"text-gray-400",bg:"bg-gray-600",icon:re,action:"Upload"},uploading:{color:"text-blue-400",bg:"bg-blue-600",icon:De,action:"Uploading..."},processing:{color:"text-yellow-400",bg:"bg-yellow-600",icon:De,action:"Processing..."},completed:{color:"text-green-400",bg:"bg-green-600",icon:he,action:"Completed"},error:{color:"text-red-400",bg:"bg-red-600",icon:de,action:"Failed"},cancelled:{color:"text-orange-400",bg:"bg-orange-600",icon:Pe,action:"Cancelled"}},d=l[s.status]||l.pending,o=d.icon;return e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(i,{className:"w-5 h-5 text-primary-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-white truncate",children:s.name}),e.jsx("span",{className:"text-xs text-gray-500",children:Tr(s.size)})]}),(s.status==="uploading"||s.status==="processing")&&e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2 mb-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${d.bg}`,style:{width:`${s.progress||0}%`}})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(o,{className:`w-4 h-4 ${d.color} ${s.status==="uploading"||s.status==="processing"?"animate-spin":""}`}),e.jsx("span",{className:d.color,children:d.action}),s.progress>0&&s.status!=="completed"&&e.jsxs("span",{className:"text-gray-400",children:["(",Math.round(s.progress),"%)"]})]}),s.error&&e.jsx("div",{className:"text-sm text-red-400 mt-1",children:s.error})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="pending"&&e.jsx("button",{onClick:n,className:"btn-primary text-sm",children:"Upload"}),(s.status==="uploading"||s.status==="processing")&&e.jsx("button",{onClick:r,className:"btn-secondary text-sm bg-red-600 hover:bg-red-700 text-white",title:"Stop upload",children:"Stop"}),s.status==="error"&&e.jsx("button",{onClick:a,className:"btn-secondary text-sm",children:"Retry"}),s.status==="cancelled"&&e.jsx("button",{onClick:a,className:"btn-secondary text-sm",children:"Retry"}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-700 rounded transition-colors",title:"Remove",children:e.jsx(Pe,{className:"w-4 h-4 text-gray-400"})})]})]})},yt=({title:s,value:t,color:a})=>e.jsxs("div",{className:"text-center p-4 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700",children:[e.jsx("div",{className:`text-2xl font-bold ${a}`,children:t}),e.jsx("div",{className:"text-sm text-gray-400",children:s})]});var Ut,z,Pa,Me,Ms,Ia,$a,Ma,us,Yt,es,ts={},Ra=[],Ir=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,st=Array.isArray;function be(s,t){for(var a in t)s[a]=t[a];return s}function ms(s){s&&s.parentNode&&s.parentNode.removeChild(s)}function ss(s,t,a){var n,r,i,l={};for(i in t)i=="key"?n=t[i]:i=="ref"?r=t[i]:l[i]=t[i];if(arguments.length>2&&(l.children=arguments.length>3?Ut.call(arguments,2):a),typeof s=="function"&&s.defaultProps!=null)for(i in s.defaultProps)l[i]===void 0&&(l[i]=s.defaultProps[i]);return Ge(s,l,n,r,null)}function Ge(s,t,a,n,r){var i={type:s,props:t,key:a,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r==null?++Pa:r,__i:-1,__u:0};return r==null&&z.vnode!=null&&z.vnode(i),i}function Ye(s){return s.children}function ve(s,t){this.props=s,this.context=t}function Be(s,t){if(t==null)return s.__?Be(s.__,s.__i+1):null;for(var a;t<s.__k.length;t++)if((a=s.__k[t])!=null&&a.__e!=null)return a.__e;return typeof s.type=="function"?Be(s):null}function Da(s){var t,a;if((s=s.__)!=null&&s.__c!=null){for(s.__e=s.__c.base=null,t=0;t<s.__k.length;t++)if((a=s.__k[t])!=null&&a.__e!=null){s.__e=s.__c.base=a.__e;break}return Da(s)}}function Rs(s){(!s.__d&&(s.__d=!0)&&Me.push(s)&&!Pt.__r++||Ms!=z.debounceRendering)&&((Ms=z.debounceRendering)||Ia)(Pt)}function Pt(){for(var s,t,a,n,r,i,l,d=1;Me.length;)Me.length>d&&Me.sort($a),s=Me.shift(),d=Me.length,s.__d&&(a=void 0,r=(n=(t=s).__v).__e,i=[],l=[],t.__P&&((a=be({},n)).__v=n.__v+1,z.vnode&&z.vnode(a),La(t.__P,a,n,t.__n,t.__P.namespaceURI,32&n.__u?[r]:null,i,r==null?Be(n):r,!!(32&n.__u),l),a.__v=n.__v,a.__.__k[a.__i]=a,Rr(i,a,l),a.__e!=r&&Da(a)));Pt.__r=0}function Oa(s,t,a,n,r,i,l,d,o,c,p){var m,w,f,j,k,x,y=n&&n.__k||Ra,C=t.length;for(o=$r(a,t,y,o,C),m=0;m<C;m++)(f=a.__k[m])!=null&&(w=f.__i==-1?ts:y[f.__i]||ts,f.__i=m,x=La(s,f,w,r,i,l,d,o,c,p),j=f.__e,f.ref&&w.ref!=f.ref&&(w.ref&&ps(w.ref,null,f),p.push(f.ref,f.__c||j,f)),k==null&&j!=null&&(k=j),4&f.__u||w.__k===f.__k?o=Ua(f,o,s):typeof f.type=="function"&&x!==void 0?o=x:j&&(o=j.nextSibling),f.__u&=-7);return a.__e=k,o}function $r(s,t,a,n,r){var i,l,d,o,c,p=a.length,m=p,w=0;for(s.__k=new Array(r),i=0;i<r;i++)(l=t[i])!=null&&typeof l!="boolean"&&typeof l!="function"?(o=i+w,(l=s.__k[i]=typeof l=="string"||typeof l=="number"||typeof l=="bigint"||l.constructor==String?Ge(null,l,null,null,null):st(l)?Ge(Ye,{children:l},null,null,null):l.constructor==null&&l.__b>0?Ge(l.type,l.props,l.key,l.ref?l.ref:null,l.__v):l).__=s,l.__b=s.__b+1,d=null,(c=l.__i=Mr(l,a,o,m))!=-1&&(m--,(d=a[c])&&(d.__u|=2)),d==null||d.__v==null?(c==-1&&(r>p?w--:r<p&&w++),typeof l.type!="function"&&(l.__u|=4)):c!=o&&(c==o-1?w--:c==o+1?w++:(c>o?w--:w++,l.__u|=4))):s.__k[i]=null;if(m)for(i=0;i<p;i++)(d=a[i])!=null&&!(2&d.__u)&&(d.__e==n&&(n=Be(d)),za(d,d));return n}function Ua(s,t,a){var n,r;if(typeof s.type=="function"){for(n=s.__k,r=0;n&&r<n.length;r++)n[r]&&(n[r].__=s,t=Ua(n[r],t,a));return t}s.__e!=t&&(t&&s.type&&!a.contains(t)&&(t=Be(s)),a.insertBefore(s.__e,t||null),t=s.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function fe(s,t){return t=t||[],s==null||typeof s=="boolean"||(st(s)?s.some(function(a){fe(a,t)}):t.push(s)),t}function Mr(s,t,a,n){var r,i,l,d=s.key,o=s.type,c=t[a],p=c!=null&&(2&c.__u)==0;if(c===null&&s.key==null||p&&d==c.key&&o==c.type)return a;if(n>(p?1:0)){for(r=a-1,i=a+1;r>=0||i<t.length;)if((c=t[l=r>=0?r--:i++])!=null&&!(2&c.__u)&&d==c.key&&o==c.type)return l}return-1}function Ds(s,t,a){t[0]=="-"?s.setProperty(t,a==null?"":a):s[t]=a==null?"":typeof a!="number"||Ir.test(t)?a:a+"px"}function bt(s,t,a,n,r){var i,l;e:if(t=="style")if(typeof a=="string")s.style.cssText=a;else{if(typeof n=="string"&&(s.style.cssText=n=""),n)for(t in n)a&&t in a||Ds(s.style,t,"");if(a)for(t in a)n&&a[t]==n[t]||Ds(s.style,t,a[t])}else if(t[0]=="o"&&t[1]=="n")i=t!=(t=t.replace(Ma,"$1")),l=t.toLowerCase(),t=l in s||t=="onFocusOut"||t=="onFocusIn"?l.slice(2):t.slice(2),s.l||(s.l={}),s.l[t+i]=a,a?n?a.u=n.u:(a.u=us,s.addEventListener(t,i?es:Yt,i)):s.removeEventListener(t,i?es:Yt,i);else{if(r=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in s)try{s[t]=a==null?"":a;break e}catch(d){}typeof a=="function"||(a==null||a===!1&&t[4]!="-"?s.removeAttribute(t):s.setAttribute(t,t=="popover"&&a==1?"":a))}}function Os(s){return function(t){if(this.l){var a=this.l[t.type+s];if(t.t==null)t.t=us++;else if(t.t<a.u)return;return a(z.event?z.event(t):t)}}}function La(s,t,a,n,r,i,l,d,o,c){var p,m,w,f,j,k,x,y,C,P,S,_,v,h,A,b,$,E=t.type;if(t.constructor!=null)return null;128&a.__u&&(o=!!(32&a.__u),i=[d=t.__e=a.__e]),(p=z.__b)&&p(t);e:if(typeof E=="function")try{if(y=t.props,C="prototype"in E&&E.prototype.render,P=(p=E.contextType)&&n[p.__c],S=p?P?P.props.value:p.__:n,a.__c?x=(m=t.__c=a.__c).__=m.__E:(C?t.__c=m=new E(y,S):(t.__c=m=new ve(y,S),m.constructor=E,m.render=Or),P&&P.sub(m),m.props=y,m.state||(m.state={}),m.context=S,m.__n=n,w=m.__d=!0,m.__h=[],m._sb=[]),C&&m.__s==null&&(m.__s=m.state),C&&E.getDerivedStateFromProps!=null&&(m.__s==m.state&&(m.__s=be({},m.__s)),be(m.__s,E.getDerivedStateFromProps(y,m.__s))),f=m.props,j=m.state,m.__v=t,w)C&&E.getDerivedStateFromProps==null&&m.componentWillMount!=null&&m.componentWillMount(),C&&m.componentDidMount!=null&&m.__h.push(m.componentDidMount);else{if(C&&E.getDerivedStateFromProps==null&&y!==f&&m.componentWillReceiveProps!=null&&m.componentWillReceiveProps(y,S),!m.__e&&m.shouldComponentUpdate!=null&&m.shouldComponentUpdate(y,m.__s,S)===!1||t.__v==a.__v){for(t.__v!=a.__v&&(m.props=y,m.state=m.__s,m.__d=!1),t.__e=a.__e,t.__k=a.__k,t.__k.some(function(U){U&&(U.__=t)}),_=0;_<m._sb.length;_++)m.__h.push(m._sb[_]);m._sb=[],m.__h.length&&l.push(m);break e}m.componentWillUpdate!=null&&m.componentWillUpdate(y,m.__s,S),C&&m.componentDidUpdate!=null&&m.__h.push(function(){m.componentDidUpdate(f,j,k)})}if(m.context=S,m.props=y,m.__P=s,m.__e=!1,v=z.__r,h=0,C){for(m.state=m.__s,m.__d=!1,v&&v(t),p=m.render(m.props,m.state,m.context),A=0;A<m._sb.length;A++)m.__h.push(m._sb[A]);m._sb=[]}else do m.__d=!1,v&&v(t),p=m.render(m.props,m.state,m.context),m.state=m.__s;while(m.__d&&++h<25);m.state=m.__s,m.getChildContext!=null&&(n=be(be({},n),m.getChildContext())),C&&!w&&m.getSnapshotBeforeUpdate!=null&&(k=m.getSnapshotBeforeUpdate(f,j)),b=p,p!=null&&p.type===Ye&&p.key==null&&(b=Fa(p.props.children)),d=Oa(s,st(b)?b:[b],t,a,n,r,i,l,d,o,c),m.base=t.__e,t.__u&=-161,m.__h.length&&l.push(m),x&&(m.__E=m.__=null)}catch(U){if(t.__v=null,o||i!=null)if(U.then){for(t.__u|=o?160:128;d&&d.nodeType==8&&d.nextSibling;)d=d.nextSibling;i[i.indexOf(d)]=null,t.__e=d}else{for($=i.length;$--;)ms(i[$]);as(t)}else t.__e=a.__e,t.__k=a.__k,U.then||as(t);z.__e(U,t,a)}else i==null&&t.__v==a.__v?(t.__k=a.__k,t.__e=a.__e):d=t.__e=Dr(a.__e,t,a,n,r,i,l,o,c);return(p=z.diffed)&&p(t),128&t.__u?void 0:d}function as(s){s&&s.__c&&(s.__c.__e=!0),s&&s.__k&&s.__k.forEach(as)}function Rr(s,t,a){for(var n=0;n<a.length;n++)ps(a[n],a[++n],a[++n]);z.__c&&z.__c(t,s),s.some(function(r){try{s=r.__h,r.__h=[],s.some(function(i){i.call(r)})}catch(i){z.__e(i,r.__v)}})}function Fa(s){return typeof s!="object"||s==null||s.__b&&s.__b>0?s:st(s)?s.map(Fa):be({},s)}function Dr(s,t,a,n,r,i,l,d,o){var c,p,m,w,f,j,k,x=a.props,y=t.props,C=t.type;if(C=="svg"?r="http://www.w3.org/2000/svg":C=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),i!=null){for(c=0;c<i.length;c++)if((f=i[c])&&"setAttribute"in f==!!C&&(C?f.localName==C:f.nodeType==3)){s=f,i[c]=null;break}}if(s==null){if(C==null)return document.createTextNode(y);s=document.createElementNS(r,C,y.is&&y),d&&(z.__m&&z.__m(t,i),d=!1),i=null}if(C==null)x===y||d&&s.data==y||(s.data=y);else{if(i=i&&Ut.call(s.childNodes),x=a.props||ts,!d&&i!=null)for(x={},c=0;c<s.attributes.length;c++)x[(f=s.attributes[c]).name]=f.value;for(c in x)if(f=x[c],c!="children"){if(c=="dangerouslySetInnerHTML")m=f;else if(!(c in y)){if(c=="value"&&"defaultValue"in y||c=="checked"&&"defaultChecked"in y)continue;bt(s,c,null,f,r)}}for(c in y)f=y[c],c=="children"?w=f:c=="dangerouslySetInnerHTML"?p=f:c=="value"?j=f:c=="checked"?k=f:d&&typeof f!="function"||x[c]===f||bt(s,c,f,x[c],r);if(p)d||m&&(p.__html==m.__html||p.__html==s.innerHTML)||(s.innerHTML=p.__html),t.__k=[];else if(m&&(s.innerHTML=""),Oa(t.type=="template"?s.content:s,st(w)?w:[w],t,a,n,C=="foreignObject"?"http://www.w3.org/1999/xhtml":r,i,l,i?i[0]:a.__k&&Be(a,0),d,o),i!=null)for(c=i.length;c--;)ms(i[c]);d||(c="value",C=="progress"&&j==null?s.removeAttribute("value"):j!=null&&(j!==s[c]||C=="progress"&&!j||C=="option"&&j!=x[c])&&bt(s,c,j,x[c],r),c="checked",k!=null&&k!=s[c]&&bt(s,c,k,x[c],r))}return s}function ps(s,t,a){try{if(typeof s=="function"){var n=typeof s.__u=="function";n&&s.__u(),n&&t==null||(s.__u=s(t))}else s.current=t}catch(r){z.__e(r,a)}}function za(s,t,a){var n,r;if(z.unmount&&z.unmount(s),(n=s.ref)&&(n.current&&n.current!=s.__e||ps(n,null,t)),(n=s.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(i){z.__e(i,t)}n.base=n.__P=null}if(n=s.__k)for(r=0;r<n.length;r++)n[r]&&za(n[r],t,a||typeof s.type!="function");a||ms(s.__e),s.__c=s.__=s.__e=void 0}function Or(s,t,a){return this.constructor(s,a)}function Ur(s,t,a){var n,r,i,l,d=be({},s.props);for(i in s.type&&s.type.defaultProps&&(l=s.type.defaultProps),t)i=="key"?n=t[i]:i=="ref"?r=t[i]:d[i]=t[i]===void 0&&l!=null?l[i]:t[i];return arguments.length>2&&(d.children=arguments.length>3?Ut.call(arguments,2):a),Ge(s.type,d,n||s.key,r||s.ref,null)}Ut=Ra.slice,z={__e:function(s,t,a,n){for(var r,i,l;t=t.__;)if((r=t.__c)&&!r.__)try{if((i=r.constructor)&&i.getDerivedStateFromError!=null&&(r.setState(i.getDerivedStateFromError(s)),l=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(s,n||{}),l=r.__d),l)return r.__E=r}catch(d){s=d}throw s}},Pa=0,ve.prototype.setState=function(s,t){var a;a=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=be({},this.state),typeof s=="function"&&(s=s(be({},a),this.props)),s&&be(a,s),s!=null&&this.__v&&(t&&this._sb.push(t),Rs(this))},ve.prototype.forceUpdate=function(s){this.__v&&(this.__e=!0,s&&this.__h.push(s),Rs(this))},ve.prototype.render=Ye,Me=[],Ia=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,$a=function(s,t){return s.__v.__b-t.__v.__b},Pt.__r=0,Ma=/(PointerCapture)$|Capture$/i,us=0,Yt=Os(!1),es=Os(!0);var ye,Ht,Us,Ba=[],ie=z,Ls=ie.__b,Fs=ie.__r,zs=ie.diffed,Bs=ie.__c,Vs=ie.unmount,qs=ie.__;function Lr(){for(var s;s=Ba.shift();)if(s.__P&&s.__H)try{s.__H.__h.forEach(Et),s.__H.__h.forEach(ns),s.__H.__h=[]}catch(t){s.__H.__h=[],ie.__e(t,s.__v)}}ie.__b=function(s){ye=null,Ls&&Ls(s)},ie.__=function(s,t){s&&t.__k&&t.__k.__m&&(s.__m=t.__k.__m),qs&&qs(s,t)},ie.__r=function(s){Fs&&Fs(s);var t=(ye=s.__c).__H;t&&(Ht===ye?(t.__h=[],ye.__h=[],t.__.forEach(function(a){a.__N&&(a.__=a.__N),a.u=a.__N=void 0})):(t.__h.forEach(Et),t.__h.forEach(ns),t.__h=[])),Ht=ye},ie.diffed=function(s){zs&&zs(s);var t=s.__c;t&&t.__H&&(t.__H.__h.length&&(Ba.push(t)!==1&&Us===ie.requestAnimationFrame||((Us=ie.requestAnimationFrame)||Fr)(Lr)),t.__H.__.forEach(function(a){a.u&&(a.__H=a.u),a.u=void 0})),Ht=ye=null},ie.__c=function(s,t){t.some(function(a){try{a.__h.forEach(Et),a.__h=a.__h.filter(function(n){return!n.__||ns(n)})}catch(n){t.some(function(r){r.__h&&(r.__h=[])}),t=[],ie.__e(n,a.__v)}}),Bs&&Bs(s,t)},ie.unmount=function(s){Vs&&Vs(s);var t,a=s.__c;a&&a.__H&&(a.__H.__.forEach(function(n){try{Et(n)}catch(r){t=r}}),a.__H=void 0,t&&ie.__e(t,a.__v))};var Hs=typeof requestAnimationFrame=="function";function Fr(s){var t,a=function(){clearTimeout(n),Hs&&cancelAnimationFrame(t),setTimeout(s)},n=setTimeout(a,35);Hs&&(t=requestAnimationFrame(a))}function Et(s){var t=ye,a=s.__c;typeof a=="function"&&(s.__c=void 0,a()),ye=t}function ns(s){var t=ye;s.__c=s.__(),ye=t}function zr(s,t){for(var a in t)s[a]=t[a];return s}function Ks(s,t){for(var a in s)if(a!=="__source"&&!(a in t))return!0;for(var n in t)if(n!=="__source"&&s[n]!==t[n])return!0;return!1}function Ws(s,t){this.props=s,this.context=t}(Ws.prototype=new ve).isPureReactComponent=!0,Ws.prototype.shouldComponentUpdate=function(s,t){return Ks(this.props,s)||Ks(this.state,t)};var Qs=z.__b;z.__b=function(s){s.type&&s.type.__f&&s.ref&&(s.props.ref=s.ref,s.ref=null),Qs&&Qs(s)};var Br=z.__e;z.__e=function(s,t,a,n){if(s.then){for(var r,i=t;i=i.__;)if((r=i.__c)&&r.__c)return t.__e==null&&(t.__e=a.__e,t.__k=a.__k),r.__c(s,t)}Br(s,t,a,n)};var Gs=z.unmount;function Va(s,t,a){return s&&(s.__c&&s.__c.__H&&(s.__c.__H.__.forEach(function(n){typeof n.__c=="function"&&n.__c()}),s.__c.__H=null),(s=zr({},s)).__c!=null&&(s.__c.__P===a&&(s.__c.__P=t),s.__c.__e=!0,s.__c=null),s.__k=s.__k&&s.__k.map(function(n){return Va(n,t,a)})),s}function qa(s,t,a){return s&&a&&(s.__v=null,s.__k=s.__k&&s.__k.map(function(n){return qa(n,t,a)}),s.__c&&s.__c.__P===t&&(s.__e&&a.appendChild(s.__e),s.__c.__e=!0,s.__c.__P=a)),s}function Kt(){this.__u=0,this.o=null,this.__b=null}function Ha(s){var t=s.__.__c;return t&&t.__a&&t.__a(s)}function jt(){this.i=null,this.l=null}z.unmount=function(s){var t=s.__c;t&&t.__R&&t.__R(),t&&32&s.__u&&(s.type=null),Gs&&Gs(s)},(Kt.prototype=new ve).__c=function(s,t){var a=t.__c,n=this;n.o==null&&(n.o=[]),n.o.push(a);var r=Ha(n.__v),i=!1,l=function(){i||(i=!0,a.__R=null,r?r(d):d())};a.__R=l;var d=function(){if(!--n.__u){if(n.state.__a){var o=n.state.__a;n.__v.__k[0]=qa(o,o.__c.__P,o.__c.__O)}var c;for(n.setState({__a:n.__b=null});c=n.o.pop();)c.forceUpdate()}};n.__u++||32&t.__u||n.setState({__a:n.__b=n.__v.__k[0]}),s.then(l,l)},Kt.prototype.componentWillUnmount=function(){this.o=[]},Kt.prototype.render=function(s,t){if(this.__b){if(this.__v.__k){var a=document.createElement("div"),n=this.__v.__k[0].__c;this.__v.__k[0]=Va(this.__b,a,n.__O=n.__P)}this.__b=null}var r=t.__a&&ss(Ye,null,s.fallback);return r&&(r.__u&=-33),[ss(Ye,null,t.__a?null:s.children),r]};var Js=function(s,t,a){if(++a[1]===a[0]&&s.l.delete(t),s.props.revealOrder&&(s.props.revealOrder[0]!=="t"||!s.l.size))for(a=s.i;a;){for(;a.length>3;)a.pop()();if(a[1]<a[0])break;s.i=a=a[2]}};(jt.prototype=new ve).__a=function(s){var t=this,a=Ha(t.__v),n=t.l.get(s);return n[0]++,function(r){var i=function(){t.props.revealOrder?(n.push(r),Js(t,s,n)):r()};a?a(i):i()}},jt.prototype.render=function(s){this.i=null,this.l=new Map;var t=fe(s.children);s.revealOrder&&s.revealOrder[0]==="b"&&t.reverse();for(var a=t.length;a--;)this.l.set(t[a],this.i=[1,0,this.i]);return s.children},jt.prototype.componentDidUpdate=jt.prototype.componentDidMount=function(){var s=this;this.l.forEach(function(t,a){Js(s,a,t)})};var Vr=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.element")||60103,qr=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,Hr=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,Kr=/[A-Z0-9]/g,Wr=typeof document!="undefined",Qr=function(s){return(typeof Symbol!="undefined"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(s)};ve.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(s){Object.defineProperty(ve.prototype,s,{configurable:!0,get:function(){return this["UNSAFE_"+s]},set:function(t){Object.defineProperty(this,s,{configurable:!0,writable:!0,value:t})}})});var Zs=z.event;function Gr(){}function Jr(){return this.cancelBubble}function Zr(){return this.defaultPrevented}z.event=function(s){return Zs&&(s=Zs(s)),s.persist=Gr,s.isPropagationStopped=Jr,s.isDefaultPrevented=Zr,s.nativeEvent=s};var Xr={enumerable:!1,configurable:!0,get:function(){return this.class}},Xs=z.vnode;z.vnode=function(s){typeof s.type=="string"&&function(t){var a=t.props,n=t.type,r={},i=n.indexOf("-")===-1;for(var l in a){var d=a[l];if(!(l==="value"&&"defaultValue"in a&&d==null||Wr&&l==="children"&&n==="noscript"||l==="class"||l==="className")){var o=l.toLowerCase();l==="defaultValue"&&"value"in a&&a.value==null?l="value":l==="download"&&d===!0?d="":o==="translate"&&d==="no"?d=!1:o[0]==="o"&&o[1]==="n"?o==="ondoubleclick"?l="ondblclick":o!=="onchange"||n!=="input"&&n!=="textarea"||Qr(a.type)?o==="onfocus"?l="onfocusin":o==="onblur"?l="onfocusout":Hr.test(l)&&(l=o):o=l="oninput":i&&qr.test(l)?l=l.replace(Kr,"-$&").toLowerCase():d===null&&(d=void 0),o==="oninput"&&r[l=o]&&(l="oninputCapture"),r[l]=d}}n=="select"&&r.multiple&&Array.isArray(r.value)&&(r.value=fe(a.children).forEach(function(c){c.props.selected=r.value.indexOf(c.props.value)!=-1})),n=="select"&&r.defaultValue!=null&&(r.value=fe(a.children).forEach(function(c){c.props.selected=r.multiple?r.defaultValue.indexOf(c.props.value)!=-1:r.defaultValue==c.props.value})),a.class&&!a.className?(r.class=a.class,Object.defineProperty(r,"className",Xr)):(a.className&&!a.class||a.class&&a.className)&&(r.class=r.className=a.className),t.props=r}(s),s.$$typeof=Vr,Xs&&Xs(s)};var Ys=z.__r;z.__r=function(s){Ys&&Ys(s),s.__c};var ea=z.diffed;z.diffed=function(s){ea&&ea(s);var t=s.props,a=s.__e;a!=null&&s.type==="textarea"&&"value"in t&&t.value!==a.value&&(a.value=t.value==null?"":t.value)};var Yr=typeof dt=="object"&&dt&&dt.Object===Object&&dt,ei=Yr,ti=ei,si=typeof self=="object"&&self&&self.Object===Object&&self,ai=ti||si||Function("return this")(),ni=ai,ri=ni,ii=ri.Symbol,Ka=ii,ta=Ka;ta&&ta.toStringTag;var sa=Ka;sa&&sa.toStringTag;function li(s,t){return Object.assign(s,t)}function ci(s,t){var a;return(a=s==null?void 0:s.key)!=null?a:t}function oi(s,t){const a=s._ptgLinkedRefs||(s._ptgLinkedRefs={});return a[t]||(a[t]=n=>{s.refs[t]=n})}function Ke(s){const t={};for(let a=0;a<s.length;a++)if(s[a]!=null){const n=ci(s[a],a.toString(36));t[n]=s[a]}return t}function di(s,t){s=s||{},t=t||{};const a=l=>Object.hasOwn(t,l)?t[l]:s[l],n={};let r=[];for(const l in s)Object.hasOwn(t,l)?r.length&&(n[l]=r,r=[]):r.push(l);const i={};for(const l in t){if(Object.hasOwn(n,l))for(let d=0;d<n[l].length;d++){const o=n[l][d];i[n[l][d]]=a(o)}i[l]=a(l)}for(let l=0;l<r.length;l++)i[r[l]]=a(r[l]);return i}const hi=s=>s;class ui extends ve{constructor(t,a){super(t,a),this.refs={},this.state={children:Ke(fe(fe(this.props.children))||[])},this.performAppear=this.performAppear.bind(this),this.performEnter=this.performEnter.bind(this),this.performLeave=this.performLeave.bind(this)}componentWillMount(){this.currentlyTransitioningKeys={},this.keysToAbortLeave=[],this.keysToEnter=[],this.keysToLeave=[]}componentDidMount(){const t=this.state.children;for(const a in t)t[a]&&this.performAppear(a)}componentWillReceiveProps(t){const a=Ke(fe(t.children)||[]),n=this.state.children;this.setState(i=>({children:di(i.children,a)}));let r;for(r in a)if(Object.hasOwn(a,r)){const i=n&&Object.hasOwn(n,r);a[r]&&i&&this.currentlyTransitioningKeys[r]?(this.keysToEnter.push(r),this.keysToAbortLeave.push(r)):a[r]&&!i&&!this.currentlyTransitioningKeys[r]&&this.keysToEnter.push(r)}for(r in n)if(Object.hasOwn(n,r)){const i=a&&Object.hasOwn(a,r);n[r]&&!i&&!this.currentlyTransitioningKeys[r]&&this.keysToLeave.push(r)}}componentDidUpdate(){const{keysToEnter:t}=this;this.keysToEnter=[],t.forEach(this.performEnter);const{keysToLeave:a}=this;this.keysToLeave=[],a.forEach(this.performLeave)}_finishAbort(t){const a=this.keysToAbortLeave.indexOf(t);a!==-1&&this.keysToAbortLeave.splice(a,1)}performAppear(t){this.currentlyTransitioningKeys[t]=!0;const a=this.refs[t];a!=null&&a.componentWillAppear?a.componentWillAppear(this._handleDoneAppearing.bind(this,t)):this._handleDoneAppearing(t)}_handleDoneAppearing(t){const a=this.refs[t];a!=null&&a.componentDidAppear&&a.componentDidAppear(),delete this.currentlyTransitioningKeys[t],this._finishAbort(t);const n=Ke(fe(this.props.children)||[]);(!n||!Object.hasOwn(n,t))&&this.performLeave(t)}performEnter(t){this.currentlyTransitioningKeys[t]=!0;const a=this.refs[t];a!=null&&a.componentWillEnter?a.componentWillEnter(this._handleDoneEntering.bind(this,t)):this._handleDoneEntering(t)}_handleDoneEntering(t){const a=this.refs[t];a!=null&&a.componentDidEnter&&a.componentDidEnter(),delete this.currentlyTransitioningKeys[t],this._finishAbort(t);const n=Ke(fe(this.props.children)||[]);(!n||!Object.hasOwn(n,t))&&this.performLeave(t)}performLeave(t){if(this.keysToAbortLeave.indexOf(t)!==-1)return;this.currentlyTransitioningKeys[t]=!0;const n=this.refs[t];n!=null&&n.componentWillLeave?n.componentWillLeave(this._handleDoneLeaving.bind(this,t)):this._handleDoneLeaving(t)}_handleDoneLeaving(t){if(this.keysToAbortLeave.indexOf(t)!==-1)return;const n=this.refs[t];n!=null&&n.componentDidLeave&&n.componentDidLeave(),delete this.currentlyTransitioningKeys[t];const r=Ke(fe(this.props.children)||[]);if(r&&Object.hasOwn(r,t))this.performEnter(t);else{const i=li({},this.state.children);delete i[t],this.setState({children:i})}}render(w,{children:m}){var f=w,{childFactory:t,transitionLeave:a,transitionName:n,transitionAppear:r,transitionEnter:i,transitionLeaveTimeout:l,transitionEnterTimeout:d,transitionAppearTimeout:o,component:c}=f,p=ws(f,["childFactory","transitionLeave","transitionName","transitionAppear","transitionEnter","transitionLeaveTimeout","transitionEnterTimeout","transitionAppearTimeout","component"]);const j=Object.entries(m).map(([k,x])=>{if(!x)return;const y=oi(this,k);return Ur(t(x),{ref:y,key:k})}).filter(Boolean);return ss(c,p,j)}}ui.defaultProps={component:"span",childFactory:hi};var mi={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(s){(function(){var t={}.hasOwnProperty;function a(){for(var i="",l=0;l<arguments.length;l++){var d=arguments[l];d&&(i=r(i,n(d)))}return i}function n(i){if(typeof i=="string"||typeof i=="number")return i;if(typeof i!="object")return"";if(Array.isArray(i))return a.apply(null,i);if(i.toString!==Object.prototype.toString&&!i.toString.toString().includes("[native code]"))return i.toString();var l="";for(var d in i)t.call(i,d)&&i[d]&&(l=r(l,d));return l}function r(i,l){return l?i?i+" "+l:i+l:i}s.exports?(a.default=a,s.exports=a):window.classNames=a})()})(mi);function J(s,t,a){return t in s?Object.defineProperty(s,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):s[t]=a,s}var pi=typeof self!="undefined"?self:global;const gi=typeof navigator!="undefined";typeof global=="undefined"||typeof process=="undefined"||!process.versions||process.versions.node;const Wa=pi.Buffer,Qa=!!Wa,xi=s=>s!==void 0;function fi(s){return s===void 0||(s instanceof Map?s.size===0:Object.values(s).filter(xi).length===0)}function ce(s){let t=new Error(s);throw delete t.stack,t}function aa(s){let t=function(a){let n=0;return a.ifd0.enabled&&(n+=1024),a.exif.enabled&&(n+=2048),a.makerNote&&(n+=2048),a.userComment&&(n+=1024),a.gps.enabled&&(n+=512),a.interop.enabled&&(n+=100),a.ifd1.enabled&&(n+=1024),n+2048}(s);return s.jfif.enabled&&(t+=50),s.xmp.enabled&&(t+=2e4),s.iptc.enabled&&(t+=14e3),s.icc.enabled&&(t+=6e3),t}const Wt=s=>String.fromCharCode.apply(null,s),na=typeof TextDecoder!="undefined"?new TextDecoder("utf-8"):void 0;class Se{static from(t,a){return t instanceof this&&t.le===a?t:new Se(t,void 0,void 0,a)}constructor(t,a=0,n,r){if(typeof r=="boolean"&&(this.le=r),Array.isArray(t)&&(t=new Uint8Array(t)),t===0)this.byteOffset=0,this.byteLength=0;else if(t instanceof ArrayBuffer){n===void 0&&(n=t.byteLength-a);let i=new DataView(t,a,n);this._swapDataView(i)}else if(t instanceof Uint8Array||t instanceof DataView||t instanceof Se){n===void 0&&(n=t.byteLength-a),(a+=t.byteOffset)+n>t.byteOffset+t.byteLength&&ce("Creating view outside of available memory in ArrayBuffer");let i=new DataView(t.buffer,a,n);this._swapDataView(i)}else if(typeof t=="number"){let i=new DataView(new ArrayBuffer(t));this._swapDataView(i)}else ce("Invalid input argument for BufferView: "+t)}_swapArrayBuffer(t){this._swapDataView(new DataView(t))}_swapBuffer(t){this._swapDataView(new DataView(t.buffer,t.byteOffset,t.byteLength))}_swapDataView(t){this.dataView=t,this.buffer=t.buffer,this.byteOffset=t.byteOffset,this.byteLength=t.byteLength}_lengthToEnd(t){return this.byteLength-t}set(t,a,n=Se){return t instanceof DataView||t instanceof Se?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t instanceof ArrayBuffer&&(t=new Uint8Array(t)),t instanceof Uint8Array||ce("BufferView.set(): Invalid data argument."),this.toUint8().set(t,a),new n(this,a,t.byteLength)}subarray(t,a){return a=a||this._lengthToEnd(t),new Se(this,t,a)}toUint8(){return new Uint8Array(this.buffer,this.byteOffset,this.byteLength)}getUint8Array(t,a){return new Uint8Array(this.buffer,this.byteOffset+t,a)}getString(t=0,a=this.byteLength){return r=this.getUint8Array(t,a),na?na.decode(r):Qa?Buffer.from(r).toString("utf8"):decodeURIComponent(escape(Wt(r)));var r}getLatin1String(t=0,a=this.byteLength){let n=this.getUint8Array(t,a);return Wt(n)}getUnicodeString(t=0,a=this.byteLength){const n=[];for(let r=0;r<a&&t+r<this.byteLength;r+=2)n.push(this.getUint16(t+r));return Wt(n)}getInt8(t){return this.dataView.getInt8(t)}getUint8(t){return this.dataView.getUint8(t)}getInt16(t,a=this.le){return this.dataView.getInt16(t,a)}getInt32(t,a=this.le){return this.dataView.getInt32(t,a)}getUint16(t,a=this.le){return this.dataView.getUint16(t,a)}getUint32(t,a=this.le){return this.dataView.getUint32(t,a)}getFloat32(t,a=this.le){return this.dataView.getFloat32(t,a)}getFloat64(t,a=this.le){return this.dataView.getFloat64(t,a)}getFloat(t,a=this.le){return this.dataView.getFloat32(t,a)}getDouble(t,a=this.le){return this.dataView.getFloat64(t,a)}getUintBytes(t,a,n){switch(a){case 1:return this.getUint8(t,n);case 2:return this.getUint16(t,n);case 4:return this.getUint32(t,n);case 8:return this.getUint64&&this.getUint64(t,n)}}getUint(t,a,n){switch(a){case 8:return this.getUint8(t,n);case 16:return this.getUint16(t,n);case 32:return this.getUint32(t,n);case 64:return this.getUint64&&this.getUint64(t,n)}}toString(t){return this.dataView.toString(t,this.constructor.name)}ensureChunk(){}}function rs(s,t){ce(`${s} '${t}' was not loaded, try using full build of exifr.`)}class gs extends Map{constructor(t){super(),this.kind=t}get(t,a){return this.has(t)||rs(this.kind,t),a&&(t in a||function(n,r){ce(`Unknown ${n} '${r}'.`)}(this.kind,t),a[t].enabled||rs(this.kind,t)),super.get(t)}keyList(){return Array.from(this.keys())}}var yi=new gs("file parser"),xe=new gs("segment parser"),bi=new gs("file reader");const ra=s=>new Promise((t,a)=>{let n=new FileReader;n.onloadend=()=>t(n.result||new ArrayBuffer),n.onerror=a,n.readAsArrayBuffer(s)}),xs=new Map,ji=new Map,vi=new Map,vt=["chunked","firstChunkSize","firstChunkSizeNode","firstChunkSizeBrowser","chunkSize","chunkLimit"],Ga=["jfif","xmp","icc","iptc","ihdr"],is=["tiff",...Ga],ne=["ifd0","ifd1","exif","gps","interop"],Nt=[...is,...ne],wt=["makerNote","userComment"],Ja=["translateKeys","translateValues","reviveValues","multiSegment"],_t=[...Ja,"sanitize","mergeOutput","silentErrors"];class Za{get translate(){return this.translateKeys||this.translateValues||this.reviveValues}}class We extends Za{get needed(){return this.enabled||this.deps.size>0}constructor(t,a,n,r){if(super(),J(this,"enabled",!1),J(this,"skip",new Set),J(this,"pick",new Set),J(this,"deps",new Set),J(this,"translateKeys",!1),J(this,"translateValues",!1),J(this,"reviveValues",!1),this.key=t,this.enabled=a,this.parse=this.enabled,this.applyInheritables(r),this.canBeFiltered=ne.includes(t),this.canBeFiltered&&(this.dict=xs.get(t)),n!==void 0)if(Array.isArray(n))this.parse=this.enabled=!0,this.canBeFiltered&&n.length>0&&this.translateTagSet(n,this.pick);else if(typeof n=="object"){if(this.enabled=!0,this.parse=n.parse!==!1,this.canBeFiltered){let{pick:i,skip:l}=n;i&&i.length>0&&this.translateTagSet(i,this.pick),l&&l.length>0&&this.translateTagSet(l,this.skip)}this.applyInheritables(n)}else n===!0||n===!1?this.parse=this.enabled=n:ce(`Invalid options argument: ${n}`)}applyInheritables(t){let a,n;for(a of Ja)n=t[a],n!==void 0&&(this[a]=n)}translateTagSet(t,a){if(this.dict){let n,r,{tagKeys:i,tagValues:l}=this.dict;for(n of t)typeof n=="string"?(r=l.indexOf(n),r===-1&&(r=i.indexOf(Number(n))),r!==-1&&a.add(Number(i[r]))):a.add(n)}else for(let n of t)a.add(n)}finalizeFilters(){!this.enabled&&this.deps.size>0?(this.enabled=!0,It(this.pick,this.deps)):this.enabled&&this.pick.size>0&&It(this.pick,this.deps)}}var le={jfif:!1,tiff:!0,xmp:!1,icc:!1,iptc:!1,ifd0:!0,ifd1:!1,exif:!0,gps:!0,interop:!1,ihdr:void 0,makerNote:!1,userComment:!1,multiSegment:!1,skip:[],pick:[],translateKeys:!0,translateValues:!0,reviveValues:!0,sanitize:!0,mergeOutput:!0,silentErrors:!0,chunked:!0,firstChunkSize:void 0,firstChunkSizeNode:512,firstChunkSizeBrowser:65536,chunkSize:65536,chunkLimit:5},ia=new Map;class Xa extends Za{static useCached(t){let a=ia.get(t);return a!==void 0||(a=new this(t),ia.set(t,a)),a}constructor(t){super(),t===!0?this.setupFromTrue():t===void 0?this.setupFromUndefined():Array.isArray(t)?this.setupFromArray(t):typeof t=="object"?this.setupFromObject(t):ce(`Invalid options argument ${t}`),this.firstChunkSize===void 0&&(this.firstChunkSize=gi?this.firstChunkSizeBrowser:this.firstChunkSizeNode),this.mergeOutput&&(this.ifd1.enabled=!1),this.filterNestedSegmentTags(),this.traverseTiffDependencyTree(),this.checkLoadedPlugins()}setupFromUndefined(){let t;for(t of vt)this[t]=le[t];for(t of _t)this[t]=le[t];for(t of wt)this[t]=le[t];for(t of Nt)this[t]=new We(t,le[t],void 0,this)}setupFromTrue(){let t;for(t of vt)this[t]=le[t];for(t of _t)this[t]=le[t];for(t of wt)this[t]=!0;for(t of Nt)this[t]=new We(t,!0,void 0,this)}setupFromArray(t){let a;for(a of vt)this[a]=le[a];for(a of _t)this[a]=le[a];for(a of wt)this[a]=le[a];for(a of Nt)this[a]=new We(a,!1,void 0,this);this.setupGlobalFilters(t,void 0,ne)}setupFromObject(t){let a;for(a of(ne.ifd0=ne.ifd0||ne.image,ne.ifd1=ne.ifd1||ne.thumbnail,Object.assign(this,t),vt))this[a]=Qt(t[a],le[a]);for(a of _t)this[a]=Qt(t[a],le[a]);for(a of wt)this[a]=Qt(t[a],le[a]);for(a of is)this[a]=new We(a,le[a],t[a],this);for(a of ne)this[a]=new We(a,le[a],t[a],this.tiff);this.setupGlobalFilters(t.pick,t.skip,ne,Nt),t.tiff===!0?this.batchEnableWithBool(ne,!0):t.tiff===!1?this.batchEnableWithUserValue(ne,t):Array.isArray(t.tiff)?this.setupGlobalFilters(t.tiff,void 0,ne):typeof t.tiff=="object"&&this.setupGlobalFilters(t.tiff.pick,t.tiff.skip,ne)}batchEnableWithBool(t,a){for(let n of t)this[n].enabled=a}batchEnableWithUserValue(t,a){for(let n of t){let r=a[n];this[n].enabled=r!==!1&&r!==void 0}}setupGlobalFilters(t,a,n,r=n){if(t&&t.length){for(let l of r)this[l].enabled=!1;let i=la(t,n);for(let[l,d]of i)It(this[l].pick,d),this[l].enabled=!0}else if(a&&a.length){let i=la(a,n);for(let[l,d]of i)It(this[l].skip,d)}}filterNestedSegmentTags(){let{ifd0:t,exif:a,xmp:n,iptc:r,icc:i}=this;this.makerNote?a.deps.add(37500):a.skip.add(37500),this.userComment?a.deps.add(37510):a.skip.add(37510),n.enabled||t.skip.add(700),r.enabled||t.skip.add(33723),i.enabled||t.skip.add(34675)}traverseTiffDependencyTree(){let{ifd0:t,exif:a,gps:n,interop:r}=this;r.needed&&(a.deps.add(40965),t.deps.add(40965)),a.needed&&t.deps.add(34665),n.needed&&t.deps.add(34853),this.tiff.enabled=ne.some(i=>this[i].enabled===!0)||this.makerNote||this.userComment;for(let i of ne)this[i].finalizeFilters()}get onlyTiff(){return!Ga.map(t=>this[t].enabled).some(t=>t===!0)&&this.tiff.enabled}checkLoadedPlugins(){for(let t of is)this[t].enabled&&!xe.has(t)&&rs("segment parser",t)}}function la(s,t){let a,n,r,i,l=[];for(r of t){for(i of(a=xs.get(r),n=[],a))(s.includes(i[0])||s.includes(i[1]))&&n.push(i[0]);n.length&&l.push([r,n])}return l}function Qt(s,t){return s!==void 0?s:t!==void 0?t:void 0}function It(s,t){for(let a of t)s.add(a)}J(Xa,"default",le);class Le{static findPosition(t,a){let n=t.getUint16(a+2)+2,r=typeof this.headerLength=="function"?this.headerLength(t,a,n):this.headerLength,i=a+r,l=n-r;return{offset:a,length:n,headerLength:r,start:i,size:l,end:i+l}}static parse(t,a={}){return new this(t,new Xa({[this.type]:a}),t).parse()}normalizeInput(t){return t instanceof Se?t:new Se(t)}constructor(t,a={},n){J(this,"errors",[]),J(this,"raw",new Map),J(this,"handleError",r=>{if(!this.options.silentErrors)throw r;this.errors.push(r.message)}),this.chunk=this.normalizeInput(t),this.file=n,this.type=this.constructor.type,this.globalOptions=this.options=a,this.localOptions=a[this.type],this.canTranslate=this.localOptions&&this.localOptions.translate}translate(){this.canTranslate&&(this.translated=this.translateBlock(this.raw,this.type))}get output(){return this.translated?this.translated:this.raw?Object.fromEntries(this.raw):void 0}translateBlock(t,a){let n=vi.get(a),r=ji.get(a),i=xs.get(a),l=this.options[a],d=l.reviveValues&&!!n,o=l.translateValues&&!!r,c=l.translateKeys&&!!i,p={};for(let[m,w]of t)d&&n.has(m)?w=n.get(m)(w):o&&r.has(m)&&(w=this.translateValue(w,r.get(m))),c&&i.has(m)&&(m=i.get(m)||m),p[m]=w;return p}translateValue(t,a){return a[t]||a.DEFAULT||t}assignToOutput(t,a){this.assignObjectToOutput(t,this.constructor.type,a)}assignObjectToOutput(t,a,n){if(this.globalOptions.mergeOutput)return Object.assign(t,n);t[a]?Object.assign(t[a],n):t[a]=n}}J(Le,"headerLength",4),J(Le,"type",void 0),J(Le,"multiSegment",!1),J(Le,"canHandle",()=>!1);function Ni(s){return s===192||s===194||s===196||s===219||s===221||s===218||s===254}function wi(s){return s>=224&&s<=239}function _i(s,t,a){for(let[n,r]of xe)if(r.canHandle(s,t,a))return n}class ca extends class{constructor(t,a,n){J(this,"errors",[]),J(this,"ensureSegmentChunk",r=>I(this,null,function*(){let i=r.start,l=r.size||65536;if(this.file.chunked)if(this.file.available(i,l))r.chunk=this.file.subarray(i,l);else try{r.chunk=yield this.file.readChunk(i,l)}catch(d){ce(`Couldn't read segment: ${JSON.stringify(r)}. ${d.message}`)}else this.file.byteLength>i+l?r.chunk=this.file.subarray(i,l):r.size===void 0?r.chunk=this.file.subarray(i):ce("Segment unreachable: "+JSON.stringify(r));return r.chunk})),this.extendOptions&&this.extendOptions(t),this.options=t,this.file=a,this.parsers=n}injectSegment(t,a){this.options[t].enabled&&this.createParser(t,a)}createParser(t,a){let n=new(xe.get(t))(a,this.options,this.file);return this.parsers[t]=n}createParsers(t){for(let a of t){let{type:n,chunk:r}=a,i=this.options[n];if(i&&i.enabled){let l=this.parsers[n];l&&l.append||l||this.createParser(n,r)}}}readSegments(t){return I(this,null,function*(){let a=t.map(this.ensureSegmentChunk);yield Promise.all(a)})}}{constructor(...t){super(...t),J(this,"appSegments",[]),J(this,"jpegSegments",[]),J(this,"unknownSegments",[])}static canHandle(t,a){return a===65496}parse(){return I(this,null,function*(){yield this.findAppSegments(),yield this.readSegments(this.appSegments),this.mergeMultiSegments(),this.createParsers(this.mergedAppSegments||this.appSegments)})}setupSegmentFinderArgs(t){t===!0?(this.findAll=!0,this.wanted=new Set(xe.keyList())):(t=t===void 0?xe.keyList().filter(a=>this.options[a].enabled):t.filter(a=>this.options[a].enabled&&xe.has(a)),this.findAll=!1,this.remaining=new Set(t),this.wanted=new Set(t)),this.unfinishedMultiSegment=!1}findAppSegments(t=0,a){return I(this,null,function*(){this.setupSegmentFinderArgs(a);let{file:n,findAll:r,wanted:i,remaining:l}=this;if(!r&&this.file.chunked&&(r=Array.from(i).some(d=>{let o=xe.get(d),c=this.options[d];return o.multiSegment&&c.multiSegment}),r&&(yield this.file.readWhole())),t=this.findAppSegmentsInRange(t,n.byteLength),!this.options.onlyTiff&&n.chunked){let d=!1;for(;l.size>0&&!d&&(n.canReadNextChunk||this.unfinishedMultiSegment);){let{nextChunkOffset:o}=n,c=this.appSegments.some(p=>!this.file.available(p.offset||p.start,p.length||p.size));if(d=t>o&&!c?!(yield n.readNextChunk(t)):!(yield n.readNextChunk(o)),(t=this.findAppSegmentsInRange(t,n.byteLength))===void 0)return}}})}findAppSegmentsInRange(t,a){a-=2;let n,r,i,l,d,o,{file:c,findAll:p,wanted:m,remaining:w,options:f}=this;for(;t<a;t++)if(c.getUint8(t)===255){if(n=c.getUint8(t+1),wi(n)){if(r=c.getUint16(t+2),i=_i(c,t,r),i&&m.has(i)&&(l=xe.get(i),d=l.findPosition(c,t),o=f[i],d.type=i,this.appSegments.push(d),!p&&(l.multiSegment&&o.multiSegment?(this.unfinishedMultiSegment=d.chunkNumber<d.chunkCount,this.unfinishedMultiSegment||w.delete(i)):w.delete(i),w.size===0)))break;f.recordUnknownSegments&&(d=Le.findPosition(c,t),d.marker=n,this.unknownSegments.push(d)),t+=r+1}else if(Ni(n)){if(r=c.getUint16(t+2),n===218&&f.stopAfterSos!==!1)return;f.recordJpegSegments&&this.jpegSegments.push({offset:t,length:r,marker:n}),t+=r+1}}return t}mergeMultiSegments(){if(!this.appSegments.some(a=>a.multiSegment))return;let t=function(a,n){let r,i,l,d=new Map;for(let o=0;o<a.length;o++)r=a[o],i=r[n],d.has(i)?l=d.get(i):d.set(i,l=[]),l.push(r);return Array.from(d)}(this.appSegments,"type");this.mergedAppSegments=t.map(([a,n])=>{let r=xe.get(a,this.options);return r.handleMultiSegments?{type:a,chunk:r.handleMultiSegments(n)}:n[0]})}getSegment(t){return this.appSegments.find(a=>a.type===t)}getOrFindSegment(t){return I(this,null,function*(){let a=this.getSegment(t);return a===void 0&&(yield this.findAppSegments(0,[t]),a=this.getSegment(t)),a})}}J(ca,"type","jpeg"),yi.set("jpeg",ca);const Si=[void 0,1,1,2,4,8,1,1,2,4,8,4,8,4];class ki extends Le{parseHeader(){var t=this.chunk.getUint16();t===18761?this.le=!0:t===19789&&(this.le=!1),this.chunk.le=this.le,this.headerParsed=!0}parseTags(t,a,n=new Map){let{pick:r,skip:i}=this.options[a];r=new Set(r);let l=r.size>0,d=i.size===0,o=this.chunk.getUint16(t);t+=2;for(let c=0;c<o;c++){let p=this.chunk.getUint16(t);if(l){if(r.has(p)&&(n.set(p,this.parseTag(t,p,a)),r.delete(p),r.size===0))break}else!d&&i.has(p)||n.set(p,this.parseTag(t,p,a));t+=12}return n}parseTag(t,a,n){let{chunk:r}=this,i=r.getUint16(t+2),l=r.getUint32(t+4),d=Si[i];if(d*l<=4?t+=8:t=r.getUint32(t+8),(i<1||i>13)&&ce(`Invalid TIFF value type. block: ${n.toUpperCase()}, tag: ${a.toString(16)}, type: ${i}, offset ${t}`),t>r.byteLength&&ce(`Invalid TIFF value offset. block: ${n.toUpperCase()}, tag: ${a.toString(16)}, type: ${i}, offset ${t} is outside of chunk size ${r.byteLength}`),i===1)return r.getUint8Array(t,l);if(i===2)return(o=function(c){for(;c.endsWith("\0");)c=c.slice(0,-1);return c}(o=r.getString(t,l)).trim())===""?void 0:o;var o;if(i===7)return r.getUint8Array(t,l);if(l===1)return this.parseTagValue(i,t);{let c=new(function(m){switch(m){case 1:return Uint8Array;case 3:return Uint16Array;case 4:return Uint32Array;case 5:return Array;case 6:return Int8Array;case 8:return Int16Array;case 9:return Int32Array;case 10:return Array;case 11:return Float32Array;case 12:return Float64Array;default:return Array}}(i))(l),p=d;for(let m=0;m<l;m++)c[m]=this.parseTagValue(i,t),t+=p;return c}}parseTagValue(t,a){let{chunk:n}=this;switch(t){case 1:return n.getUint8(a);case 3:return n.getUint16(a);case 4:return n.getUint32(a);case 5:return n.getUint32(a)/n.getUint32(a+4);case 6:return n.getInt8(a);case 8:return n.getInt16(a);case 9:return n.getInt32(a);case 10:return n.getInt32(a)/n.getInt32(a+4);case 11:return n.getFloat(a);case 12:return n.getDouble(a);case 13:return n.getUint32(a);default:ce(`Invalid tiff type ${t}`)}}}class Gt extends ki{static canHandle(t,a){return t.getUint8(a+1)===225&&t.getUint32(a+4)===1165519206&&t.getUint16(a+8)===0}parse(){return I(this,null,function*(){this.parseHeader();let{options:t}=this;return t.ifd0.enabled&&(yield this.parseIfd0Block()),t.exif.enabled&&(yield this.safeParse("parseExifBlock")),t.gps.enabled&&(yield this.safeParse("parseGpsBlock")),t.interop.enabled&&(yield this.safeParse("parseInteropBlock")),t.ifd1.enabled&&(yield this.safeParse("parseThumbnailBlock")),this.createOutput()})}safeParse(t){let a=this[t]();return a.catch!==void 0&&(a=a.catch(this.handleError)),a}findIfd0Offset(){this.ifd0Offset===void 0&&(this.ifd0Offset=this.chunk.getUint32(4))}findIfd1Offset(){if(this.ifd1Offset===void 0){this.findIfd0Offset();let t=this.chunk.getUint16(this.ifd0Offset),a=this.ifd0Offset+2+12*t;this.ifd1Offset=this.chunk.getUint32(a)}}parseBlock(t,a){let n=new Map;return this[a]=n,this.parseTags(t,a,n),n}parseIfd0Block(){return I(this,null,function*(){if(this.ifd0)return;let{file:t}=this;this.findIfd0Offset(),this.ifd0Offset<8&&ce("Malformed EXIF data"),!t.chunked&&this.ifd0Offset>t.byteLength&&ce(`IFD0 offset points to outside of file.
this.ifd0Offset: ${this.ifd0Offset}, file.byteLength: ${t.byteLength}`),t.tiff&&(yield t.ensureChunk(this.ifd0Offset,aa(this.options)));let a=this.parseBlock(this.ifd0Offset,"ifd0");return a.size!==0?(this.exifOffset=a.get(34665),this.interopOffset=a.get(40965),this.gpsOffset=a.get(34853),this.xmp=a.get(700),this.iptc=a.get(33723),this.icc=a.get(34675),this.options.sanitize&&(a.delete(34665),a.delete(40965),a.delete(34853),a.delete(700),a.delete(33723),a.delete(34675)),a):void 0})}parseExifBlock(){return I(this,null,function*(){if(this.exif||(this.ifd0||(yield this.parseIfd0Block()),this.exifOffset===void 0))return;this.file.tiff&&(yield this.file.ensureChunk(this.exifOffset,aa(this.options)));let t=this.parseBlock(this.exifOffset,"exif");return this.interopOffset||(this.interopOffset=t.get(40965)),this.makerNote=t.get(37500),this.userComment=t.get(37510),this.options.sanitize&&(t.delete(40965),t.delete(37500),t.delete(37510)),this.unpack(t,41728),this.unpack(t,41729),t})}unpack(t,a){let n=t.get(a);n&&n.length===1&&t.set(a,n[0])}parseGpsBlock(){return I(this,null,function*(){if(this.gps||(this.ifd0||(yield this.parseIfd0Block()),this.gpsOffset===void 0))return;let t=this.parseBlock(this.gpsOffset,"gps");return t&&t.has(2)&&t.has(4)&&(t.set("latitude",oa(...t.get(2),t.get(1))),t.set("longitude",oa(...t.get(4),t.get(3)))),t})}parseInteropBlock(){return I(this,null,function*(){if(!this.interop&&(this.ifd0||(yield this.parseIfd0Block()),this.interopOffset!==void 0||this.exif||(yield this.parseExifBlock()),this.interopOffset!==void 0))return this.parseBlock(this.interopOffset,"interop")})}parseThumbnailBlock(t=!1){return I(this,null,function*(){if(!this.ifd1&&!this.ifd1Parsed&&(!this.options.mergeOutput||t))return this.findIfd1Offset(),this.ifd1Offset>0&&(this.parseBlock(this.ifd1Offset,"ifd1"),this.ifd1Parsed=!0),this.ifd1})}extractThumbnail(){return I(this,null,function*(){if(this.headerParsed||this.parseHeader(),this.ifd1Parsed||(yield this.parseThumbnailBlock(!0)),this.ifd1===void 0)return;let t=this.ifd1.get(513),a=this.ifd1.get(514);return this.chunk.getUint8Array(t,a)})}get image(){return this.ifd0}get thumbnail(){return this.ifd1}createOutput(){let t,a,n,r={};for(a of ne)if(t=this[a],!fi(t))if(n=this.canTranslate?this.translateBlock(t,a):Object.fromEntries(t),this.options.mergeOutput){if(a==="ifd1")continue;Object.assign(r,n)}else r[a]=n;return this.makerNote&&(r.makerNote=this.makerNote),this.userComment&&(r.userComment=this.userComment),r}assignToOutput(t,a){if(this.globalOptions.mergeOutput)Object.assign(t,a);else for(let[n,r]of Object.entries(a))this.assignObjectToOutput(t,n,r)}}function oa(s,t,a,n){var r=s+t/60+a/3600;return n!=="S"&&n!=="W"||(r*=-1),r}J(Gt,"type","tiff"),J(Gt,"headerLength",10),xe.set("tiff",Gt);const fs={ifd0:!1,ifd1:!1,exif:!1,gps:!1,interop:!1,sanitize:!1,reviveValues:!0,translateKeys:!1,translateValues:!1,mergeOutput:!1};Object.assign({},fs,{firstChunkSize:4e4,gps:[1,2,3,4]});Object.assign({},fs,{tiff:!1,ifd1:!0,mergeOutput:!1});Object.assign({},fs,{firstChunkSize:4e4,ifd0:[274]});if(typeof navigator=="object"){let s=navigator.userAgent;s.includes("iPad")||s.includes("iPhone")?s.match(/OS (\d+)_(\d+)/):s.includes("OS X 10")&&s.match(/OS X 10[_.](\d+)/),s.includes("Chrome/")?s.match(/Chrome\/(\d+)/):s.includes("Firefox/")&&s.match(/Firefox\/(\d+)/)}class Ci extends Se{constructor(...t){super(...t),J(this,"ranges",new Ai),this.byteLength!==0&&this.ranges.add(0,this.byteLength)}_tryExtend(t,a,n){if(t===0&&this.byteLength===0&&n){let r=new DataView(n.buffer||n,n.byteOffset,n.byteLength);this._swapDataView(r)}else{let r=t+a;if(r>this.byteLength){let{dataView:i}=this._extend(r);this._swapDataView(i)}}}_extend(t){let a;a=Qa?Wa.allocUnsafe(t):new Uint8Array(t);let n=new DataView(a.buffer,a.byteOffset,a.byteLength);return a.set(new Uint8Array(this.buffer,this.byteOffset,this.byteLength),0),{uintView:a,dataView:n}}subarray(t,a,n=!1){return a=a||this._lengthToEnd(t),n&&this._tryExtend(t,a),this.ranges.add(t,a),super.subarray(t,a)}set(t,a,n=!1){n&&this._tryExtend(a,t.byteLength,t);let r=super.set(t,a);return this.ranges.add(a,r.byteLength),r}ensureChunk(t,a){return I(this,null,function*(){this.chunked&&(this.ranges.available(t,a)||(yield this.readChunk(t,a)))})}available(t,a){return this.ranges.available(t,a)}}class Ai{constructor(){J(this,"list",[])}get length(){return this.list.length}add(t,a,n=0){let r=t+a,i=this.list.filter(l=>da(t,l.offset,r)||da(t,l.end,r));if(i.length>0){t=Math.min(t,...i.map(d=>d.offset)),r=Math.max(r,...i.map(d=>d.end)),a=r-t;let l=i.shift();l.offset=t,l.length=a,l.end=r,this.list=this.list.filter(d=>!i.includes(d))}else this.list.push({offset:t,length:a,end:r})}available(t,a){let n=t+a;return this.list.some(r=>r.offset<=t&&n<=r.end)}}function da(s,t,a){return s<=t&&t<=a}class Ei extends Ci{constructor(t,a){super(0),J(this,"chunksRead",0),this.input=t,this.options=a}readWhole(){return I(this,null,function*(){this.chunked=!1,yield this.readChunk(this.nextChunkOffset)})}readChunked(){return I(this,null,function*(){this.chunked=!0,yield this.readChunk(0,this.options.firstChunkSize)})}readNextChunk(){return I(this,arguments,function*(t=this.nextChunkOffset){if(this.fullyRead)return this.chunksRead++,!1;let a=this.options.chunkSize,n=yield this.readChunk(t,a);return!!n&&n.byteLength===a})}readChunk(t,a){return I(this,null,function*(){if(this.chunksRead++,(a=this.safeWrapAddress(t,a))!==0)return this._readChunk(t,a)})}safeWrapAddress(t,a){return this.size!==void 0&&t+a>this.size?Math.max(0,this.size-t):a}get nextChunkOffset(){if(this.ranges.list.length!==0)return this.ranges.list[0].length}get canReadNextChunk(){return this.chunksRead<this.options.chunkLimit}get fullyRead(){return this.size!==void 0&&this.nextChunkOffset===this.size}read(){return this.options.chunked?this.readChunked():this.readWhole()}close(){}}bi.set("blob",class extends Ei{readWhole(){return I(this,null,function*(){this.chunked=!1;let s=yield ra(this.input);this._swapArrayBuffer(s)})}readChunked(){return this.chunked=!0,this.size=this.input.size,super.readChunked()}_readChunk(s,t){return I(this,null,function*(){let a=t?s+t:void 0,n=this.input.slice(s,a),r=yield ra(n);return this.set(r,s,!0)})}});u.createContext({uppy:void 0,status:"init",progress:0});var Ti={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ve=u;function Pi(s,t){return s===t&&(s!==0||1/s===1/t)||s!==s&&t!==t}var Ii=typeof Object.is=="function"?Object.is:Pi,$i=Ve.useState,Mi=Ve.useEffect,Ri=Ve.useLayoutEffect,Di=Ve.useDebugValue;function Oi(s,t){var a=t(),n=$i({inst:{value:a,getSnapshot:t}}),r=n[0].inst,i=n[1];return Ri(function(){r.value=a,r.getSnapshot=t,Jt(r)&&i({inst:r})},[s,a,t]),Mi(function(){return Jt(r)&&i({inst:r}),s(function(){Jt(r)&&i({inst:r})})},[s]),Di(a),a}function Jt(s){var t=s.getSnapshot;s=s.value;try{var a=t();return!Ii(s,a)}catch(n){return!0}}function Ui(s,t){return t()}var Li=typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"?Ui:Oi;Ti.useSyncExternalStore=Ve.useSyncExternalStore!==void 0?Ve.useSyncExternalStore:Li;var Fi={};/**
 * @license React
 * use-sync-external-store-with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var at=u;function zi(s,t){return s===t&&(s!==0||1/s===1/t)||s!==s&&t!==t}var Bi=typeof Object.is=="function"?Object.is:zi,Vi=at.useSyncExternalStore,qi=at.useRef,Hi=at.useEffect,Ki=at.useMemo,Wi=at.useDebugValue;Fi.useSyncExternalStoreWithSelector=function(s,t,a,n,r){var i=qi(null);if(i.current===null){var l={hasValue:!1,value:null};i.current=l}else l=i.current;i=Ki(function(){function o(f){if(!c){if(c=!0,p=f,f=n(f),r!==void 0&&l.hasValue){var j=l.value;if(r(j,f))return m=j}return m=f}if(j=m,Bi(p,f))return j;var k=n(f);return r!==void 0&&r(j,k)?(p=f,j):(p=f,m=k)}var c=!1,p,m,w=a===void 0?null:a;return[function(){return o(t())},w===null?void 0:function(){return o(w())}]},[t,a,n,r]);var d=Vi(s,i[0],i[1]);return Hi(function(){l.hasValue=!0,l.value=d},[d]),Wi(d),d};const ha=({onSuccess:s,onError:t})=>{const{api:a,settings:n,updateSetting:r}=te(),[i,l]=u.useState(""),[d,o]=u.useState(!1),[c,p]=u.useState([]),[m,w]=u.useState(""),f=u.useRef(null),j=Aa("process-url-stream",{onMessage:v=>{y(v)},autoConnect:!1}),k=v=>{try{const h=new URL(v);return h.protocol==="http:"||h.protocol==="https:"}catch(h){return!1}},x=()=>I(void 0,null,function*(){if(!i.trim()){w("Please enter a URL");return}if(!k(i)){w("Please enter a valid HTTP/HTTPS URL");return}w(""),o(!0);const v={id:S(),url:i.trim(),status:"processing",progress:0,startTime:new Date,sessionId:null,error:null};p(h=>[v,...h]);try{j.connect();const h=yield a.processing.processUrlStream({url:i.trim(),enableContextual:n.processing.enableContextualEmbeddings,source:"user"});p(A=>A.map(b=>b.id===v.id?L(R({},b),{sessionId:h.sessionId}):b)),s&&s({url:i.trim(),sessionId:h.sessionId}),l("")}catch(h){p(A=>A.map(b=>b.id===v.id?L(R({},b),{status:"error",error:h.message||"Processing failed",endTime:new Date}):b)),t&&t({url:i.trim()},h)}finally{o(!1)}}),y=v=>{try{if(!v||typeof v!="object")return;v.type==="progress"&&v.sessionId&&p(h=>h.map(A=>{var b;return A.sessionId===v.sessionId?L(R({},A),{status:v.status||A.status,progress:((b=v.progress)==null?void 0:b.percentage)||A.progress,error:v.error||A.error,endTime:v.status==="completed"||v.status==="error"?new Date:A.endTime}):A}))}catch(h){}},C=v=>{p(h=>h.filter(A=>A.id!==v))},P=v=>{var h;l(v.url),(h=f.current)==null||h.focus()},S=()=>Math.random().toString(36).substr(2,9),_=v=>{v.key==="Enter"&&!d&&x()};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"font-bold mb-4 flex items-center gap-2",children:[e.jsx(Rt,{className:"w-5 h-5 text-primary-400"}),"Process URL"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"relative",children:[e.jsx(pa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{ref:f,type:"url",placeholder:"https://example.com/article",value:i,onChange:v=>{l(v.target.value),w("")},onKeyPress:_,className:`input-primary pl-10 ${m?"border-red-500":""}`,disabled:d})]}),m&&e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-red-400 text-sm",children:[e.jsx(de,{className:"w-4 h-4"}),m]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4 text-sm text-gray-400",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.processing.enableContextualEmbeddings,onChange:v=>r("processing","enableContextualEmbeddings",v.target.checked),className:"w-4 h-4 rounded"}),e.jsx("span",{children:"Enable Contextual Embeddings"})]})}),e.jsx("button",{onClick:x,disabled:d||!i.trim(),className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:d?e.jsxs(e.Fragment,{children:[e.jsx(De,{className:"w-4 h-4 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"w-4 h-4"}),"Process URL"]})})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h4",{className:"font-bold mb-3",children:"Quick Start Templates"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[{label:"GitHub Repository",template:"https://github.com/",icon:"🔧"},{label:"Research Paper",template:"https://arxiv.org/",icon:"📄"},{label:"Documentation",template:"https://docs.",icon:"📚"},{label:"Blog Article",template:"https://",icon:"✍️"}].map((v,h)=>e.jsxs("button",{onClick:()=>l(v.template),className:"flex items-center gap-3 p-3 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700 hover:border-gray-600 transition-colors text-left",children:[e.jsx("span",{className:"text-xl",children:v.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:v.label}),e.jsx("div",{className:"text-xs text-gray-400",children:v.template})]})]},h))})]}),c.length>0&&e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"font-bold",children:"Processing History"}),e.jsxs("div",{className:"text-sm text-gray-400",children:[c.length," item",c.length!==1?"s":""]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto custom-scrollbar",children:c.map(v=>e.jsx(Qi,{item:v,onRemove:()=>C(v.id),onRetry:()=>P(v)},v.id))})]}),c.length>0&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(St,{title:"Total URLs",value:c.length,color:"text-blue-400"}),e.jsx(St,{title:"Completed",value:c.filter(v=>v.status==="completed").length,color:"text-green-400"}),e.jsx(St,{title:"Processing",value:c.filter(v=>v.status==="processing").length,color:"text-yellow-400"}),e.jsx(St,{title:"Failed",value:c.filter(v=>v.status==="error").length,color:"text-red-400"})]})]})},Qi=({item:s,onRemove:t,onRetry:a})=>{const n={processing:{color:"text-yellow-400",bg:"bg-yellow-600",icon:De,action:"Processing..."},completed:{color:"text-green-400",bg:"bg-green-600",icon:he,action:"Completed"},error:{color:"text-red-400",bg:"bg-red-600",icon:de,action:"Failed"}},r=n[s.status]||n.processing,i=r.icon,l=(d,o)=>o?`${Math.round((o-d)/1e3)}s`:"In progress...";return e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Rt,{className:"w-5 h-5 text-primary-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-white truncate",children:s.url}),e.jsx("button",{onClick:()=>window.open(s.url,"_blank"),className:"p-1 hover:bg-gray-700 rounded transition-colors",title:"Open URL",children:e.jsx(Dt,{className:"w-3 h-3 text-gray-400"})})]}),s.status==="processing"&&e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2 mb-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${r.bg}`,style:{width:`${s.progress||0}%`}})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(i,{className:`w-4 h-4 ${r.color} ${s.status==="processing"?"animate-spin":""}`}),e.jsx("span",{className:r.color,children:r.action}),s.progress>0&&s.status==="processing"&&e.jsxs("span",{className:"text-gray-400",children:["(",Math.round(s.progress),"%)"]}),e.jsx("span",{className:"text-gray-500",children:l(s.startTime,s.endTime)})]}),s.error&&e.jsx("div",{className:"text-sm text-red-400 mt-1",children:s.error})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="error"&&e.jsx("button",{onClick:a,className:"btn-secondary text-sm",children:"Retry"}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-700 rounded transition-colors",title:"Remove",children:e.jsx(Pe,{className:"w-4 h-4 text-gray-400"})})]})]})},St=({title:s,value:t,color:a})=>e.jsxs("div",{className:"text-center p-4 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700",children:[e.jsx("div",{className:`text-2xl font-bold ${a}`,children:t}),e.jsx("div",{className:"text-sm text-gray-400",children:s})]}),Gi=()=>{const{api:s,documents:t,systemStats:a,refreshDocuments:n}=te(),[r,i]=u.useState("files"),[l,d]=u.useState([]),[o,c]=u.useState({totalProcessed:0,successfulProcessing:0,failedProcessing:0,averageTime:0});u.useEffect(()=>{p();const j=setInterval(p,5e3);return()=>clearInterval(j)},[]);const p=()=>I(void 0,null,function*(){try{const[j,k]=yield Promise.all([s.processing.getQueue(),s.processing.getStats()]);d(j||[]),c(x=>R(R({},x),k))}catch(j){}}),m=(j,k)=>I(void 0,null,function*(){setTimeout(()=>{n()},1e3),c(x=>L(R({},x),{totalProcessed:x.totalProcessed+1}))}),w=(j,k)=>{c(x=>L(R({},x),{totalProcessed:x.totalProcessed+1,failedProcessing:x.failedProcessing+1}))},f=[{id:"files",label:"File Upload",icon:Je,description:"Upload and process documents",component:$s},{id:"urls",label:"URL Processing",icon:Rt,description:"Process content from URLs",component:ha},{id:"queue",label:"Processing Queue",icon:Ce,description:"Monitor processing status",component:ua}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(kt,{title:"Total Documents",value:(t==null?void 0:t.length)||0,icon:re,color:"text-blue-400",change:"+12 today"}),e.jsx(kt,{title:"Processing Queue",value:l.length,icon:Ce,color:"text-yellow-400",change:l.length>0?`${l.filter(j=>j.status==="processing").length} active`:"Empty"}),e.jsx(kt,{title:"Success Rate",value:`${o.totalProcessed>0?Math.round((o.totalProcessed-o.failedProcessing)/o.totalProcessed*100):100}%`,icon:tt,color:"text-green-400",change:`${o.failedProcessing} failed`}),e.jsx(kt,{title:"Avg Processing Time",value:`${o.averageTime||45}s`,icon:Ne,color:"text-purple-400",change:"Per document"})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"flex items-center gap-2 mb-6 bg-gray-800 bg-opacity-50 rounded-lg p-1",children:f.map(j=>{const k=j.icon,x=r===j.id;return e.jsxs("button",{onClick:()=>i(j.id),className:`flex items-center gap-2 px-4 py-3 rounded-md text-sm font-medium transition-all duration-200 flex-1 ${x?"bg-primary-600 text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-gray-700"}`,children:[e.jsx(k,{className:"w-4 h-4"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{children:j.label}),e.jsx("div",{className:"text-xs opacity-75",children:j.description})]})]},j.id)})}),e.jsxs("div",{className:"min-h-[500px]",children:[r==="files"&&e.jsx($s,{onSuccess:m,onError:w}),r==="urls"&&e.jsx(ha,{onSuccess:m,onError:w}),r==="queue"&&e.jsx(ua,{queue:l,onRefresh:p})]})]}),e.jsx(Ji,{documents:(t==null?void 0:t.slice(0,5))||[]})]})},ua=({queue:s,onRefresh:t})=>{const{api:a}=te(),n=(l,d)=>I(void 0,null,function*(){try{yield a.processing.stopProcessing(l),t&&t()}catch(o){}}),r=l=>{switch(l){case"queued":return"text-gray-400";case"processing":return"text-yellow-400";case"completed":return"text-green-400";case"error":return"text-red-400";default:return"text-gray-400"}},i=l=>{switch(l){case"queued":return Ne;case"processing":return Ce;case"completed":return re;case"error":return Ce;default:return Ne}};return s.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ce,{className:"w-16 h-16 text-gray-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"No Active Processing"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Upload files or process URLs to see them appear in the queue."}),e.jsxs("button",{onClick:t,className:"btn-primary",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Refresh Queue"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold text-lg",children:"Active Processing Queue"}),e.jsxs("button",{onClick:t,className:"btn-secondary text-sm",children:[e.jsx(Ce,{className:"w-4 h-4"}),"Refresh"]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto custom-scrollbar",children:s.map((l,d)=>{const o=i(l.status),c=r(l.status);return e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(o,{className:`w-5 h-5 ${c} ${l.status==="processing"?"animate-spin":""}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-white truncate",children:l.title||l.url||l.filename||"Unknown Item"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[l.completedChunks||0," / ",l.totalChunks||0," chunks"]})]}),l.status==="processing"&&l.progress&&e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2 mb-2",children:e.jsx("div",{className:"h-2 bg-yellow-500 rounded-full transition-all duration-300",style:{width:`${l.progress||0}%`}})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:c,children:l.status==="processing"?"Processing...":l.status==="completed"?"Completed":l.status==="error"?"Failed":"Queued"}),l.progress&&e.jsxs("span",{className:"text-gray-400",children:["(",Math.round(l.progress),"%)"]}),l.estimatedTime&&e.jsxs("span",{className:"text-gray-500",children:["• ~",l.estimatedTime,"s remaining"]})]}),l.error&&e.jsx("div",{className:"text-sm text-red-400 mt-1",children:l.error})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:l.startedAt||l.createdAt?new Date(l.startedAt||l.createdAt).toLocaleTimeString():"Pending"}),(l.status==="processing"||l.status==="queued")&&l.id&&e.jsxs("button",{onClick:()=>n(l.id,l.title||l.filename||"Unknown Item"),className:"px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-white text-sm font-medium flex items-center gap-1 min-w-fit",title:"Stop processing",children:[e.jsx(En,{className:"w-4 h-4"}),"Stop"]}),e.jsx("button",{onClick:()=>{},className:"px-2 py-1 bg-blue-600 hover:bg-blue-700 rounded text-white text-xs",title:"Debug item data",children:"Debug"})]})]},l.id||d)})})]})},Ji=({documents:s})=>!s||s.length===0?null:e.jsxs("div",{className:"card",children:[e.jsxs("h3",{className:"font-bold mb-4 flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-primary-400"}),"Recent Activity"]}),e.jsx("div",{className:"space-y-3",children:s.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-800 bg-opacity-30 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(re,{className:"w-4 h-4 text-primary-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-white truncate",children:t.title||t.url||"Untitled Document"}),e.jsxs("div",{className:"text-sm text-gray-400",children:[t.chunkCount||0," chunks • ",t.contentType||"document"]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:t.processedAt?new Date(t.processedAt).toLocaleDateString():"Recently"})]},t.id||a))})]}),kt=({title:s,value:t,icon:a,color:n,change:r})=>e.jsxs("div",{className:"card text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(a,{className:`w-6 h-6 ${n}`})}),e.jsx("div",{className:`text-2xl font-bold ${n} mb-1`,children:t}),e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:s}),r&&e.jsx("div",{className:"text-xs text-gray-500",children:r})]}),Zi=()=>{const{api:s,settings:t}=te(),[a,n]=u.useState([]),[r,i]=u.useState(""),[l,d]=u.useState(!1),[o,c]=u.useState("gpt-4o-mini"),[p,m]=u.useState(!0),[w,f]=u.useState(null),j=u.useRef(null),k=u.useRef(null);u.useEffect(()=>{x()},[a]);const x=()=>{var h;(h=j.current)==null||h.scrollIntoView({behavior:"smooth"})};u.useEffect(()=>{y()},[]);const y=()=>{const h={id:v(),type:"assistant",content:"👋 Hi! I'm your AutoLlama AI assistant. I can help you search and understand your processed documents using advanced RAG (Retrieval-Augmented Generation). What would you like to know?",timestamp:new Date,sources:[]};n([h]),f(v())},C=()=>I(void 0,null,function*(){if(!r.trim()||l)return;const h={id:v(),type:"user",content:r.trim(),timestamp:new Date};n(A=>[...A,h]),i(""),d(!0);try{const A=yield s.chat.sendMessage({message:r.trim(),model:o,ragEnabled:p,conversationId:w,systemContext:"You are AutoLlama's AI assistant. Use the knowledge base to provide helpful, accurate responses with source citations."}),b={id:v(),type:"assistant",content:A.content||A.message||"I apologize, but I encountered an issue processing your request.",timestamp:new Date,sources:A.sources||[],metadata:A.metadata||{}};n($=>[...$,b])}catch(A){const b={id:v(),type:"assistant",content:`I encountered an error: ${A.message||"Unable to process your request"}. Please try again or check your connection settings.`,timestamp:new Date,isError:!0};n($=>[...$,b])}finally{d(!1)}}),P=h=>{h.key==="Enter"&&!h.shiftKey&&(h.preventDefault(),C())},S=()=>{n([]),f(v()),y()},_=h=>{navigator.clipboard.writeText(h)},v=()=>Math.random().toString(36).substr(2,9);return e.jsxs("div",{className:"flex flex-col h-full max-h-[80vh] bg-gray-900 rounded-xl border border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700 bg-gray-800 bg-opacity-50 rounded-t-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-600 bg-opacity-20 rounded-lg flex items-center justify-center",children:e.jsx(Y,{className:"w-5 h-5 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-white",children:"AutoLlama Chat"}),e.jsx("p",{className:"text-sm text-gray-400",children:"RAG-powered AI assistant • Connected to your knowledge base"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-400",children:"RAG:"}),e.jsx("button",{onClick:()=>m(!p),className:`relative w-10 h-6 rounded-full transition-colors ${p?"bg-primary-600":"bg-gray-600"}`,children:e.jsx("div",{className:`absolute w-4 h-4 bg-white rounded-full top-1 transition-transform ${p?"translate-x-5":"translate-x-1"}`})})]}),e.jsxs("select",{value:o,onChange:h=>c(h.target.value),className:"bg-gray-700 border border-gray-600 rounded-md px-3 py-1 text-sm text-white",children:[e.jsx("option",{value:"gpt-4o-mini",children:"GPT-4o Mini"}),e.jsx("option",{value:"gpt-4o",children:"GPT-4o"}),e.jsx("option",{value:"gpt-3.5-turbo",children:"GPT-3.5 Turbo"})]}),e.jsx("button",{onClick:S,className:"p-2 hover:bg-gray-700 rounded-lg transition-colors",title:"Clear conversation",children:e.jsx(ba,{className:"w-4 h-4 text-gray-400"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar",children:[a.map(h=>e.jsx(Xi,{message:h,onCopy:()=>_(h.content)},h.id)),l&&e.jsxs("div",{className:"flex items-center gap-3 p-4",children:[e.jsx("div",{className:"w-8 h-8 bg-primary-600 bg-opacity-20 rounded-full flex items-center justify-center",children:e.jsx(ja,{className:"w-4 h-4 text-primary-400"})}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-400",children:[e.jsx(Ee,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"AutoLlama is thinking..."})]})]}),e.jsx("div",{ref:j})]}),e.jsxs("div",{className:"p-4 border-t border-gray-700 bg-gray-800 bg-opacity-30 rounded-b-xl",children:[e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx("div",{className:"flex-1 relative",children:e.jsx("textarea",{ref:k,value:r,onChange:h=>i(h.target.value),onKeyPress:P,placeholder:"Ask me anything about your processed documents...",className:"w-full bg-gray-700 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400 resize-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",rows:Math.min(Math.max(r.split(`
`).length,1),4),disabled:l})}),e.jsx("button",{onClick:C,disabled:!r.trim()||l,className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsx(Tn,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2 text-xs text-gray-500",children:[e.jsx("span",{children:"Press Enter to send, Shift+Enter for new line"}),e.jsxs("span",{className:`flex items-center gap-1 ${p?"text-green-400":"text-gray-500"}`,children:[e.jsx(Y,{className:"w-3 h-3"}),p?"RAG Active":"RAG Disabled"]})]})]})]})},Xi=({message:s,onCopy:t})=>{const a=s.type==="user",n=s.isError;return e.jsxs("div",{className:`flex gap-3 ${a?"flex-row-reverse":"flex-row"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${a?"bg-blue-600 bg-opacity-20":n?"bg-red-600 bg-opacity-20":"bg-primary-600 bg-opacity-20"}`,children:a?e.jsx(Pn,{className:"w-4 h-4 text-blue-400"}):e.jsx(ja,{className:`w-4 h-4 ${n?"text-red-400":"text-primary-400"}`})}),e.jsxs("div",{className:`flex-1 max-w-[80%] ${a?"text-right":"text-left"}`,children:[e.jsxs("div",{className:`inline-block p-4 rounded-2xl ${a?"bg-blue-600 bg-opacity-20 text-blue-100":n?"bg-red-600 bg-opacity-20 text-red-100 border border-red-500 border-opacity-30":"bg-gray-800 bg-opacity-50 text-gray-100"}`,children:[e.jsx("div",{className:"whitespace-pre-wrap leading-relaxed",children:s.content}),s.sources&&s.sources.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-600 border-opacity-50",children:[e.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Sources:"}),e.jsx("div",{className:"space-y-1",children:s.sources.map((r,i)=>e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx(Dt,{className:"w-3 h-3 text-gray-400"}),e.jsx("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 underline truncate max-w-xs",children:r.title||r.url}),r.score&&e.jsxs("span",{className:"text-gray-500",children:["(",Math.round(r.score*100),"%)"]})]},i))})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-gray-500",children:[e.jsx("span",{children:s.timestamp.toLocaleTimeString()}),e.jsx("button",{onClick:t,className:"hover:text-gray-300 transition-colors",title:"Copy message",children:e.jsx(Tt,{className:"w-3 h-3"})})]})]})]})},Yi=()=>{const{api:s,documents:t,systemStats:a}=te(),[n,r]=u.useState({totalQueries:0,averageResponseTime:0,knowledgeBaseSize:0,ragAccuracy:0}),[i,l]=u.useState(!0);u.useEffect(()=>{d()},[]);const d=()=>I(void 0,null,function*(){try{const p=yield s.chat.getStats();r(m=>R(R({},m),p))}catch(p){r({totalQueries:0,averageResponseTime:1.2,knowledgeBaseSize:(t==null?void 0:t.length)||0,ragAccuracy:92})}}),o=["Summarize the main points from my recent uploads","What topics do I have the most content about?","Find information about machine learning in my documents","What are the key insights from my research papers?","Show me content related to AI and automation"],c=p=>{l(!1)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(Ct,{title:"Knowledge Base",value:`${n.knowledgeBaseSize||(t==null?void 0:t.length)||0} docs`,icon:re,color:"text-blue-400",description:"Processed documents"}),e.jsx(Ct,{title:"RAG Accuracy",value:`${n.ragAccuracy||92}%`,icon:tt,color:"text-green-400",description:"Answer relevance"}),e.jsx(Ct,{title:"Response Time",value:`${n.averageResponseTime||1.2}s`,icon:je,color:"text-yellow-400",description:"Average speed"}),e.jsx(Ct,{title:"Total Queries",value:n.totalQueries||0,icon:Ze,color:"text-purple-400",description:"Chat sessions"})]}),i?e.jsx(el,{sampleQuestions:o,onQuestionSelect:c,onStartChat:()=>l(!1),knowledgeBaseSize:(t==null?void 0:t.length)||0}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsx(Zi,{})}),e.jsx("div",{className:"space-y-4",children:e.jsx(tl,{documents:t,onQuestionSelect:c,sampleQuestions:o})})]})]})},el=({sampleQuestions:s,onQuestionSelect:t,onStartChat:a,knowledgeBaseSize:n})=>e.jsxs("div",{className:"card text-center space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-20 h-20 bg-primary-600 bg-opacity-20 rounded-full flex items-center justify-center mx-auto",children:e.jsx(Y,{className:"w-10 h-10 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold mb-2",children:"AutoLlama RAG Chat"}),e.jsx("p",{className:"text-xl text-gray-400",children:"Your AI assistant powered by your processed documents"})]})]}),e.jsxs("div",{className:"bg-gray-800 bg-opacity-50 rounded-lg p-6 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3 mb-4",children:[e.jsx(re,{className:"w-6 h-6 text-blue-400"}),e.jsx("span",{className:"text-lg font-medium",children:"Knowledge Base Ready"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-400",children:n}),e.jsx("div",{className:"text-gray-400",children:"Documents"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-400",children:"RAG"}),e.jsx("div",{className:"text-gray-400",children:"Enhanced"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-400",children:"GPT-4o"}),e.jsx("div",{className:"text-gray-400",children:"Powered"})]})]})]}),e.jsxs("div",{className:"space-y-4 max-w-3xl mx-auto",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-300",children:"Try asking about:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:s.map((r,i)=>e.jsx("button",{onClick:()=>t(r),className:"p-4 bg-gray-800 bg-opacity-50 rounded-lg border border-gray-700 hover:border-primary-500 hover:bg-primary-600 hover:bg-opacity-10 transition-all text-left group",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ze,{className:"w-5 h-5 text-gray-400 group-hover:text-primary-400 mt-1 flex-shrink-0"}),e.jsxs("span",{className:"text-gray-300 group-hover:text-white text-sm",children:['"',r,'"']})]})},i))})]}),e.jsxs("button",{onClick:a,className:"btn-primary text-lg px-8 py-3",children:[e.jsx(Ze,{className:"w-5 h-5"}),"Start Chatting"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto text-sm",children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(Te,{className:"w-8 h-8 text-blue-400 mx-auto"}),e.jsx("h4",{className:"font-bold text-white",children:"Semantic Search"}),e.jsx("p",{className:"text-gray-400",children:"Find relevant information across all your documents using advanced vector search"})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(Y,{className:"w-8 h-8 text-green-400 mx-auto"}),e.jsx("h4",{className:"font-bold text-white",children:"Context-Aware"}),e.jsx("p",{className:"text-gray-400",children:"Responses include contextual understanding of your document relationships"})]}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(tt,{className:"w-8 h-8 text-purple-400 mx-auto"}),e.jsx("h4",{className:"font-bold text-white",children:"Source Citations"}),e.jsx("p",{className:"text-gray-400",children:"Every answer includes links to the source documents for verification"})]})]})]}),tl=({documents:s,onQuestionSelect:t,sampleQuestions:a})=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"font-bold mb-3 flex items-center gap-2",children:[e.jsx(je,{className:"w-4 h-4 text-yellow-400"}),"Quick Questions"]}),e.jsx("div",{className:"space-y-2",children:a.slice(0,3).map((n,r)=>e.jsxs("button",{onClick:()=>t(n),className:"w-full text-left p-2 text-sm bg-gray-800 bg-opacity-50 rounded-md hover:bg-gray-700 transition-colors",children:['"',n.substring(0,50),'..."']},r))})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"font-bold mb-3 flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-blue-400"}),"Recent Documents"]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto custom-scrollbar",children:s==null?void 0:s.slice(0,5).map((n,r)=>e.jsxs("div",{className:"p-2 bg-gray-800 bg-opacity-30 rounded-md",children:[e.jsx("div",{className:"font-medium text-white text-sm truncate",children:n.title||n.url||"Untitled"}),e.jsxs("div",{className:"text-xs text-gray-400",children:[n.chunkCount||0," chunks • ",n.contentType||"document"]})]},r))})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h4",{className:"font-bold mb-3 flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-primary-400"}),"RAG Features"]}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),e.jsx("span",{children:"Contextual embeddings active"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"}),e.jsx("span",{children:"Vector similarity search"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-400 rounded-full"}),e.jsx("span",{children:"Source citation included"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),e.jsx("span",{children:"Real-time knowledge base"})]})]})]})]}),Ct=({title:s,value:t,icon:a,color:n,description:r})=>e.jsxs("div",{className:"card text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-2",children:e.jsx(a,{className:`w-6 h-6 ${n}`})}),e.jsx("div",{className:`text-2xl font-bold ${n} mb-1`,children:t}),e.jsx("div",{className:"text-sm text-gray-400 mb-1",children:s}),e.jsx("div",{className:"text-xs text-gray-500",children:r})]}),Ya=u.createContext(),te=()=>{const s=u.useContext(Ya);if(!s)throw new Error("useAppContext must be used within AppProvider");return s};if(typeof window!="undefined"){const s=window.onerror;window.onerror=function(t,a,n,r,i){return t&&t.includes("severity")?!0:s?s.call(this,t,a,n,r,i):!1}}function sl(){var qe,D;const[s,t]=u.useState("dashboard"),[a,n]=u.useState(null),[r,i]=u.useState(null),[l,d]=u.useState([]),[o,c]=u.useState(0),[p,m]=u.useState(!1),[w,f]=u.useState([]),[j,k]=u.useState({}),[x,y]=u.useState(""),[C,P]=u.useState([]),[S,_]=u.useState([]),v=Ln(),h=ds(),A=Aa("/api/stream",{onMessage:g=>{b(g)},onError:g=>{}}),b=g=>{switch(g.type||g.step){case"connection":break;case"system_update":g.data&&(h.utils.invalidateCache.stats(),k(N=>{var M,O,B,K,me,ct,$e,ys,bs,js;return L(R({},N),{database:L(R({},N.database),{status:((M=g.data.database)==null?void 0:M.status)||"unknown",healthy:((O=g.data.database)==null?void 0:O.healthy)||!1}),knowledgeBase:L(R({},N.knowledgeBase),{qdrant_status:((B=g.data.qdrant)==null?void 0:B.status)==="connected"?"active":"inactive",total_documents:((K=g.data.qdrant)==null?void 0:K.documents)||((me=N.knowledgeBase)==null?void 0:me.total_documents)||0,total_chunks:((ct=g.data.qdrant)==null?void 0:ct.chunks)||(($e=N.knowledgeBase)==null?void 0:$e.total_chunks)||0,contextual_documents:((ys=N.knowledgeBase)==null?void 0:ys.contextual_documents)||0}),processing:{activeSessions:((bs=g.data.processing)==null?void 0:bs.activeSessions)||0,totalProcessing:((js=g.data.processing)==null?void 0:js.totalProcessing)||0},lastUpdated:new Date})}),setTimeout(()=>{h.stats.getKnowledgeBase().then(N=>{k(M=>L(R({},M),{knowledgeBase:R(R({},M.knowledgeBase),N)}))}).catch(N=>{})},100));break;case"processing_progress":se(g.sessionId,g.progress);break;case"chunk_update":Q(g.chunkId,g.status);break;case"system_stats":k(N=>R(R({},N),g.stats));break;case"document_created":h.utils.invalidateCache.all(),H(),q(),setTimeout(()=>{h.utils.invalidateCache.all(),H()},500);break;case"processing_complete":case"file_processing_complete":case"session_complete":case"content_processed":h.utils.invalidateCache.all(),H(),q(),setTimeout(()=>{H()},2e3);break;case"chunk_processing_complete":g.chunkData&&g.chunkData.currentChunk===g.chunkData.totalChunks&&(h.utils.invalidateCache.all(),q(),H());break}};u.useEffect(()=>{$(),E(),setTimeout(()=>{q()},2e3)},[]),u.useEffect(()=>{var T;if(S.some(N=>N.status==="processing"||N.status==="uploading")||((T=j.processing)==null?void 0:T.totalProcessing)>0){const N=setInterval(()=>{h.utils.invalidateCache.stats(),h.utils.invalidateCache.all(),H(),q()},3e3);return()=>{clearInterval(N)}}else{const N=setInterval(()=>{h.utils.invalidateCache.all(),q(),H()},5e3);return()=>{clearInterval(N)}}},[S,(qe=j.processing)==null?void 0:qe.totalProcessing]),u.useEffect(()=>{const g=setInterval(()=>{h.utils.invalidateCache.stats(),H()},2e3);return()=>{clearInterval(g)}},[]),u.useEffect(()=>{const g=T=>{var M;if(S.some(O=>O.status==="processing"||O.status==="uploading")||((M=j.processing)==null?void 0:M.totalProcessing)>0){const O="Processing is currently active. Refreshing the page will interrupt the upload/processing. Are you sure you want to continue?";return T.preventDefault(),T.returnValue=O,O}};return window.addEventListener("beforeunload",g),()=>{window.removeEventListener("beforeunload",g)}},[S,(D=j.processing)==null?void 0:D.totalProcessing]);const $=()=>I(this,null,function*(){try{h.utils.invalidateCache.all(),yield Promise.all([q(),H(),W()])}catch(g){}}),E=()=>{try{const g=localStorage.getItem("autollama_upload_sessions");g&&JSON.parse(g).forEach(N=>{(N.status==="processing"||N.status==="uploading")&&(Z(L(R({},N),{status:"reconnecting",reconnected:!0})),U(N.sessionId))})}catch(g){localStorage.removeItem("autollama_upload_sessions")}},U=g=>I(this,null,function*(){try{const T=yield fetch(`/api/upload-session/${g}`);if(T.ok){const N=yield T.json();if(N.status==="processing"){F(g,"processing");const M=new EventSource(`/api/session-stream/${g}`);M.onmessage=O=>{const B=JSON.parse(O.data);b(B)},M.onerror=()=>{F(g,"failed")}}else F(g,N.status),N.status==="completed"&&(q(),H())}else F(g,"failed")}catch(T){F(g,"failed")}}),W=()=>I(this,null,function*(){try{const g=yield fetch("/api/cleanup-status");if(g.ok){const T=yield g.json();if(T.success&&T.current_stuck_sessions>0&&window.confirm(`Found ${T.current_stuck_sessions} interrupted processing session(s). Would you like to clean them up and allow new uploads?`)){const M=yield fetch("/api/cleanup-sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({threshold:5})});if(M.ok){const O=yield M.json()}}}}catch(g){}}),q=u.useCallback((g=!1)=>I(this,null,function*(){var T,N;try{h.utils.invalidateCache.all();const M=Math.max(40,((N=(T=v.settings)==null?void 0:T.ui)==null?void 0:N.documentsPerPage)||20),O=yield h.documents.getAll({limit:M,offset:0}),B=(O==null?void 0:O.documents)||[];B.slice(0,5).forEach((K,me)=>{}),f(B)}catch(M){}}),[]),H=u.useCallback(()=>I(this,null,function*(){try{h.utils.invalidateCache.stats();const[g,T,N]=yield Promise.all([h.stats.getKnowledgeBase(),h.stats.getDatabase(),h.stats.getHealth()]);k({knowledgeBase:g,database:T,health:N,lastUpdated:new Date})}catch(g){}}),[]),se=(g,T)=>{f(N=>N.map(M=>M.sessionId===g?L(R({},M),{processingProgress:T}):M))},Q=(g,T)=>{a&&n(N=>{var M;return L(R({},N),{chunks:((M=N.chunks)==null?void 0:M.map(O=>O.chunk_id===g?L(R({},O),{status:T}):O))||[]})})},Z=g=>{const T=g.map(N=>({id:ue(),file:N,name:N.name,size:N.size,type:N.type,status:"pending",progress:0,error:null,sessionId:null,timestamp:new Date}));return _(N=>[...N,...T]),T},F=(g,T)=>{_(N=>{const M=N.map(O=>O.id===g?R(R({},O),T):O);return ae(M),M})},ae=g=>{try{const T=g.filter(N=>N.status==="processing"||N.status==="uploading").map(N=>({id:N.id,name:N.name,size:N.size,type:N.type,status:N.status,progress:N.progress,sessionId:N.sessionId,timestamp:N.timestamp}));localStorage.setItem("autollama_upload_sessions",JSON.stringify(T))}catch(T){}},ee=g=>{_(T=>T.filter(N=>N.id!==g))},oe=()=>{_(g=>g.filter(T=>T.status!=="completed"))},ue=()=>Math.random().toString(36).substr(2,9),Ie=g=>I(this,null,function*(){if(n(g),t("document"),!g.chunks)try{const T=btoa(g.url),N=yield h.documents.getChunks(T,{limit:1e3});n(M=>L(R({},M),{chunks:(N==null?void 0:N.chunks)||[]}))}catch(T){}}),Oe=()=>{t("dashboard"),n(null),i(null),d([]),c(0)},nt=(g,T=[],N=0)=>{i(g),d(T),c(N+1)},rt=g=>{g>=1&&g<=l.length&&(c(g),i(l[g-1]))},it=g=>{y(g),g.trim()&&s!=="search"&&t("search"),!g.trim()&&s==="search"&&t("dashboard")},lt={currentView:s,selectedDocument:a,selectedChunk:r,selectedChunks:l,chunkIndex:o,showSettings:p,documents:w,systemStats:j,searchQuery:x,searchResults:C,uploadQueue:S,settings:v.settings,connectionStatus:v.connectionStatus,updateSetting:v.updateSetting,updateCategory:v.updateCategory,api:h,sse:A,setCurrentView:t,setShowSettings:m,handleDocumentSelect:Ie,handleBackToDashboard:Oe,handleChunkSelect:nt,handleChunkNavigate:rt,handleSearchQueryChange:it,refreshDocuments:q,loadSystemStats:H,addToUploadQueue:Z,updateUploadStatus:F,removeFromUploadQueue:ee,clearCompletedUploads:oe};return e.jsx(Ya.Provider,{value:lt,children:e.jsx(nn,{children:e.jsxs("div",{className:"min-h-screen bg-gray-900 text-white bg-pattern",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 opacity-50"}),e.jsx("div",{className:"relative z-10",children:e.jsxs(rn,{children:[e.jsx(He,{path:"/",element:e.jsx(At,{})}),e.jsx(He,{path:"/dashboard",element:e.jsx(At,{})}),e.jsx(He,{path:"/document/:id",element:e.jsx(At,{})}),e.jsx(He,{path:"/search",element:e.jsx(At,{})}),e.jsx(He,{path:"*",element:e.jsx(ln,{to:"/",replace:!0})})]})}),p&&e.jsx(xr,{}),e.jsx(nl,{})]})})})}const At=()=>{const{currentView:s,showSettings:t,setShowSettings:a}=te();return e.jsxs("div",{className:"w-full max-w-7xl mx-auto p-4 md:p-8",children:[e.jsx(al,{}),e.jsxs("main",{className:"mt-8",children:[s==="dashboard"&&e.jsx(nr,{}),s==="document"&&e.jsx(Sr,{}),s==="search"&&e.jsx(ur,{}),s==="processing"&&e.jsx(Gi,{}),s==="chat"&&e.jsx(Yi,{})]})]})},al=()=>{const{searchQuery:s,handleSearchQueryChange:t,setShowSettings:a,setCurrentView:n,systemStats:r,sse:i}=te();return e.jsxs("header",{className:"text-center mb-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold mb-2 flex items-center justify-center gap-3",children:e.jsxs("button",{onClick:()=>n("dashboard"),className:"flex items-center gap-3 hover:opacity-80 transition-opacity cursor-pointer bg-transparent border-none",children:[e.jsx("span",{className:"text-6xl animate-bounce-gentle",children:"🦙"}),e.jsx("span",{className:"text-gradient",children:"AutoLlama.io"})]})}),e.jsx("p",{className:"text-xl text-gray-400",children:"The Digital Pasture"}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-2 text-sm text-gray-500",children:[e.jsx("span",{children:"v2.0 Context Llama"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${i.isConnected?"bg-green-400":"bg-red-400"}`}),i.isConnected?"Connected":"Disconnected"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-4",children:[e.jsxs("div",{className:"relative w-full sm:w-80",children:[e.jsx(Te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search documents, chunks, topics...",value:s,onChange:l=>t(l.target.value),className:"input-primary pl-10"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>n("chat"),className:"btn-primary",children:[e.jsx(Ze,{className:"w-5 h-5"}),"AI Chat"]}),e.jsxs("button",{onClick:()=>n("processing"),className:"btn-secondary",children:[e.jsx(re,{className:"w-5 h-5"}),"Process"]}),e.jsx("button",{onClick:()=>a(!0),className:"btn-secondary",title:"Settings",children:e.jsx(Mt,{className:"w-5 h-5"})})]})]})]})},nl=()=>{const{systemStats:s,sse:t}=te();return e.jsxs("footer",{className:"text-center p-4 text-xs text-gray-500 relative z-10 border-t border-gray-800 mt-16",children:[e.jsxs("div",{className:"flex flex-wrap justify-center items-center gap-4",children:[e.jsx("span",{children:"Connected to Qdrant & PostgreSQL"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:"OpenAI Model: gpt-4o-mini"}),e.jsx("span",{children:"•"}),e.jsxs("span",{className:"flex items-center gap-1",children:["Real-time Updates",e.jsx("span",{className:"text-yellow-400",children:"⚡"})]}),e.jsx("span",{children:"•"}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${t.isConnected?"bg-green-400":"bg-red-400"}`}),t.isConnected?"Live":"Offline"]})]}),s.lastUpdated&&e.jsxs("div",{className:"mt-2 text-gray-600",children:["Last updated: ",s.lastUpdated.toLocaleTimeString()]})]})};Zt.createRoot(document.getElementById("root")).render(e.jsx(ma.StrictMode,{children:e.jsx(sl,{})}));export{e as j,te as u};
